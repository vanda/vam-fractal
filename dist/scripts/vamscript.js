!function n(o,r,s){function a(t,e){if(!r[t]){if(!o[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=r[t]={exports:{}},o[t][0].call(i.exports,function(e){return a(o[t][1][e]||e)},i,i.exports,n,o,r,s)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,c){c.defaults={},c.set=function(e,t,i){var i=i||{},n=c.defaults,o=i.expires||n.expires,r=i.domain||n.domain,s=void 0!==i.path?i.path:void 0!==n.path?n.path:"/",a=(void 0!==i.secure?i:n).secure,l=(void 0!==i.httponly?i:n).httponly,i=(void 0!==i.samesite?i:n).samesite,n=o?new Date("number"==typeof o?(new Date).getTime()+864e5*o:o):0;document.cookie=e.replace(/[^+#$&^`|]/g,encodeURIComponent).replace("(","%28").replace(")","%29")+"="+t.replace(/[^+#$&/:<-\[\]-}]/g,encodeURIComponent)+(n&&0<=n.getTime()?";expires="+n.toUTCString():"")+(r?";domain="+r:"")+(s?";path="+s:"")+(a?";secure":"")+(l?";httponly":"")+(i?";samesite="+i:"")},c.get=function(e){for(var t=document.cookie.split(";");t.length;){var i=t.pop(),n=(n=i.indexOf("="))<0?i.length:n;if(decodeURIComponent(i.slice(0,n).replace(/^\s+/,""))===e)return decodeURIComponent(i.slice(n+1))}return null},c.erase=function(e,t){c.set(e,"",{expires:-1,domain:t&&t.domain,path:t&&t.path,secure:0,httponly:0})},c.all=function(){for(var e={},t=document.cookie.split(";");t.length;){var i=t.pop(),n=(n=i.indexOf("="))<0?i.length:n;e[decodeURIComponent(i.slice(0,n).replace(/^\s+/,""))]=decodeURIComponent(i.slice(n+1))}return e}},{}],2:[function(e,t,i){var n,o;n=this,o=function(){return function(n,e){e=e||{};var o,i=window,r={clamp:e.clamp||2,useNativeClamp:void 0===e.useNativeClamp||e.useNativeClamp,splitOnChars:e.splitOnChars||[".","-","–","—"," "],animate:e.animate||!1,truncationChar:e.truncationChar||"…",truncationHTML:e.truncationHTML},e=n.style,t=n.innerHTML,s=void 0!==n.style.webkitLineClamp,a=r.clamp,l=a.indexOf&&(-1<a.indexOf("px")||-1<a.indexOf("em"));function c(e,t){return i.getComputedStyle||(i.getComputedStyle=function(i,e){return this.el=i,this.getPropertyValue=function(e){var t=/(\-([a-z]){1})/g;return t.test(e="float"==e?"styleFloat":e)&&(e=e.replace(t,function(){return arguments[2].toUpperCase()})),i.currentStyle&&i.currentStyle[e]?i.currentStyle[e]:null},this}),i.getComputedStyle(e,null).getPropertyValue(t)}function u(e){var e=e||n.clientHeight,t=h(n);return Math.max(Math.floor(e/t),0)}function h(e){var t=c(e,"line-height");return"normal"==t&&(t=1.2*parseInt(c(e,"font-size"))),parseInt(t)}r.truncationHTML&&((o=document.createElement("span")).innerHTML=r.truncationHTML);var d,p,m,g=r.splitOnChars.slice(0),v=g[0];function f(e){return e.lastChild.children&&0<e.lastChild.children.length?f(Array.prototype.slice.call(e.children).pop()):e.lastChild&&e.lastChild.nodeValue&&""!==e.lastChild.nodeValue&&e.lastChild.nodeValue!=r.truncationChar?e.lastChild:(e.lastChild.parentNode.removeChild(e.lastChild),f(n))}function y(e,t){if(t){var i=e.nodeValue.replace(r.truncationChar,"");if(d||(v=0<g.length?g.shift():"",d=i.split(v)),1<d.length?(p=d.pop(),b(e,d.join(v))):d=null,o&&(e.nodeValue=e.nodeValue.replace(r.truncationChar,""),n.innerHTML=e.nodeValue+" "+o.innerHTML+r.truncationChar),d){if(n.clientHeight<=t){if(!(0<=g.length&&""!==v))return n.innerHTML;b(e,d.join(v)+v+p),d=null}}else""===v&&(b(e,""),e=f(n),g=r.splitOnChars.slice(0),v=g[0],p=d=null);if(!r.animate)return y(e,t);setTimeout(function(){y(e,t)},!0===r.animate?10:r.animate)}}function b(e,t){e.nodeValue=t+r.truncationChar}return"auto"==a?a=u():l&&(a=u(parseInt(a))),s&&r.useNativeClamp?(e.overflow="hidden",e.textOverflow="ellipsis",e.webkitBoxOrient="vertical",e.display="-webkit-box",e.webkitLineClamp=a,l&&(e.height=r.clamp+"px")):(s=a,(l=h(n)*s)<=n.clientHeight&&(m=y(f(n),l))),{original:t,clamped:m}}},"function"==typeof define&&define.amd?define([],o):"object"==typeof i?t.exports=o():n.$clamp=o()},{}],3:[function(M,z,B){function c(e){return new c.Viewer(e)}(n=c).version={versionStr:"3.1.0",major:parseInt("3",10),minor:parseInt("1",10),revision:parseInt("0",10)},N={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},F=Object.prototype.toString,q=Object.prototype.hasOwnProperty,n.isFunction=function(e){return"function"===n.type(e)},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},n.type=function(e){return null==e?String(e):N[F.call(e)]||"object"},n.isPlainObject=function(e){if(!e||"object"!==c.type(e)||e.nodeType||n.isWindow(e))return!1;if(e.constructor&&!q.call(e,"constructor")&&!q.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t,i;for(i in e)t=i;return void 0===t||q.call(e,t)},n.isEmptyObject=function(e){for(var t in e)return!1;return!0},n.freezeObject=function(e){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(e){return e},n.freezeObject(e)},n.supportsCanvas=(j=document.createElement("canvas"),!(!n.isFunction(j.getContext)||!j.getContext("2d"))),n.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},n.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),n.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),n.supportsEventListenerOptions=function(){var t=0;if(n.supportsAddEventListener)try{var e={get capture(){return t++,!1},get once(){return t++,!1},get passive(){return t++,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=0}return 3<=t}(),n.getCurrentPixelDensityRatio=function(){var e,t;return n.supportsCanvas?(t=document.createElement("canvas").getContext("2d"),e=window.devicePixelRatio||1,t=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,Math.max(e,1)/t):1},n.pixelDensityRatio=n.getCurrentPixelDensityRatio();var n,N,F,q,j,W,e,U,u,V,G,Z,X,K,h,Y,o,r,g,d,J,a,$,Q,s,p,m,v,ee,te,ie,l,f,ne,y,oe,b,w,re,se,_,ae,x,S,T,E,P,le,C,R,k=c;function ce(e){}k.extend=function(){var e,t,i,n,o,r=arguments[0]||{},s=arguments.length,a=!1,l=1;for("boolean"==typeof r&&(a=r,r=arguments[1]||{},l=2),"object"==typeof r||c.isFunction(r)||(r={}),s===l&&(r=this,--l);l<s;l++)if(null!==(e=arguments[l])||void 0!==e)for(t in e)o=r[t],r!==(i=e[t])&&(a&&i&&(c.isPlainObject(i)||(n=c.isArray(i)))?(o=n?(n=!1,o&&c.isArray(o)?o:[]):o&&c.isPlainObject(o)?o:{},r[t]=c.extend(a,o,i)):void 0!==i&&(r[t]=i));return r},k.extend(k,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(t,i){return function(){var e=arguments;return i.apply(t,e=void 0===e?[]:e)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(e){return k._viewers.get(this.getElement(e))},getElement:function(e){return e="string"==typeof e?document.getElementById(e):e},getElementPosition:function(e){for(var t,i=new k.Point,n=Te(e=k.getElement(e),t="fixed"===k.getElementStyle(e).position);n;)i.x+=e.offsetLeft,i.y+=e.offsetTop,t&&(i=i.plus(k.getPageScroll())),n=Te(e=n,t="fixed"===k.getElementStyle(e).position);return i},getElementOffset:function(e){var t,i=(e=k.getElement(e))&&e.ownerDocument,n={top:0,left:0};return i?(t=i.documentElement,void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),e=i===i.window?i:9===i.nodeType&&(i.defaultView||i.parentWindow),new k.Point(n.left+(e.pageXOffset||t.scrollLeft)-(t.clientLeft||0),n.top+(e.pageYOffset||t.scrollTop)-(t.clientTop||0))):new k.Point},getElementSize:function(e){return e=k.getElement(e),new k.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=k.getElement(e)).currentStyle}:function(e){return e=k.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var a={};return k.getCssPropertyWithVendorPrefix=function(e){if(void 0!==a[e])return a[e];var t=document.createElement("div").style,i=null;if(void 0!==t[e])i=e;else for(var n=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=k.capitalizeFirstLetter(e),r=0;r<n.length;r++){var s=n[r]+o;if(void 0!==t[s]){i=s;break}}return a[e]=i},k.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){e%=t;return e<0&&(e+=t),e},pointInElement:function(e,t){e=k.getElement(e);var i=k.getElementOffset(e),e=k.getElementSize(e);return t.x>=i.x&&t.x<i.x+e.x&&t.y<i.y+e.y&&t.y>=i.y},getMousePosition:function(e){if("number"==typeof e.pageX)k.getMousePosition=function(e){var t=new k.Point;return t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");k.getMousePosition=function(e){var t=new k.Point;return t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return k.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)k.getPageScroll=function(){return new k.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)k.getPageScroll=function(){return new k.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new k.Point(0,0);k.getPageScroll=function(){return new k.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return k.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)k.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=k.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=k.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void(k.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=k.getPageScroll()).x!==t.x&&i.y!==t.y)return void(k.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});k.setPageScroll=function(e){}}k.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)k.getWindowSize=function(){return new k.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)k.getWindowSize=function(){return new k.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");k.getWindowSize=function(){return new k.Point(document.body.clientWidth,document.body.clientHeight)}}return k.getWindowSize()},makeCenteredNode:function(e){e=k.getElement(e);var t=[k.makeNeutralElement("div"),k.makeNeutralElement("div"),k.makeNeutralElement("div")];return k.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),k.extend(t[1].style,{display:"table-row"}),k.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var e=document.createElement(e),t=e.style;return t.background="transparent none",t.border="none",t.margin="0px",t.padding="0px",t.position="static",e},now:function(){return Date.now?k.now=Date.now:k.now=function(){return(new Date).getTime()},k.now()},makeTransparentImage:function(e){var t=k.makeNeutralElement("img");return t.src=e,t},setElementOpacity:function(e,t,i){e=k.getElement(e),i&&!k.Browser.alpha&&(t=Math.round(t)),k.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(i=Math.round(100*t),e.style.filter="alpha(opacity="+i+")"):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=k.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},setElementPointerEvents:function(e,t){void 0!==(e=k.getElement(e)).style&&void 0!==e.style.pointerEvents&&(e.style.pointerEvents=t)},setElementPointerEventsNone:function(e){k.setElementPointerEvents(e,"none")},addClass:function(e,t){(e=k.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,o,i=i||0;if(!e)throw new TypeError;if(!(0===(o=e.length)||o<=i))for(n=i=i<0?o-Math.abs(i):i;n<o;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){for(var i=[],n=(e=k.getElement(e)).className.split(/\s+/),o=0;o<n.length;o++)n[o]&&n[o]!==t&&i.push(n[o]);e.className=i.join(" ")},normalizeEventListenerOptions:function(e){e=void 0!==e?"boolean"==typeof e?k.supportsEventListenerOptions?{capture:e}:e:k.supportsEventListenerOptions?e:void 0!==e.capture&&e.capture:!!k.supportsEventListenerOptions&&{capture:!1};return e},addEvent:function(){if(k.supportsAddEventListener)return function(e,t,i,n){n=k.normalizeEventListenerOptions(n),(e=k.getElement(e)).addEventListener(t,i,n)};if(document.documentElement.attachEvent&&document.attachEvent)return function(e,t,i){(e=k.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(k.supportsRemoveEventListener)return function(e,t,i,n){n=k.normalizeEventListenerOptions(n),(e=k.getElement(e)).removeEventListener(t,i,n)};if(document.documentElement.detachEvent&&document.detachEvent)return function(e,t,i){(e=k.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){e.preventDefault()},eventIsCanceled:function(e){return e.defaultPrevented},stopEvent:function(e){e.stopPropagation()},createCallback:function(i,n){for(var o=[],e=2;e<arguments.length;e++)o.push(arguments[e]);return function(){for(var e=o.concat([]),t=0;t<arguments.length;t++)e.push(arguments[t]);return n.apply(i,e)}},getUrlParameter:function(e){e=fe[e];return e||null},getUrlProtocol:function(e){e=e.match(/^([a-z]+:)\/\//i);return null===e?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?k.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:k.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");k.createAjaxRequest=function(){return new XMLHttpRequest}}return k.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){k.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,o=e.headers,r=e.responseType||null,s=e.postData||null,e=e.url);var n,o,r,s,a=k.getUrlProtocol(e),l=k.createAjaxRequest("file:"===a);if(!k.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");l.onreadystatechange=function(){4===l.readyState&&(l.onreadystatechange=function(){},200<=l.status&&l.status<300||0===l.status&&"http:"!==a&&"https:"!==a?t(l):k.isFunction(i)?i(l):k.console.error("AJAX request returned %d: %s",l.status,e))};var c=s?"POST":"GET";try{if(l.open(c,e,!0),r&&(l.responseType=r),o)for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&o[u]&&l.setRequestHeader(u,o[u]);n&&(l.withCredentials=!0),l.send(s)}catch(e){k.console.error("%s while making AJAX request: %s",e.name,e.message),l.onreadystatechange=function(){},k.isFunction(i)&&i(l,e)}return l},jsonp:function(e){var i,t=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,o=e.callbackName||"openseadragon"+k.now(),r=window[o],s=e.param||"callback",a=e.callback,t=t.replace(/(=)\?(&|$)|\?\?/i,"$1"+o+"$2");t+=(/\?/.test(t)?"&":"?")+s+"="+o,window[o]=function(e){if(r)window[o]=r;else try{delete window[o]}catch(e){}a&&k.isFunction(a)&&a(e)},i=document.createElement("script"),void 0===e.async&&!1===e.async||(i.async="async"),e.scriptCharset&&(i.charset=e.scriptCharset),i.src=t,i.onload=i.onreadystatechange=function(e,t){!t&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=void 0)},n.insertBefore(i,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)k.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");k.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return k.parseXml(e)},parseJSON:function(e){return k.parseJSON=window.JSON.parse,k.parseJSON(e)},imageFormatSupported:function(e){return!!ve[(e=e||"").toLowerCase()]},setImageFormatsSupported:function(e){k.extend(ve,e)}}),k.console=window.console||{log:ce,debug:ce,info:ce,warn:ce,error:ce,assert:ce};var t,ue,he,de,pe,me,ge,ve={bmp:!(k.Browser={vendor:k.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},fe={},ye=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(k.Browser.vendor=k.BROWSERS.IE,k.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=i.indexOf("Edge")?(k.Browser.vendor=k.BROWSERS.EDGE,k.Browser.version=parseFloat(i.substring(i.indexOf("Edge")+5))):0<=i.indexOf("Edg")?(k.Browser.vendor=k.BROWSERS.CHROMEEDGE,k.Browser.version=parseFloat(i.substring(i.indexOf("Edg")+4))):0<=i.indexOf("Firefox")?(k.Browser.vendor=k.BROWSERS.FIREFOX,k.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):0<=i.indexOf("Safari")?(k.Browser.vendor=0<=i.indexOf("Chrome")?k.BROWSERS.CHROME:k.BROWSERS.SAFARI,k.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(i)&&(k.Browser.vendor=k.BROWSERS.IE,k.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":k.Browser.vendor=k.BROWSERS.OPERA,k.Browser.version=parseFloat(ye)}for(var be,we=window.location.search.substring(1).split("&"),_e=0;_e<we.length;_e++)if(0<(be=(Se=we[_e]).indexOf("="))){var xe=Se.substring(0,be),Se=Se.substring(be+1);try{fe[xe]=decodeURIComponent(Se)}catch(e){k.console.error("Ignoring malformed URL parameter: %s=%s",xe,Se)}}function Te(e,t){return t&&e!==document.body?document.body:e.offsetParent}function Ee(e){try{return e.addEventListener&&e.removeEventListener}catch(e){}}function Pe(e,t){return e.hash.toString()+t.type+t.id.toString()}function Ce(){var e,t,i,n,o=V.length,r=u.now(),s=r-Z;for(Z=r,e=0;e<o;e++)(i=(t=V[e]).gPoint).direction=Math.atan2(i.currentPos.y-t.lastPos.y,i.currentPos.x-t.lastPos.x),n=t.lastPos.distanceTo(i.currentPos),t.lastPos=i.currentPos,i.speed=.75*(1e3*n/(1+s))+.25*i.speed}function Re(e){for(var t,i,n,o,r=h[e.hash],s=r.activePointersLists.length,a=0;a<s;a++)if(0<(i=r.activePointersLists[a]).getLength()){for(o=[],n=i.asArray(),t=0;t<n.length;t++)o.push(n[t]);for(t=0;t<o.length;t++)Xe(e,i,o[t])}for(a=0;a<s;a++)r.activePointersLists.pop();r.sentDragEvent=!1}function ke(e){var t,i,n=h[e.hash];if(n.tracking){for(i=0;i<u.MouseTracker.subscribeEvents.length;i++)t=u.MouseTracker.subscribeEvents[i],u.removeEvent(e.element,t,n[t],!1);Re(e),n.tracking=!1}}function Le(e,t){e=h[e.hash];if("pointerevent"===t)return{upName:"pointerup",upHandler:e.pointerupcaptured,moveName:"pointermove",moveHandler:e.pointermovecaptured};if("mouse"===t)return{upName:"pointerup",upHandler:e.pointerupcaptured,moveName:"pointermove",moveHandler:e.pointermovecaptured};if("touch"===t)return{upName:"touchend",upHandler:e.touchendcaptured,moveName:"touchmove",moveHandler:e.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function De(e,t){var i;if(u.MouseTracker.havePointerCapture)if(u.MouseTracker.havePointerEvents){if(!(i=e.getActivePointersListByType(t.type).getById(t.id))||!i.captured)return;try{e.element.releasePointerCapture(t.id)}catch(e){}}else e.element.releaseCapture();else i=Le(e,u.MouseTracker.havePointerEvents?"pointerevent":t.type),Y&&Ee(window.top)&&u.removeEvent(window.top,i.upName,i.upHandler,!0),u.removeEvent(u.MouseTracker.captureElement,i.moveName,i.moveHandler,!0),u.removeEvent(u.MouseTracker.captureElement,i.upName,i.upHandler,!0);Ke(e,t,!1)}function Ie(e){return u.MouseTracker.havePointerEvents?e.pointerId:u.MouseTracker.mousePointerId}function L(e){return u.MouseTracker.havePointerEvents?e.pointerType||(u.Browser.vendor===u.BROWSERS.IE?"mouse":""):"mouse"}function Ae(e){return!u.MouseTracker.havePointerEvents||e.isPrimary}function D(e){return u.getMousePosition(e)}function Oe(e,t){return I(D(e),t)}function I(e,t){t=u.getElementOffset(t);return e.minus(t)}function He(e,t){return new u.Point((e.x+t.x)/2,(e.y+t.y)/2)}function Me(e,t){var i={target:t.target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX||t.clientX,pageY:t.pageY||t.clientY,deltaMode:"MozMousePixelScroll"===t.type?0:1,deltaX:0,deltaZ:0};"mousewheel"===u.MouseTracker.wheelEventName?i.deltaY=-t.wheelDelta/u.DEFAULT_SETTINGS.pixelsPerWheelLine:i.deltaY=t.detail,ze(e,i,t)}function ze(e,t,i){var n=null,o=t.deltaY<0?1:-1,r={originalEvent:t,eventType:"wheel",pointerType:"mouse",isEmulated:t!==i};A(e,r),!e.scrollHandler||r.preventGesture||r.defaultPrevented||(n={eventSource:e,pointerType:"mouse",position:Oe(t,e.element),scroll:o,shift:t.shiftKey,isTouchEvent:!1,originalEvent:i,preventDefault:r.preventDefault||r.defaultPrevented,userData:e.userData},e.scrollHandler(n)),r.stopPropagation&&u.stopEvent(i),(n&&n.preventDefault||r.preventDefault&&!r.defaultPrevented)&&u.cancelEvent(i)}function Be(e,t){var i={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},t={originalEvent:t,eventType:"pointerenter",pointerType:i.type,isEmulated:!1};A(e,t),Ye(e,t,i)}function Ne(e,t){var i={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},t={originalEvent:t,eventType:"pointerleave",pointerType:i.type,isEmulated:!1};A(e,t),Je(e,t,i)}function Fe(e,t){var i,n,o={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},r={originalEvent:t,eventType:"pointerover",pointerType:o.type,isEmulated:!1},s=(A(e,r),r);i=e.getActivePointersListByType(o.type),(n=i.getById(o.id))?o=n:(o.captured=!1,o.insideElementPressed=!1),e.overHandler&&e.overHandler({eventSource:e,pointerType:o.type,position:I(o.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==i.buttons,isTouchEvent:"touch"===o.type,originalEvent:s.originalEvent,userData:e.userData}),r.preventDefault&&!r.defaultPrevented&&u.cancelEvent(t),r.stopPropagation&&u.stopEvent(t)}function qe(e,t){var i,n,o={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},r={originalEvent:t,eventType:"pointerout",pointerType:o.type,isEmulated:!1},s=(A(e,r),r);i=e.getActivePointersListByType(o.type),(n=i.getById(o.id))?o=n:(o.captured=!1,o.insideElementPressed=!1),e.outHandler&&e.outHandler({eventSource:e,pointerType:o.type,position:o.currentPos&&I(o.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==i.buttons,isTouchEvent:"touch"===o.type,originalEvent:s.originalEvent,userData:e.userData}),r.preventDefault&&!r.defaultPrevented&&u.cancelEvent(t),r.stopPropagation&&u.stopEvent(t)}function je(e,t){var i={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},n=u.MouseTracker.havePointerEvents&&"touch"===i.type&&u.Browser.vendor!==u.BROWSERS.IE,o={originalEvent:t,eventType:"pointerdown",pointerType:i.type,isEmulated:!1};if(A(e,o),$e(e,o,i,t.button),o.preventDefault&&!o.defaultPrevented&&u.cancelEvent(t),o.stopPropagation&&u.stopEvent(t),o.shouldCapture)if(n)Ke(e,i,!0);else{t=e,o=i;if(u.MouseTracker.havePointerCapture)if(u.MouseTracker.havePointerEvents)try{t.element.setPointerCapture(o.id)}catch(e){return void u.console.warn("setPointerCapture() called on invalid pointer ID")}else t.element.setCapture(!0);else n=Le(t,u.MouseTracker.havePointerEvents?"pointerevent":o.type),Y&&Ee(window.top)&&u.addEvent(window.top,n.upName,n.upHandler,!0),u.addEvent(u.MouseTracker.captureElement,n.upName,n.upHandler,!0),u.addEvent(u.MouseTracker.captureElement,n.moveName,n.moveHandler,!0);Ke(t,o,!0)}}function We(e,t){Ue(e,t)}function Ue(e,t){var i={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},n={originalEvent:t,eventType:"pointerup",pointerType:i.type,isEmulated:!1};A(e,n),Qe(e,n,i,t.button),n.preventDefault&&!n.defaultPrevented&&u.cancelEvent(t),n.stopPropagation&&u.stopEvent(t),n.shouldReleaseCapture&&(t.target===e.element?De(e,i):Ke(e,i,!1))}function Ve(e,t){Ge(e,t)}function Ge(e,t){var i={id:Ie(t),type:L(t),isPrimary:Ae(t),currentPos:D(t),currentTime:u.now()},n={originalEvent:t,eventType:"pointermove",pointerType:i.type,isEmulated:!1};A(e,n),et(e,n,i),n.preventDefault&&!n.defaultPrevented&&u.cancelEvent(t),n.stopPropagation&&u.stopEvent(t)}function Ze(e,t){t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function Xe(e,t,i){var n=t.getById(i.id);n?(n.captured&&(u.console.warn("stopTrackingPointer() called on captured pointer"),De(e,n)),t.removeContact(),t.removeById(i.id)):t.getLength()}function A(e,t){t.eventSource=e,t.eventPhase=t.originalEvent&&void 0!==t.originalEvent.eventPhase?t.originalEvent.eventPhase:0,t.defaultPrevented=u.eventIsCanceled(t.originalEvent),t.shouldCapture=!1,t.shouldReleaseCapture=!1,t.userData=e.userData;var i=e,n=t;switch(n.eventType){case"pointermove":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasGestureHandlers,n.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1;break;case"pointerdown":case"pointerup":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasGestureHandlers,n.stopPropagation=!1;break;case"wheel":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!1,n.preventGesture=!i.hasScrollHandler,n.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":n.isStoppable=!0,n.isCancelable=!1,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1;break;case"click":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!!i.clickHandler,n.preventGesture=!1,n.stopPropagation=!1;break;case"dblclick":n.isStoppable=!0,n.isCancelable=!0,n.preventDefault=!!i.dblClickHandler,n.preventGesture=!1,n.stopPropagation=!1;break;default:n.isStoppable=!1,n.isCancelable=!1,n.preventDefault=!1,n.preventGesture=!1,n.stopPropagation=!1}e.preProcessEventHandler&&e.preProcessEventHandler(t)}function Ke(e,t,i){e=e.getActivePointersListByType(t.type),t=e.getById(t.id);t?i&&!t.captured?(t.captured=!0,e.captureCount++):!i&&t.captured&&(t.captured=!1,e.captureCount--,e.captureCount<0&&(e.captureCount=0,u.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):u.console.warn("updatePointerCaptured() called on untracked pointer")}function Ye(e,t,i){var n=e.getActivePointersListByType(i.type),o=n.getById(i.id);o?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=i.currentPos,o.currentTime=i.currentTime,i=o):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,Ze(n,i)),e.enterHandler&&e.enterHandler({eventSource:e,pointerType:i.type,position:I(i.currentPos,e.element),buttons:n.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==n.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})}function Je(e,t,i){var n=e.getActivePointersListByType(i.type),o=n.getById(i.id);o?(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=i.currentPos,o.currentTime=i.currentTime):Xe(e,n,o),i=o):(i.captured=!1,i.insideElementPressed=!1),(e.leaveHandler||e.exitHandler)&&(o={eventSource:e,pointerType:i.type,position:i.currentPos&&I(i.currentPos,e.element),buttons:n.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==n.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData},e.leaveHandler&&e.leaveHandler(o),e.exitHandler&&e.exitHandler(o))}function $e(e,t,i,n){var o=h[e.hash],r=e.getActivePointersListByType(i.type);void 0!==t.originalEvent.buttons?r.buttons=t.originalEvent.buttons:0===n?r.buttons|=1:1===n?r.buttons|=4:2===n?r.buttons|=2:3===n?r.buttons|=8:4===n?r.buttons|=16:5===n&&(r.buttons|=32),0!==n?(t.shouldCapture=!1,t.shouldReleaseCapture=!1,!e.nonPrimaryPressHandler||t.preventGesture||t.defaultPrevented||(t.preventDefault=!0,e.nonPrimaryPressHandler({eventSource:e,pointerType:i.type,position:I(i.currentPos,e.element),button:n,buttons:r.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData}))):((n=r.getById(i.id))?(n.insideElementPressed=!0,n.insideElement=!0,n.originalTarget=t.originalEvent.target,n.contactPos=i.currentPos,n.contactTime=i.currentTime,n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime,i=n):(i.captured=!1,i.insideElementPressed=!0,i.insideElement=!0,i.originalTarget=t.originalEvent.target,Ze(r,i)),r.addContact(),t.preventGesture||t.defaultPrevented?(t.shouldCapture=!1,t.shouldReleaseCapture=!1):(t.shouldCapture=!0,t.shouldReleaseCapture=!1,t.preventDefault=!0,(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&u.MouseTracker.gesturePointVelocityTracker.addPoint(e,i),1===r.contacts?e.pressHandler&&!t.preventGesture&&e.pressHandler({eventSource:e,pointerType:i.type,position:I(i.contactPos,e.element),buttons:r.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData}):2===r.contacts&&e.pinchHandler&&"touch"===i.type&&(o.pinchGPoints=r.asArray(),o.lastPinchDist=o.currentPinchDist=o.pinchGPoints[0].currentPos.distanceTo(o.pinchGPoints[1].currentPos),o.lastPinchCenter=o.currentPinchCenter=He(o.pinchGPoints[0].currentPos,o.pinchGPoints[1].currentPos))))}function Qe(e,t,i,n){var o,r,s=h[e.hash],a=e.getActivePointersListByType(i.type),l=!1;void 0!==t.originalEvent.buttons?a.buttons=t.originalEvent.buttons:0===n?a.buttons^=-2:1===n?a.buttons^=-5:2===n?a.buttons^=-3:3===n?a.buttons^=-9:4===n?a.buttons^=-17:5===n&&(a.buttons^=-33),t.shouldCapture=!1,0!==n?(t.shouldReleaseCapture=!1,!e.nonPrimaryReleaseHandler||t.preventGesture||t.defaultPrevented||(t.preventDefault=!0,e.nonPrimaryReleaseHandler({eventSource:e,pointerType:i.type,position:I(i.currentPos,e.element),button:n,buttons:a.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData}))):((n=a.getById(i.id))?(a.removeContact(),n.captured&&(l=!0),n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime,n.insideElement||Xe(e,a,n),o=n.currentPos,r=n.currentTime):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,Ze(a,i),n=i),t.preventGesture||t.defaultPrevented||(l?(t.shouldReleaseCapture=!0,t.preventDefault=!0,(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&u.MouseTracker.gesturePointVelocityTracker.removePoint(e,n),0===a.contacts?(e.releaseHandler&&o&&e.releaseHandler({eventSource:e,pointerType:n.type,position:I(o,e.element),buttons:a.buttons,insideElementPressed:n.insideElementPressed,insideElementReleased:n.insideElement,isTouchEvent:"touch"===n.type,originalEvent:t.originalEvent,userData:e.userData}),e.dragEndHandler&&s.sentDragEvent&&e.dragEndHandler({eventSource:e,pointerType:n.type,position:I(n.currentPos,e.element),speed:n.speed,direction:n.direction,shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===n.type,originalEvent:t.originalEvent,userData:e.userData}),s.sentDragEvent=!1,(e.clickHandler||e.dblClickHandler)&&n.insideElement&&(i=r-n.contactTime<=e.clickTimeThreshold&&n.contactPos.distanceTo(o)<=e.clickDistThreshold,e.clickHandler&&e.clickHandler({eventSource:e,pointerType:n.type,position:I(n.currentPos,e.element),quick:i,shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===n.type,originalEvent:t.originalEvent,originalTarget:n.originalTarget,userData:e.userData}),e.dblClickHandler&&i&&(a.clicks++,1===a.clicks?(s.lastClickPos=o,s.dblClickTimeOut=setTimeout(function(){a.clicks=0},e.dblClickTimeThreshold)):2===a.clicks&&(clearTimeout(s.dblClickTimeOut),a.clicks=0,s.lastClickPos.distanceTo(o)<=e.dblClickDistThreshold&&e.dblClickHandler({eventSource:e,pointerType:n.type,position:I(n.currentPos,e.element),shift:t.originalEvent.shiftKey,isTouchEvent:"touch"===n.type,originalEvent:t.originalEvent,userData:e.userData}),s.lastClickPos=null)))):2===a.contacts&&e.pinchHandler&&"touch"===n.type&&(s.pinchGPoints=a.asArray(),s.lastPinchDist=s.currentPinchDist=s.pinchGPoints[0].currentPos.distanceTo(s.pinchGPoints[1].currentPos),s.lastPinchCenter=s.currentPinchCenter=He(s.pinchGPoints[0].currentPos,s.pinchGPoints[1].currentPos))):(t.shouldReleaseCapture=!1,e.releaseHandler&&o&&(e.releaseHandler({eventSource:e,pointerType:n.type,position:I(o,e.element),buttons:a.buttons,insideElementPressed:n.insideElementPressed,insideElementReleased:n.insideElement,isTouchEvent:"touch"===n.type,originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0))))}function et(n,o,r){var e,t,i=h[n.hash],s=n.getActivePointersListByType(r.type);void 0!==o.originalEvent.buttons&&(s.buttons=o.originalEvent.buttons),(e=s.getById(r.id))&&(e.lastPos=e.currentPos,e.lastTime=e.currentTime,e.currentPos=r.currentPos,e.currentTime=r.currentTime,o.shouldCapture=!1,o.shouldReleaseCapture=!1,n.stopHandler&&"mouse"===r.type&&(clearTimeout(n.stopTimeOut),n.stopTimeOut=setTimeout(function(){var e,t,i;e=n,t=o.originalEvent,i=r.type,e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:Oe(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,userData:e.userData})},n.stopDelay)),0===s.contacts?n.moveHandler&&n.moveHandler({eventSource:n,pointerType:r.type,position:I(r.currentPos,n.element),buttons:s.buttons,isTouchEvent:"touch"===r.type,originalEvent:o.originalEvent,userData:n.userData}):1===s.contacts?(n.moveHandler&&(e=s.asArray()[0],n.moveHandler({eventSource:n,pointerType:e.type,position:I(e.currentPos,n.element),buttons:s.buttons,isTouchEvent:"touch"===e.type,originalEvent:o.originalEvent,userData:n.userData})),!n.dragHandler||o.preventGesture||o.defaultPrevented||(t=(e=s.asArray()[0]).currentPos.minus(e.lastPos),n.dragHandler({eventSource:n,pointerType:e.type,position:I(e.currentPos,n.element),buttons:s.buttons,delta:t,speed:e.speed,direction:e.direction,shift:o.originalEvent.shiftKey,isTouchEvent:"touch"===e.type,originalEvent:o.originalEvent,userData:n.userData}),o.preventDefault=!0,i.sentDragEvent=!0)):2===s.contacts&&(n.moveHandler&&(e=s.asArray(),n.moveHandler({eventSource:n,pointerType:e[0].type,position:I(He(e[0].currentPos,e[1].currentPos),n.element),buttons:s.buttons,isTouchEvent:"touch"===e[0].type,originalEvent:o.originalEvent,userData:n.userData})),!n.pinchHandler||"touch"!==r.type||o.preventGesture||o.defaultPrevented||(t=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos))!==i.currentPinchDist&&(i.lastPinchDist=i.currentPinchDist,i.currentPinchDist=t,i.lastPinchCenter=i.currentPinchCenter,i.currentPinchCenter=He(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos),n.pinchHandler({eventSource:n,pointerType:"touch",gesturePoints:i.pinchGPoints,lastCenter:I(i.lastPinchCenter,n.element),center:I(i.currentPinchCenter,n.element),lastDistance:i.lastPinchDist,distance:i.currentPinchDist,shift:o.originalEvent.shiftKey,originalEvent:o.originalEvent,userData:n.userData}),o.preventDefault=!0)))}function tt(e,t,i){var n=e.getActivePointersListByType(i.type),i=n.getById(i.id);i&&Xe(e,n,i)}function it(e,t){for(var i=e.controls,n=i.length-1;0<=n;n--)if(i[n].element===t)return n;return-1}function nt(e){return e=g.getElement(e),new g.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function ot(e,t){if(t instanceof g.Overlay)return t;var i,n,o=null,r=(t.element?o=g.getElement(t.element):(r=t.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random()),(o=g.getElement(t.id))||((o=document.createElement("a")).href="#/overlay/"+r),o.id=r,g.addClass(o,t.className||"openseadragon-overlay")),t.location),s=t.width,a=t.height,e=(r||(i=t.x,n=t.y,void 0!==t.px&&(i=(e=e.viewport.imageToViewportRectangle(new g.Rect(t.px,t.py,s||0,a||0))).x,n=e.y,s=void 0!==s?e.width:void 0,a=void 0!==a?e.height:void 0),r=new g.Point(i,n)),t.placement);return e&&"string"===g.type(e)&&(e=g.Placement[t.placement.toUpperCase()]),new g.Overlay({element:o,location:r,placement:e,onDraw:t.onDraw,checkResize:t.checkResize,width:s,height:a,rotationMode:t.rotationMode})}function rt(e,t){for(var i=e.length-1;0<=i;i--)if(e[i].element===t)return i;return-1}function st(e,t){return g.requestAnimationFrame(function(){t(e)})}function at(o){g.requestAnimationFrame(function(){var e,t,i,n=o;if(n.controlsShouldFade){for(e=g.now(),e=e-n.controlsFadeBeginTime,t=1-e/n.controlsFadeLength,t=Math.min(1,t),t=Math.max(0,t),i=n.controls.length-1;0<=i;i--)n.controls[i].autoFade&&n.controls[i].setOpacity(t);0<t&&at(n)}})}function lt(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=g.now()+e.controlsFadeDelay,window.setTimeout(function(){at(e)},e.controlsFadeDelay))}function ct(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;0<=t;t--)e.controls[t].setOpacity(1)}function ut(){ct(this)}function ht(){lt(this)}function dt(e){var t={tracker:e.eventSource,position:e.position,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.raiseEvent("canvas-contextmenu",t),e.preventDefault=t.preventDefault}function pt(e){var t={originalEvent:e.originalEvent,preventDefaultAction:!1,preventVerticalPan:e.preventVerticalPan||!this.panVertical,preventHorizontalPan:e.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 38:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 40:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 37:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 39:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;default:e.preventDefault=!1}}function mt(e){var t={originalEvent:e.originalEvent,preventDefaultAction:!1,preventVerticalPan:e.preventVerticalPan||!this.panVertical,preventHorizontalPan:e.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 119:case 87:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,-40))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 115:case 83:t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,40))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 97:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(-40,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 100:t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(40,0))),this.viewport.applyConstraints()),e.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(g.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(g.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(g.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(g.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),e.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),e.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:e.preventDefault=!1}}function gt(e){document.activeElement!==this.canvas&&this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,originalTarget:e.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",t),!t.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function vt(e){var t={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",t),!t.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function ft(e){var t,i,n,o={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag",o),(t=this.gestureSettingsByDeviceType(e.pointerType)).dragToPan&&!o.preventDefaultAction&&this.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan&&(o=this.viewport.deltaPointsFromPixels(e.delta.negate()),this.viewport.centerSpringX.target.value+=o.x,this.viewport.centerSpringY.target.value+=o.y,i=this.viewport.getBounds(),n=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=o.x,this.viewport.centerSpringY.target.value-=o.y,i.x!==n.x&&(e.delta.x=0),i.y!==n.y&&(e.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan))}function yt(e){var t,i,n={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag-end",n),!n.preventDefaultAction&&this.viewport&&((n=this.gestureSettingsByDeviceType(e.pointerType)).flickEnabled&&e.speed>=n.flickMinSpeed&&(t=0,this.panHorizontal&&(t=n.flickMomentum*e.speed*Math.cos(e.direction)),i=0,this.panVertical&&(i=n.flickMomentum*e.speed*Math.sin(e.direction)),n=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),e=this.viewport.pointFromPixel(new g.Point(n.x-t,n.y-i)),this.viewport.panTo(e,!1)),this.viewport.applyConstraints())}function bt(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function wt(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function _t(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function xt(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function St(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function Tt(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function Et(e){var t,i,n,o={tracker:e.eventSource,pointerType:e.pointerType,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",o),this.viewport&&(!(n=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom||o.preventDefaultPanAction&&o.preventDefaultZoomAction||(i=this.viewport.pointFromPixel(e.center,!0),n.zoomToRefPoint&&!o.preventDefaultPanAction&&(t=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(t.x=0),this.panVertical||(t.y=0),this.viewport.panBy(t,!0)),o.preventDefaultZoomAction||this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),this.viewport.applyConstraints()),n.pinchRotate&&!o.preventDefaultRotateAction&&(t=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),i=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(t-i)*(180/Math.PI))))}function Pt(e){var t,i,n=g.now();n-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=n,n={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",n),!n.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),(t=this.gestureSettingsByDeviceType(e.pointerType)).scrollToZoom&&(i=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(i,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())),e.preventDefault=n.preventDefault):e.preventDefault=!0}function Ct(e){d[this.hash].mouseInside=!0,ct(this),this.raiseEvent("container-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function Rt(e){e.pointers<1&&(d[this.hash].mouseInside=!1,d[this.hash].animating||lt(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function kt(e){var t,i,n,o,r;!(t=e)._opening&&d[t.hash]&&(t.autoResize&&(o=nt(t.container),n=d[t.hash].prevContainerSize,o.equals(n)||(i=t.viewport,t.preserveImageSizeOnResize?(n=n.x/o.x,n=i.getZoom()*n,r=i.getCenter(),i.resize(o,!1),i.zoomTo(n,null,!0),i.panTo(r,!0)):(n=i.getBounds(),i.resize(o,!0),i.fitBoundsWithConstraints(n,!0)),d[t.hash].prevContainerSize=o,d[t.hash].forceRedraw=!0)),r=t.viewport.update(),i=t.world.update()||r,r&&t.raiseEvent("viewport-change"),t.referenceStrip&&(i=t.referenceStrip.update(t.viewport)||i),!(n=d[t.hash].animating)&&i&&(t.raiseEvent("animation-start"),ct(t)),(o=n&&!i)&&(d[t.hash].animating=!1),(i||o||d[t.hash].forceRedraw||t.world.needsDraw())&&((r=t).imageLoader.clear(),r.drawer.clear(),r.world.draw(),r.raiseEvent("update-viewport",{}),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),d[t.hash].forceRedraw=!1,i&&t.raiseEvent("animation")),o&&(t.raiseEvent("animation-finish"),d[t.hash].mouseInside||lt(t)),d[t.hash].animating=i),e.isOpen()?e._updateRequestId=st(e,kt):e._updateRequestId=!1}function O(e,t){return e?e+t:t}function Lt(){d[this.hash].lastZoomTime=g.now(),d[this.hash].zoomFactor=this.zoomPerSecond,d[this.hash].zooming=!0,At(this)}function Dt(){d[this.hash].lastZoomTime=g.now(),d[this.hash].zoomFactor=1/this.zoomPerSecond,d[this.hash].zooming=!0,At(this)}function It(){d[this.hash].zooming=!1}function At(e){g.requestAnimationFrame(g.delegate(e,Ot))}function Ot(){var e,t;d[this.hash].zooming&&this.viewport&&(t=(e=g.now())-d[this.hash].lastZoomTime,t=Math.pow(d[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(t),this.viewport.applyConstraints(),d[this.hash].lastZoomTime=e,At(this))}function Ht(){this.viewport&&(d[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function Mt(){this.viewport&&(d[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function zt(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Bt(){this.viewport&&this.viewport.goHome()}function Nt(){this.isFullPage()&&!g.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Ft(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?g.positiveModulo(e+this.rotationIncrement,360):g.positiveModulo(e-this.rotationIncrement,360),this.viewport.setRotation(e))}function qt(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?g.positiveModulo(e-this.rotationIncrement,360):g.positiveModulo(e+this.rotationIncrement,360),this.viewport.setRotation(e))}function jt(){this.viewport.toggleFlip()}function Wt(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),t=this.viewport.pointFromPixel(e.position),this.panVertical?this.panHorizontal||(t.x=this.viewer.viewport.getCenter(!0).x):t.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(t),this.viewer.viewport.applyConstraints())}function Ut(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function Vt(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function Gt(e){var t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.viewer.raiseEvent("navigator-scroll",t),e.preventDefault=t.preventDefault}function Zt(e,t){Xt(e,"rotate("+t+"deg)")}function Xt(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}function Kt(e,t){for(var i,n=t.Image,o=n.Url,r=n.Format,s=n.Size,a=n.DisplayRect||[],l=parseInt(s.Width,10),s=parseInt(s.Height,10),c=parseInt(n.TileSize,10),n=parseInt(n.Overlap,10),u=[],h=0;h<a.length;h++)i=a[h].Rect,u.push(new m.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return m.extend(!0,{width:l,height:s,tileSize:c,tileOverlap:n,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:r,displayRects:u},t)}function Yt(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,t=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),i=!1;return 2===e.version&&1<e.profile.length&&e.profile[1].supports&&(i=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(i=-1!==e.extraFeatures.indexOf("sizeByWh")),!t||i}function Jt(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}function $t(i){y.requestAnimationFrame(function(){var e,t;(e=i).shouldFade&&(t=1-(t=(t=y.now())-e.fadeBeginTime)/e.fadeLength,t=Math.min(1,t),t=Math.max(0,t),e.imgGroup&&y.setElementOpacity(e.imgGroup,t,!0),0<t&&$t(e))})}function Qt(e,t){var i;e.element.disabled||(t>=y.ButtonState.GROUP&&e.currentState===y.ButtonState.REST&&((i=e).shouldFade=!1,i.imgGroup&&y.setElementOpacity(i.imgGroup,1,!0),e.currentState=y.ButtonState.GROUP),t>=y.ButtonState.HOVER&&e.currentState===y.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=y.ButtonState.HOVER),t>=y.ButtonState.DOWN&&e.currentState===y.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=y.ButtonState.DOWN))}function ei(e,t){var i;e.element.disabled||(t<=y.ButtonState.HOVER&&e.currentState===y.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=y.ButtonState.HOVER),t<=y.ButtonState.GROUP&&e.currentState===y.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=y.ButtonState.GROUP),t<=y.ButtonState.REST&&e.currentState===y.ButtonState.GROUP&&((i=e).shouldFade=!0,i.fadeBeginTime=y.now()+i.fadeDelay,window.setTimeout(function(){$t(i)},i.fadeDelay),e.currentState=y.ButtonState.REST))}function ti(e){e.quick&&(e="horizontal"===this.scroll?Math.floor(e.position.x/this.panelWidth):Math.floor(e.position.y/this.panelHeight),this.viewer.goToPage(e)),this.element.focus()}function ii(e){var t,i,n,o,r;this.dragging=!0,this.element&&(t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=w.getElementSize(this.viewer.canvas),"horizontal"===this.scroll?0<-e.delta.x?t>-(n-r.x)&&(this.element.style.marginLeft=t+2*e.delta.x+"px",H(this,r.x,t+2*e.delta.x)):-e.delta.x<0&&t<0&&(this.element.style.marginLeft=t+2*e.delta.x+"px",H(this,r.x,t+2*e.delta.x)):0<-e.delta.y?i>-(o-r.y)&&(this.element.style.marginTop=i+2*e.delta.y+"px",H(this,r.y,i+2*e.delta.y)):-e.delta.y<0&&i<0&&(this.element.style.marginTop=i+2*e.delta.y+"px",H(this,r.y,i+2*e.delta.y)))}function ni(e){var t,i,n,o,r;this.element&&(t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=w.getElementSize(this.viewer.canvas),"horizontal"===this.scroll?0<e.scroll?t>-(n-r.x)&&(this.element.style.marginLeft=t-60*e.scroll+"px",H(this,r.x,t-60*e.scroll)):e.scroll<0&&t<0&&(this.element.style.marginLeft=t-60*e.scroll+"px",H(this,r.x,t-60*e.scroll)):e.scroll<0?i>r.y-o&&(this.element.style.marginTop=i+60*e.scroll+"px",H(this,r.y,i+60*e.scroll)):0<e.scroll&&i<0&&(this.element.style.marginTop=i+60*e.scroll+"px",H(this,r.y,i+60*e.scroll)),e.preventDefault=!0)}function H(e,t,i){for(var n,o,r="horizontal"===e.scroll?e.panelWidth:e.panelHeight,s=Math.ceil(t/r)+5,a=Math.ceil((Math.abs(i)+t)/r)+1,l=s=(s=a-s)<0?0:s;l<a&&l<e.panels.length;l++)(o=e.panels[l]).activePanel||(n=(n=e.viewer.tileSources[l]).referenceStripThumbnailUrl?{type:"image",url:n.referenceStripThumbnailUrl}:n,n=new w.Viewer({id:o.id,tileSources:[n],element:o,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:e.viewer.loadTilesWithAjax,ajaxHeaders:e.viewer.ajaxHeaders,useCanvas:e.useCanvas}),w.setElementPointerEventsNone(n.canvas),w.setElementPointerEventsNone(n.container),n.innerTracker.setTracking(!1),n.outerTracker.setTracking(!1),e.miniViewers[o.id]=n,o.activePanel=!0)}function oi(e){e=e.eventSource.element;"horizontal"===this.scroll?e.style.marginBottom="0px":e.style.marginLeft="0px"}function ri(e){e=e.eventSource.element;"horizontal"===this.scroll?e.style.marginBottom="-"+w.getElementSize(e).y/2+"px":e.style.marginLeft="-"+w.getElementSize(e).x/2+"px"}function si(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 38:ni.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 40:case 37:ni.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 39:ni.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}function ai(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 61:ni.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 45:ni.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 48:case 119:case 87:ni.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 115:case 83:case 97:ni.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 100:ni.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}function li(e){ae.extend(!0,this,{timeout:ae.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}function ci(e){return e!==P.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&e!==P.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&e!==P.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function ui(e){return ci(e)?le:e}function hi(e){C.console.assert(e,"[TileCache.cacheTile] options is required"),C.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),C.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage}function di(e){C.console.assert(e,"[ImageRecord] options is required"),C.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]}k.Browser.alpha=!(k.Browser.vendor===k.BROWSERS.CHROME&&k.Browser.version<2),k.Browser.opacity=!0,k.Browser.vendor===k.BROWSERS.IE&&k.Browser.version<11&&k.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon"),t=window,me=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,ge=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame,me&&ge?(k.requestAnimationFrame=function(){return me.apply(t,arguments)},k.cancelAnimationFrame=function(){return ge.apply(t,arguments)}):(ue=[],he=[],de=0,k.requestAnimationFrame=function(e){return ue.push([++de,e]),pe=pe||setInterval(function(){if(ue.length){var e=k.now(),t=he;for(he=ue,ue=t;he.length;)he.shift()[1](e)}else clearInterval(pe),pe=void 0},20),de},k.cancelAnimationFrame=function(e){for(var t=0,i=ue.length;t<i;t+=1)if(ue[t][0]===e)return void ue.splice(t,1);for(t=0,i=he.length;t<i;t+=1)if(he[t][0]===e)return void he.splice(t,1)}),j=this,ie=function(){return c},"function"==typeof define&&define.amd?define([],ie):"object"==typeof z&&z.exports?z.exports=c:j.OpenSeadragon=c,W=c,e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(e){return e.requestFullscreen()},e.exitFullScreen=function(){document.exitFullscreen()},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(e){return e.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(e){return e.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(e){return e.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(e){return e.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return null!==e.getFullScreenElement()},e.cancelFullScreen=function(){W.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},W.extend(W,e),(U=c).EventSource=function(){this.events={}},U.EventSource.prototype={addOnceHandler:function(t,i,e,n){function o(e){++s===n&&r.removeHandler(t,o),i(e)}var r=this,s=(n=n||1,0);this.addHandler(t,o,e)},addHandler:function(e,t,i){var n=this.events[e];n||(this.events[e]=n=[]),t&&U.isFunction(t)&&(n[n.length]={handler:t,userData:i||null})},removeHandler:function(e,t){var i,n=this.events[e],o=[];if(n&&U.isArray(n)){for(i=0;i<n.length;i++)n[i].handler!==t&&o.push(n[i]);this.events[e]=o}},numberOfHandlers:function(e){e=this.events[e];return e?e.length:0},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var o=this.events[e];return o&&o.length?(o=1===o.length?[o[0]]:Array.apply(null,o),function(e,t){for(var i=o.length,n=0;n<i;n++)o[n]&&(t.eventSource=e,t.userData=o[n].userData,o[n].handler(t))}):null},raiseEvent:function(e,t){e=this.getHandler(e);e&&e(this,t=t||{})}},K=[],h={},(u=c).MouseTracker=function(e){K.push(this);var t=arguments,c=(u.isPlainObject(e)||(e={element:t[0],clickTimeThreshold:t[1],clickDistThreshold:t[2]}),this.hash=Math.random(),this.element=u.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||u.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||u.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||u.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||u.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.preProcessEventHandler=e.preProcessEventHandler||null,this.contextMenuHandler=e.contextMenuHandler||null,this.enterHandler=e.enterHandler||null,this.leaveHandler=e.leaveHandler||null,this.exitHandler=e.exitHandler||null,this.overHandler=e.overHandler||null,this.outHandler=e.outHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null,this);h[this.hash]={click:function(e){var t={originalEvent:e,eventType:"click",pointerType:"mouse",isEmulated:!1};A(c,t),t.preventDefault&&!t.defaultPrevented&&u.cancelEvent(e),t.stopPropagation&&u.stopEvent(e)},dblclick:function(e){var t={originalEvent:e,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};A(c,t),t.preventDefault&&!t.defaultPrevented&&u.cancelEvent(e),t.stopPropagation&&u.stopEvent(e)},keydown:function(e){var t=c,i=null,n={originalEvent:e,eventType:"keydown",pointerType:"",isEmulated:!1};A(t,n),!t.keyDownHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyDownHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&u.cancelEvent(e),n.stopPropagation&&u.stopEvent(e)},keyup:function(e){var t=c,i=null,n={originalEvent:e,eventType:"keyup",pointerType:"",isEmulated:!1};A(t,n),!t.keyUpHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyUpHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&u.cancelEvent(e),n.stopPropagation&&u.stopEvent(e)},keypress:function(e){var t=c,i=null,n={originalEvent:e,eventType:"keypress",pointerType:"",isEmulated:!1};A(t,n),!t.keyHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,keyCode:e.keyCode||e.charCode,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.keyHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&u.cancelEvent(e),n.stopPropagation&&u.stopEvent(e)},focus:function(e){var t,i;A(t=c,i={originalEvent:e=e,eventType:"focus",pointerType:"",isEmulated:!1}),t.focusHandler&&!i.preventGesture&&t.focusHandler({eventSource:t,originalEvent:e,userData:t.userData})},blur:function(e){var t,i;A(t=c,i={originalEvent:e=e,eventType:"blur",pointerType:"",isEmulated:!1}),t.blurHandler&&!i.preventGesture&&t.blurHandler({eventSource:t,originalEvent:e,userData:t.userData})},contextmenu:function(e){var t=c,i=null,n={originalEvent:e,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};A(t,n),!t.contextMenuHandler||n.preventGesture||n.defaultPrevented||(i={eventSource:t,position:I(D(e),t.element),originalEvent:n.originalEvent,preventDefault:n.preventDefault||n.defaultPrevented,userData:t.userData},t.contextMenuHandler(i)),(i&&i.preventDefault||n.preventDefault&&!n.defaultPrevented)&&u.cancelEvent(e),n.stopPropagation&&u.stopEvent(e)},wheel:function(e){ze(c,e,e)},mousewheel:function(e){Me(c,e)},DOMMouseScroll:function(e){Me(c,e)},MozMousePixelScroll:function(e){Me(c,e)},losecapture:function(e){var t=c,i={id:u.MouseTracker.mousePointerId,type:"mouse"},n={originalEvent:e,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};A(t,n),e.target===t.element&&Ke(t,i,!1),n.stopPropagation&&u.stopEvent(e)},mouseenter:function(e){Be(c,e)},mouseleave:function(e){Ne(c,e)},mouseover:function(e){Fe(c,e)},mouseout:function(e){qe(c,e)},mousedown:function(e){je(c,e)},mouseup:function(e){We(c,e)},mousemove:function(e){Ve(c,e)},touchstart:function(e){var t,i,n,o=c,r=e,s=r.changedTouches.length,a=o.getActivePointersListByType("touch"),l=(t=u.now(),a.getLength()>r.touches.length-s&&u.console.warn("Tracked touch contact count doesn't match event.touches.length"),{originalEvent:r,eventType:"pointerdown",pointerType:"touch",isEmulated:!1});for(A(o,l),i=0;i<s;i++)n={id:r.changedTouches[i].identifier,type:"touch",isPrimary:0===a.getLength(),currentPos:D(r.changedTouches[i]),currentTime:t},Ye(o,l,n),$e(o,l,n,0),Ke(o,n,!0);l.preventDefault&&!l.defaultPrevented&&u.cancelEvent(r),l.stopPropagation&&u.stopEvent(r)},touchend:function(e){var t,i,n,o=c,r=e,s=r.changedTouches.length,a=(t=u.now(),{originalEvent:r,eventType:"pointerup",pointerType:"touch",isEmulated:!1});for(A(o,a),i=0;i<s;i++)n={id:r.changedTouches[i].identifier,type:"touch",currentPos:D(r.changedTouches[i]),currentTime:t},Qe(o,a,n,0),Ke(o,n,!1),Je(o,a,n);a.preventDefault&&!a.defaultPrevented&&u.cancelEvent(r),a.stopPropagation&&u.stopEvent(r)},touchmove:function(e){var t,i,n,o=c,r=e,s=r.changedTouches.length,a=(t=u.now(),{originalEvent:r,eventType:"pointermove",pointerType:"touch",isEmulated:!1});for(A(o,a),i=0;i<s;i++)n={id:r.changedTouches[i].identifier,type:"touch",currentPos:D(r.changedTouches[i]),currentTime:t},et(o,a,n);a.preventDefault&&!a.defaultPrevented&&u.cancelEvent(r),a.stopPropagation&&u.stopEvent(r)},touchcancel:function(e){var t,i,n=c,o=e,r=o.changedTouches.length,s={originalEvent:o,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(A(n,s),t=0;t<r;t++)i={id:o.changedTouches[t].identifier,type:"touch"},tt(n,0,i);s.stopPropagation&&u.stopEvent(o)},gesturestart:function(e){e=e,u.eventIsCanceled(e)||e.preventDefault()},gesturechange:function(e){e=e,u.eventIsCanceled(e)||e.preventDefault()},gotpointercapture:function(e){var t=c,i={originalEvent:e,eventType:"gotpointercapture",pointerType:L(e),isEmulated:!1};A(t,i),e.target===t.element&&Ke(t,{id:e.pointerId,type:L(e)},!0),i.stopPropagation&&u.stopEvent(e)},lostpointercapture:function(e){var t=c,i={originalEvent:e,eventType:"lostpointercapture",pointerType:L(e),isEmulated:!1};A(t,i),e.target===t.element&&Ke(t,{id:e.pointerId,type:L(e)},!1),i.stopPropagation&&u.stopEvent(e)},pointerenter:function(e){Be(c,e)},pointerleave:function(e){Ne(c,e)},pointerover:function(e){Fe(c,e)},pointerout:function(e){qe(c,e)},pointerdown:function(e){je(c,e)},pointerup:function(e){We(c,e)},pointermove:function(e){Ve(c,e)},pointercancel:function(e){var t,i,n;t=c,i={id:(e=e).pointerId,type:L(e)},A(t,n={originalEvent:e,eventType:"pointercancel",pointerType:i.type,isEmulated:!1}),tt(t,0,i),n.stopPropagation&&u.stopEvent(e)},pointerupcaptured:function(e){var t=c;t.getActivePointersListByType(L(e)).getById(e.pointerId)&&Ue(t,e),u.stopEvent(e)},pointermovecaptured:function(e){var t=c;t.getActivePointersListByType(L(e)).getById(e.pointerId)&&Ge(t,e),u.stopEvent(e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,u.MouseTracker.havePointerEvents&&u.setElementPointerEvents(this.element,"auto"),this.exitHandler&&u.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),e.startDisabled||this.setTracking(!0)},u.MouseTracker.prototype={destroy:function(){var e;for(ke(this),this.element=null,e=0;e<K.length;e++)if(K[e]===this){K.splice(e,1);break}h[this.hash]=null,delete h[this.hash]},isTracking:function(){return h[this.hash].tracking},setTracking:function(e){if(e){var t,i,n=this,o=h[n.hash];if(!o.tracking){for(i=0;i<u.MouseTracker.subscribeEvents.length;i++)t=u.MouseTracker.subscribeEvents[i],u.addEvent(n.element,t,o[t],t===u.MouseTracker.wheelEventName&&{passive:!1,capture:!1});Re(n),o.tracking=!0}}else ke(this);return this},getActivePointersListByType:function(e){for(var t,i=h[this.hash],n=i.activePointersLists.length,o=0;o<n;o++)if(i.activePointersLists[o].type===e)return i.activePointersLists[o];return t=new u.MouseTracker.GesturePointList(e),i.activePointersLists.push(t),t},getActivePointerCount:function(){for(var e=h[this.hash],t=e.activePointersLists.length,i=0,n=0;n<t;n++)i+=e.activePointersLists[n].getLength();return i},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},Y=function(){try{return window.self!==window.top}catch(e){return!0}}(),u.MouseTracker.gesturePointVelocityTracker=(V=[],Z=G=0,{addPoint:function(e,t){e=Pe(e,t);V.push({guid:e,gPoint:t,lastPos:t.currentPos}),1===V.length&&(Z=u.now(),G=window.setInterval(Ce,50))},removePoint:function(e,t){for(var i=Pe(e,t),n=V.length,o=0;o<n;o++)if(V[o].guid===i){V.splice(o,1),0===--n&&window.clearInterval(G);break}}}),u.MouseTracker.captureElement=document,u.MouseTracker.wheelEventName=u.Browser.vendor===u.BROWSERS.IE&&8<u.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",u.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",u.MouseTracker.wheelEventName],"DOMMouseScroll"===u.MouseTracker.wheelEventName&&u.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(u.MouseTracker.havePointerEvents=!0,u.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),u.MouseTracker.havePointerCapture=(X=document.createElement("div"),u.isFunction(X.setPointerCapture)&&u.isFunction(X.releasePointerCapture)),u.MouseTracker.havePointerCapture&&u.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(u.MouseTracker.havePointerEvents=!1,u.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),u.MouseTracker.mousePointerId="legacy-mouse",u.MouseTracker.havePointerCapture=(X=document.createElement("div"),u.isFunction(X.setCapture)&&u.isFunction(X.releaseCapture)),u.MouseTracker.havePointerCapture&&u.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&u.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&u.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),u.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},u.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e)return this._gPoints[i];return null},getPrimary:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(u.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}},(o=c).ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},o.Control=function(e,t,i){var n=e.parentNode;"number"==typeof t&&(o.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),t={anchor:t}),t.attachToViewer=void 0===t.attachToViewer||t.attachToViewer,this.autoFade=void 0===t.autoFade||t.autoFade,this.element=e,this.anchor=t.anchor,this.container=i,this.anchor===o.ControlAnchor.ABSOLUTE?(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof t.top?t.top+"px":t.top,this.wrapper.style.left="number"==typeof t.left?t.left+"px":t.left,this.wrapper.style.height="number"==typeof t.height?t.height+"px":t.height,this.wrapper.style.width="number"==typeof t.width?t.width+"px":t.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===o.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),t.attachToViewer?this.anchor===o.ControlAnchor.TOP_RIGHT||this.anchor===o.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},o.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==o.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor===o.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[o.SIGNAL]&&o.Browser.vendor===o.BROWSERS.IE?o.setElementOpacity(this.element,e,!0):o.setElementOpacity(this.wrapper,e,!0)}},(r=c).ControlDock=function(e){var t,i,n=["topleft","topright","bottomright","bottomleft"];for(r.extend(!0,this,{id:"controldock-"+r.now()+"-"+Math.floor(1e6*Math.random()),container:r.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=r.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<n.length;i++)this.controls[t=n[i]]=r.makeNeutralElement("div"),this.controls[t].style.position="absolute",t.match("left")&&(this.controls[t].style.left="0px"),t.match("right")&&(this.controls[t].style.right="0px"),t.match("top")&&(this.controls[t].style.top="0px"),t.match("bottom")&&(this.controls[t].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},r.ControlDock.prototype={addControl:function(e,t){e=r.getElement(e);var i=null;if(!(0<=it(this,e))){switch(t.anchor){case r.ControlAnchor.TOP_RIGHT:i=this.controls.topright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingTop="0px";break;case r.ControlAnchor.BOTTOM_RIGHT:i=this.controls.bottomright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingBottom="0px";break;case r.ControlAnchor.BOTTOM_LEFT:i=this.controls.bottomleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingBottom="0px";break;case r.ControlAnchor.TOP_LEFT:i=this.controls.topleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingTop="0px";break;case r.ControlAnchor.ABSOLUTE:i=this.container,e.style.margin="0px",e.style.padding="0px";break;default:case r.ControlAnchor.NONE:i=this.container,e.style.margin="0px",e.style.padding="0px"}this.controls.push(new r.Control(e,t,i)),e.style.display="inline-block"}},removeControl:function(e){e=it(this,e=r.getElement(e));return 0<=e&&(this.controls[e].destroy(),this.controls.splice(e,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var e=this.controls.length-1;0<=e;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){for(var t=this.controls.length-1;0<=t;t--)this.controls[t].setVisible(e);return this}},c.Placement=c.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),d={},J=1,(g=c).Viewer=function(e){var t,i=arguments,n=this;if((e=g.isPlainObject(e)?e:{id:i[0],xmlPath:1<i.length?i[1]:void 0,prefixUrl:2<i.length?i[2]:void 0,controls:3<i.length?i[3]:void 0,overlays:4<i.length?i[4]:void 0}).config&&(g.extend(!0,e,e.config),delete e.config),g.extend(!0,this,{id:e.id,hash:e.hash||J++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},g.DEFAULT_SETTINGS,e),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==d[this.hash]&&g.console.warn("Hash "+this.hash+" has already been used."),d[this.hash]={fsBoundsDelta:new g.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=g.now(),g.EventSource.call(this),this.addHandler("open-failed",function(e){e=g.getString("Errors.OpenFailed",e.eventSource,e.message);n._showMessage(e)}),g.ControlDock.call(this,e),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=g.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(i=this.canvas.style).width="100%",i.height="100%",i.overflow="hidden",i.position="absolute",i.top="0px",i.left="0px",g.setElementTouchActionNone(this.canvas),""!==e.tabIndex&&(this.canvas.tabIndex=void 0===e.tabIndex?0:e.tabIndex),this.container.className="openseadragon-container",(i=this.container.style).width="100%",i.height="100%",i.position="relative",i.overflow="hidden",i.left="0px",i.top="0px",i.textAlign="left",g.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new g.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:g.delegate(this,dt),keyDownHandler:g.delegate(this,pt),keyHandler:g.delegate(this,mt),clickHandler:g.delegate(this,gt),dblClickHandler:g.delegate(this,vt),dragHandler:g.delegate(this,ft),dragEndHandler:g.delegate(this,yt),enterHandler:g.delegate(this,bt),leaveHandler:g.delegate(this,wt),pressHandler:g.delegate(this,_t),releaseHandler:g.delegate(this,xt),nonPrimaryPressHandler:g.delegate(this,St),nonPrimaryReleaseHandler:g.delegate(this,Tt),scrollHandler:g.delegate(this,Pt),pinchHandler:g.delegate(this,Et)}),this.outerTracker=new g.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:g.delegate(this,Ct),leaveHandler:g.delegate(this,Rt)}),this.toolbar&&(this.toolbar=new g.ControlDock({element:this.toolbar})),this.bindStandardControls(),d[this.hash].prevContainerSize=nt(this.container),this.world=new g.World({viewer:this}),this.world.addHandler("add-item",function(e){n.source=n.world.getItemAt(0).source,d[n.hash].forceRedraw=!0,n._updateRequestId||(n._updateRequestId=st(n,kt))}),this.world.addHandler("remove-item",function(e){n.world.getItemCount()?n.source=n.world.getItemAt(0).source:n.source=null,d[n.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(e){n.viewport&&n.viewport._setContentBounds(n.world.getHomeBounds(),n.world.getContentFactor())}),this.world.addHandler("item-index-change",function(e){n.source=n.world.getItemAt(0).source}),this.viewport=new g.Viewport({containerSize:d[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new g.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:e.timeout}),this.tileCache=new g.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new g.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=g.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(t=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(t,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(t=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(t,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new g.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});g.requestAnimationFrame(function(){lt(n)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),g._viewers.set(this.element,this)},g.extend(g.Viewer.prototype,g.EventSource.prototype,g.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return g.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return g.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},get buttons(){return g.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(i,e){var o=this;if(this.close(),i)if(this.sequenceMode&&g.isArray(i))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===e||isNaN(e)||(this.initialPage=e),this.tileSources=i,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);else if((i=g.isArray(i)?i:[i]).length){this._opening=!0;for(var r,n=i.length,s=0,a=0,l=function(){if(s+a===n)if(s){!o._firstOpen&&o.preserveViewport||(o.viewport.goHome(!0),o.viewport.update()),o._firstOpen=!1;var e=i[0];if(e.tileSource&&(e=e.tileSource),o.overlays&&!o.preserveOverlays)for(var t=0;t<o.overlays.length;t++)o.currentOverlays[t]=ot(o,o.overlays[t]);o._drawOverlays(),o._opening=!1,o.raiseEvent("open",{source:e})}else o._opening=!1,o.raiseEvent("open-failed",r)},t=0;t<i.length;t++)!function(i){void 0!==(i=g.isPlainObject(i)&&i.tileSource?i:{tileSource:i}).index&&(g.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete i.index),void 0===i.collectionImmediately&&(i.collectionImmediately=!0);var n=i.success,t=(i.success=function(e){if(s++,i.tileSource.overlays)for(var t=0;t<i.tileSource.overlays.length;t++)o.addOverlay(i.tileSource.overlays[t]);n&&n(e),l()},i.error);i.error=function(e){a++,r=r||e,t&&t(e),l()},o.addTiledImage(i)}(i[t])}return this},close:function(){return d[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),d[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(d[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(g.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),d[this.navigator.hash]=null,delete d[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),d[this.hash]=null,delete d[this.hash],this.canvas=null,this.container=null,g._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){for(var e=this.controls.length,t=0;t<this.controls.length;t++)e=e&&this.controls[t].isVisible();return e},setControlsEnabled:function(e){return(e?ct:lt)(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return d[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,o=n.style,r=document.documentElement.style,s=this;if(e!==this.isFullPage()){var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),!a.preventDefaultAction){if(e){for(this.elementSize=g.getElementSize(this.element),this.pageScroll=g.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=r.margin,o.margin="0",r.margin="0",this.bodyPadding=o.padding,this.docPadding=r.padding,o.padding="0",r.padding="0",this.bodyWidth=o.width,this.docWidth=r.width,o.width="100%",r.width="100%",this.bodyHeight=o.height,this.docHeight=r.height,o.height="100%",r.height="100%",this.bodyDisplay=o.display,o.display="block",this.previousBody=[],d[this.hash].prevElementParent=this.element.parentNode,d[this.hash].prevNextSibling=this.element.nextSibling,d[this.hash].prevElementWidth=this.element.style.width,d[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;i<t;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),g.addClass(this.toolbar.element,"fullpage")),g.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=g.getElementSize(this.element).y-g.getElementSize(this.toolbar.element).y+"px"),d[this.hash].fullPage=!0,g.delegate(this,Ct)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,r.margin=this.docMargin,o.padding=this.bodyPadding,r.padding=this.docPadding,o.width=this.bodyWidth,r.width=this.docWidth,o.height=this.bodyHeight,r.height=this.docHeight,o.display=this.bodyDisplay,n.removeChild(this.element),t=this.previousBody.length,i=0;i<t;i++)n.appendChild(this.previousBody.shift());g.removeClass(this.element,"fullpage"),d[this.hash].prevElementParent.insertBefore(this.element,d[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),g.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=d[this.hash].prevElementWidth,this.element.style.height=d[this.hash].prevElementHeight;var l=0,c=function(){g.setPageScroll(s.pageScroll);var e=g.getPageScroll();++l<10&&(e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&g.requestAnimationFrame(c)};g.requestAnimationFrame(c),d[this.hash].fullPage=!1,g.delegate(this,Rt)({})}this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e})}}return this},setFullScreen:function(e){var t=this;if(!g.supportsFullScreen)return this.setFullPage(e);if(g.isFullScreen()!==e){var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),!i.preventDefaultAction)if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=g.isFullScreen();e||(g.removeEvent(document,g.fullScreenEventName,n),g.removeEvent(document,g.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.navigator&&t.viewport&&setTimeout(function(){t.navigator.update(t.viewport)}),t.raiseEvent("full-screen",{fullScreen:e})};g.addEvent(document,g.fullScreenEventName,n),g.addEvent(document,g.fullScreenErrorEventName,n),g.requestFullScreen(document.body)}else g.exitFullScreen()}return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return g.isFullScreen()&&this.isFullPage()},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(i){g.console.assert(i,"[Viewer.addTiledImage] options is required"),g.console.assert(i.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),g.console.assert(!i.replace||-1<i.index&&i.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var n=this,o=(i.replace&&(i.replaceItem=n.world.getItemAt(i.index)),this._hideMessage(),void 0===i.placeholderFillStyle&&(i.placeholderFillStyle=this.placeholderFillStyle),void 0===i.opacity&&(i.opacity=this.opacity),void 0===i.preload&&(i.preload=this.preload),void 0===i.compositeOperation&&(i.compositeOperation=this.compositeOperation),void 0===i.crossOriginPolicy&&(i.crossOriginPolicy=(void 0!==i.tileSource.crossOriginPolicy?i.tileSource:this).crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=this.ajaxWithCredentials),void 0===i.loadTilesWithAjax&&(i.loadTilesWithAjax=this.loadTilesWithAjax),void 0===i.ajaxHeaders||null===i.ajaxHeaders?i.ajaxHeaders=this.ajaxHeaders:g.isPlainObject(i.ajaxHeaders)&&g.isPlainObject(this.ajaxHeaders)&&(i.ajaxHeaders=g.extend({},this.ajaxHeaders,i.ajaxHeaders)),{options:i});function t(e){for(var t=0;t<n._loadQueue.length;t++)if(n._loadQueue[t]===o){n._loadQueue.splice(t,1);break}0===n._loadQueue.length&&r(o),n.raiseEvent("add-item-failed",e),i.error&&i.error(e)}function r(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}if(g.isArray(i.tileSource))setTimeout(function(){t({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:i.tileSource,options:i})});else{this._loadQueue.push(o);var s=this,a=i.tileSource,l=i,c=function(e){o.tileSource=e,p()},u=function(e){e.options=i,t(e),p()},h=s;if("string"===g.type(a))if(a.match(/^\s*<.*>\s*$/))a=g.parseXml(a);else if(a.match(/^\s*[{[].*[}\]]\s*$/))try{var e=g.parseJSON(a);a=e}catch(e){}function d(e,t){e.ready?c(e):(e.addHandler("ready",function(){c(e)}),e.addHandler("open-failed",function(e){u({message:e.message,source:t})}))}setTimeout(function(){var e,t;"string"===g.type(a)?(a=new g.TileSource({url:a,crossOriginPolicy:(void 0!==l.crossOriginPolicy?l:s).crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,ajaxHeaders:l.ajaxHeaders||s.ajaxHeaders,splitHashDataForPost:s.splitHashDataForPost,useCanvas:s.useCanvas,success:function(e){c(e.tileSource)}})).addHandler("open-failed",function(e){u(e)}):g.isPlainObject(a)||a.nodeType?(void 0!==a.crossOriginPolicy||void 0===l.crossOriginPolicy&&void 0===s.crossOriginPolicy||(a.crossOriginPolicy=(void 0!==l.crossOriginPolicy?l:s).crossOriginPolicy),void 0===a.ajaxWithCredentials&&(a.ajaxWithCredentials=s.ajaxWithCredentials),void 0===a.useCanvas&&(a.useCanvas=s.useCanvas),g.isFunction(a.getTileUrl)?((e=new g.TileSource(a)).getTileUrl=a.getTileUrl,c(e)):(e=g.TileSource.determineType(h,a))?(t=e.prototype.configure.apply(h,[a]),d(new e(t),a)):u({message:"Unable to load TileSource",source:a})):d(a,a)})}function p(){for(var e,t,i;n._loadQueue.length&&(e=n._loadQueue[0]).tileSource;)n._loadQueue.splice(0,1),e.options.replace&&(-1!==(i=n.world.getIndexOfItem(e.options.replaceItem))&&(e.options.index=i),n.world.removeItem(e.options.replaceItem)),i=new g.TiledImage({viewer:n,source:e.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,flipped:e.options.flipped,compositeOperation:e.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:n.debugMode,subPixelRoundingForTransparency:n.subPixelRoundingForTransparency}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.navigator&&(t=g.extend({},e.options,{replace:!1,originalTiledImage:i,tileSource:e.tileSource}),n.navigator.addTiledImage(t)),n.world.addItem(i,{index:e.options.index}),0===n._loadQueue.length&&r(e),1!==n.world.getItemCount()||n.preserveViewport||n.viewport.goHome(!0),e.options.success&&e.options.success({item:i})}},addSimpleImage:function(e){g.console.assert(e,"[Viewer.addSimpleImage] options is required"),g.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");e=g.extend({},e,{tileSource:{type:"image",url:e.url}});delete e.url,this.addTiledImage(e)},addLayer:function(t){var i=this,e=(g.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead."),g.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}}));return this.addTiledImage(e),this},getLayerAtLevel:function(e){return g.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return g.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return g.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,t){return g.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,t)},removeLayer:function(e){return g.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return d[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=g.delegate(this,ut),t=g.delegate(this,ht),i=g.delegate(this,this.goToNextPage),n=g.delegate(this,this.goToPreviousPage),o=this.navImages,r=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new g.Button({element:this.previousButton?g.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.PreviousPage"),srcRest:O(this.prefixUrl,o.previous.REST),srcGroup:O(this.prefixUrl,o.previous.GROUP),srcHover:O(this.prefixUrl,o.previous.HOVER),srcDown:O(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new g.Button({element:this.nextButton?g.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.NextPage"),srcRest:O(this.prefixUrl,o.next.REST),srcGroup:O(this.prefixUrl,o.next.GROUP),srcHover:O(this.prefixUrl,o.next.HOVER),srcDown:O(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),r&&(this.paging=new g.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:g.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||g.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=g.delegate(this,Lt),t=g.delegate(this,It),i=g.delegate(this,Ht),n=g.delegate(this,Dt),o=g.delegate(this,Mt),r=g.delegate(this,Bt),s=g.delegate(this,Nt),a=g.delegate(this,Ft),l=g.delegate(this,qt),c=g.delegate(this,jt),u=g.delegate(this,ut),h=g.delegate(this,ht),d=this.navImages,p=[],m=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(m=!1),this.showZoomControl&&(p.push(this.zoomInButton=new g.Button({element:this.zoomInButton?g.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.ZoomIn"),srcRest:O(this.prefixUrl,d.zoomIn.REST),srcGroup:O(this.prefixUrl,d.zoomIn.GROUP),srcHover:O(this.prefixUrl,d.zoomIn.HOVER),srcDown:O(this.prefixUrl,d.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:u,onBlur:h})),p.push(this.zoomOutButton=new g.Button({element:this.zoomOutButton?g.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.ZoomOut"),srcRest:O(this.prefixUrl,d.zoomOut.REST),srcGroup:O(this.prefixUrl,d.zoomOut.GROUP),srcHover:O(this.prefixUrl,d.zoomOut.HOVER),srcDown:O(this.prefixUrl,d.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:u,onBlur:h}))),this.showHomeControl&&p.push(this.homeButton=new g.Button({element:this.homeButton?g.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.Home"),srcRest:O(this.prefixUrl,d.home.REST),srcGroup:O(this.prefixUrl,d.home.GROUP),srcHover:O(this.prefixUrl,d.home.HOVER),srcDown:O(this.prefixUrl,d.home.DOWN),onRelease:r,onFocus:u,onBlur:h})),this.showFullPageControl&&p.push(this.fullPageButton=new g.Button({element:this.fullPageButton?g.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.FullPage"),srcRest:O(this.prefixUrl,d.fullpage.REST),srcGroup:O(this.prefixUrl,d.fullpage.GROUP),srcHover:O(this.prefixUrl,d.fullpage.HOVER),srcDown:O(this.prefixUrl,d.fullpage.DOWN),onRelease:s,onFocus:u,onBlur:h})),this.showRotationControl&&(p.push(this.rotateLeftButton=new g.Button({element:this.rotateLeftButton?g.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.RotateLeft"),srcRest:O(this.prefixUrl,d.rotateleft.REST),srcGroup:O(this.prefixUrl,d.rotateleft.GROUP),srcHover:O(this.prefixUrl,d.rotateleft.HOVER),srcDown:O(this.prefixUrl,d.rotateleft.DOWN),onRelease:a,onFocus:u,onBlur:h})),p.push(this.rotateRightButton=new g.Button({element:this.rotateRightButton?g.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.RotateRight"),srcRest:O(this.prefixUrl,d.rotateright.REST),srcGroup:O(this.prefixUrl,d.rotateright.GROUP),srcHover:O(this.prefixUrl,d.rotateright.HOVER),srcDown:O(this.prefixUrl,d.rotateright.DOWN),onRelease:l,onFocus:u,onBlur:h}))),this.showFlipControl&&p.push(this.flipButton=new g.Button({element:this.flipButton?g.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.Flip"),srcRest:O(this.prefixUrl,d.flip.REST),srcGroup:O(this.prefixUrl,d.flip.GROUP),srcHover:O(this.prefixUrl,d.flip.HOVER),srcDown:O(this.prefixUrl,d.flip.DOWN),onRelease:c,onFocus:u,onBlur:h})),m?(this.buttonGroup=new g.ButtonGroup({buttons:p,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",g.delegate(this,zt)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||g.ControlAnchor.TOP_LEFT})):this.customButtons=p),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&0<=e&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(e,t,i,n){t=g.isPlainObject(e)?e:{element:e,location:t,placement:i,onDraw:n};return e=g.getElement(t.element),0<=rt(this.currentOverlays,e)||(i=ot(this,t),this.currentOverlays.push(i),i.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:t.location,placement:t.placement})),this},updateOverlay:function(e,t,i){var n;return e=g.getElement(e),0<=(n=rt(this.currentOverlays,e))&&(this.currentOverlays[n].update(t,i),d[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=g.getElement(e),0<=(t=rt(this.currentOverlays,e))&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),d[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return d[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){return e=g.getElement(e),0<=(e=rt(this.currentOverlays,e))?this.currentOverlays[e]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<e?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=g.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=g.makeCenteredNode(t),g.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var e=this.currentOverlays.length,t=0;t<e;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?this.referenceStrip||this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new g.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):g.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),g.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){g.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var e=g.pixelDensityRatio,t=g.getCurrentPixelDensityRatio();e!==t&&(g.pixelDensityRatio=t,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)},goToNextPage:function(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)},isAnimating:function(){return d[this.hash].animating}}),(a=c).Navigator=function(e){var t,i,n,o=e.viewer,r=this;function s(e){Zt(r.displayRegionContainer,e),Zt(r.displayRegion,-e),r.viewport.setRotation(e)}e.id?(this.element=document.getElementById(e.id),e.controlOptions={anchor:a.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(e.id="navigator-"+a.now(),this.element=a.makeNeutralElement("div"),e.controlOptions={anchor:a.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:e.autoFade},e.position&&("BOTTOM_RIGHT"===e.position?e.controlOptions.anchor=a.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===e.position?e.controlOptions.anchor=a.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===e.position?e.controlOptions.anchor=a.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===e.position?e.controlOptions.anchor=a.ControlAnchor.TOP_LEFT:"ABSOLUTE"===e.position&&(e.controlOptions.anchor=a.ControlAnchor.ABSOLUTE,e.controlOptions.top=e.top,e.controlOptions.left=e.left,e.controlOptions.height=e.height,e.controlOptions.width=e.width))),this.element.id=e.id,this.element.className+=" navigator",(e=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.navigatorSizeRatio},e,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:e.autoResize,minZoomImageRatio:1,background:e.background,opacity:e.opacity,borderColor:e.borderColor,displayRegionColor:e.displayRegionColor})).minPixelRatio=this.minPixelRatio=o.minPixelRatio,a.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new a.Point(1,1),this.totalBorderWidths=new a.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),e.controlOptions.anchor!==a.ControlAnchor.NONE&&(n=this.element.style,i=this.borderWidth,n.margin="0px",n.border=i+"px solid "+e.borderColor,n.padding="0px",n.background=e.background,n.opacity=e.opacity,n.overflow="hidden"),this.displayRegion=a.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",i=this.displayRegion.style,n=this.borderWidth,i.position="relative",i.top="0px",i.left="0px",i.fontSize="0px",i.overflow="hidden",i.border=n+"px solid "+e.displayRegionColor,i.margin="0px",i.padding="0px",i.background="transparent",i.float="left",i.cssFloat="left",i.styleFloat="left",i.zIndex=999999999,i.cursor="default",a.setElementPointerEventsNone(this.displayRegion),a.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=a.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",a.setElementPointerEventsNone(this.displayRegionContainer),a.setElementTouchActionNone(this.displayRegionContainer),o.addControl(this.element,e.controlOptions),this._resizeWithViewer=e.controlOptions.anchor!==a.ControlAnchor.ABSOLUTE&&e.controlOptions.anchor!==a.ControlAnchor.NONE,e.width&&e.height?(this.setWidth(e.width),this.setHeight(e.height)):this._resizeWithViewer&&(t=a.getElementSize(o.element),this.element.style.height=Math.round(t.y*e.sizeRatio)+"px",this.element.style.width=Math.round(t.x*e.sizeRatio)+"px",this.oldViewerSize=t,t=a.getElementSize(this.element),this.elementArea=t.x*t.y),this.oldContainerSize=new a.Point(0,0),a.Viewer.apply(this,[e]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),e.navigatorRotate&&(s(e.viewer.viewport?e.viewer.viewport.getRotation():e.viewer.degrees||0),e.viewer.addHandler("rotate",function(e){s(e.degrees)})),this.innerTracker.destroy(),this.innerTracker=new a.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:a.delegate(this,Ut),clickHandler:a.delegate(this,Wt),releaseHandler:a.delegate(this,Vt),scrollHandler:a.delegate(this,Gt),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",a.setElementPointerEventsNone(this.canvas),a.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){r.viewport&&r.viewport.goHome(!0)}),o.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=r.world.getItemAt(t.previousIndex);r.world.setItemIndex(e,t.newIndex)},1)}),o.world.addHandler("remove-item",function(e){e=e.item,e=r._getMatchingItem(e);e&&r.world.removeItem(e)}),this.update(o.viewport)},a.extend(a.Navigator.prototype,a.EventSource.prototype,a.Viewer.prototype,{updateSize:function(){var e;this.viewport&&!(e=new a.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight)).equals(this.oldContainerSize)&&(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){Xt(this.displayRegion,e),Xt(this.canvas,e),Xt(this.element,e)},update:function(e){var t,i,n=a.getElementSize(this.viewer.element);this._resizeWithViewer&&n.x&&n.y&&!n.equals(this.oldViewerSize)&&(this.oldViewerSize=n,n=this.maintainSizeRatio||!this.elementArea?(t=n.x*this.sizeRatio,n.y*this.sizeRatio):(t=Math.sqrt(this.elementArea*(n.x/n.y)),this.elementArea/t),this.element.style.width=Math.round(t)+"px",this.element.style.height=Math.round(n)+"px",this.elementArea||(this.elementArea=t*n),this.updateSize()),e&&this.viewport&&(t=e.getBoundsNoRotate(!0),n=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!1),e=this.viewport.pixelFromPointNoRotate(t.getBottomRight(),!1).minus(this.totalBorderWidths),(t=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",t.top=Math.round(n.y)+"px",t.left=Math.round(n.x)+"px",i=Math.abs(n.x-e.x),n=Math.abs(n.y-e.y),t.width=Math.round(Math.max(i,0))+"px",t.height=Math.round(Math.max(n,0))+"px")},addTiledImage:function(e){var n=this,o=e.originalTiledImage,e=(delete e.original,a.extend({},e,{success:function(e){var t=e.item;function i(){n._matchBounds(t,o)}t._originalForNavigator=o,n._matchBounds(t,o,!0),n._matchOpacity(t,o),n._matchCompositeOperation(t,o),o.addHandler("bounds-change",i),o.addHandler("clip-change",i),o.addHandler("opacity-change",function(){n._matchOpacity(t,o)}),o.addHandler("composite-operation-change",function(){n._matchCompositeOperation(t,o)})}}));return a.Viewer.prototype.addTiledImage.apply(this,[e])},destroy:function(){return a.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip()),e.setFlip(t.getFlip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}}),Q={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}},($=c).extend($,{getString:function(e){for(var t=e.split("."),i=null,n=arguments,o=Q,r=0;r<t.length-1;r++)o=o[t[r]]||{};return"string"!=typeof(i=o[t[r]])&&($.console.error("Untranslated source string:",e),i=""),i.replace(/\{\d+\}/g,function(e){e=parseInt(e.match(/\d+/),10)+1;return e<n.length?n[e]:""})},setString:function(e,t){for(var i=e.split("."),n=Q,o=0;o<i.length-1;o++)n[i[o]]||(n[i[o]]={}),n=n[i[o]];n[i[o]]=t}}),(s=c).Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},s.Point.prototype={clone:function(){return new s.Point(this.x,this.y)},plus:function(e){return new s.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new s.Point(this.x-e.x,this.y-e.y)},times:function(e){return new s.Point(this.x*e,this.y*e)},divide:function(e){return new s.Point(this.x/e,this.y/e)},negate:function(){return new s.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new s.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof s.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,t){if(t=t||new s.Point(0,0),e%90==0)switch(s.positiveModulo(e,360)){case 0:i=1,n=0;break;case 90:i=0,n=1;break;case 180:i=-1,n=0;break;case 270:i=0,n=-1}else var e=e*Math.PI/180,i=Math.cos(e),n=Math.sin(e);e=i*(this.x-t.x)-n*(this.y-t.y)+t.x,t=n*(this.x-t.x)+i*(this.y-t.y)+t.y;return new s.Point(e,t)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}},(p=c).TileSource=function(e,t,i,n,o,r){var s,a=this,l=arguments,l=p.isPlainObject(e)?e:{width:l[0],height:l[1],tileSize:l[2],tileOverlap:l[3],minLevel:l[4],maxLevel:l[5]};if(p.EventSource.call(this),p.extend(!0,this,l),!this.success)for(s=0;s<arguments.length;s++)if(p.isFunction(arguments[s])){this.success=arguments[s];break}this.success&&this.addHandler("ready",function(e){a.success(e)}),"string"===p.type(e)&&(this.url=e),this.url?(this.aspectRatio=1,this.dimensions=new p.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=l.width&&l.height?l.width/l.height:1,this.dimensions=new p.Point(l.width,l.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=l.tileOverlap||0,this.minLevel=l.minLevel||0,this.maxLevel=void 0!==l.maxLevel&&null!==l.maxLevel?l.maxLevel:l.width&&l.height?Math.ceil(Math.log(Math.max(l.width,l.height))/Math.log(2)):0,this.success&&p.isFunction(this.success)&&this.success(this))},p.TileSource.prototype={getTileSize:function(e){return p.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth||this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight||this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){for(var t={},e=0;e<=this.maxLevel;e++)t[e]=1/Math.pow(2,this.maxLevel-e);this.getLevelScale=function(e){return t[e]}},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.getTileWidth(e)),t=Math.ceil(t*this.dimensions.y/this.getTileHeight(e));return new p.Point(i,t)},getPixelRatio:function(e){var e=this.dimensions.times(this.getLevelScale(e)),t=1/e.x*p.pixelDensityRatio,e=1/e.y*p.pixelDensityRatio;return new p.Point(t,e)},getClosestLevel:function(){for(var e,t=this.minLevel+1;t<=this.maxLevel&&!(1<(e=this.getNumTiles(t)).x||1<e.y);t++);return t-1},getTileAtPoint:function(e,t){var i=0<=t.x&&t.x<=1&&0<=t.y&&t.y<=1/this.aspectRatio,i=(p.console.assert(i,"[TileSource.getTileAtPoint] must be called with a valid point."),this.dimensions.x*this.getLevelScale(e)),n=t.x*i,i=t.y*i,n=Math.floor(n/this.getTileWidth(e)),i=Math.floor(i/this.getTileHeight(e));1<=t.x&&(n=this.getNumTiles(e).x-1);return t.y>=1/this.aspectRatio-1e-15&&(i=this.getNumTiles(e).y-1),new p.Point(n,i)},getTileBounds:function(e,t,i,n){var o=this.dimensions.times(this.getLevelScale(e)),r=this.getTileWidth(e),e=this.getTileHeight(e),s=0===t?0:r*t-this.tileOverlap,a=0===i?0:e*i-this.tileOverlap,r=r+(0===t?1:2)*this.tileOverlap,t=e+(0===i?1:2)*this.tileOverlap,e=1/o.x,r=Math.min(r,o.x-s),t=Math.min(t,o.y-a);return n?new p.Rect(0,0,r,t):new p.Rect(s*e,a*e,r*e,t*e)},getImageInfo:function(o){var t,i,e,n,r,s=this,a=(o&&-1<(n=(e=(r=o.split("/"))[r.length-1]).lastIndexOf("."))&&(r[r.length-1]=e.slice(0,n)),null);this.splitHashDataForPost&&-1!==(r=o.indexOf("#"))&&(a=o.substring(r+1),o=o.substr(0,r)),t=function(e){"string"==typeof e&&(e=p.parseXml(e));var t=p.TileSource.determineType(s,e,o);t?(void 0===(i=t.prototype.configure.apply(s,[e,o,a])).ajaxWithCredentials&&(i.ajaxWithCredentials=s.ajaxWithCredentials),i=new t(i),s.ready=!0,s.raiseEvent("ready",{tileSource:i})):s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:o})},o.match(/\.js$/)?(e=o.split("/").pop().replace(".js",""),p.jsonp({url:o,async:!1,callbackName:e,callback:t})):p.makeAjaxRequest({url:o,postData:a,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){e=function(t){var e,i,n=t.responseText,o=t.status;{if(!t)throw new Error(p.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw o=t.status,e=404===o?"Not Found":t.statusText,new Error(p.getString("Errors.Status",o,e))}if(n.match(/\s*<.*/))try{i=t.responseXML&&t.responseXML.documentElement?t.responseXML:p.parseXml(n)}catch(e){i=t.responseText}else if(n.match(/\s*[{[].*/))try{i=p.parseJSON(n)}catch(e){i=n}else i=n;return i}(e);t(e)},error:function(t,i){try{n="HTTP "+t.status+" attempting to load TileSource: "+o}catch(e){var t=void 0!==i&&i.toString?i.toString():"Unknown error",n=t+" attempting to load TileSource: "+o}p.console.error(n),s.raiseEvent("open-failed",{message:n,source:o,postData:a})}})},supports:function(e,t){return!1},configure:function(e,t,i){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTilePostData:function(e,t,i){return null},getTileAjaxHeaders:function(e,t,i){return{}},getTileHashKey:function(e,t,i,n,o,r){return o?n+"+"+JSON.stringify(o):n},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=t&&0<=i&&t<n.x&&i<n.y}},p.extend(!0,p.TileSource.prototype,p.EventSource.prototype),p.TileSource.determineType=function(e,t,i){for(var n in c)if(n.match(/.+TileSource$/)&&p.isFunction(c[n])&&p.isFunction(c[n].prototype.supports)&&c[n].prototype.supports.call(e,t,i))return c[n];return p.console.error("No TileSource was able to open %s %s",i,t),null},(m=c).DziTileSource=function(e,t,i,n,o,r,s,a,l){var c,u,h,d=m.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o,fileFormat:r,displayRects:s,minLevel:a,maxLevel:l};if(this._levelRects={},this.tilesUrl=d.tilesUrl,this.fileFormat=d.fileFormat,this.displayRects=d.displayRects,this.displayRects)for(c=this.displayRects.length-1;0<=c;c--)for(h=(u=this.displayRects[c]).minLevel;h<=u.maxLevel;h++)this._levelRects[h]||(this._levelRects[h]=[]),this._levelRects[h].push(u);m.TileSource.apply(this,[d])},m.extend(m.DziTileSource.prototype,m.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:!e.documentElement||"Image"!==e.documentElement.localName&&"Image"!==e.documentElement.tagName||(i=e.documentElement.namespaceURI),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(e,t,i){e=(m.isPlainObject(e)?Kt:function(e,t){if(!t||!t.documentElement)throw new Error(m.getString("Errors.Xml"));var i,n,o,r,s=t.documentElement,a=s.localName||s.tagName,l=t.documentElement.namespaceURI,t=null,c=[];if("Image"===a)try{if(void 0===(u=s.getElementsByTagName("Size")[0])&&(u=s.getElementsByTagNameNS(l,"Size")[0]),t={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:s.getAttribute("Url"),Format:s.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(s.getAttribute("Overlap"),10),TileSize:parseInt(s.getAttribute("TileSize"),10),Size:{Height:parseInt(u.getAttribute("Height"),10),Width:parseInt(u.getAttribute("Width"),10)}}},!m.imageFormatSupported(t.Image.Format))throw new Error(m.getString("Errors.ImageFormat",t.Image.Format.toUpperCase()));for(void 0===(i=s.getElementsByTagName("DisplayRect"))&&(i=s.getElementsByTagNameNS(l,"DisplayRect")[0]),r=0;r<i.length;r++)n=i[r],void 0===(o=n.getElementsByTagName("Rect")[0])&&(o=n.getElementsByTagNameNS(l,"Rect")[0]),c.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(n.getAttribute("MinLevel"),10),MaxLevel:parseInt(n.getAttribute("MaxLevel"),10)}});return c.length&&(t.Image.DisplayRect=c),Kt(0,t)}catch(e){throw e instanceof Error?e:new Error(m.getString("Errors.Dzi"))}else{if("Collection"===a)throw new Error(m.getString("Errors.Dzc"));var u;if("Error"===a)throw u=s.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(u)}throw new Error(m.getString("Errors.Dzi"))})(this,e);return t&&!e.tilesUrl&&(e.tilesUrl=t.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),-1!==t.search(/\.(dzi|xml|js)\?/)?e.queryParams=t.match(/\?.*/):e.queryParams=""),e},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,c=this._levelRects[e];if(!(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)){if(!c||!c.length)return!0;for(l=c.length-1;0<=l;l--)if(!(e<(a=c[l]).minLevel||e>a.maxLevel)&&(n=this.getLevelScale(e),o=a.x*n,r=a.y*n,s=o+a.width*n,a=r+a.height*n,o=Math.floor(o/this._tileWidth),r=Math.floor(r/this._tileWidth),s=Math.ceil(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),o<=t&&t<s&&r<=i&&i<a))return!0}return!1}}),(v=c).IIIFTileSource=function(e){if(v.extend(!0,this,e),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(e.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=e.version,this.tile_width&&this.tile_height)e.tileWidth=this.tile_width,e.tileHeight=this.tile_height;else if(this.tile_width)e.tileSize=this.tile_width;else if(this.tile_height)e.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)e.tileWidth=this.tiles[0].width,e.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var i=0;i<this.tiles[t].scaleFactors.length;i++){var n=this.tiles[t].scaleFactors[i];this.scale_factors.push(n),e.tileSizePerScaleFactor[n]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(Yt(e)){for(var o=Math.min(this.height,this.width),r=[256,512,1024],s=[],a=0;a<r.length;a++)r[a]<=o&&s.push(r[a]);0<s.length?e.tileSize=Math.max.apply(null,s):e.tileSize=o}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,e.levels=Jt(this),v.extend(!0,e,{width:e.levels[e.levels.length-1].width,height:e.levels[e.levels.length-1].height,tileSize:Math.max(e.height,e.width),tileOverlap:0,minLevel:0,maxLevel:e.levels.length-1}),this.levels=e.levels):v.console.error("Nothing in the info.json to construct image pyramids from");var l;e.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?(l=Math.max.apply(null,this.scale_factors),e.maxLevel=Math.round(Math.log(l)*Math.LOG2E)):e.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),v.TileSource.apply(this,[e])},v.extend(v.IIIFTileSource.prototype,v.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!==e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!==e["@context"]&&"http://iiif.io/api/image/1/context.json"!==e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!==e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!==e.documentElement.namespaceURI))))},configure:function(e,t,i){var n;if(v.isPlainObject(e)){if(e["@context"]){var o=e["@context"];if(Array.isArray(o))for(var r=0;r<o.length;r++)if("string"==typeof o[r]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(o[r])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===o[r])){o=o[r];break}switch(o){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":e.version=1;break;case"http://iiif.io/api/image/2/context.json":e.version=2;break;case"http://iiif.io/api/image/3/context.json":e.version=3;break;default:v.console.error("Data has a @context property which contains no known IIIF context URI.")}}else e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=t.replace("/info.json",""),e.version=1;if(!e["@id"]&&e.id&&(e["@id"]=e.id),e.preferredFormats)for(var s=0;s<e.preferredFormats.length;s++)if(c.imageFormatSupported(e.preferredFormats[s])){e.tileFormat=e.preferredFormats[s];break}return e}return(n=function(e){if(!e||!e.documentElement)throw new Error(v.getString("Errors.Xml"));var e=e.documentElement,t=e.tagName,i=null;if("info"===t)try{return function e(t,i,n){var o,r;if(3===t.nodeType&&n)(r=t.nodeValue.trim()).match(/^\d*$/)&&(r=Number(r)),i[n]?(v.isArray(i[n])||(i[n]=[i[n]]),i[n].push(r)):i[n]=r;else if(1===t.nodeType)for(o=0;o<t.childNodes.length;o++)e(t.childNodes[o],i,t.nodeName)}(e,i={}),i}catch(e){throw e instanceof Error?e:new Error(v.getString("Errors.IIIF"))}throw new Error(v.getString("Errors.IIIF"))}(e))["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=t.replace("/info.xml",""),n.version=1,n},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return v.TileSource.prototype.getTileWidth.call(this,e);e=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return v.TileSource.prototype.getTileHeight.call(this,e);e=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[e]?this.tileSizePerScaleFactor[e].height:this._tileHeight},getLevelScale:function(e){var t;return this.emulateLegacyImagePyramid?(t=NaN,0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:t):v.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){return this.emulateLegacyImagePyramid?this.getLevelScale(e)?new v.Point(1,1):new v.Point(0,0):v.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,t){return this.emulateLegacyImagePyramid?new v.Point(0,0):v.TileSource.prototype.getTileAtPoint.call(this,e,t)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid)return r=null,0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:r;var n,o,r=Math.pow(.5,this.maxLevel-e),s=Math.ceil(this.width*r),a=Math.ceil(this.height*r),l=this.getTileWidth(e),e=this.getTileHeight(e),c=Math.ceil(l/r),u=Math.ceil(e/r),h=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat;return s<l&&a<e?(o=2===this.version&&s===this.width?"full":3===this.version&&s===this.width&&a===this.height?"max":3===this.version?s+","+a:s+",",n="full"):(l=t*c,e=i*u,a=Math.min(c,this.width-l),s=Math.min(u,this.height-e),n=0===t&&0===i&&a===this.width&&s===this.height?"full":[l,e,a,s].join(","),c=Math.ceil(a*r),u=Math.ceil(s*r),o=2===this.version&&c===this.width?"full":3===this.version&&c===this.width&&u===this.height?"max":3===this.version?c+","+u:c+","),[this["@id"],n,o,"0",h].join("/")},__testonly__:{canBeTiled:Yt,constructLevels:Jt}}),(ee=c).OsmTileSource=function(e,t,i,n,o){var r=ee.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o};r.width&&r.height||(r.width=65572864,r.height=65572864),r.tileSize||(r.tileSize=256,r.tileOverlap=0),r.tilesUrl||(r.tilesUrl="http://tile.openstreetmap.org/"),r.minLevel=8,ee.TileSource.apply(this,[r])},ee.extend(ee.OsmTileSource.prototype,ee.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}}),(te=c).TmsTileSource=function(e,t,i,n,o){var r=te.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o},s=256*Math.ceil(r.width/256),a=256*Math.ceil(r.height/256),l=a<s?s/256:a/256;r.maxLevel=Math.ceil(Math.log(l)/Math.log(2))-1,r.tileSize=256,r.width=s,r.height=a,te.TileSource.apply(this,[r])},te.extend(te.TmsTileSource.prototype,te.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}}),(ie=c).ZoomifyTileSource=function(e){void 0===e.tileSize&&(e.tileSize=256),void 0===e.fileFormat&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,c.TileSource.apply(this,[e])},ie.extend(ie.ZoomifyTileSource.prototype,ie.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,o={},r=0;r<e;r++)n+=(o=this.gridSize[r]).x*o.y;return n+=(o=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"===e.type},configure:function(e,t,i){return e},getTileUrl:function(e,t,i){var n=this._calculateAbsoluteTileNumber(e,t,i),n=Math.floor(n/256);return this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+"."+this.fileFormat}}),(l=c).LegacyTileSource=function(e){var t,i,n;(t=l.isArray(e)?{type:"legacy-image-pyramid",levels:e}:t).levels=function(e){var t,i,n=[];for(i=0;i<e.length;i++)(t=e[i]).height&&t.width&&t.url?n.push({url:t.url,width:Number(t.width),height:Number(t.height)}):l.console.error("Unsupported image format: %s",t.url||"<no URL>");return n.sort(function(e,t){return e.height-t.height})}(t.levels),0<t.levels.length?(i=t.levels[t.levels.length-1].width,n=t.levels[t.levels.length-1].height):(n=i=0,l.console.error("No supported image formats found")),l.extend(!0,t,{width:i,height:n,tileSize:Math.max(n,i),tileOverlap:0,minLevel:0,maxLevel:0<t.levels.length?t.levels.length-1:0}),l.TileSource.apply(this,[t]),this.levels=t.levels},l.extend(l.LegacyTileSource.prototype,l.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"===e.type||e.documentElement&&"legacy-image-pyramid"===e.documentElement.getAttribute("type")},configure:function(e,t,i){e=l.isPlainObject(e)?e.levels:function(e){if(!e||!e.documentElement)throw new Error(l.getString("Errors.Xml"));var t,i,n=e.documentElement,o=n.tagName,r=null,s=[];if("image"===o)try{for(r={type:n.getAttribute("type"),levels:[]},s=n.getElementsByTagName("level"),i=0;i<s.length;i++)t=s[i],r.levels.push({url:t.getAttribute("url"),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10)});return r.levels}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===o)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===o)throw new Error("Error: "+e)}throw new Error("Unknown element "+o)}(e);return e},getLevelScale:function(e){var t=NaN;return t=0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:t},getNumTiles:function(e){return this.getLevelScale(e)?new l.Point(1,1):new l.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return n=0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:n}}),(f=c).ImageTileSource=function(e){e=f.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),f.TileSource.apply(this,[e])},f.extend(f.ImageTileSource.prototype,f.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t,i){return e},getImageInfo:function(e){var t=this._image=new Image,i=this;this.crossOriginPolicy&&(t.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(t.useCredentials=this.ajaxWithCredentials),f.addEvent(t,"load",function(){i.width=t.naturalWidth,i.height=t.naturalHeight,i.aspectRatio=i.width/i.height,i.dimensions=new f.Point(i.width,i.height),i._tileWidth=i.width,i._tileHeight=i.height,i.tileOverlap=0,i.minLevel=0,i.levels=i._buildLevels(),i.maxLevel=i.levels.length-1,i.ready=!0,i.raiseEvent("ready",{tileSource:i})}),f.addEvent(t,"error",function(){i.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),t.src=e},getLevelScale:function(e){var t=NaN;return t=e>=this.minLevel&&e<=this.maxLevel?this.levels[e].width/this.levels[this.maxLevel].width:t},getNumTiles:function(e){return this.getLevelScale(e)?new f.Point(1,1):new f.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return n=e>=this.minLevel&&e<=this.maxLevel?this.levels[e].url:n},getContext2D:function(e,t,i){var n=null;return n=e>=this.minLevel&&e<=this.maxLevel?this.levels[e].context2D:n},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var e=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(this.buildPyramid&&f.supportsCanvas&&this.useCanvas){var t=this._image.naturalWidth,i=this._image.naturalHeight,n=document.createElement("canvas"),o=n.getContext("2d");if(n.width=t,n.height=i,o.drawImage(this._image,0,0,t,i),e[0].context2D=o,delete this._image,!f.isCanvasTainted(n))for(;2<=t&&2<=i;){var t=Math.floor(t/2),i=Math.floor(i/2),r=document.createElement("canvas"),s=r.getContext("2d");r.width=t,r.height=i,s.drawImage(n,0,0,t,i),e.splice(0,0,{context2D:s,width:t,height:i}),n=r,o=s}}else delete this._image;return e},_freeupCanvasMemory:function(){for(var e=0;e<this.levels.length;e++)this.levels[e].context2D&&(this.levels[e].context2D.canvas.height=0,this.levels[e].context2D.canvas.width=0)}}),(ne=c).TileSourceCollection=function(e,t,i,n){ne.console.error("TileSourceCollection is deprecated; use World instead")},(y=c).ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},y.Button=function(e){var t=this;y.EventSource.call(this),y.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:y.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:y.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},e),this.element=e.element||y.makeNeutralElement("div"),e.element||(this.imgRest=y.makeTransparentImage(this.srcRest),this.imgGroup=y.makeTransparentImage(this.srcGroup),this.imgHover=y.makeTransparentImage(this.srcHover),this.imgDown=y.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,y.setElementPointerEventsNone(this.imgRest),y.setElementPointerEventsNone(this.imgGroup),y.setElementPointerEventsNone(this.imgHover),y.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",y.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",y.Browser.vendor===y.BROWSERS.FIREFOX&&y.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=y.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new y.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(Qt(t,y.ButtonState.DOWN),t.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||Qt(t,y.ButtonState.HOVER)},focusHandler:function(e){t.tracker.enterHandler(e),t.raiseEvent("focus",{originalEvent:e.originalEvent})},leaveHandler:function(e){ei(t,y.ButtonState.GROUP),e.insideElementPressed&&t.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(e){t.tracker.leaveHandler(e),t.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(e){Qt(t,y.ButtonState.DOWN),t.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(ei(t,y.ButtonState.HOVER),t.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?ei(t,y.ButtonState.GROUP):Qt(t,y.ButtonState.HOVER)},clickHandler:function(e){e.quick&&t.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){13===e.keyCode?(t.raiseEvent("click",{originalEvent:e.originalEvent}),t.raiseEvent("release",{originalEvent:e.originalEvent}),e.preventDefault=!0):e.preventDefault=!1}}),ei(this,y.ButtonState.REST)},y.extend(y.Button.prototype,y.EventSource.prototype,{notifyGroupEnter:function(){Qt(this,y.ButtonState.GROUP)},notifyGroupExit:function(){ei(this,y.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,y.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,y.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}}),(oe=c).ButtonGroup=function(e){oe.extend(!0,this,{buttons:[],clickTimeThreshold:oe.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:oe.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var t,i=this.buttons.concat([]),n=this;if(this.element=e.element||oe.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",t=0;t<i.length;t++)this.element.appendChild(i[t].element);oe.setElementTouchActionNone(this.element),this.tracker=new oe.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){for(var t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},leaveHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},oe.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}},(b=c).Rect=function(e,t,i,n,o){var r,s;this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof o?o:0,this.degrees=b.positiveModulo(this.degrees,360),270<=this.degrees?(r=this.getTopRight(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):180<=this.degrees?(r=this.getBottomRight(),this.x=r.x,this.y=r.y,this.degrees-=180):90<=this.degrees&&(r=this.getBottomLeft(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},b.Rect.fromSummits=function(e,t,i){var n=e.distanceTo(t),i=e.distanceTo(i),t=t.minus(e),o=Math.atan(t.y/t.x);return t.x<0?o+=Math.PI:t.y<0&&(o+=2*Math.PI),new b.Rect(e.x,e.y,n,i,o/Math.PI*180)},b.Rect.prototype={clone:function(){return new b.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new b.Point(this.x,this.y)},getBottomRight:function(){return new b.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new b.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new b.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new b.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new b.Point(this.width,this.height)},equals:function(e){return e instanceof b.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new b.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new b.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var t=this.getBoundingBox(),e=e.getBoundingBox(),i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),o=Math.max(t.x+t.width,e.x+e.width),t=Math.max(t.y+t.height,e.y+e.height);return new b.Rect(i,n,o-i,t-n)},intersection:function(e){for(var s=1e-10,t=[],i=this.getTopLeft(),i=(e.containsPoint(i,s)&&t.push(i),this.getTopRight()),i=(e.containsPoint(i,s)&&t.push(i),this.getBottomLeft()),i=(e.containsPoint(i,s)&&t.push(i),this.getBottomRight()),i=(e.containsPoint(i,s)&&t.push(i),e.getTopLeft()),i=(this.containsPoint(i,s)&&t.push(i),e.getTopRight()),i=(this.containsPoint(i,s)&&t.push(i),e.getBottomLeft()),i=(this.containsPoint(i,s)&&t.push(i),e.getBottomRight()),n=(this.containsPoint(i,s)&&t.push(i),this._getSegments()),o=e._getSegments(),r=0;r<n.length;r++)for(var a=n[r],l=0;l<o.length;l++){var c=o[l],c=function(e,t,i,n){var t=t.minus(e),n=n.minus(i),o=-n.x*t.y+t.x*n.y;if(0!=o){var r=(t.x*(e.y-i.y)-t.y*(e.x-i.x))/o,n=(n.x*(e.y-i.y)-n.y*(e.x-i.x))/o;if(-s<=r&&r<=1-s&&-s<=n&&n<=1-s)return new b.Point(e.x+n*t.x,e.y+n*t.y)}return null}(a[0],a[1],c[0],c[1]);c&&t.push(c)}if(0===t.length)return null;for(var u=t[0].x,h=t[0].x,d=t[0].y,p=t[0].y,m=1;m<t.length;m++){var g=t[m];g.x<u&&(u=g.x),g.x>h&&(h=g.x),g.y<d&&(d=g.y),g.y>p&&(p=g.y)}return new b.Rect(u,d,h-u,p-d)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(e,t){if(0===(e=b.positiveModulo(e,360)))return this.clone();t=t||this.getCenter();var i=this.getTopLeft().rotate(e,t),e=(e=this.getTopRight().rotate(e,t).minus(i)).apply(function(e){return Math.abs(e)<1e-15?0:e}),t=Math.atan(e.y/e.x);return e.x<0?t+=Math.PI:e.y<0&&(t+=2*Math.PI),new b.Rect(i.x,i.y,this.width,this.height,t/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight(),o=Math.min(e.x,t.x,i.x,n.x),r=Math.max(e.x,t.x,i.x,n.x),s=Math.min(e.y,t.y,i.y,n.y),e=Math.max(e.y,t.y,i.y,n.y);return new b.Rect(o,s,r-o,e-s)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),t=Math.floor(e.x),i=Math.floor(e.y),n=Math.ceil(e.width+e.x-t),e=Math.ceil(e.height+e.y-i);return new b.Rect(t,i,n,e)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),o=this.getBottomLeft(),r=n.minus(i),s=o.minus(i);return(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-n.x)*r.x+(e.y-n.y)*r.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-o.x)*s.x+(e.y-o.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}},re={},(w=c).ReferenceStrip=function(e){var t,i,n,o=e.viewer,r=w.getElementSize(o.element);for(e.id||(e.id="referencestrip-"+w.now(),this.element=w.makeNeutralElement("div"),this.element.id=e.id,this.element.className="referencestrip"),e=w.extend(!0,{sizeRatio:w.DEFAULT_SETTINGS.referenceStripSizeRatio,position:w.DEFAULT_SETTINGS.referenceStripPosition,scroll:w.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:w.DEFAULT_SETTINGS.clickTimeThreshold},e,{element:this.element}),w.extend(this,e),re[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(i=this.element.style).marginTop="0px",i.marginRight="0px",i.marginBottom="0px",i.marginLeft="0px",i.left="0px",i.bottom="0px",i.border="0px",i.background="#000",i.position="relative",w.setElementTouchActionNone(this.element),w.setElementOpacity(this.element,.8),this.viewer=o,this.tracker=new w.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:w.delegate(this,ti),dragHandler:w.delegate(this,ii),scrollHandler:w.delegate(this,ni),enterHandler:w.delegate(this,oi),leaveHandler:w.delegate(this,ri),keyDownHandler:w.delegate(this,si),keyHandler:w.delegate(this,ai),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),e.width&&e.height?(this.element.style.width=e.width+"px",this.element.style.height=e.height+"px",o.addControl(this.element,{anchor:w.ControlAnchor.BOTTOM_LEFT})):"horizontal"===e.scroll?(this.element.style.width=r.x*e.sizeRatio*o.tileSources.length+12*o.tileSources.length+"px",this.element.style.height=r.y*e.sizeRatio+"px",o.addControl(this.element,{anchor:w.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=r.y*e.sizeRatio*o.tileSources.length+12*o.tileSources.length+"px",this.element.style.width=r.x*e.sizeRatio+"px",o.addControl(this.element,{anchor:w.ControlAnchor.TOP_LEFT})),this.panelWidth=r.x*this.sizeRatio+8,this.panelHeight=r.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},n=0;n<o.tileSources.length;n++)(t=w.makeNeutralElement("div")).id=this.element.id+"-"+n,t.style.width=this.panelWidth+"px",t.style.height=this.panelHeight+"px",t.style.display="inline",t.style.float="left",t.style.cssFloat="left",t.style.styleFloat="left",t.style.padding="2px",w.setElementTouchActionNone(t),w.setElementPointerEventsNone(t),this.element.appendChild(t),t.activePanel=!1,this.panels.push(t);H(this,"vertical"===this.scroll?r.y:r.x,0),this.setFocus(0)},w.ReferenceStrip.prototype={setFocus:function(e){var t,i=this.element.querySelector("#"+this.element.id+"-"+e),n=w.getElementSize(this.viewer.canvas),o=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),s=-Number(this.element.style.marginLeft.replace("px","")),a=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==i&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=i,this.currentSelected.style.background="#999","horizontal"===this.scroll?(t=Number(e)*(this.panelWidth+3))>s+n.x-this.panelWidth?(t=Math.min(t,o-n.x),this.element.style.marginLeft=-t+"px",H(this,n.x,-t)):t<s&&(t=Math.max(0,t-n.x/2),this.element.style.marginLeft=-t+"px",H(this,n.x,-t)):(t=Number(e)*(this.panelHeight+3))>a+n.y-this.panelHeight?(t=Math.min(t,r-n.y),this.element.style.marginTop=-t+"px",H(this,n.y,-t)):t<a&&(t=Math.max(0,t-n.y/2),this.element.style.marginTop=-t+"px",H(this,n.y,-t)),this.currentPage=e,oi.call(this,{eventSource:this.tracker}))},update:function(){return!!re[this.id].animating},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}},(se=c).DisplayRect=function(e,t,i,n,o,r){se.Rect.apply(this,[e,t,i,n]),this.minLevel=o,this.maxLevel=r},se.extend(se.DisplayRect.prototype,se.Rect.prototype),(_=c).Spring=function(e){var t=arguments;"object"!=typeof e&&(e={initial:t.length&&"number"==typeof t[0]?t[0]:void 0,springStiffness:1<t.length?t[1].springStiffness:5,animationTime:1<t.length?t[1].animationTime:1.5}),_.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),_.console.assert("number"==typeof e.animationTime&&0<=e.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),_.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:_.now()},_.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},_.Spring.prototype={resetTo:function(e){_.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=_.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){_.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(_.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(_.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=_.now(),t=this._exponential?(e=this.start._logValue,this.target._logValue):(e=this.start.value,this.target.value);var e,t=this.current.time>=this.target.time?t:e+(t-e)*(t=this.springStiffness,e=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(t*-e))/(1-Math.exp(-t))),i=this.current.value;return this._exponential?this.current.value=Math.exp(t):this.current.value=t,i!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}},ae=c,li.prototype={errorMsg:null,start:function(){var o=this,e=this.abort;this.image=new Image,this.image.onload=function(){o.finish(!0)},this.image.onabort=this.image.onerror=function(){o.errorMsg="Image load aborted",o.finish(!1)},this.jobId=window.setTimeout(function(){o.errorMsg="Image load exceeded timeout ("+o.timeout+" ms)",o.finish(!1)},this.timeout),this.loadWithAjax?(this.request=ae.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",postData:this.postData,success:function(t){var i;try{i=new window.Blob([t.response])}catch(e){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===e.name&&n&&((n=new n).append(t.response),i=n.getBlob())}0===i.size&&(o.errorMsg="Empty image response.",o.finish(!1));t=(window.URL||window.webkitURL).createObjectURL(i);o.image.src=t},error:function(e){o.errorMsg="Image load aborted - XHR error: Ajax returned "+e.status,o.finish(!1)}}),this.abort=function(){o.request.abort(),"function"==typeof e&&e()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},ae.ImageLoader=function(e){ae.extend(!0,this,{jobLimit:ae.DEFAULT_SETTINGS.imageLoaderLimit,timeout:ae.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},ae.ImageLoader.prototype={addJob:function(n){var o=this,e=new li({src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,postData:n.postData,callback:function(e){var t=o,i=n.callback;t.jobsInProgress--,(!t.jobLimit||t.jobsInProgress<t.jobLimit)&&0<t.jobQueue.length&&(t.jobQueue.shift().start(),t.jobsInProgress++),i(e.image,e.errorMsg,e.request)},abort:n.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(e.start(),this.jobsInProgress++):this.jobQueue.push(e)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}},(x=c).Tile=function(e,t,i,n,o,r,s,a,l,c,u,h){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=c,this.exists=o,this.url=r,this.postData=u,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,void 0===h&&(x.console.error("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),h=x.TileSource.prototype.getTileHashKey(e,t,i,r,l,u)),this.cacheKey=h,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},x.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){this.cacheImageRecord?this.loaded?(this.element||(this.element=x.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==e&&e.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),x.setElementOpacity(this.element,this.opacity)):x.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):x.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,t,i,n,o){var r,s,a=this.position.times(x.pixelDensityRatio),l=this.size.times(x.pixelDensityRatio);this.context2D||this.cacheImageRecord?(s=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&s?(e.save(),e.globalAlpha=this.opacity,"number"==typeof i&&1!==i&&(a=a.times(i),l=l.times(i)),n instanceof x.Point&&(a=a.plus(n)),1===e.globalAlpha&&this._hasTransparencyChannel()&&(o&&(a.x=Math.round(a.x),a.y=Math.round(a.y),l.x=Math.round(l.x),l.y=Math.round(l.y)),e.clearRect(a.x,a.y,l.x,l.y)),t({context:e,tile:this,rendered:s}),i=this.sourceBounds?(r=Math.min(this.sourceBounds.width,s.canvas.width),Math.min(this.sourceBounds.height,s.canvas.height)):(r=s.canvas.width,s.canvas.height),e.translate(a.x+l.x/2,0),this.flipped&&e.scale(-1,1),e.drawImage(s.canvas,0,0,r,i,-l.x/2,a.y,l.x,l.y),e.restore()):x.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):x.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return x.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*x.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,t,i){var n=Math.max(1,Math.ceil((i.x-t.x)/2)),i=Math.max(1,Math.ceil((i.y-t.y)/2));return new x.Point(n,i).minus(this.position.times(x.pixelDensityRatio).times(e||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}},(S=c).OverlayPlacement=S.Placement,S.OverlayRotationMode=S.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),S.Overlay=function(e,t,i){e=S.isPlainObject(e)?e:{element:e,location:t,placement:i};this.element=e.element,this.style=e.element.style,this._init(e)},S.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=void 0===e.placement?S.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=void 0===e.checkResize||e.checkResize,this.width=void 0===e.width?null:e.width,this.height=void 0===e.height?null:e.height,this.rotationMode=e.rotationMode||S.OverlayRotationMode.EXACT,this.location instanceof S.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=S.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new S.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,t){var i=S.Placement.properties[this.placement];i&&(i.isHorizontallyCentered?e.x-=t.x/2:i.isRight&&(e.x-=t.x),i.isVerticallyCentered?e.y-=t.y/2:i.isBottom&&(e.y-=t.y))},destroy:function(){var e=this.element,t=this.style,e=(e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),this.onDraw=null,t.top="",t.left="",t.position="",null!==this.width&&(t.width=""),null!==this.height&&(t.height=""),S.getCssPropertyWithVendorPrefix("transformOrigin")),i=S.getCssPropertyWithVendorPrefix("transform");e&&i&&(t[e]="",t[i]="")},drawHTML:function(e,t){var i,n=this.element,e=(n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=S.getElementSize(n)),this._getOverlayPositionAndSize(t)),n=e.position,t=this.size=e.size,e=e.rotate;this.onDraw?this.onDraw(n,t,this.element):((i=this.style).left=n.x+"px",i.top=n.y+"px",null!==this.width&&(i.width=t.x+"px"),null!==this.height&&(i.height=t.y+"px"),n=S.getCssPropertyWithVendorPrefix("transformOrigin"),t=S.getCssPropertyWithVendorPrefix("transform"),n&&t&&(e?(i[n]=this._getTransformOrigin(),i[t]="rotate("+e+"deg)"):(i[n]="",i[t]="")),i.display="block")},_getOverlayPositionAndSize:function(e){var t,i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e),o=(this.adjust(i,n),0);return e.degrees&&this.rotationMode!==S.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===S.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height?(t=new S.Rect(i.x,i.y,n.x,n.y),i=(t=this._getBoundingBox(t,e.degrees)).getTopLeft(),n=t.getSize()):o=e.degrees),{position:i,size:n,rotate:o}},_getSizeInPixels:function(e){var t=this.size.x,i=this.size.y;return null===this.width&&null===this.height||(e=e.deltaPixelsFromPointsNoRotate(new S.Point(this.width||0,this.height||0),!0),null!==this.width&&(t=e.x),null!==this.height&&(i=e.y)),!this.checkResize||null!==this.width&&null!==this.height||(e=this.size=S.getElementSize(this.element),null===this.width&&(t=e.x),null===this.height&&(i=e.y)),new S.Point(t,i)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(e){var t=new S.Point(e.x,e.y),i=S.Placement.properties[this.placement];return i&&(i.isHorizontallyCentered?t.x+=e.width/2:i.isRight&&(t.x+=e.width),i.isVerticallyCentered?t.y+=e.height/2:i.isBottom&&(t.y+=e.height)),t},_getTransformOrigin:function(){var e="",t=S.Placement.properties[this.placement];return t&&(t.isLeft?e="left":t.isRight&&(e="right"),t.isTop?e+=" top":t.isBottom&&(e+=" bottom")),e},update:function(e,t){e=S.isPlainObject(e)?e:{location:e,placement:t};this._init({location:e.location||this.location,placement:(void 0!==e.placement?e:this).placement,onDraw:e.onDraw||this.onDraw,checkResize:e.checkResize||this.checkResize,width:(void 0!==e.width?e:this).width,height:(void 0!==e.height?e:this).height,rotationMode:e.rotationMode||this.rotationMode})},getBounds:function(e){S.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var t=this.width,i=this.height,n=(null!==t&&null!==i||(n=e.deltaPointsFromPixelsNoRotate(this.size,!0),null===t&&(t=n.x),null===i&&(i=n.y)),this.location.clone());return this.adjust(n,new S.Point(t,i)),this._adjustBoundsForRotation(e,new S.Rect(n.x,n.y,t,i))},_adjustBoundsForRotation:function(e,t){if(!e||0===e.degrees||this.rotationMode===S.OverlayRotationMode.EXACT)return t;if(this.rotationMode!==S.OverlayRotationMode.BOUNDING_BOX)return t.rotate(-e.degrees,this._getPlacementPoint(t));if(null===this.width||null===this.height)return t;t=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new S.Rect(t.position.x,t.position.y,t.size.x,t.size.y))}},(T=c).Drawer=function(e){T.console.assert(e.viewer,"[Drawer] options.viewer is required");var t=arguments;T.isPlainObject(e)||(e={source:t[0],viewport:t[1],element:t[2]}),T.console.assert(e.viewport,"[Drawer] options.viewport is required"),T.console.assert(e.element,"[Drawer] options.element is required"),e.source&&T.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor="string"==typeof e.debugGridColor?[e.debugGridColor]:e.debugGridColor||T.DEFAULT_SETTINGS.debugGridColor,e.opacity&&T.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=T.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=T.getElement(e.element),this.canvas=T.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(t=this._calculateCanvasSize(),this.canvas.width=t.x,this.canvas.height=t.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",T.setElementOpacity(this.canvas,this.opacity,!0),T.setElementPointerEventsNone(this.canvas),T.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},T.Drawer.prototype={addOverlay:function(e,t,i,n){return T.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,t,i,n),this},updateOverlay:function(e,t,i){return T.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,t,i),this},removeOverlay:function(e){return T.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return T.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(e){e=this.viewport.pixelFromPointNoRotate(e,!0);return new T.Point(e.x*T.pixelDensityRatio,e.y*T.pixelDensityRatio)},clipWithPolygons:function(e,t){var i;this.useCanvas&&((i=this._getContext(t)).beginPath(),e.forEach(function(e){e.forEach(function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)})}),i.clip())},setOpacity:function(e){T.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var t=this.viewer.world,i=0;i<t.getItemCount();i++)t.getItemAt(i).setOpacity(e);return this},getOpacity:function(){T.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,t=0,i=0;i<e.getItemCount();i++){var n=e.getItemAt(i).getOpacity();t<n&&(t=n)}return t},needsUpdate:function(){return T.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return T.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return T.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return T.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){var e;this.canvas.innerHTML="",this.useCanvas&&(e=this._calculateCanvasSize(),this.canvas.width===e.x&&this.canvas.height===e.y||(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(e=this._calculateSketchCanvasSize(),this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear())},_clear:function(e,t){this.useCanvas&&(e=this._getContext(e),t?e.clearRect(t.x,t.y,t.width,t.height):(t=e.canvas,e.clearRect(0,0,t.width,t.height)))},viewportToDrawerRectangle:function(e){var t=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),e=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new T.Rect(t.x*T.pixelDensityRatio,t.y*T.pixelDensityRatio,e.x*T.pixelDensityRatio,e.y*T.pixelDensityRatio)},drawTile:function(e,t,i,n,o,r){T.console.assert(e,"[Drawer.drawTile] tile is required"),T.console.assert(t,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(i=this._getContext(i),e.drawCanvas(i,t,n=n||1,o,r)):e.drawHTML(this.canvas)},_getContext:function(e){var i,t=this.context;return e&&(null===this.sketchCanvas&&(this.sketchCanvas=document.createElement("canvas"),e=this._calculateSketchCanvasSize(),this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()&&(i=this).viewer.addHandler("rotate",function e(){var t;0!==i.viewport.getRotation()&&(i.viewer.removeHandler("rotate",e),t=i._calculateSketchCanvasSize(),i.sketchCanvas.width=t.x,i.sketchCanvas.height=t.y)}),this._updateImageSmoothingEnabled(this.sketchContext)),t=this.sketchContext),t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){this.useCanvas&&((t=this._getContext(t)).beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip())},drawRectangle:function(e,t,i){this.useCanvas&&((i=this._getContext(i)).save(),i.fillStyle=t,i.fillRect(e.x,e.y,e.width,e.height),i.restore())},blendSketch:function(e,t,i,n){var o,r=e;T.isPlainObject(r)||(r={opacity:e,scale:t,translate:i,compositeOperation:n}),this.useCanvas&&this.sketchCanvas&&(e=r.opacity,n=r.compositeOperation,o=r.bounds,this.context.save(),this.context.globalAlpha=e,n&&(this.context.globalCompositeOperation=n),o?(o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height)):(t=r.scale||1,e=(i=r.translate)instanceof T.Point?i:new T.Point(0,0),o=n=0,i&&(r=this.sketchCanvas.width-this.canvas.width,i=this.sketchCanvas.height-this.canvas.height,n=Math.round(r/2),o=Math.round(i/2)),this.context.drawImage(this.sketchCanvas,e.x-n*t,e.y-o*t,(this.canvas.width+2*n)*t,(this.canvas.height+2*o)*t,-n,-o,this.canvas.width+2*n,this.canvas.height+2*o)),this.context.restore())},drawDebugInfo:function(e,t,i,n){var o,r,s;this.useCanvas&&(r=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,(o=this.context).save(),o.lineWidth=2*T.pixelDensityRatio,o.font="small-caps bold "+13*T.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[r],o.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),o.strokeRect(e.position.x*T.pixelDensityRatio,e.position.y*T.pixelDensityRatio,e.size.x*T.pixelDensityRatio,e.size.y*T.pixelDensityRatio),r=(e.position.x+e.size.x/2)*T.pixelDensityRatio,s=(e.position.y+e.size.y/2)*T.pixelDensityRatio,o.translate(r,s),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-r,-s),0===e.x&&0===e.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*T.pixelDensityRatio,(e.position.y-30)*T.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*T.pixelDensityRatio,(e.position.y-20)*T.pixelDensityRatio)),o.fillText("Level: "+e.level,(e.position.x+10)*T.pixelDensityRatio,(e.position.y+20)*T.pixelDensityRatio),o.fillText("Column: "+e.x,(e.position.x+10)*T.pixelDensityRatio,(e.position.y+30)*T.pixelDensityRatio),o.fillText("Row: "+e.y,(e.position.x+10)*T.pixelDensityRatio,(e.position.y+40)*T.pixelDensityRatio),o.fillText("Order: "+i+" of "+t,(e.position.x+10)*T.pixelDensityRatio,(e.position.y+50)*T.pixelDensityRatio),o.fillText("Size: "+e.size.toString(),(e.position.x+10)*T.pixelDensityRatio,(e.position.y+60)*T.pixelDensityRatio),o.fillText("Position: "+e.position.toString(),(e.position.x+10)*T.pixelDensityRatio,(e.position.y+70)*T.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),o.restore())},debugRect:function(e){var t;this.useCanvas&&((t=this.context).save(),t.lineWidth=2*T.pixelDensityRatio,t.strokeStyle=this.debugGridColor[0],t.fillStyle=this.debugGridColor[0],t.strokeRect(e.x*T.pixelDensityRatio,e.y*T.pixelDensityRatio,e.width*T.pixelDensityRatio,e.height*T.pixelDensityRatio),t.restore())},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(e){e=this._getContext(e).canvas;return new T.Point(e.width,e.height)},getCanvasCenter:function(){return new T.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var t=e.point?e.point.times(T.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(e.useSketch);i.save(),i.translate(t.x,t.y),this.viewer.viewport.flipped?(i.rotate(Math.PI/180*-e.degrees),i.scale(-1,1)):i.rotate(Math.PI/180*e.degrees),i.translate(-t.x,-t.y)},_flip:function(e){var t=(e=e||{}).point?e.point.times(T.pixelDensityRatio):this.getCanvasCenter(),e=this._getContext(e.useSketch);e.translate(t.x,0),e.scale(-1,1),e.translate(-t.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var e=T.pixelDensityRatio,t=this.viewport.getContainerSize();return{x:Math.round(t.x*e),y:Math.round(t.y*e)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;e=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:e,y:e}}},(E=c).Viewport=function(e){var t=arguments;(e=t.length&&t[0]instanceof E.Point?{containerSize:t[0],contentSize:t[1],config:t[2]}:e).config&&(E.extend(!0,e,e.config),delete e.config),this._margins=E.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,E.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:E.DEFAULT_SETTINGS.springStiffness,animationTime:E.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:E.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:E.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:E.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:E.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:E.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:E.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:E.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:E.DEFAULT_SETTINGS.maxZoomLevel,degrees:E.DEFAULT_SETTINGS.degrees,flipped:E.DEFAULT_SETTINGS.flipped,homeFillsViewer:E.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:E.DEFAULT_SETTINGS.silenceMultiImageWarnings},e),this._updateContainerInnerSize(),this.centerSpringX=new E.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new E.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new E.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new E.Rect(0,0,1,1),1),this.goHome(!0),this.update()},E.Viewport.prototype={resetContentSize:function(e){return E.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),E.console.assert(e instanceof E.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),E.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),E.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new E.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,t){E.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,t)},_setContentBounds:function(e,t){E.console.assert(e,"[Viewport._setContentBounds] bounds is required"),E.console.assert(e instanceof E.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),E.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),E.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(t),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(t),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:t,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio(),e=this.homeFillsViewer?1<=e?e:1:1<=e?1:e;return e/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),i=t/this.getAspectRatio();return new E.Rect(e.x-t/2,e.y-i/2,t,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new E.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return E.extend({},this._margins)},setMargins:function(e){E.console.assert("object"===E.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=E.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var t=this.getCenter(e),e=1/this.getZoom(e),i=e/this.getAspectRatio();return new E.Rect(t.x-e/2,t.y-i/2,e,i)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),e=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/e,t.y-=this._margins.top/e,t.width+=(this._margins.left+this._margins.right)/e,t.height+=(this._margins.top+this._margins.bottom)/e,t},getCenter:function(e){var t,i,n,o=new E.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),r=new E.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?o:this.zoomPoint?(e=this.pixelFromPoint(this.zoomPoint,!0),i=(n=1/(t=this.getZoom()))/this.getAspectRatio(),o=new E.Rect(o.x-n/2,o.y-i/2,n,i),n=this._pixelFromPoint(this.zoomPoint,o).minus(e).divide(this._containerInnerSize.x*t),r.plus(n)):r},getZoom:function(e){return(e?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var t,i,n,e=new E.Rect(e.x,e.y,e.width,e.height);return this.wrapHorizontal||(t=this.visibilityRatio*e.width,n=e.x+e.width,i=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,n=this._contentBoundsNoRotate.x-n+t,i=i-e.x-t,t>this._contentBoundsNoRotate.width?e.x+=(n+i)/2:i<0?e.x+=i:0<n&&(e.x+=n)),this.wrapVertical||(t=this.visibilityRatio*e.height,i=e.y+e.height,n=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,i=this._contentBoundsNoRotate.y-i+t,n=n-e.y-t,t>this._contentBoundsNoRotate.height?e.y+=(i+n)/2:n<0?e.y+=n:0<i&&(e.y+=i)),e},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t),t=(t!==i&&this.zoomTo(i,this.zoomPoint,e),this.getBoundsNoRotate()),i=this._applyBoundaryConstraints(t);return this._raiseConstraintsEvent(e),t.x===i.x&&t.y===i.y&&!e||this.fitBounds(i.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,t){var i=(t=t||{}).immediately||!1,t=t.constraints||!1,n=this.getAspectRatio(),o=e.getCenter(),e=new E.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox(),n=(e.getAspectRatio()>=n?e.height=e.width/n:e.width=e.height*n,e.x=o.x-e.width/2,e.y=o.y-e.height/2,1/e.width);if(t&&(t=e.getAspectRatio(),n!==(r=this._applyZoomConstraints(n))&&(e.width=1/(n=r),e.x=o.x-e.width/2,e.height=e.width/t,e.y=o.y-e.height/2),o=(e=this._applyBoundaryConstraints(e)).getCenter(),this._raiseConstraintsEvent(i)),i)return this.panTo(o,!0),this.zoomTo(n,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var r=this.getBounds(),t=this.getZoom();if(0===t||Math.abs(n/t-1)<1e-8)return this.zoomTo(n,!0),this.panTo(o,i);o=(e=e.rotate(-this.getRotation())).getTopLeft().times(n).minus(r.getTopLeft().times(t)).divide(n-t);return this.zoomTo(n,o,i)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var t=new E.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(t,e)},fitHorizontally:function(e){var t=new E.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(t,e)},getConstrainedBounds:function(e){e=this.getBounds(e);return this._applyBoundaryConstraints(e)},panBy:function(e,t){var i=new E.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(e),t)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(e,t,i){var n=this;return this.zoomPoint=t instanceof E.Point&&!isNaN(t.x)&&!isNaN(t.y)?t:null,i?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:t,immediately:i}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=E.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e})),this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),o=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,o.width=n.width*i,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(o,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new E.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this,t=(this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom);return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){var t;this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),e(),t=this.pixelFromPoint(this.zoomPoint,!0).minus(t),t=this.deltaPointsFromPixels(t,!0),this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)):e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(e,t){return e.minus(t.getTopLeft()).times(this._containerInnerSize.x/t.width).plus(new E.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(e,t){t=this.getBoundsNoRotate(t);return e.minus(new E.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/t.width).plus(t.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new E.Point(e*this._contentSizeNoRotate.x/i,t*this._contentSizeNoRotate.x/i)},viewportToImageCoordinates:function(e,t){if(e instanceof E.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||E.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(e,t,!0)}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,t-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new E.Point(e/this._contentSizeNoRotate.x*i,t/this._contentSizeNoRotate.x*i)},imageToViewportCoordinates:function(e,t){if(e instanceof E.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)this.silenceMultiImageWarnings||E.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(e,t,!0)}i=this._imageToViewportDelta(e,t);return i.x+=this._contentBoundsNoRotate.x,i.y+=this._contentBoundsNoRotate.y,i},imageToViewportRectangle:function(e,t,i,n){var o=e;if(o instanceof E.Rect||(o=new E.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)this.silenceMultiImageWarnings||E.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===r)return this.viewer.world.getItemAt(0).imageToViewportRectangle(e,t,i,n,!0)}r=this.imageToViewportCoordinates(o.x,o.y),e=this._imageToViewportDelta(o.width,o.height);return new E.Rect(r.x,r.y,e.x,e.y,o.degrees)},viewportToImageRectangle:function(e,t,i,n){var o=e;if(o instanceof E.Rect||(o=new E.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)this.silenceMultiImageWarnings||E.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===r)return this.viewer.world.getItemAt(0).viewportToImageRectangle(e,t,i,n,!0)}r=this.viewportToImageCoordinates(o.x,o.y),e=this._viewportToImageDelta(o.width,o.height);return new E.Rect(r.x,r.y,e.x,e.y,o.degrees)},viewerElementToImageCoordinates:function(e){e=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){e=this.imageToViewportCoordinates(e);return this.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){E.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");e=e.minus(E.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return E.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(E.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return E.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return E.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){E.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");e=e.minus(E.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(e)},viewportToWindowCoordinates:function(e){return E.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(E.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)this.silenceMultiImageWarnings||E.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===t)return this.viewer.world.getItemAt(0).viewportToImageZoom(e)}t=this._contentSizeNoRotate.x;return e*(this._containerInnerSize.x/t*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)this.silenceMultiImageWarnings||E.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===t)return this.viewer.world.getItemAt(0).imageToViewportZoom(e)}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped!==e&&(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}},(P=c).TiledImage=function(e){var t=this,i=(P.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),P.console.assert(e.drawer,"[TiledImage] options.drawer is required"),P.console.assert(e.viewer,"[TiledImage] options.viewer is required"),P.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),P.console.assert(e.source,"[TiledImage] options.source is required"),P.console.assert(!e.clip||e.clip instanceof P.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),P.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof P.Rect&&(this._clip=e.clip.clone()),delete e.clip,e.x||0),n=(delete e.x,e.y||0),o=(delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y,1),r=(e.width?(o=e.width,delete e.width,e.height&&(P.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(o=e.height/this.normHeight,delete e.height),e.fitBounds),s=(delete e.fitBounds,e.fitBoundsPlacement||c.Placement.CENTER),a=(delete e.fitBoundsPlacement,e.degrees||0);delete e.degrees,P.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:P.DEFAULT_SETTINGS.springStiffness,animationTime:P.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:P.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:P.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:P.DEFAULT_SETTINGS.wrapVertical,immediateRender:P.DEFAULT_SETTINGS.immediateRender,blendTime:P.DEFAULT_SETTINGS.blendTime,alwaysBlend:P.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:P.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:P.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:P.DEFAULT_SETTINGS.iOSDevice,debugMode:P.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:P.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:P.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:P.DEFAULT_SETTINGS.placeholderFillStyle,opacity:P.DEFAULT_SETTINGS.opacity,preload:P.DEFAULT_SETTINGS.preload,compositeOperation:P.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:P.DEFAULT_SETTINGS.subPixelRoundingForTransparency},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new P.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new P.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new P.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new P.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),r&&this.fitBounds(r,s,!0),this._drawingHandler=function(e){t.viewer.raiseEvent("tile-drawing",P.extend({tiledImage:t},e))}},P.extend(P.TiledImage.prototype,P.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=P.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(e){return e?new P.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new P.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return P.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var t,i=this.getBoundsNoRotate(e);return this._clip&&(t=(e?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,t=this._clip.times(t),i=new P.Rect(i.x+t.x,i.y+t.y,t.width,t.height)),i.rotate(this.getRotation(e),this._getRotationPoint(e))},getTileBounds:function(e,t,i){var n=this.source.getNumTiles(e),o=(n.x+t%n.x)%n.x,r=(n.y+i%n.y)%n.y,e=this.source.getTileBounds(e,o,r);return this.getFlip()&&(e.x=1-e.x-e.width),e.x+=(t-o)/n.x,e.y+=this._worldHeightCurrent/this._worldWidthCurrent*((i-r)/n.y),e},getContentSize:function(){return new P.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var e=this.imageToWindowCoordinates(new P.Point(0,0)),t=this.imageToWindowCoordinates(this.getContentSize());return new P.Point(t.x-e.x,t.y-e.y)},_viewportToImageDelta:function(e,t,i){i=(i?this._scaleSpring.current:this._scaleSpring.target).value;return new P.Point(e*(this.source.dimensions.x/i),t*(this.source.dimensions.y*this.contentAspectX/i))},viewportToImageCoordinates:function(e,t,i){e=e instanceof P.Point?(i=t,e):new P.Point(e,t);return e=e.rotate(-this.getRotation(i),this._getRotationPoint(i)),i?this._viewportToImageDelta(e.x-this._xSpring.current.value,e.y-this._ySpring.current.value):this._viewportToImageDelta(e.x-this._xSpring.target.value,e.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,t,i){i=(i?this._scaleSpring.current:this._scaleSpring.target).value;return new P.Point(e/this.source.dimensions.x*i,t/this.source.dimensions.y/this.contentAspectX*i)},imageToViewportCoordinates:function(e,t,i){e instanceof P.Point&&(i=t,t=e.y,e=e.x);e=this._imageToViewportDelta(e,t);return i?(e.x+=this._xSpring.current.value,e.y+=this._ySpring.current.value):(e.x+=this._xSpring.target.value,e.y+=this._ySpring.target.value),e.rotate(this.getRotation(i),this._getRotationPoint(i))},imageToViewportRectangle:function(e,t,i,n,o){var r=e,e=(r instanceof P.Rect?o=t:r=new P.Rect(e,t,i,n),this.imageToViewportCoordinates(r.getTopLeft(),o)),t=this._imageToViewportDelta(r.width,r.height,o);return new P.Rect(e.x,e.y,t.x,t.y,r.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,t,i,n,o){var r=e,e=(e instanceof P.Rect?o=t:r=new P.Rect(e,t,i,n),this.viewportToImageCoordinates(r.getTopLeft(),o)),t=this._viewportToImageDelta(r.width,r.height,o);return new P.Rect(e.x,e.y,t.x,t.y,r.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){e=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(e){e=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){e=e.minus(c.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(c.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var t=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new P.Rect((e.x-this._xSpring.current.value)/t,(e.y-this._ySpring.current.value)/t,e.width/t,e.height/t,e.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(e){var t=function(e){return e instanceof P.Point||"number"==typeof e.x&&"number"==typeof e.y};try{if(!P.isArray(e))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=e.map(function(e){return e.map(function(e){try{if(t(e))return{x:e.x,y:e.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}})})}catch(e){P.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),P.console.error(e),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(e,t,i){t=t||P.Placement.CENTER;var n,t=P.Placement.properties[t],o=this.contentAspectX,r=0,s=0,a=1,l=1;this._clip&&(o=this._clip.getAspectRatio(),a=this._clip.width/this.source.dimensions.x,l=this._clip.height/this.source.dimensions.y,s=e.getAspectRatio()>o?(r=this._clip.x/this._clip.height*e.height,this._clip.y/this._clip.height*e.height):(r=this._clip.x/this._clip.width*e.width,this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o?(l=e.height/l,n=0,t.isHorizontallyCentered?n=(e.width-e.height*o)/2:t.isRight&&(n=e.width-e.height*o),this.setPosition(new P.Point(e.x-r+n,e.y-s),i),this.setHeight(l,i)):(n=e.width/a,l=0,t.isVerticallyCentered?l=(e.height-e.width/o)/2:t.isBottom&&(l=e.height-e.width/o),this.setPosition(new P.Point(e.x-r,e.y-s+l),i),this.setWidth(n,i))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){P.console.assert(!e||e instanceof P.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof P.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(e){this.flipped=!!e,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return(e?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,t=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2)))),t=Math.max(t,this.source.minLevel||0);return{lowestLevel:Math.min(e,t),highestLevel:t}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var e=this.viewport,t=this._viewportToTiledImageRectangle(e.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var i=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(t=t.intersection(i)))return}for(var i=this._getLevelsInterval(),n=i.lowestLevel,i=i.highestLevel,o=null,r=!1,s=P.now(),a=i;n<=a;a--){var l=!1,c=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(a),!0).x*this._scaleSpring.current.value;if(a===n||!r&&c>=this.minPixelRatio)r=l=!0;else if(!r)continue;var u=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(a),!1).x*this._scaleSpring.current.value,h=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,h=this.immediateRender?1:h,c=Math.min(1,(c-.5)/.5),h=h/Math.abs(h-u),o=this._updateLevel(r,l,a,c,h,t,s,o);if(this._providesCoverage(this.coverage,a))break}this._drawTiles(this.lastDrawn),o&&!o.context2D?(this._loadTile(o,s),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,t,i){var n=this.wrapHorizontal?(s=P.positiveModulo(t.x,1),P.positiveModulo(i.x,1)):(s=Math.max(0,t.x),Math.min(1,i.x)),o=1/this.source.aspectRatio,r=this.wrapVertical?(a=P.positiveModulo(t.y,o),P.positiveModulo(i.y,o)):(a=Math.max(0,t.y),Math.min(o,i.y)),s=this.source.getTileAtPoint(e,new P.Point(s,a)),a=this.source.getTileAtPoint(e,new P.Point(n,r)),n=this.source.getNumTiles(e);return this.wrapHorizontal&&(s.x+=n.x*Math.floor(t.x),a.x+=n.x*Math.floor(i.x)),this.wrapVertical&&(s.y+=n.y*Math.floor(t.y/o),a.y+=n.y*Math.floor(i.y/o)),{topLeft:s,bottomRight:a}},_updateLevel:function(e,t,i,n,o,r,s,a){var l=r.getBoundingBox().getTopLeft(),c=r.getBoundingBox().getBottomRight(),l=(this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:e,level:i,opacity:n,visibility:o,drawArea:r,topleft:l,bottomright:c,currenttime:s,best:a}),this._resetCoverage(this.coverage,i),this._resetCoverage(this.loadingCoverage,i),this._getCornerTiles(i,l,c)),u=l.topLeft,h=l.bottomRight,d=this.source.getNumTiles(i),p=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(h.x+=1,this.wrapHorizontal||(h.x=Math.min(h.x,d.x-1)));for(var m=u.x;m<=h.x;m++)for(var g,v=u.y;v<=h.y;v++)g=this.getFlip()?(g=(d.x+m%d.x)%d.x,m+d.x-g-g-1):m,null!==r.intersection(this.getTileBounds(i,g,v))&&(a=this._updateTile(t,e,g,v,i,n,o,p,d,s,a));return a},_updateTile:function(e,t,i,n,o,r,s,a,l,c,u){var l=this._getTile(i,n,o,c,l,this._worldWidthCurrent,this._worldHeightCurrent),h=(this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:l}),this._setCoverage(this.coverage,o,i,n,!1),l.loaded||l.loading||this._isCovered(this.loadingCoverage,o,i,n));return this._setCoverage(this.loadingCoverage,o,i,n,h),l.exists&&(e&&!t&&(this._isCovered(this.coverage,o,i,n)?this._setCoverage(this.coverage,o,i,n,!0):t=!0),t&&(this._positionTile(l,this.source.tileOverlap,this.viewport,a,s),l.loaded||(l.context2D?this._setTileLoaded(l):(e=this._tileCache.getImageRecord(l.cacheKey))&&(t=e.getImage(),this._setTileLoaded(l,t))),l.loaded?this._blendTile(l,i,n,o,r,c)&&(this._needsDraw=!0):l.loading?this._tilesLoading++:h||(u=this._compareTiles(u,l)))),u},_getTile:function(e,t,i,n,o,r,s){var a,l,c,u,h,d,p,m,g,v=this.tilesMatrix,f=this.source;return v[i]||(v[i]={}),v[i][e]||(v[i][e]={}),v[i][e][t]&&!v[i][e][t].flipped==!this.flipped||(a=(o.x+e%o.x)%o.x,l=(o.y+t%o.y)%o.y,g=this.getTileBounds(i,e,t),c=f.getTileBounds(i,a,l,!0),u=f.tileExists(i,a,l),h=f.getTileUrl(i,a,l),d=f.getTilePostData(i,a,l),this.loadTilesWithAjax?(p=f.getTileAjaxHeaders(i,a,l),P.isPlainObject(this.ajaxHeaders)&&(p=P.extend({},this.ajaxHeaders,p))):p=null,m=f.getContext2D?f.getContext2D(i,a,l):void 0,g=new P.Tile(i,e,t,g,u,h,m,this.loadTilesWithAjax,p,c,d,f.getTileHashKey(i,a,l,h,p,d)),this.getFlip()?0==a&&(g.isRightMost=!0):a==o.x-1&&(g.isRightMost=!0),l==o.y-1&&(g.isBottomMost=!0),g.flipped=this.flipped,v[i][e][t]=g),(g=v[i][e][t]).lastTouchTime=n,g},_loadTile:function(n,o){var r=this;n.loading=!0,this._imageLoader.addJob({src:n.url,postData:n.postData,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(e,t,i){r._onTileLoad(n,o,e,t,i)},abort:function(){n.loading=!1}})},_onTileLoad:function(t,e,i,n,o){var r,s;i?e<this.lastResetTime?(P.console.warn("Ignoring tile %s loaded before reset: %s",t,t.url),t.loading=!1):(s=function(){var e=r.source.getClosestLevel();r._setTileLoaded(t,i,e,o)},(r=this)._midDraw?window.setTimeout(s,1):s()):(P.console.error("Tile %s failed to load: %s - error: %s",t,t.url,n),this.viewer.raiseEvent("tile-load-failed",{tile:t,tiledImage:this,time:e,message:n,tileRequest:o}),t.loading=!1,t.exists=!1)},_setTileLoaded:function(e,t,i,n){var o=0,r=this;function s(){return o++,a}function a(){0===--o&&(e.loading=!1,e.loaded=!0,e.context2D||r._tileCache.cacheTile({image:t,tile:e,cutoff:i,tiledImage:r}),r._needsDraw=!0)}this.viewer.raiseEvent("tile-loaded",{tile:e,tiledImage:this,tileRequest:n,image:t,getCompletionCallback:s}),s()()},_positionTile:function(e,t,i,n,o){var r=e.bounds.getTopLeft(),s=(r.x*=this._scaleSpring.current.value,r.y*=this._scaleSpring.current.value,r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value,e.bounds.getSize()),a=(s.x*=this._scaleSpring.current.value,s.y*=this._scaleSpring.current.value,i.pixelFromPointNoRotate(r,!0)),r=i.pixelFromPointNoRotate(r,!1),l=i.deltaPixelsFromPointsNoRotate(s,!0),i=i.deltaPixelsFromPointsNoRotate(s,!1),s=r.plus(i.divide(2)),r=n.squaredDistanceTo(s);t||(l=l.plus(new P.Point(1,1))),e.isRightMost&&this.wrapHorizontal&&(l.x+=.75),e.isBottomMost&&this.wrapVertical&&(l.y+=.75),e.position=a,e.size=l,e.squaredDistance=r,e.visibility=o},_blendTile:function(e,t,i,n,o,r){var s,a=1e3*this.blendTime;if(e.blendStart||(e.blendStart=r),r=r-e.blendStart,s=a?Math.min(1,r/a):1,this.alwaysBlend&&(s*=o),e.opacity=s,this.lastDrawn.push(e),1===s)this._setCoverage(this.coverage,n,t,i,!0),this._hasOpaqueTile=!0;else if(r<a)return!0;return!1},_compareTiles:function(e,t){return!e||t.visibility>e.visibility||t.visibility===e.visibility&&t.squaredDistance<e.squaredDistance?t:e},_drawTiles:function(e){if(0!==this.opacity&&(0!==e.length||this.placeholderFillStyle)){var t,i,n,o,r=e[0],s=(r&&(t=this.opacity<1||this.compositeOperation&&"source-over"!==this.compositeOperation||!this._isBottomItem()&&r._hasTransparencyChannel()),this.viewport.getZoom(!0)),s=this.viewportToImageZoom(s),s=(1<e.length&&s>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360==0&&P.supportsCanvas&&this.viewer.useCanvas&&(t=!0,i=r.getScaleForEdgeSmoothing(),n=r.getTranslationForEdgeSmoothing(i,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0))),t&&(i||(o=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),!this._drawer.viewer.viewport.getFlip()||0===this.viewport.degrees&&this.getRotation(!0)%360==0||(o.x=this._drawer.viewer.container.clientWidth-(o.x+o.width)),o=o.times(P.pixelDensityRatio)),this._drawer._clear(!0,o)),i||(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:t}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:t}),0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip()),!1);if(this._clip&&(this._drawer.saveContext(t),l=(l=this.imageToViewportRectangle(this._clip,!0)).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),l=this._drawer.viewportToDrawerRectangle(l),i&&(l=l.times(i)),n&&(l=l.translate(n)),this._drawer.setClip(l,t),s=!0),this._croppingPolygons){this._drawer.saveContext(t);try{var a=this._croppingPolygons.map(function(e){return e.map(function(e){e=this.imageToViewportCoordinates(e.x,e.y,!0).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),e=this._drawer.viewportCoordToDrawerCoord(e);return e=i?e.times(i):e})});this._drawer.clipWithPolygons(a,t)}catch(e){P.console.error(e)}s=!0}this.placeholderFillStyle&&!1===this._hasOpaqueTile&&(l=this._drawer.viewportToDrawerRectangle(this.getBounds(!0)),i&&(l=l.times(i)),n&&(l=l.translate(n)),a=null,a="function"==typeof this.placeholderFillStyle?this.placeholderFillStyle(this,this._drawer.context):this.placeholderFillStyle,this._drawer.drawRectangle(l,a,t));var l=function(e){if("number"==typeof e)return ui(e);if(!e||!P.Browser)return le;var t=e[P.Browser.vendor];ci(t)&&(t=e["*"]);return ui(t)}(this.subPixelRoundingForTransparency),c=!1;l===P.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?c=!0:l===P.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(c=!(this.viewer&&this.viewer.isAnimating()));for(var u=e.length-1;0<=u;u--)r=e[u],this._drawer.drawTile(r,this._drawingHandler,t,i,n,c),r.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:r});s&&this._drawer.restoreContext(t),i||(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(t),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(t)),t&&(i&&(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:!1}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:i,translate:n,compositeOperation:this.compositeOperation,bounds:o}),i&&(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(!1))),i||0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(e)}},_drawDebugInfo:function(e){if(this.debugMode)for(var t=e.length-1;0<=t;t--){var i=e[t];try{this._drawer.drawDebugInfo(i,e.length,t,this)}catch(e){P.console.error(e)}}},_providesCoverage:function(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(void 0!==i&&void 0!==n)return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n];for(s in o=e[t])if(Object.prototype.hasOwnProperty.call(o,s))for(a in r=o[s])if(Object.prototype.hasOwnProperty.call(r,a)&&!r[a])return!1;return!0},_isCovered:function(e,t,i,n){return void 0===i||void 0===n?this._providesCoverage(e,t+1):this._providesCoverage(e,t+1,2*i,2*n)&&this._providesCoverage(e,t+1,2*i,2*n+1)&&this._providesCoverage(e,t+1,2*i+1,2*n)&&this._providesCoverage(e,t+1,2*i+1,2*n+1)},_setCoverage:function(e,t,i,n,o){e[t]?(e[t][i]||(e[t][i]={}),e[t][i][n]=o):P.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",t)},_resetCoverage:function(e,t){e[t]={}}}),le=P.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER,C=c,di.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){var e;return this._renderedContext||((e=document.createElement("canvas")).width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null),this._renderedContext},setRenderedContext:function(e){C.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){C.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var t=0;t<this._tiles.length;t++)if(this._tiles[t]===e)return void this._tiles.splice(t,1);C.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},C.TileCache=function(e){this._maxImageCacheCount=(e=e||{}).maxImageCacheCount||C.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},C.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(e){C.console.assert(e,"[TileCache.cacheTile] options is required"),C.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),C.console.assert(e.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),C.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var t=e.cutoff||0,i=this._tilesLoaded.length,n=this._imagesLoaded[e.tile.cacheKey];if(n||(C.console.assert(e.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),n=this._imagesLoaded[e.tile.cacheKey]=new di({image:e.image}),this._imagesLoadedCount++),n.addTile(e.tile),e.tile.cacheImageRecord=n,this._imagesLoadedCount>this._maxImageCacheCount){for(var o,r,s,a,l,c,u=null,h=-1,d=null,p=this._tilesLoaded.length-1;0<=p;p--)(o=(c=this._tilesLoaded[p]).tile).level<=t||o.beingDrawn||(u?(a=o.lastTouchTime,r=u.lastTouchTime,l=o.level,s=u.level,(a<r||a===r&&s<l)&&(u=o,h=p,d=c)):(u=o,h=p,d=c));u&&0<=h&&(this._unloadTile(d),i=h)}this._tilesLoaded[i]=new hi({tile:e.tile,tiledImage:e.tiledImage})},clearTilesFor:function(e){var t;C.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(t=this._tilesLoaded[i]).tiledImage===e&&(this._unloadTile(t),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(e){return C.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){C.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var t=e.tile,e=e.tiledImage,i=(t.unload(),t.cacheImageRecord=null,this._imagesLoaded[t.cacheKey]);i.removeTile(t),i.getTileCount()||(i.destroy(),delete this._imagesLoaded[t.cacheKey],this._imagesLoadedCount--),e.viewer.raiseEvent("tile-unloaded",{tile:t,tiledImage:e})}},(R=c).World=function(e){var t=this;R.console.assert(e.viewer,"[World] options.viewer is required"),R.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){t._autoRefigureSizes?t._figureSizes():t._needsSizesFigured=!0},this._figureSizes()},R.extend(R.World.prototype,R.EventSource.prototype,{addItem:function(e,t){R.console.assert(e,"[World.addItem] item is required"),R.console.assert(e instanceof R.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(t=t||{}).index?(t=Math.max(0,Math.min(this._items.length,t.index)),this._items.splice(t,0,e)):this._items.push(e),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return R.console.assert(void 0!==e,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return R.console.assert(e,"[World.getIndexOfItem] item is required"),R.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,t){R.console.assert(e,"[World.setItemIndex] item is required"),R.console.assert(void 0!==t,"[World.setItemIndex] index is required");var i=this.getIndexOfItem(e);if(t>=this._items.length)throw new Error("Index bigger than number of layers.");t!==i&&-1!==i&&(this._items.splice(i,1),this._items.splice(t,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:i,newIndex:t}))},removeItem:function(e){R.console.assert(e,"[World.removeItem] item is required");var t=R.indexOf(this._items,e);-1!==t&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(t,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){(this._autoRefigureSizes=e)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){var t,i,n,o=(e=e||{}).immediately||!1,r=e.layout||R.DEFAULT_SETTINGS.collectionLayout,s=e.rows||R.DEFAULT_SETTINGS.collectionRows,a=e.columns||R.DEFAULT_SETTINGS.collectionColumns,l=e.tileSize||R.DEFAULT_SETTINGS.collectionTileSize,c=l+(e.tileMargin||R.DEFAULT_SETTINGS.collectionTileMargin),u=!e.rows&&a?a:Math.ceil(this._items.length/s),h=0,d=0;this.setAutoRefigureSizes(!1);for(var p=0;p<this._items.length;p++)p&&p%u==0&&("horizontal"===r?(d+=c,h=0):(h+=c,d=0)),n=(i=(n=(t=this._items[p]).getBounds()).width>n.height?l:l*(n.width/n.height))*(n.height/n.width),n=new R.Point(h+(l-i)/2,d+(l-n)/2),t.setPosition(n,o),t.setWidth(i,o),"horizontal"===r?h+=c:d+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,t=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(this._items.length){for(var n=this._items[0],o=n.getBounds(),r=(this._contentFactor=n.getContentSize().x/o.width,n.getClippedBounds().getBoundingBox()),s=r.x,a=r.y,l=r.x+r.width,c=r.y+r.height,u=1;u<this._items.length;u++)o=(n=this._items[u]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/o.width),r=n.getClippedBounds().getBoundingBox(),s=Math.min(s,r.x),a=Math.min(a,r.y),l=Math.max(l,r.x+r.width),c=Math.max(c,r.y+r.height);this._homeBounds=new R.Rect(s,a,l-s,c-a),this._contentSize=new R.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new R.Rect(0,0,1,1),this._contentSize=new R.Point(1,1),this._contentFactor=1;this._contentFactor===i&&this._homeBounds.equals(e)&&this._contentSize.equals(t)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})},{}],4:[function(e,t,i){"use strict";t.exports=function(e,t,i,n){t=t||"&",i=i||"=";var o={};if("string"==typeof e&&0!==e.length){var r=/\+/g,t=(e=e.split(t),1e3),s=(n&&"number"==typeof n.maxKeys&&(t=n.maxKeys),e.length);0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var l,c=e[a].replace(r,"%20"),u=c.indexOf(i),u=0<=u?(l=c.substr(0,u),c.substr(u+1)):(l=c,""),c=decodeURIComponent(l),u=decodeURIComponent(u);Object.prototype.hasOwnProperty.call(o,c)?h(o[c])?o[c].push(u):o[c]=[o[c],u]:o[c]=u}}return o};var h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],5:[function(e,t,i){"use strict";function r(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}t.exports=function(i,n,o,e){return n=n||"&",o=o||"=","object"==typeof(i=null===i?void 0:i)?a(l(i),function(e){var t=encodeURIComponent(r(e))+o;return s(i[e])?a(i[e],function(e){return t+encodeURIComponent(r(e))}).join(n):t+encodeURIComponent(r(i[e]))}).join(n):e?encodeURIComponent(r(e))+o+encodeURIComponent(r(i)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i.push(t(e[n],n));return i}var l=Object.keys||function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}},{}],6:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode"),i.encode=i.stringify=e("./encode")},{"./decode":4,"./encode":5}],7:[function(e,t,i){var n,o;n=this,o=function(){function p(e,t,i){if(i){var n=document.createDocumentFragment(),o=!t.hasAttribute("viewBox")&&i.getAttribute("viewBox");o&&t.setAttribute("viewBox",o);for(var r=i.cloneNode(!0);r.childNodes.length;)n.appendChild(r.firstChild);e.appendChild(n)}}return function(e){var a=Object(e),e=window.top!==window.self,l="polyfill"in a?a.polyfill:/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/.test(navigator.userAgent)||(navigator.userAgent.match(/\bEdge\/12\.(\d+)\b/)||[])[1]<10547||(navigator.userAgent.match(/\bAppleWebKit\/(\d+)\b/)||[])[1]<537||/\bEdge\/.(\d+)\b/.test(navigator.userAgent)&&e,c={},u=window.requestAnimationFrame||setTimeout,h=document.getElementsByTagName("use"),d=0;l&&function e(){for(var t=0;t<h.length;){var i,n=h[t],o=n.parentNode,r=function(e){for(var t=e;"svg"!==t.nodeName.toLowerCase()&&(t=t.parentNode););return t}(o),s=n.getAttribute("xlink:href")||n.getAttribute("href");!s&&a.attributeName&&(s=n.getAttribute(a.attributeName)),r&&s?l&&(!a.validate||a.validate(s,r,n)?(o.removeChild(n),s=(n=s.split("#")).shift(),n=n.join("#"),s.length?((i=c[s])||((i=c[s]=new XMLHttpRequest).open("GET",s),i.send(),i._embeds=[]),i._embeds.push({parent:o,svg:r,id:n}),function(n){n.onreadystatechange=function(){var i;4===n.readyState&&((i=n._cachedDocument)||((i=n._cachedDocument=document.implementation.createHTMLDocument("")).body.innerHTML=n.responseText,n._cachedTarget={}),n._embeds.splice(0).map(function(e){var t=(t=n._cachedTarget[e.id])||(n._cachedTarget[e.id]=i.getElementById(e.id));p(e.parent,e.svg,t)}))},n.onreadystatechange()}(i)):p(o,r,document.getElementById(n))):(++t,++d)):++t}(!h.length||0<h.length-d)&&u(e,67)}()}},"function"==typeof define&&define.amd?define([],function(){return n.svg4everybody=o()}):"object"==typeof t&&t.exports?t.exports=o():n.svg4everybody=o()},{}],8:[function(e,t,i){var n,o;n=this,o=function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function s(e){return t({},te,e)}function e(e,t){var i,n="LazyLoad::Initialized",t=new e(t);try{i=new CustomEvent(n,{detail:{instance:t}})}catch(e){(i=document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,{instance:t})}window.dispatchEvent(i)}function l(e,t){return e.getAttribute(re+t)}function u(e){return b(e)===oe}function h(e){return e.llTempImage}function M(e,t){e&&(e.toLoadCount=t)}function z(e){for(var t,i=[],n=0;t=e.children[n];n+=1)"SOURCE"===t.tagName&&i.push(t);return i}function B(e,t){z(e).forEach(t)}function N(e){delete e[v]}function i(t,e){var i;D(t)||(i={},e.forEach(function(e){i[e]=t.getAttribute(e)}),t[v]=i)}function d(n,e){var o;D(n)&&(o=ce(n),e.forEach(function(e){var t,i;t=n,(i=o[e=e])?t.setAttribute(e,i):t.removeAttribute(e)}))}function F(e,t,i){T(e,t.class_applied),w(e,ne),i&&(t.unobserve_completed&&P(e,t),S(t.callback_applied,e,i))}function q(e,t,i){T(e,t.class_loading),w(e,f),i&&(C(i,1),S(t.callback_loading,e,i))}function n(e,t,i){i&&e.setAttribute(t,i)}function j(e,t){n(e,g,l(e,t.data_sizes)),n(e,r,l(e,t.data_srcset)),n(e,m,l(e,t.data_src))}function W(e,t){!t||0<t.loadingCount||0<t.toLoadCount||S(e.callback_finish,t)}function U(e,t,i){e.addEventListener(t,i),e.llEvLisnrs[t]=i}function V(e,t,i){delete e.llTempImage,C(i,-1),i&&--i.toLoadCount,E(e,t.class_loading),t.unobserve_completed&&P(e,i)}function c(s,a,l){var e,t,c=h(s)||s;I(c)||(I(e=c)||(e.llEvLisnrs={}),t="VIDEO"===e.tagName?"loadeddata":"load",U(e,t,function(e){var t=0,i=s,n=a,o=l,r=u(i);V(i,n,o),T(i,n.class_loaded),w(i,ie),S(n.callback_loaded,i,o),r||W(n,o),A(c)}),U(e,"error",function(e){var t=0,i=s,n=a,o=l,r=u(i);V(i,n,o),T(i,n.class_error),w(i,y),S(n.callback_error,i,o),n.restore_on_error&&d(i,L),r||W(n,o),A(c)}))}function G(e){return e.use_native&&"loading"in HTMLImageElement.prototype}function Z(e,c,u){e.forEach(function(e){return e.isIntersecting||0<e.intersectionRatio?(o=e.target,r=e,s=c,a=u,l=0<=se.indexOf(b(o)),w(o,"entered"),T(o,s.class_entered),E(o,s.class_exited),s.unobserve_entered&&P(o,a),S(s.callback_enter,o,r,a),void(l||O(o,s,a))):(r=e.target,l=e,o=c,s=u,void(x(r)||(T(r,o.class_exited),a=r,e=l,i=s,(t=o).cancel_on_exit&&b(a)===f&&"IMG"===a.tagName&&(A(a),R(n=a,function(e){pe(e)}),pe(n),me(a),E(a,t.class_loading),C(i,-1),_(a),S(t.callback_cancel,a,e,i)),S(o.callback_exit,r,l,s))));var t,i,n,o,r,s,a,l})}function X(e){return Array.prototype.slice.call(e)}function a(e){return e.container.querySelectorAll(e.elements_selector)}function K(e){return b(e)===y}function Y(e,t){return e=e||a(t),X(e).filter(x)}function o(e,t){var n,o,i,r,e=s(e);this._settings=e,this.loadingCount=0,i=e,r=this,$&&!G(i)&&(r._observer=new IntersectionObserver(function(e){Z(e,i,r)},{root:i.container===document?null:i.container,rootMargin:i.thresholds||i.threshold+"px"})),n=e,o=this,p&&(o._onlineHandler=function(){var t,e,i;e=o,i=a(t=n),X(i).filter(K).forEach(function(e){E(e,t.class_error),_(e)}),e.update()},window.addEventListener("online",o._onlineHandler)),this.update(t)}var p="undefined"!=typeof window,J=p&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),$=p&&"IntersectionObserver"in window,Q=p&&"classList"in document.createElement("p"),ee=p&&1<window.devicePixelRatio,te={elements_selector:".lazy",container:J||p?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},m="src",r="srcset",g="sizes",v="llOriginalAttrs",f="loading",ie="loaded",ne="applied",y="error",oe="native",re="data-",b=function(e){return l(e,"ll-status")},w=function(e,t){var i;e=e,i="data-ll-status",null!==t?e.setAttribute(i,t):e.removeAttribute(i)},_=function(e){return w(e,null)},x=function(e){return null===b(e)},se=[f,"loaded",ne,y],S=function(e,t,i,n){e&&(void 0===n?void 0===i?e(t):e(t,i):e(t,i,n))},T=function(e,t){Q?e.classList.add(t):e.className+=(e.className?" ":"")+t},E=function(e,t){Q?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},P=function(e,t){t&&(t=t._observer)&&t.unobserve(e)},C=function(e,t){e&&(e.loadingCount+=t)},R=function(e,t){e=e.parentNode;e&&"PICTURE"===e.tagName&&z(e).forEach(t)},k=[m],ae=[m,"poster"],L=[m,r,g],le=["data"],D=function(e){return!!e[v]},ce=function(e){return e[v]},ue={IMG:function(e,t){R(e,function(e){i(e,L),j(e,t)}),i(e,L),j(e,t)},IFRAME:function(e,t){i(e,k),n(e,m,l(e,t.data_src))},VIDEO:function(e,t){B(e,function(e){i(e,k),n(e,m,l(e,t.data_src))}),i(e,ae),n(e,"poster",l(e,t.data_poster)),n(e,m,l(e,t.data_src)),e.load()},OBJECT:function(e,t){i(e,le),n(e,"data",l(e,t.data_src))}},he=["IMG","IFRAME","VIDEO","OBJECT"],de=function(e,t,i){e.removeEventListener(t,i)},I=function(e){return!!e.llEvLisnrs},A=function(e){if(I(e)){var t,i=e.llEvLisnrs;for(t in i){var n=i[t];de(e,t,n)}delete e.llEvLisnrs}},O=function(e,t,i){var n,o,r,s,a;-1<he.indexOf(e.tagName)?(c(r=e,n=t,a=i),n=n,a=a,(o=ue[(r=r).tagName])&&(o(r,n),q(r,n,a))):(o=t,r=i,(n=e).llTempImage=document.createElement("IMG"),c(n,o,r),D(a=n)||(a[v]={backgroundImage:a.style.backgroundImage}),a=r,e=l(t=n,(i=o).data_bg),s=l(t,i.data_bg_hidpi),(s=ee&&s?s:e)&&(t.style.backgroundImage='url("'.concat(s,'")'),h(t).setAttribute(m,s),q(t,i,a)),e=r,i=l(s=n,(t=o).data_bg_multi),a=l(s,t.data_bg_multi_hidpi),(a=ee&&a?a:i)&&(s.style.backgroundImage=a,F(s,t,e)),i=r,(t=l(a=n,(s=o).data_bg_set))&&(e=(t=t.split("|")).map(function(e){return"image-set(".concat(e,")")}),a.style.backgroundImage=e.join(),""===a.style.backgroundImage&&(e=t.map(function(e){return"-webkit-image-set(".concat(e,")")}),a.style.backgroundImage=e.join()),F(a,s,i)))},pe=function(e){e.removeAttribute(m),e.removeAttribute(r),e.removeAttribute(g)},me=function(e){R(e,function(e){d(e,L)}),d(e,L)},ge={IMG:me,IFRAME:function(e){d(e,k)},VIDEO:function(e){B(e,function(e){d(e,k)}),d(e,ae),e.load()},OBJECT:function(e){d(e,le)}},ve=["IMG","IFRAME","VIDEO"];if(o.prototype={update:function(e){var t,i,n,o,r=this._settings,e=Y(e,r);M(this,e.length),!J&&$?G(r)?(n=r,o=this,e.forEach(function(e){var t,i;-1!==ve.indexOf(e.tagName)&&(t=n,i=o,(e=e).setAttribute("loading","lazy"),c(e,t,i),(i=ue[e.tagName])&&i(e,t),w(e,oe))}),M(o,0)):(r=e,(t=this._observer).disconnect(),i=t,r.forEach(function(e){i.observe(e)})):this.loadAll(e)},destroy:function(){this._observer&&this._observer.disconnect(),p&&window.removeEventListener("online",this._onlineHandler),a(this._settings).forEach(function(e){N(e)}),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){var t=this,i=this._settings;Y(e,i).forEach(function(e){P(e,t),O(e,i,t)})},restoreAll:function(){var o=this._settings;a(o).forEach(function(e){var t,i,n;t=o,(n=ge[(i=e=e).tagName])?n(i):D(n=i)&&(i=ce(n),n.style.backgroundImage=i.backgroundImage),n=t,x(i=e)||u(i)||(E(i,n.class_entered),E(i,n.class_exited),E(i,n.class_applied),E(i,n.class_loading),E(i,n.class_loaded),E(i,n.class_error)),_(e),N(e)})}},o.load=function(e,t){t=s(t);O(e,t)},o.resetStatus=function(e){_(e)},p){var fe=o,H=window.lazyLoadOptions;if(H)if(H.length)for(var ye,be=0;ye=H[be];be+=1)e(fe,ye);else e(fe,H)}return o},"object"==typeof i&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):(n="undefined"!=typeof globalThis?globalThis:n||self).LazyLoad=o()},{}],9:[function(e,t,i){"use strict";var n=a(e("vanilla-lazyload")),o=a(e("svg4everybody")),r=a(e("../../components/blocks/object-image-overlay/_object-image-overlay")),s=a(e("../../components/blocks/object-card/_object-card"));function a(e){return e&&e.__esModule?e:{default:e}}e("../../components/blocks/background-video/_background-video"),e("../../components/groups/block-grid/_grid-reveal-more"),e("../../components/blocks/cookie-banner/_cookie-banner"),e("../../components/blocks/facet-box/_facet-box"),e("../../components/blocks/image-carousel/_image-carousel"),e("../../components/blocks/image-overlay-license-modal/_image-overlay-license-modal"),e("../../components/blocks/image-row/_image-row"),e("../../components/blocks/object-details/object-details"),e("../../components/blocks/object-shuffler/_object-shuffler"),e("../../components/blocks/modal/_modal"),e("../../components/blocks/newsletter-signup/_newsletter-signup"),e("../../components/blocks/search-form/_search-form"),e("../../components/blocks/search-pagination/_search-pagination"),e("../../components/blocks/search-result/_search-result"),e("../../components/blocks/search-results/_search-results"),e("../../components/blocks/site-nav/_site-nav"),e("../../components/blocks/toggle-nav/_toggle-nav"),e("../../components/blocks/video-thumbnail/_video-thumbnail"),e("../../components/blocks/video-trailer/_video-trailer"),e("../../components/groups/facet-box-modal/_facet-box-modal"),e("../../components/groups/image-overlay/_image-overlay"),e("../../components/groups/story-box-container/_story-box-container"),new n.default({elements_selector:"img[data-srcset]",cancel_on_exit:!1,class_loading:"s-lazyload--blur",class_error:"s-lazyload--error",callback_error:function(e){var t=e.parentNode.insertBefore(document.createElement("div"),e);t.className=e.className,t.dataset.imgFailed=e.src,e.parentNode.removeChild(e)}}),(0,s.default)(),(0,r.default)(),(0,o.default)()},{"../../components/blocks/background-video/_background-video":10,"../../components/blocks/cookie-banner/_cookie-banner":11,"../../components/blocks/facet-box/_facet-box":12,"../../components/blocks/image-carousel/_image-carousel":13,"../../components/blocks/image-overlay-license-modal/_image-overlay-license-modal":14,"../../components/blocks/image-row/_image-row":15,"../../components/blocks/modal/_modal":16,"../../components/blocks/newsletter-signup/_newsletter-signup":17,"../../components/blocks/object-card/_object-card":18,"../../components/blocks/object-details/object-details":19,"../../components/blocks/object-image-overlay/_object-image-overlay":20,"../../components/blocks/object-shuffler/_object-shuffler":21,"../../components/blocks/search-form/_search-form":22,"../../components/blocks/search-pagination/_search-pagination":23,"../../components/blocks/search-result/_search-result":24,"../../components/blocks/search-results/_search-results":25,"../../components/blocks/site-nav/_site-nav":26,"../../components/blocks/toggle-nav/_toggle-nav":27,"../../components/blocks/video-thumbnail/_video-thumbnail":28,"../../components/blocks/video-trailer/_video-trailer":29,"../../components/groups/block-grid/_grid-reveal-more":30,"../../components/groups/facet-box-modal/_facet-box-modal":31,"../../components/groups/image-overlay/_image-overlay":32,"../../components/groups/story-box-container/_story-box-container":33,svg4everybody:7,"vanilla-lazyload":8}],10:[function(e,t,i){"use strict";var n,o,r,s,a,l,c,u,h=document.querySelector(".js-background-video");h&&(n=document.querySelector(".js-background-video-container"),o=document.querySelector(".js-stop-button"),r=document.querySelector(".js-background-video-credit"),s=document.querySelector(".js-background-image-credit"),a=0,l=function(){r&&r.classList.remove("s-hidden"),s&&s.classList.add("s-hidden")},c=function(){r&&r.classList.add("s-hidden"),s&&s.classList.remove("s-hidden")},h.addEventListener("canplaythrough",function(){20<=a?(n.classList.remove("b-video-background--fade"),h.pause(),c(),o.classList.add("s-hidden")):(n.classList.add("b-video-background--fade"),a+=1,l(),o.classList.remove("s-hidden")),0===n.offsetHeight&&o.classList.add("s-hidden")}),u=function(){0===n.offsetHeight?(h.pause(),c(),o.classList.add("s-hidden")):(h.play(),l(),o.classList.remove("s-hidden"))},window.addEventListener("load",function(){u()}),window.addEventListener("resize",function(){u()}),o&&(o.onclick=function(){h.pause(),n.classList.remove("b-video-background--fade"),h.paused&&(o.classList.add("s-hidden"),c())}))},{}],11:[function(e,t,i){"use strict";var n,o=document.querySelector(".js-cookie-banner");o&&(n=document.querySelector(".js-cookie-banner-close"),document.addEventListener("DOMContentLoaded",function(){o.classList.remove("b-cookie-banner--hidden")},!0),n.onclick=function(e){e.preventDefault(),o.classList.add("b-cookie-banner--hidden")})},{}],12:[function(e,t,i){"use strict";function s(e){return new CustomEvent("termToggle",{detail:e,bubbles:!(1<arguments.length&&void 0!==arguments[1])||arguments[1]})}function n(){m.addEventListener("termToggle",function(e){var t,i,n,o,r;e.stopPropagation(),e=e.detail,i=e.id,n=e.facet,o=e.term,r=e.paramName,i&&((e=Array.from(document.querySelectorAll("button[data-id='"+i+"']")).filter(function(e){return!e.classList.contains("b-facet-box__facet-term-toggle-button")})).length?(e.forEach(function(e){return e.remove()}),document.querySelector(".b-search-form__facets").children.length||document.querySelector(".b-search-form__facet-pane").classList.remove("b-search-form__facet-pane--active")):(t=function(){Array.from(document.querySelectorAll("button[data-id='"+i+"']")).forEach(function(e){return e.dispatchEvent(s({id:i,facet:n,term:o,paramName:r}))})},(e=document.createElement("button")).dataset.id=i,e.className="b-facet-box__term",e.innerHTML='<span class="b-facet-box__term-text">'+n+": "+o+"</span>",e.onclick=function(e){"date_terms"===e.target.closest(".b-facet-box__term").dataset.id&&Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input")).forEach(function(e){e.value=""}),t()},e.classList.add("b-facet-box__term--mobile"),m.appendChild(e),(e=e.cloneNode(!0)).classList.remove("b-facet-box__term--mobile"),e.onclick=function(e){"date_terms"===e.target.closest(".b-facet-box__term").dataset.id&&Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input")).forEach(function(e){e.value=""}),e.preventDefault(),t()},e.classList.add("b-facet-box__term--form"),document.querySelector(".b-search-form__facets")&&document.querySelector(".b-search-form__facets").appendChild(e),document.querySelector(".b-search-form__facet-pane--active")||document.querySelector(".b-search-form__facet-pane").classList.add("b-search-form__facet-pane--active")),window.dispatchEvent(new Event("resize")))}),document.querySelector(".b-facet-box").addEventListener("newFacets",function(e){Object.keys(g).forEach(function(e){return delete g[e]});var t,a,l,e=e.detail,i=e.facets,e=e.activeFacets,i=(i.forEach(function(e){var t,i;Object.assign(g,(t={},i=e.facet,e=Object.assign(e,{index:0}),i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t))}),Array.from(document.querySelectorAll(".b-facet-box__hidden-input")).forEach(function(e){return e.remove()}),document.querySelector(".b-facet-box__facet-container")),n=(i.innerHTML="",m.innerHTML="",t=e,a=document.querySelector(".b-facet-box__facet-container"),l=Array.from(t).reduce(function(e,t){var i=t.split("-")[0],t=t.split("-")[1];return e[i]?e[i].push(t):e[i]=[t],e},{}),Object.values(g).forEach(function(e){var n=e.facet,t=e.terms,o=e.paramName,e=e.index,r=document.createElement("DIV"),i=(r.className="b-facet-box__facet",r.setAttribute("data-param-name",o),r.innerHTML=f(n,5<t.length),r.setAttribute("aria-haspopup","true"),r.setAttribute("aria-expanded","false"),r.addEventListener("click",function(e){e.preventDefault(),e.target.classList.contains(h)&&(e.target.parentNode.setAttribute("aria-expanded",String(!("true"===e.target.parentNode.getAttribute("aria-expanded")))),e.target.classList.toggle(e.target.classList[0]+"--active"),e.target.parentNode.querySelector("."+d).classList.toggle(d+"--active"))}),t.map(function(e){return e.value})),s=l[o]&&l[o].reduce(function(e,t){t=i.indexOf(t);return t<e?e:t},5)||0;s=(s=5*Math.ceil(s/5))>t.length?t.length:s||5,t.slice(e,s).forEach(function(e){var t=e.term,i=e.count,e=e.value;r.querySelector("."+d).appendChild(v(n,o,t,e,i))}),g[n].index+=s,5<t.length&&(g[n].index<t.length?(r.querySelector("."+d).appendChild(r.querySelector(".b-facet-box__term-more-container")),r.querySelector("."+d+" .b-facet-box__term-more").onclick=function(e){e.preventDefault(),y(e)}):r.querySelector("."+d).appendChild(r.querySelector(".b-facet-box__term-more-container")).remove()),a.appendChild(r)}),document.createElement("DIV")),o=(n.className="b-facet-box__facet b-facet-box__facet-date",n.setAttribute("aria-haspopup","true"),n.setAttribute("aria-expanded","false"),n.innerHTML='<button tabindex="0" class="b-facet-box__facet-text" data-facet-text="dates">Dates</button><div class="b-facet-box__facet-term-container"><span class="b-facet-box__facet-term-container-text">Use a hyphen to indicate dates BC. For example -800 is 800 BC.</span><form class="b-facet-box__facet-date-container"><div class="b-facet-box__facet-date-container-start"><label class="b-facet-box__facet-date-label">From year:</label><input class="b-facet-box__facet-date-input" placeholder="-800" type="number" name="year_made_from"></div><div class="b-facet-box__facet-date-container-end"><label class="b-facet-box__facet-date-label">To year:</label><input class="b-facet-box__facet-date-input" placeholder="2000" type="number" name="year_made_to"></div><div class="b-facet-box__facet-date-container-button"><label class="b-facet-box__facet-date-label">&nbsp;</label><button class="b-facet-box__facet-date-button"><svg class="b-facet-box__facet-date-button-icon" aria-label="apply-date-facet" role="img"><use xlink:href="/assets/svg/vamicons.svg#search"></use></svg></button></div></form><span disabled="false" class="b-facet-box__facet-term-container-text b-facet-box__facet-term-container-text--warning">Please enter both a start and end year.</span></div>',n.querySelector("button").addEventListener("click",function(e){var t;e.preventDefault(),e.target.classList.contains(h)&&(t=n.getAttribute("aria-expanded"),n.setAttribute("aria-expanded","true"===t?"false":"true"),e.target.classList.toggle(e.target.classList[0]+"--active"),e.target.parentNode.querySelector("."+d).classList.toggle(d+"--active"))}),n.querySelector("form").addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation();var t,i,n,o=Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input")),e=(o.forEach(function(e){return e.classList.remove("b-facet-box__facet-date-input--error")}),o.map(function(e){return e.value}));2!==e.filter(function(e){return e.length}).length?(e.forEach(function(e,t){e.length||o[t].classList.add("b-facet-box__facet-date-input--error")}),document.querySelector(".b-facet-box__facet-term-container-text--warning").removeAttribute("disabled")):((n=document.createElement("INPUT")).type="hidden",n.className="b-search-results__hidden-date",document.querySelectorAll(".b-search-results__hidden-date").forEach(function(e){return e.remove()}),t=function(e){return parseInt(e,10)<0?-1*e+" BC":e},document.querySelector('button[data-id="date_terms"]')&&m.dispatchEvent(s({facet:"dates",id:"date_terms",paramName:"date_terms",refreshing_page:!1,term:t(e[0])+" - "+t(e[1])},!0)),document.querySelector(".b-facet-box__facet-term-container-text--warning").setAttribute("disabled","true"),(i=n.cloneNode(!0)).name="year_made_from",i.value=e[0],(n=n.cloneNode(!0)).name="year_made_to",n.value=e[1],document.querySelector("#vam-etc-search").appendChild(i),document.querySelector("#vam-etc-search").appendChild(n),m.dispatchEvent(s({facet:"dates",id:"date_terms",paramName:"date_terms",refreshing_page:!1,term:t(e[0])+" - "+t(e[1])},!0)))}),i.append(n),{});e&&Array.from(e).forEach(function(e){var t=document.querySelector("button[data-id='"+e+"'"),i=e.split("-");if(t)t.dispatchEvent(s(Object.assign(t.dataset,{refreshing_page:!0}))),document.querySelector("."+p).dispatchEvent(s(t.dataset));else for(;!document.querySelector("button[data-id='"+e+"']")&&document.querySelector('div[data-param-name="'+i[0]+'"] .b-facet-box__term-more');)document.querySelector('div[data-param-name="'+i[0]+'"] .b-facet-box__term-more').click(),document.querySelector("button[data-id='"+e+"'").dispatchEvent(s(Object.assign(document.querySelector("button[data-id='"+e+"'").dataset,{refreshing_page:!0}))),document.querySelector("."+p).dispatchEvent(s(document.querySelector("button[data-id='"+e+"'").dataset));"year_made_from"!==i[0]&&"year_made_to"!==i[0]||(t=i[0],n.querySelector('input[name="'+t+'"]').value=2!==i.length?"-"+i[2]:i[1],o[t]=2!==i.length?"-"+i[2]:i[1],2===Object.keys(o).length&&n.querySelector("form button").click())}),window.dispatchEvent(new Event("resize"))},!0),document.onclick=function(e){e.target.classList.contains("b-facet-box__close-button")&&(e.preventDefault(),e.target.dispatchEvent(new Event("closeFacetOverlay",{bubbles:!0}))),e.target.closest("."+c+"-button")&&(e.preventDefault(),e=e.target.closest("."+c+"-button"),m.dispatchEvent(s(e.dataset,!1)),e.dispatchEvent(s(e.dataset)))}}function r(){var t=(t=[]).concat(Array.from(document.querySelectorAll(".b-facet-box__term-list button")));return Array.from(document.querySelectorAll(".b-facet-box__facet")).forEach(function(e){t.push(e.querySelector("button")),"true"===e.getAttribute("aria-expanded")&&(t=e.classList.contains("b-facet-box__facet-date")?t.concat(Array.from(e.querySelectorAll("form button, form input"))):t.concat(Array.from(e.querySelectorAll("ul button"))))}),t}function a(e){var t,i,n,o=r();"Escape"===e.key&&(document.querySelector(".b-facet-box").classList.remove("b-facet-box--active"),window.removeEventListener("keydown",a)),9===e.keyCode&&(t=o[0],i=o[o.length-1],n=e.shiftKey,o.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault())))}var o,l="b-facet-box__facet",c=l+"-term-toggle",u=c+"-tick",h=l+"-text",d=l+"-term-container",p="b-facet-box__term-list",m=document.querySelector("."+p),g={},v=function(e,i,t,n,o){var r=document.createElement("LI"),s=(r.className="b-facet-box__facet-term-toggle",r.innerHTML='<button class="b-facet-box__facet-term-toggle-button"><div class="b-facet-box__facet-term-toggle-checkbox"><svg class="b-facet-box__facet-term-toggle-tick" aria-hidden="true" role="img"><use xlink:href="/assets/svg/vamicons.svg#tick"></use></svg></div><span id="'+i.replace(" ","")+"-"+t.replace(" ","")+'-checkbox-label" class="b-facet-box__facet-term-toggle-text">'+t+'</span><span class="b-facet-box__facet-term-toggle-result">('+o+")</span></button>",r.querySelector("button")),a=(s.dataset.id=i.replace(" ","")+"-"+n,s.dataset.facet=e,s.dataset.paramName=i,s.dataset.term=t,s.dataset.value=n,s.dataset.count=o,s.setAttribute("aria-labelledby",i.replace(" ","")+"-"+t.replace(" ","")+"-checkbox-label"),s.setAttribute("role","switch"),s.setAttribute("aria-checked","false"),document.createElement("INPUT"));return a.type="checkbox",a.className="b-facet-box__hidden-input",a.name=i,a.value=n,a.id=i+"="+n,a.setAttribute("aria-hidden","true"),r.addEventListener("termToggle",function(e){var t=document.querySelector('input[id="'+i+"="+n+'"]');t?(t.click(),t.remove()):(document.querySelector("#vam-etc-search").appendChild(a),document.querySelector('input[id="'+i+"="+n+'"]').checked=!0),e.target.querySelector("."+u).classList.contains(u+"--active")?e.target.setAttribute("aria-checked","false"):e.target.setAttribute("aria-checked","true"),e.target.querySelector("."+u).classList.toggle(u+"--active"),e.detail.refreshing_page||document.querySelector(".b-facet-box").dispatchEvent(new Event("boxChecked",{bubbles:!0}))}),r},f=function(e,t){return'<button class="b-facet-box__facet-text" data-facet-text="'+e+'">'+e+'</button><ul data-facet="'+e+'" class="b-facet-box__facet-term-container">'+(t?'<li class="b-facet-box__term-more-container"><button data-facet="'+e+'" class="b-facet-box__term-more" aria-label="see more terms of facet '+e+'">See more</button></li>':"")+"</ul>"},y=function(e){e.preventDefault();var t=e.target.parentNode,n=e.target.parentNode.parentNode,e=g[e.target.dataset.facet],i=e.terms,o=e.index,r=e.facet,s=e.paramName;i.slice(o,o+5).forEach(function(e){var t=e.term,i=e.count,e=e.value;n.appendChild(v(r,s,t,e,i))}),g[r].index+=5,g[r].index<i.length?n.appendChild(t):t.remove(),Array.from(n.querySelectorAll(".b-facet-box__facet-term-toggle-button")).slice(-1)[0].focus()};document.querySelector(".b-facet-box")&&(n(),(o=document.createElement("SPAN")).classList.add("b-facet-box__instruction"),o.setAttribute("aria-live","polite"),o.innerHTML="Use Escape Key to close filters",document.querySelector(".b-facet-box__modal-button-open")&&document.querySelectorAll(".b-facet-box__modal-button-open").forEach(function(e){return e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(".b-facet-box").classList.add("b-facet-box--active"),window.addEventListener("keydown",a),document.querySelector(".b-facet-box").appendChild(o),r()[0].focus()})}),document.querySelector(".b-facet-box__close-button")&&document.querySelector(".b-facet-box__close-button").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".b-facet-box").classList.remove("b-facet-box--active"),window.removeEventListener("keydown",a),document.querySelector(".b-facet-box").removeChild(o)}),window.addEventListener("resize",function(){var t,i,n,e=Array.from(document.querySelectorAll(".b-facet-box__term.b-facet-box__term--form"));document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross")&&(499<window.innerWidth&&window.innerWidth<992?(t=document.querySelector(".b-search-form__facets").offsetWidth,i=0,n=1,e.forEach(function(e){(i+=e.offsetWidth)<t&&(n+=1)}),0<e.length-n?document.querySelector(".b-search-form__facets-mobile").style.display="block":document.querySelector(".b-search-form__facets-mobile").style.display="none",document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross").innerHTML="+"+(e.length-n)):window.innerWidth<500?(0<e.length?document.querySelector(".b-search-form__facets-mobile").style.display="block":document.querySelector(".b-search-form__facets-mobile").style.display="none",document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross").innerHTML=e.length-1+" filter"+(1<e.length-1?"s":"")+" applied"):document.querySelector(".b-search-form__facets-mobile").style.display="none")}))},{}],13:[function(e,t,i){"use strict";var e=e("openseadragon"),e=(e=e)&&e.__esModule?e:{default:e};var n,r,s,o,a,l,c,u,h,d,p,m=document.querySelector(".b-image-carousel"),g=document.querySelector(".b-image-carousel__conceal-right"),v=document.querySelector(".b-image-carousel__conceal-left"),f=Array.from(document.querySelectorAll(".b-image-carousel__prev")),y=Array.from(document.querySelectorAll(".b-image-carousel__next")),b=document.querySelector(".b-image-overlay-detail__total-number-of-images"),w=document.querySelector(".b-image-overlay-detail__current-image"),_=document.querySelector(".b-image-overlay__img-ref-number"),x=document.querySelector(".b-image-overlay-detail__copyright-holder"),S=document.querySelector(".b-modal__description-license-contact"),T=document.querySelectorAll(".b-image-overlay-detail__navigation-container > button"),E=document.querySelectorAll(".b-image-carousel__prevnext > button"),P=[];m&&(P=(m.dataset.images?JSON.parse(m.dataset.images):{images:[]}).images),m&&P.length&&(n=function(e){var t=document.querySelectorAll(".b-image-carousel__image-preview-container").length;m.dataset.viewIndex=0<e?e>P.length-t?P.length-t:e:0},r=function(e){m.dataset.index=e},s=P.map(function(e){var t=e.imageId,e=e.alt,i=new Image;return i.src="https://framemark.vam.ac.uk/collections/"+t+"/full/!100,100/0/default.jpg",i.alt="thumbnail for "+e,i.className="b-image-carousel__image-preview",i}),o=function(n){var e=Array.from(document.querySelectorAll(".b-image-carousel__image-preview-container")),o=parseInt(m.dataset.viewIndex,10);e.forEach(function(e,t){var i=o+t;e.classList.remove("b-image-carousel__image-preview-container--selected"),i===parseInt(m.dataset.index,10)&&(e.classList.add("b-image-carousel__image-preview-container--selected"),n&&e.focus()),P[i].alt&&e.setAttribute("aria-label","view "+P[i].alt),e.firstElementChild&&e.firstElementChild.remove(),e.appendChild(s[i]),e.onclick=function(){r(i)}})},a=(0,e.default)({element:document.querySelector("#js-image-overlay__osd"),showHomeControl:!1,showFullPageControl:!1,zoomInButton:"js-image-overlay__zoomin",zoomOutButton:"js-image-overlay__zoomout",showNavigator:!0,navigatorId:"js-image-overlay__zoomnavigator",navigatorDisplayRegionColor:"#b7b8bd",navigatorAutoFade:!1}),(e=document.querySelector("#js-image-overlay__zoomnavigator")).parentNode.parentNode.insertBefore(e,e.parentNode),e.parentNode.removeChild(e.nextSibling),l=document.querySelector(".b-image-overlay-detail__zoom-in"),c=document.querySelector(".b-image-overlay-detail__zoom-out"),document.addEventListener("click",function(e){e.target.closest(".b-image-overlay-detail__zoom-in")?(a.viewport.getZoom()===a.viewport.getMaxZoom()&&l.classList.remove("b-image-overlay-detail__zoom-in--enabled"),c.classList.add("b-image-overlay-detail__zoom-out--enabled")):e.target.closest(".b-image-overlay-detail__zoom-out")&&(a.viewport.getZoom()===a.viewport.getMinZoom()&&c.classList.remove("b-image-overlay-detail__zoom-out--enabled"),l.classList.add("b-image-overlay-detail__zoom-in--enabled"))},!1),u={},new MutationObserver(function(e){var t,i;e.filter(function(e){return"data-view-index"===e.attributeName}).length&&(i=parseInt(m.dataset.viewIndex,10),v.style.display=0<i?"block":"none",g.style.display=i+document.querySelectorAll(".b-image-carousel__image-preview-container").length>=P.length?"none":"block"),e.filter(function(e){return"data-image-id"===e.attributeName}).length&&(t=m.dataset.imageId,-1<(i=P.findIndex(function(e){return e.imageId===t}))&&r(i)),e.filter(function(e){return"data-index"===e.attributeName}).length&&(i=parseInt(m.dataset.index,10),n(i-Math.floor(document.querySelectorAll(".b-image-carousel__image-preview-container").length/2)),e=P[i],u.tileSource="https://framemark.vam.ac.uk/collections/"+e.imageId+"/info.json",a.world.removeAll(),a.addTiledImage(u),a.viewport.fitHorizontally().fitVertically(),S.setAttribute("href","mailto:vaimages@vam.ac.uk?subject=Image reference: "+e.ref),_.innerHTML=e.ref,x.innerHTML=e.copyright,o(!0),991<window.innerWidth?(0<i?E[0].removeAttribute("disabled"):E[0].setAttribute("disabled","true"),i===P.length-1?E[1].setAttribute("disabled","true"):E[1].removeAttribute("disabled")):(0<i?T[0].removeAttribute("disabled"):T[0].setAttribute("disabled","true"),i===P.length-1?T[1].setAttribute("disabled","true"):T[1].removeAttribute("disabled")),w.innerHTML=""+(i+1))}).observe(m,{attributes:!0}),document.addEventListener("keydown",function(){var e;document.querySelector(".b-image-overlay__container--active")&&document.activeElement!==a.canvas&&(37===event.keyCode&&0<=(e=parseInt(m.dataset.index,10)-1)&&r(e),39===event.keyCode&&(e=parseInt(m.dataset.index,10)+1)<P.length&&r(e))}),(h=document.createElement("BUTTON")).className="b-image-carousel__image-preview-container",h.innerHTML='<div class="b-image-carousel__image-preview"></div>',d=function(){if(b.innerHTML=P.length,m.dataset.index||(m.dataset.index=0),m.dataset.viewIndex||(m.dataset.viewIndex=0),m)if(window.innerWidth<1200){if(3<document.querySelectorAll(".b-image-carousel__image-preview-container").length||0===document.querySelectorAll(".b-image-carousel__image-preview-container").length){document.querySelector(".b-image-carousel__image-carousel").innerHTML="";for(var e=0;e<3&&e!==P.length;e+=1)document.querySelector(".b-image-carousel__image-carousel").appendChild(h.cloneNode(!0))}}else if(1199<window.innerWidth&&(document.querySelectorAll(".b-image-carousel__image-preview-container").length<5||0===document.querySelectorAll(".b-image-carousel__image-preview-container").length)&&P.length!==document.querySelectorAll(".b-image-carousel__image-preview-container").length){document.querySelector(".b-image-carousel__image-carousel").innerHTML="";for(var t=0;t<5&&t!==P.length;t+=1)document.querySelector(".b-image-carousel__image-carousel").appendChild(h.cloneNode(!0))}},p=function(){window.innerWidth<992&&(T.forEach(function(e){e.removeAttribute("disabled")}),E.forEach(function(e){e.setAttribute("disabled","true")})),991<window.innerWidth&&(T.forEach(function(e){e.setAttribute("disabled","true")}),E.forEach(function(e){e.removeAttribute("disabled")}))},g.onclick=function(){var e=parseInt(m.dataset.viewIndex,10)+1;n(e),o()},v.onclick=function(){var e=parseInt(m.dataset.viewIndex,10)-1;n(e),o()},f.forEach(function(e){e.onclick=function(){var e=parseInt(m.dataset.index,10);r(e-1)}}),y.forEach(function(e){e.onclick=function(){var e=parseInt(m.dataset.index,10);r(e+1)}}),window.addEventListener("resize",function(){d(),r(parseInt(m.dataset.index,10)),p(),m.dataset.index=m.dataset.index,o(),c.classList.add("b-image-overlay-detail__zoom-out--enabled"),l.classList.add("b-image-overlay-detail__zoom-in--enabled")}),p(),d(),m.dataset.index=m.dataset.index,o())},{openseadragon:3}],14:[function(e,t,i){"use strict";var s="b-image-overlay-license-modal",a="__image-modal",n="__agree-to-terms",l="__modal-download-content",c="__modal-contact-content",o="__checkbox-container",r="__agree-checkbox",u="__agree-to-terms-reminder",h="--active",d="--warning",p=["__icon-link-container","__checkmark","__image-icon-link",n],m=document.querySelector("."+s+a),g=document.querySelector(".b-image-overlay")||document.querySelector("body"),v=document.querySelector("."+s+l),f=document.querySelector("."+s+c),y=document.querySelector(".u-link.b-image-overlay-license-modal__download-link.js-modal-action"),b=document.querySelector(".b-icon-link.b-icon-link__download.js-modal-action"),w=document.querySelector(".b-image-overlay-license-modal__close-container");window.addEventListener("click",function(e){var t;e.target.closest(".b-image-overlay-license-modal__close-container")&&(w.disabled=!0,m.classList.remove("b-modal--active"),m.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0}))),e.target.closest("."+s+"__download-button")&&(v.querySelector(".b-image-overlay-license-modal__close-container").disabled=!1,f.querySelector(".b-image-overlay-license-modal__close-container").disabled=!0,t=v.querySelectorAll(".b-image-overlay-license-modal__close-container,.b-image-overlay-license-modal__title-section a,.b-modal__description.b-image-overlay-license-modal__description-container,.b-image-overlay-license-modal__content-container button,.b-image-overlay-license-modal__footer-section a"),g.classList.add("b-image-overlay--unfocus"),m.dispatchEvent(new CustomEvent("jsModalOpen",{bubbles:!0})),m.classList.add("b-modal--active"),w.disabled=!1,v.classList.add(s+l+h),f.classList.remove(s+c+h),t[0].focus()),e.target.closest("."+s+"__contact-button")&&(v.querySelector(".b-image-overlay-license-modal__close-container").disabled=!0,f.querySelector(".b-image-overlay-license-modal__close-container").disabled=!1,g.classList.add("b-image-overlay--unfocus"),m.dispatchEvent(new CustomEvent("jsModalOpen",{bubbles:!0})),m.classList.add("b-modal--active"),w.disabled=!1,v.classList.remove(s+l+h),f.classList.add(s+c+h),document.querySelector(".b-modal__description-license-contact").focus()),e.target.closest("."+s+"__contact-modal-open")&&(v.classList.remove(s+l+h),f.classList.add(s+c+h),document.querySelector(".b-modal__description-license-contact").focus()),e.target.closest("."+s+o)&&e.target.closest("."+s+n)===document.querySelector("."+s+n)&&(document.querySelector("."+s+r).checked=!document.querySelector("."+s+r).checked,document.querySelector("."+s+n).classList.remove(s+n+d),document.querySelector("."+s+r).checked?(document.querySelector("."+s+u).style.display="none",p.forEach(function(e){return document.querySelector("."+s+e)&&document.querySelector("."+s+e).classList.add(s+e+"--active")}),document.querySelector(".b-image-overlay-license-modal__download-link .b-icon-link").classList.add("b-icon-link--active"),y.setAttribute("data-tracking-collections","image download"),b.setAttribute("data-tracking-collections","image download")):(p.forEach(function(e){return document.querySelector("."+s+e)&&document.querySelector("."+s+e).classList.remove(s+e+"--active")}),document.querySelector(".b-image-overlay-license-modal__download-link .b-icon-link").classList.remove("b-icon-link--active"),y.removeAttribute("data-tracking-collections"),b.removeAttribute("data-tracking-collections"))),e.target.closest("."+s+o)&&!document.querySelector("."+s+r).checked&&(document.querySelector("."+s+u).style.display="block",document.querySelector("."+s+n).classList.add(s+n+d))}),window.addEventListener("keydown",function(e){var t,i,n,o=document.querySelector("."+s+a+".b-modal--active"),r=document.querySelector("."+s+l+"."+s+l+h)||document.querySelector("."+s+c+"."+s+c+h);return o&&9===e.keyCode&&(t=(r=r.querySelectorAll(".b-image-overlay-license-modal__close-container,.b-image-overlay-license-modal__title-section a,.b-modal__description.b-image-overlay-license-modal__description-container,.b-image-overlay-license-modal__content-container button,.b-image-overlay-license-modal__footer-section a"))[0],i=r[r.length-1],n=e.shiftKey,r.length&&(n&&document.activeElement===t?((1===r.length?t:i).focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault()))),13===e.keyCode&&document.activeElement.classList.contains("b-image-overlay-license-modal__contact-modal-open")&&document.activeElement.click(),!o||27!==e.keyCode||(m.classList.remove("b-modal--active"),m.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0})),e.preventDefault(),e.stopPropagation(),!1)})},{}],15:[function(e,t,i){"use strict";document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelectorAll(".b-image-row");t.length&&(e=0,Array.from(t,function(a){e+=1,a.classList.add("b-image-row-"+e),a._imageRowId=e;function t(){var e=a.querySelectorAll(".b-image-row__img"),t=[],i=e[0].closest(".b-image-row"),n=getComputedStyle(i),o=i.getBoundingClientRect().width-parseInt(n.paddingLeft,10)-parseInt(n.paddingRight,10),r="",s=0;Array.from(e,function(e){return e.naturalWidth?t.push(e.naturalWidth/e.naturalHeight):(t.push(1),e.closest(".b-image-row__item").classList.add("b-image-row__item--failed")),(s+=1)%2==0&&(r+=".b-image-row-"+i._imageRowId+" .b-image-row__item:nth-child("+(s-1)+"),.b-image-row-"+i._imageRowId+" .b-image-row__item:nth-child("+s+") {height: "+Math.round(o/(t[s-2]+t[s-1])-1.5)+"px;}"),!0}),l.innerHTML="@media screen and (max-width: 768px) {.b-image-row-"+i._imageRowId+" {flex-wrap: wrap;}"+r+"}.b-image-row-"+i._imageRowId+" .b-image-row__item {height: "+o/t.reduce(function(e,t){return e+t})+"px;}"}function i(e){o.push(e),o.length===n.length&&t()}var l=a.parentNode.insertBefore(document.createElement("style"),a),n=a.querySelectorAll(".b-image-row__img"),o=[];return Array.from(n,function(t){return new MutationObserver(function(){t.complete?i(t):(document.addEventListener("load",function(e){e.target===t&&i(t)},!1),t.addEventListener("error",function(){i(t)},!1))}).observe(t,{attributes:!0}),!0}),window.addEventListener("resize",t,!1),!0}))},!0)},{}],16:[function(e,t,i){"use strict";var e=e("browser-cookies"),n=(e=e)&&e.__esModule?e:{default:e};e=document.querySelectorAll(".js-modal");function l(e,t){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"myClick",category:e,action:t})}Array.from(e,function(o){function r(){o.setAttribute("tabindex","-1"),o.setAttribute("aria-hidden","true"),l(t,"pop-up dismissed"),o.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0})),o.classList.remove("b-modal--active")}function s(e){var t,i,n;9===e.keyCode&&(t=a[0],i=a[a.length-1],n=e.shiftKey,a.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault()))),"Escape"===e.key&&(o.removeEventListener("keydown",s),r())}var t=o.dataset.modalCampaign,a=o.querySelectorAll("a");return o.dataset.modalOnceOnly&&n.default.get(t)||o.dataset.notOnLoad||(document.body.appendChild(o),o.setAttribute("tabindex","0"),o.removeAttribute("aria-hidden"),o.classList.add("b-modal--active"),l(t,"pop-up displayed"),o.focus(),a[1].focus(),o.addEventListener("keydown",s)),o.addEventListener("click",function(e){o.dataset.modalOnceOnly&&n.default.set(t,"seen",{domain:o.dataset.modalDomain,expires:365}),e.target!==o&&(Array.from(e.target.classList).find(function(e){return"js-modal-action"===e})||e.target.closest(".js-modal-action")?l(t,"clicked: "+e.target.textContent):(o.removeEventListener("keydown",s),r()))}),!0})},{"browser-cookies":1}],17:[function(e,t,i){"use strict";Array.from(document.querySelectorAll(".js-newsletter_form"),function(r){return r.addEventListener("submit",function(e){e.preventDefault();var e=r.querySelector(".js-emailValidation"),t=r.querySelector(".js-newsletter__descriptor"),i=r.querySelector(".js-newsletter__submit"),n=new XMLHttpRequest,o="";e=e.value,/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)?(n||r.submit(),Array.from(r.querySelectorAll("input"),function(e){return o+=e.name+"="+encodeURIComponent(e.value)+"&",!0}),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?(i.value="Thank you!",t.innerHTML="A confirmation email will be sent to this address shortly&hellip;",r.classList.remove("invalid"),r.classList.add("sent")):r.submit())},n.open("POST",r.action),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o)):(t.innerHTML="That doesn't look like an email address&hellip;",r.classList.add("invalid"),r.querySelector(".b-newsletter__form-fields-field").setAttribute("aria-invalid","true"))}),!0})},{}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){Array.from(document.querySelectorAll(".b-object-card__warning"),function(e){return e.innerHTML='<div class="b-object-card__warning__banner"><div class="b-object-card__warning__banner__text">This object, or the text that describes it, is deemed offensive and discriminatory. We are committed to improving our records, and work is ongoing.</div><div class="b-object-card__warning__banner__dismiss">View record</div></div>'+e.innerHTML+"",!0})},document.addEventListener("click",function(e){return!e.target.closest(".b-object-card__warning")||(e.preventDefault(),e.stopImmediatePropagation(),e.target.closest(".b-object-card__warning").classList.remove("b-object-card__warning"),!1)},!1)},{}],19:[function(e,t,i){"use strict";var n=document.createElement("DIV"),o=["etc-details__cell-concealer","etc-details__cell-revealer"],r=['<span class="etc-details__cell-concealer-text">Read More</span><button class="etc-details__cell-concealer-button">+</button>','<span class="etc-details__cell-concealer-text">Read Less</span><button class="etc-details__cell-concealer-button">-</button>'];function s(e){var t="etc-details__cell-free-content--hidden",i=e.target.parentElement.querySelector(".etc-details__cell-free-content"),n=i.classList.contains(t);e.target.innerHTML=r[n?1:0],e.target.className=o[n?1:0],n?(i.classList.remove(t),e.target.setAttribute("data-tracking-collections","read less")):(i.classList.add(t),e.target.setAttribute("data-tracking-collections","read more"))}n.className=o[0],n.innerHTML=r[0],n.setAttribute("data-tracking-collections","read more"),Array.from(document.querySelectorAll(".etc-details__cell-free")).forEach(function(e){var t;200<e.offsetHeight&&(e.querySelector(".etc-details__cell-free-content").classList.add("etc-details__cell-free-content--hidden"),(t=n.cloneNode(!0)).onclick=s,e.appendChild(t))})},{}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){var r,l,c=Array.from(document.querySelectorAll(".js-object-image-overlay-item"));c.length&&(r=document.querySelector(".b-object-image-overlay")||document.createElement("div"),document.body.appendChild(r),r.classList.add("b-object-image-overlay"),r.innerHTML='<button class="b-object-image-overlay__dismiss" title="Close" aria-label="Close"></button><div class="b-object-image-overlay__items"></div>',l=r.querySelector(".b-object-image-overlay__items"),r.addItem=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=c[e]||c[0],i=e.dataset.objectImageOverlay?JSON.parse(e.dataset.objectImageOverlay):null,n=i&&i.museumNumber?'Museum number: <span itemprop="identifier">'+i.museumNumber+"</span>":"",o=i&&i.copyright?'<br/><span itemprop="copyrightHolder">'+i.copyright+"</span>":"",n=n||o?'<div class="b-object-image-overlay__numbercopyright">'+n+""+o+"</div>":"",o=i&&i.onDisplay?'<div class="b-object-image-overlay__location-status"><svg role="img" viewBox="0 0 52 52"><path d="M51.59 25.348C45.15 15.57 35.838 10 26 10S6.851 15.57.41 25.348L0 26l.41.652C6.85 36.43 16.162 42 26 42s19.149-5.57 25.59-15.348L52 26l-.41-.652zM25.5 35c-5.225 0-9.5-4.275-9.5-9.5s4.275-9.5 9.5-9.5 9.5 4.275 9.5 9.5-4.275 9.5-9.5 9.5z" fill="currentColor"/></svg>On display</div>':"",r="",i=(i&&i.onDisplay?r=(r=i.displayOverride)||(i.locationSite?'<div class="b-object-image-overlay__location-site">'+i.locationSite+"</div>":"")+(i.locationRoom||""):i&&null!==i.onDisplay&&!i.onDisplay&&(r=i.storageOverride||"This object is currently not on display"),i&&i.visitUrl?'<a tabindex="-1" class="b-object-image-overlay__visit" href="'+i.visitUrl+'" data-tracking-oic="visit the object">Find out how to visit this object</a>':""),o=r||i?'<div class="b-object-image-overlay__location">'+o+'<div class="b-object-image-overlay__location-copy">'+r+"</div>"+i+"</div>":"",r=e.querySelector("a").getAttribute("href"),i=e.querySelector("img"),i=i?'<img class="b-object-image-overlay__image"itemprop="contentUrl"alt="'+i.alt+'"sizes="(max-width: 991px) calc(100vw - 20px),(min-width: 992px) calc(70vw - 145px),(min-width: 1200px) 710px"srcset="'+i.srcset+'"src="'+i.src+'">':'<div class="s-lazyload--error"></div>',s=1<r.length?'<br/><a tabindex="-1" class="b-object-image-overlay__cta b-object-image-overlay__cta--screen" href="'+r+'" data-tracking-oic="explore the object">Explore object in more depth</a>':"",r=1<r.length?'<a tabindex="-1" class="b-object-image-overlay__cta b-object-image-overlay__cta--mobile" href="'+r+'" data-tracking-oic="explore the object">Explore object in more depth</a>':"",a=document.createElement("div");a.classList.add("b-object-image-overlay__item"),a.innerHTML+='<div class="b-object-image-overlay__content"><figure class="b-object-image-overlay__figure">'+i+'<figcaption class="b-object-image-overlay__figcaption">'+n+'<div class="b-object-image-overlay__prevnext"><button disabled class="b-object-image-overlay__prev b-object-image-overlay__prev--disabled" title="Previous" aria-label="Previous" data-tracking-oic="previous object"><svg role="img" viewBox="0 0 100 100"><path fill="none" d="M-1-1h582v402H-1z"/><path d="M70.173 12.294L57.446.174l-47.62 50 47.62 50 12.727-12.122-36.075-37.879z" fill="currentColor"/></svg></button><button disabled class="b-object-image-overlay__next b-object-image-overlay__next--disabled" title="Next" aria-label="Next" data-tracking-oic="next object"><svg role="img" viewBox="0 0 100 100"><path fill="none" d="M-1-1h582v402H-1z"/><path d="M20 88.052l12.727 12.121 47.62-50-47.62-50L20 12.294l36.075 37.88z" fill="currentColor"/></svg></button></div></figcaption></figure><div class="b-object-image-overlay__details"><div class="b-object-image-overlay__caption">'+e.querySelector("figcaption").textContent+""+s+"</div>"+o+""+r+"</div></div>",t?l.insertBefore(a,l.firstElementChild):l.appendChild(a)},r.getIndex=function(t){return c.findIndex(function(e){return e===t})},r.clipItem=function(){(0<arguments.length&&void 0!==arguments[0]&&arguments[0]?l.lastElementChild:l.firstElementChild).remove()},r.buttonInit=function(e){r.querySelectorAll("button").forEach(function(e){return e.setAttribute("disabled",!0)}),r.querySelectorAll("a").forEach(function(e){return e.setAttribute("tabindex","-1")}),991<window.innerWidth&&r.querySelector(".b-object-image-overlay__dismiss").removeAttribute("disabled"),r.querySelector(".b-object-image-overlay__dismiss").removeAttribute("disabled");function t(e,t,i){(e||t||i).focus()}var i=document.querySelectorAll(".b-object-image-overlay__item")[1],n=i.querySelector(".b-object-image-overlay__prev"),o=i.querySelector(".b-object-image-overlay__next");991<window.innerWidth&&(0<r._index&&(n.classList.add("b-object-image-overlay__prev--enabled"),n.removeAttribute("disabled")),r._index<c.length-1&&(o.classList.add("b-object-image-overlay__next--enabled"),o.removeAttribute("disabled"))),i.querySelectorAll("a").forEach(function(e){return e.removeAttribute("tabindex")}),991<window.innerWidth?i.querySelector(".b-object-image-overlay__cta--mobile")&&(i.querySelector(".b-object-image-overlay__cta--mobile").setAttribute("tabindex",-1),i.querySelector(".b-object-image-overlay__cta--screen").removeAttribute("tabindex")):i.querySelector(".b-object-image-overlay__cta--screen")&&(i.querySelector(".b-object-image-overlay__cta--screen").setAttribute("tabindex",-1),i.querySelector(".b-object-image-overlay__cta--mobile").removeAttribute("tabindex")),r.focusable=[document.querySelector(".b-object-image-overlay__dismiss")].concat(Array.from(i.querySelectorAll('button:not([disabled]), a:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])')));e?t(i.querySelector(".b-object-image-overlay__prev:not([disabled]"),i.querySelector(".b-object-image-overlay__next:not([disabled]"),r.focusable[0]):t(i.querySelector(".b-object-image-overlay__next:not([disabled]"),i.querySelector(".b-object-image-overlay__prev:not([disabled]"),r.focusable[0])},r.advance=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(!e&&r._index<c.length-1||e&&0<r._index)&&(r.clipItem(e),r.addItem(r._index+2*(e?-1:1),e),r._index+=e?-1:1,r.track(r._index)),r.buttonInit(e)},r.track=function(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"OIC",object:c[e].querySelector("figcaption").textContent.trim(),museumNumber:JSON.parse(c[e].dataset.objectImageOverlay).museumNumber})},document.addEventListener("click",function(e){var t,o;e.target.closest(".js-object-image-overlay-item")&&(e.preventDefault(),e=e.target.closest(".js-object-image-overlay-item"),r._index=r.getIndex(e),r.addItem(r._index),r.classList.add("b-object-image-overlay--active"),r.addItem(r._index+1),r.addItem(r._index-1,!0),r.focus(),r.track(r._index),r.buttonInit(),document.body.style.overflow="hidden",t=function(e){var t,i,n;"ArrowLeft"===e.key?(e.preventDefault(),r.advance(!0)):"ArrowRight"===e.key?(e.preventDefault(),r.advance()):"Escape"===e.key||"Esc"===e.key?o():9===e.keyCode&&(t=r.focusable[0],i=r.focusable[r.focusable.length-1],n=e.shiftKey,r.focusable.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault())))},o=function(){r.classList.remove("b-object-image-overlay--active"),document.body.style.overflow="",l.innerHTML="",r.onclick=null,document.removeEventListener("keydown",t,!1)},document.addEventListener("keydown",t,!1),r.onclick=function(e){e.target.matches(".b-object-image-overlay__item, .b-object-image-overlay__dismiss")?(e.preventDefault(),o()):e.target.closest(".b-object-image-overlay__next--enabled")?(e.preventDefault(),r.advance()):e.target.closest(".b-object-image-overlay__prev--enabled")&&(e.preventDefault(),r.advance(!0))})},!1))}},{}],21:[function(e,t,i){"use strict";var p,n,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],o=!0,t=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!i||n.length!==i);o=!0);}catch(e){t=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};p={init:function(e){for(var o=JSON.parse(e.dataset.objectShuffler),r=e.querySelector(".b-object-shuffler__tabs"),s=r.removeChild(r.querySelector(".b-object-shuffler__tab")),t=e.querySelector(".b-object-shuffler__deck"),a=t.firstElementChild.firstElementChild,i=a.firstElementChild,l=p.setSize(a),c=parseFloat(window.getComputedStyle(a).getPropertyValue("transition-duration")),u=parseFloat(window.getComputedStyle(i).getPropertyValue("transition-duration")),n=1;n<o.length;n+=1)t.parentNode.appendChild(t.cloneNode(!0));var h=0,d=(Array.from(e.querySelectorAll(".b-object-shuffler__deck"),function(n){return n._props={deckTitle:o[h].title||"",slideSize:l,itemsData:o[h].data||[],itemsExclude:o[h].exclude||null,itemsDataFeed:encodeURI(o[h].feed),itemsIndex:0,transitionDurationItem:c,transitionDurationImg:u},p.getData(n).then(function(){if(n._props.itemsData.length<1.5*l)return n.parentNode.removeChild(n),!1;for(var e=r.appendChild(s.cloneNode(!0)),t=(e.className="b-object-shuffler__tab",e.title=""+n._props.deckTitle,e.setAttribute("tabindex","0"),e.setAttribute("aria-hidden",!1),e.dataset.trackingCollections="you may also like carousel",e._deck=n,e===e.parentNode.firstElementChild&&(e.setAttribute("active",!0),e._deck.setAttribute("active",!0)),n.firstElementChild),i=1;i<l;i+=1)t.appendChild(a.cloneNode(!0));t.removeAttribute("active");e=p.newSlide(n);e.setAttribute("active",!0),p.newSlide(n),e.closest(".b-object-shuffler__deck[active]")&&p.tabIndexSlide(e),h===o.length&&1===h&&(r.removeChild(r.firstElementChild),r.classList.add("b-object-shuffler__tabs--void"))}),h+=1,!0}),document.addEventListener("click",function(e){var t;e.target.closest(".b-object-shuffler__tab")&&(e=e.target,(t=r.querySelector("[active]"))&&(t.removeAttribute("active"),t._deck.removeAttribute("active"),p.tabIndexSlide(t._deck.querySelector(".b-object-shuffler__slide[active]"),!1)),e.setAttribute("active",!0),e._deck.setAttribute("active",!0),p.tabIndexSlide(e._deck.querySelector(".b-object-shuffler__slide[active]")))},!1),e.querySelector(".b-object-shuffler__more-icon"));d.addEventListener("click",function(){p.nextSlide(e.querySelector(".b-object-shuffler__deck[active]")),d.setAttribute("active",!0)},!1),d.addEventListener("animationend",function(){d.removeAttribute("active")},!1)},setSize:function(e){return 2*Math.floor(e.parentNode.getBoundingClientRect().width/e.getBoundingClientRect().width)},getData:function(n){var e=2*n._props.slideSize;return n._props.itemsData.length<n._props.itemsIndex+e?(n._props.apiPage=n._props.apiPage+1||1,e=n._props.itemsDataFeed+"&page_size="+e+"&page="+n._props.apiPage,fetch(e).then(function(e){return e.json()}).then(function(e){Array.from(e.records,function(e){var t,i;return e.systemNumber!==n._props.itemsExclude&&(t=e._images._iiif_image_base_url+"full/",i=e._primaryTitle||"untitled "+e.objectType,n._props.itemsData.push({img:{srcset:t+"250,/0/default.jpg 250w, "+t+"350,/0/default.jpg 350w, "+t+"450,/0/default.jpg 450w, "+t+"550,/0/default.jpg 550w, "+t+"700,/0/default.jpg 700w, "+t+"900,/0/default.jpg 900w",src:t+"350,/0/default.jpg",alt:i},title:i,href:"/item/"+e.systemNumber+"/"})),!0})}).catch(function(e){return console.error(e.name,e.message)})):Promise.resolve(!0)},newSlide:function(l){var e=l.appendChild(l.firstElementChild.cloneNode(!0));return Array.from(e.children,function(e){var t=l._props.itemsIndex%l._props.itemsData.length,i=e.querySelector("img"),t=(e.title=l._props.itemsData[t].title,e.href=l._props.itemsData[t].href,e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden",!0),e.dataset.trackingCollections="you may also like object",i.alt=l._props.itemsData[t].img.alt,i.classList.remove("s-lazyload--abort"),i.onerror=function(){return i.classList.add("s-lazyload--abort"),!0},i.srcset=l._props.itemsData[t].img.srcset,i.src=l._props.itemsData[t].img.src,.1*Math.random()),n=1+(0<l._props.itemsIndex%2?1:-1)*t,o=l._props.itemsIndex%l._props.slideSize,r=o>l._props.slideSize/2-1?-1:1,s=o%(l._props.slideSize/2)*(100/(l._props.slideSize/2)),o=o<l._props.slideSize/2?0:50,a=34*t*1,r=r*t*74;return e.style.width="auto",e.style.height=50*n+"%",e.style.position="absolute",e.style.left=s+a+"%",e.style.top=o+r+"%",e.style.setProperty("--js-rotation",5*Math.sin(2*Math.random()*Math.PI)+"deg"),e.style.transitionDuration=l._props.transitionDurationItem*n*n+"s",i.style.transitionDuration=l._props.transitionDurationImg*n*n+"s",l._props.itemsIndex+=1,!0}),p.getData(l),e},nextSlide:function(e){p.newSlide(e),e.firstElementChild.remove();e=e.querySelector("[active]");e.removeAttribute("active"),p.tabIndexSlide(e,!1),e.nextSibling.setAttribute("active",!0),p.tabIndexSlide(e.nextSibling)},tabIndexSlide:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Array.from(e.children,function(e){return e.setAttribute("tabindex",t?"0":"-1"),e.setAttribute("aria-hidden",!t),!0})}},n=null,"IntersectionObserver"in window&&(n=new IntersectionObserver(function(e){var e=o(e,1)[0];0<e.intersectionRatio&&(e=e.target,n.unobserve(e),e.initialised||(p.init(e),e.initialised=!0))},{rootMargin:"0px 0px 1000px 0px"})),document.addEventListener("DOMContentLoaded",function(){Array.from(document.querySelectorAll(".js-object-shuffler"),function(t){try{n.observe(t)}catch(e){p.init(t)}return!0})},!0)},{}],22:[function(e,t,i){"use strict";Array.from(document.querySelectorAll(".js-search-site, .js-search-etc-gateway"),function(o){var e,t,i,n,r,s,a,l,c,u=o.querySelector(".b-search-form__input");return o.classList.contains("js-search-site")?(o._props={type:"siteSearch"},e=o.querySelector(".b-search-form__underscore"),t=o.querySelector(".b-search-form__submit"),i=o.querySelector(".b-search-form__clear"),n=function(){e.innerHTML=u.value.replace(/\s/g,"&nbsp;")},u.value.length?i.classList.remove("b-search-form__clear--hidden"):t.classList.add("b-search-form__submit--hidden"),n(),u.addEventListener("input",function(){n(),i.classList.add("b-search-form__clear--hidden"),u.value.length?t.classList.remove("b-search-form__submit--hidden"):t.classList.add("b-search-form__submit--hidden")},!1),i.addEventListener("click",function(){i.classList.add("b-search-form__clear--hidden"),u.value="",n()},!1)):o.classList.contains("js-search-etc-gateway")&&(o._props={type:"etcGatewaySearch",suggestionsTop:"https://collections.vam.ac.uk/assets/data/suggestions.json",suggestionsAPI:"https://api.vam.ac.uk/v2/sayt/search"},r=function(e){window.dataLayer.push({event:e.target.tracking.event,eventCategory:e.target.tracking.eventCategory,eventAction:e.target.tracking.eventAction,eventLabel:e.target.tracking.eventLabel})},s=o.querySelector(".b-search-form__suggestions"),a=function(e,t){var i,n,o=document.createElement("a");s.childElementCount<10&&(i=t.displayName||t.displayTerm,n="https://collections.vam.ac.uk/search/?id_"+t.recordType+"="+t.systemNumber,o.className="b-search-form__suggestion",o.href=n,o.tabindex=0,o.innerHTML='<div class="b-search-form__suggestion-type">'+t.recordType+"</div>"+i+"",o.tracking={event:"autosuggest EtC landing",eventCategory:"search - autosuggest - "+t.index,eventAction:e,eventLabel:n},o.addEventListener("click",r),s.appendChild(o))},(l=o)._props.storedSuggestions=JSON.parse(sessionStorage.getItem("storedSuggestions_"+l._props.type)),c=new Date,(!l._props.storedSuggestions||c.getTime()>l._props.storedSuggestions.expires?fetch(l._props.suggestionsTop,{cache:"no-cache"}).then(function(e){return e.json()}).then(function(e){e={expires:c.getTime()+9e5,data:e};l._props.storedSuggestions=e,sessionStorage.setItem("storedSuggestions_"+l._props.type,JSON.stringify(l._props.storedSuggestions))}).catch(function(e){return console.error(e.name,e.message)}):Promise.resolve(!0)).then(function(){var n=null;u.addEventListener("input",function(){var e,t,i;o.removeAttribute("suggesting"),s.innerHTML="",u.value.length&&(e=u.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),t="(^|\\|)",2<u.value.length&&(t="\\b"),i=new RegExp(""+t+e+".*","i"),Array.from(o._props.storedSuggestions.data,function(e){return Array.from(e.suggestions,function(e){var t=e.displayName;return i.test(t)&&(o.setAttribute("suggesting",!0),a(u.value,e)),!0}),!0}),4<u.value.length&&(n&&n.abort(),n=new window.AbortController,setTimeout(function(){return n.abort()},500),fetch(o._props.suggestionsAPI+"?q="+encodeURI(e)+"&page_size=10",{signal:n.signal}).then(function(e){return e.json()}).then(function(e){0<e.info.record_count&&(o.setAttribute("suggesting",!0),Array.from(e.records,function(e){return a(u.value,e),!0}))}).catch(function(e){return console.error(e.name,e.message)})))},!1)}).catch(function(e){return console.error(e.name,e.message)}),document.addEventListener("keydown",function(e){13===e.keyCode&&document.activeElement.closest(".b-search-form__filter-toggle")&&document.activeElement.click()}),document.addEventListener("click",function(e){var t,i;e.target.closest(".b-search-form__filter-toggle")&&((e=e.target.closest(".b-search-form__filter-toggle-set")).toggleAttribute("active"),i=(t=Array.from(document.querySelectorAll(".b-search-form__filter-toggle"))).indexOf(document.querySelector('[tabindex="0"]')),t[i].setAttribute("tabindex",-1),t[i].setAttribute("aria-hidden",!0),t[[1,0][i]].setAttribute("tabindex",0),t[[1,0][i]].removeAttribute("aria-hidden"),Array.from(e.querySelectorAll("input"),function(e){return!(e.value="")}))},!1)),!0})},{}],23:[function(e,t,i){"use strict";var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],o=!0,t=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!i||n.length!==i);o=!0);}catch(e){t=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};function a(e,t){e.dataset.pageIndex=t,e.value=t,e.innerHTML=""+(t+1<11?0:"")+t,e.ariaLabel="Go to page "+t}function l(){var e,t=f(c.dataset),i=t.pageIndex,n=t.pageSize;(t=t.totalCount)<n?document.querySelector(".b-search-pagination__display-counter").innerHTML="":(e=n*(i=i-1)+1,i=n*i+n,document.querySelector(".b-search-pagination__display-counter").innerHTML=""+e+" - "+(t<i?t:i)+" of "+t+"")}var c=document.querySelector(".b-search-pagination"),u=Array.from(document.querySelectorAll(".b-search-pagination__page-button")),h=Array.from(document.querySelectorAll(".b-search-pagination__page-button-seperator")),d=document.querySelector(".b-search-pagination__prev-link"),p=document.querySelector(".b-search-pagination__next-link"),m=document.querySelector(".b-search-pagination__page-button-seperator-start"),g=document.querySelector(".b-search-pagination__page-button-seperator-last"),o=document.querySelector('input[name="page"]'),r=document.querySelector('input[name="page_size"]'),v="b-search-pagination__page-button--current",f=function(e){return Object.entries(e).reduce(function(e,t){var t=n(t,2),i=t[0],t=t[1];return Object.assign(e,(e=+t,(t=i)in(i={})?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i))},{})};c&&(c.addEventListener("click",function(e){var t,e=e.target;return(e.closest(".b-search-pagination__page-button")||e.closest(".b-search-pagination__prev-link")||e.closest(".b-search-pagination__next-link"))&&!e.getAttribute("disabled")&&(t=e.dataset.pageIndex,c.dataset.pageIndex=t,o.value=t,window.setTimeout(function(){return o.dispatchEvent(new Event("change"))},100)),e.closest(".b-search-pagination__page-size")&&(t=e.dataset.pageSize,document.querySelector(".b-search-pagination__page-size--active").classList.toggle("b-search-pagination__page-size--active"),e.classList.add("b-search-pagination__page-size--active"),c.dataset.pageSize=t,r.value=t,window.setTimeout(function(){return r.dispatchEvent(new Event("change"))},100),l()),!1}),new MutationObserver(function(e){var i,n,o,r,t,s;e.filter(function(e){return"data-page-size"===e.attributeName}).length&&document.querySelector('button[data-page-size="'+c.dataset.pageSize+'"]')&&(document.querySelector(".b-search-pagination__page-size--active").classList.remove("b-search-pagination__page-size--active"),document.querySelector('button[data-page-size="'+c.dataset.pageSize+'"]').classList.add("b-search-pagination__page-size--active"),l()),e.filter(function(e){return"data-pages"===e.attributeName}).length&&(i=f(c.dataset).pages,u.forEach(function(e,t){i-1<t?e.setAttribute("disabled",!0):e.removeAttribute("disabled"),a(e,t+1)}),h.forEach(function(e){e.setAttribute("disabled",!0)}),t=u.slice(u.filter(function(e){return!e.getAttribute("disabled")}).length-1)[0],a(t,i),c.dataset.pageIndex=c.dataset.pageIndex),e.filter(function(e){return"data-page-index"===e.attributeName}).length&&(t=f(c.dataset),n=t.pageIndex,o=t.pages,t=document.querySelector("."+v),r=2<n&&n<o-1&&5<o,n<3&&(m.setAttribute("disabled","true"),u.slice(1)[0].removeAttribute("disabled","true"),o<6?g.setAttribute("disabled","true"):(u.slice(3)[0].setAttribute("disabled","true"),g.removeAttribute("disabled"))),o-3<n&&5<o&&(m.removeAttribute("disabled"),g.setAttribute("disabled","true"),u.slice(3)[0].setAttribute("disabled","true"),u.slice(1)[0].removeAttribute("disabled")),r&&(u.slice(3)[0].removeAttribute("disabled"),u.slice(1)[0].removeAttribute("disabled"),m.removeAttribute("disabled"),g.removeAttribute("disabled")),5<o&&u.slice(1,4).filter(function(e){return!e.getAttribute("disabled")}).forEach(function(e,t){a(e,t+(n<3?2:0)+(r?n-1:0)+(o-1<=n?o-2:0))}),t.classList.remove(v),u.filter(function(e){return+e.dataset.pageIndex===n})[0].classList.add(v),l(),t=f(c.dataset),s=t.pageIndex,t=t.pages,d.dataset.pageIndex=s-1,p.dataset.pageIndex=s+1,+d.dataset.pageIndex<1?d.setAttribute("disabled",!0):d.removeAttribute("disabled"),+p.dataset.pageIndex>t?p.setAttribute("disabled",!0):p.removeAttribute("disabled")),e.filter(function(e){return"data-total-count"===e.attributeName}).length&&l()}).observe(c,{attributes:!0}),c.dataset.pages=c.dataset.pages,c.dataset.totalCount=c.dataset.totalCount,c.dataset.pageIndex=c.dataset.pageIndex)},{}],24:[function(e,t,i){"use strict";function n(){Array.from(document.querySelectorAll(".js-search-result-text"),function(e){var t,i,n,o,r,s;return(e=e).dataset.fulltext||(e.dataset.fulltext=e.innerHTML),s=e.dataset.fulltext,e.innerHTML=s,10<e.scrollHeight-e.clientHeight&&(i=s.indexOf("</em>")-(t=e.clientHeight/e.scrollHeight*s.length),n=0,o=s.lastIndexOf(" ",t),r="",0<i&&(r="&hellip;",n=s.indexOf(" ",20+i)+1,o=s.lastIndexOf(" ",t+i+20)),e.innerHTML=""+r+s.substring(n,o)+"&hellip;"),!0})}n(),window.addEventListener("resize",n,!1)},{}],25:[function(e,t,i){"use strict";function o(){Array.from(document.querySelectorAll(".b-search-results__offensive-warning")).forEach(function(e){var t=Array.from(document.querySelectorAll(".b-search-results__body-row"))[e.getAttribute("data-row-index")],i=(t.offsetHeight-e.offsetHeight)/2;e.style.top=t.offsetTop+i+"px",e.style.left="5px"})}function n(){Array.from(document.querySelectorAll(".b-search-results__body-row")).forEach(function(e,t){var i,n;e.classList.contains("b-search-results__body-row--offensive")&&((i=document.createElement("DIV")).className="b-search-results__offensive-warning",i.innerHTML='<div class="b-search-results__offensive-warning-text">This object, or the text that describes it, is deemed offensive and discriminatory. We are committed to improving our records, and work is ongoing.</br><button class="b-search-results__offensive-warning-button">View record</button></div>',n=(e.offsetHeight-i.offsetHeight)/2,i.style.top=e.offsetTop+n+"px",i.setAttribute("data-row-index",t),i.onclick=function(e){return Array.from(document.querySelectorAll(".b-search-results__body-row"))[e.target.parentElement.getAttribute("data-row-index")].classList.remove("b-search-results__body-row--offensive"),e.target.parentElement.remove(),o(),e.stopPropagation(),!1},e.parentElement.appendChild(i),o())}),o()}window.addEventListener("resize",function(){o()}),n(),document.querySelector(".etc-template__results-container")&&(document.querySelector(".etc-template__results-container").addEventListener("initWarnings",function(){n()}),document.querySelector(".etc-template__results-container").addEventListener("initSorts",function(){Array.from(document.querySelectorAll(".b-search-results__head-cell")).forEach(function(e){parseInt(e.dataset.sortable,10)&&(e.onclick=function(e){return e=e.target,t=e.dataset.value,i=document.querySelector(".b-search-results__hidden-input-order-by"),n=document.querySelector(".b-search-results__hidden-input-order-sort"),o="b-search-results__head-cell--sort-asc",r={"b-search-results__head-cell--sort-asc":"b-search-results__head-cell--sort-desc","b-search-results__head-cell--sort-desc":"b-search-results__head-cell--sort-none"}[Array.from(e.classList)[2]],Array.from(document.querySelectorAll(".b-search-results__head-cell")).forEach(function(e){e.classList.remove("b-search-results__head-cell--sort-desc"),e.classList.remove("b-search-results__head-cell--sort-asc"),e.classList.remove("b-search-results__head-cell--sort-none")}),r?"b-search-results__head-cell--sort-desc"===r?n.value="desc":"b-search-results__head-cell--sort-none"===r&&(i.value="",n.value="asc"):(e.classList.add(o),i.value=t),e.classList.add(r||o),void e.dispatchEvent(new Event("change",{bubbles:!0}));var t,i,n,o,r})})}),document.querySelector(".etc-template__results-container").dispatchEvent(new Event("initSorts")))},{}],26:[function(e,t,i){"use strict";var e=e("browser-cookies"),e=(e=e)&&e.__esModule?e:{default:e};var n,o,r,s,a,l,c,u,h,d,p,m,g,v,f,y,b,w,_,x,S,T,E=document.querySelector(".b-site-nav");E&&(n=E.querySelectorAll(".js-site-nav__mobile-toggle"),o=E.querySelector(".js-site-nav__mobile-toggle--icon"),r=E.querySelector(".js-site-nav__mobile-toggle-text"),s=E.querySelectorAll(".js-site-nav-bag"),a=E.querySelector(".js-site-nav-search-btn"),l=E.querySelector(".js-site-nav-search"),c=l.querySelector(".b-search-form__input"),u=l.querySelector(".js-search-content"),h=l.querySelector(".js-search-suggest"),d=e.default.get("basketCount"),e=E.querySelector(".js-site-nav__tablet-toggle"),d&&0<d&&(Array.from(s,function(e){return e.classList.remove("b-site-nav__bag--hidden"),e.querySelector(".js-site-nav-bag-total").innerHTML=d<100?d:"",!0}),r.classList.add("b-site-nav__mobile-toggle-text--hidden")),o&&"none"!==window.getComputedStyle(o).display&&(x=function(e){60<e?o.classList.add("b-site-nav__mobile-toggle--solo"):o.classList.remove("b-site-nav__mobile-toggle--solo")},T=!1,window.addEventListener("scroll",function(e){return e.preventDefault(),S=window.pageYOffset,T||window.requestAnimationFrame(function(){x.call(void 0,S),T=!1}),T=!0},!1)),e&&e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(".js-site-nav-more").classList.toggle("active")},!1),p=function(e){e?(l.classList.add("b-site-nav__core__search--active"),document.body.style.overflow="hidden",c.setSelectionRange(100,100)):(l.classList.remove("b-site-nav__core__search--active"),document.body.style.overflow="")},Array.from(n,function(e){function t(e){"Tab"!==e.key&&9!==e.keyCode||(document.activeElement===i&&e.shiftKey?(e.preventDefault(),n.focus()):document.activeElement!==n||e.shiftKey||(e.preventDefault(),i.focus()))}var i=o,n=E.querySelector(".b-site-nav__core__item:nth-last-child(2)>a");return e.addEventListener("click",function(e){e.preventDefault(),E.classList.contains("b-site-nav--open")?(E.classList.remove("b-site-nav--open"),E.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",t,!1),p(!1)):(E.classList.add("b-site-nav--open"),E.setAttribute("aria-expanded","true"),document.addEventListener("keydown",t,!1),p(!0))},!1),!0}),a&&(m=c,(g=a).addEventListener("click",function(e){e.preventDefault(),a.classList.contains("b-site-nav__core__search-btn--active")?(a.classList.remove("b-site-nav__core__search-btn--active"),document.removeEventListener("keydown",v,!1),p(!1)):(a.classList.add("b-site-nav__core__search-btn--active"),document.addEventListener("keydown",v,!1),p(!0))},!(v=function(e){"Tab"!==e.key&&9!==e.keyCode||(document.activeElement===m&&e.shiftKey?(e.preventDefault(),g.focus()):document.activeElement!==g||e.shiftKey||(e.preventDefault(),m.focus()))}))),f=0===document.location.host.indexOf("localhost")?"https://www.vam.ac.uk/":"/",(!(y=JSON.parse(sessionStorage.getItem("storedSearch")))||Date.parse(new Date)>Date.parse(y.expires))&&((b=new XMLHttpRequest).open("GET",f+"services/search/suggest/promoted"),b.send(),b.onreadystatechange=function(){var e;b.readyState===XMLHttpRequest.DONE&&200===b.status&&(e=new Date,e={expires:new Date(e.setMinutes(e.getMinutes()+15)),results:b.responseText},sessionStorage.setItem("storedSearch",JSON.stringify(e)),y=JSON.parse(sessionStorage.getItem("storedSearch")))}),w=function(){window.dataLayer.push({event:"autosuggest search",eventCategory:(void 0).tracking.eventCategory,eventAction:(void 0).tracking.eventAction,eventLabel:(void 0).tracking.eventLabel})},_=function(i,e,n,o){var r=null,s=null,a=null;JSON.parse(e).forEach(function(e){for(r=0;r<e.suggestions.length;r+=1){var t;s=e.suggestions[r].title,e.suggestions[r].terms&&(s=e.suggestions[r].terms.join("|")),i.test(s)&&(u.classList.remove("b-site-nav__core__search__container--hidden"),a=e.suggestions[r].icon||"https://s3-eu-west-1.amazonaws.com/vanda-production-assets/static/search/result_placeholder.jpg",t=document.createElement("li"),o&&t.classList.add("js-live-result"),t.innerHTML='<div class="b-search-result-auto-suggest"><a class="b-search-result-auto-suggest-content"href="'+e.suggestions[r].url+'"><img class="b-search-result-auto-suggest-image"src="'+a+'"alt=""aria-hidden="true"><div class="b-search-result-auto-suggest-text"><div class="b-search-result-auto-suggest-content-type">'+e.suggestions[r].type+'</div><div class="b-search-result-auto-suggest-title">'+e.suggestions[r].title+"</div></div></a></div>",t.tracking={eventCategory:"search - autosuggest - "+e.suggestions[r].type,eventAction:n,eventLabel:e.suggestions[r].url},t.addEventListener("click",w),h.appendChild(t))}})},c&&c.addEventListener("input",function(){var e,t,i,n;c.value.length<42&&(u.classList.add("b-site-nav__core__search__container--hidden"),h.innerHTML="",c.value.length&&(e="(^|\\|)",2<c.value.length&&(e="\\b"),t=c.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i=new RegExp(""+e+t+".*","i"),_(i,y.results,c.value,!1),4<c.value.length&&((n=new XMLHttpRequest).open("GET",f+"services/search/suggest/popular?q="+encodeURI(c.value)),n.send(),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status&&(Array.from(h.querySelectorAll(".js-live-result"),function(e){return e.remove(),!0}),_(i,n.responseText,c.value,!0))})))},!1))},{"browser-cookies":1}],27:[function(e,t,i){"use strict";var e=e("querystring"),e=(e=e)&&e.__esModule?e:{default:e};var o,r,s=document.querySelector(".js-toggle-nav");s&&(o=s.querySelectorAll(".js-toggle-nav-btn"),r=e.default.parse(window.location.search.replace("?","")).type,Array.from(o,function(i){var n=document.querySelectorAll(i.dataset.toggeesSelector);return i.addEventListener("click",function(e){e.preventDefault();var t=i.dataset.toggleType;s.scrollLeft=i.offsetLeft-(s.getBoundingClientRect().width-i.getBoundingClientRect().width)/2,i.preventHistoryPush||window.history.pushState({toggleNavType:t},"","?type="+t),i.preventHistoryPush=!1,Array.from(n,function(e){return e.style.display="none",e.dataset.toggleType===t&&(e.style.display="block"),!0}),Array.from(o,function(e){return e.classList.remove("b-toggle-nav__button--active"),!0}),i.classList.add("b-toggle-nav__button--active")},!1),i.dataset.toggleType===r&&(i.preventHistoryPush=!0,setTimeout(function(){i.click()},50)),!0}),window.addEventListener("popstate",function(t){return t.state&&t.state.toggleNavType&&Array.from(o,function(e){return t.state.toggleNavType===e.dataset.toggleType&&(e.preventHistoryPush=!0,e.click()),!0}),!0},!1),r||void 0===s.dataset.toggleTypeDefault||document.querySelector("[data-toggle-type="+s.dataset.toggleTypeDefault+"]").click())},{querystring:6}],28:[function(e,t,i){"use strict";var n=document.querySelectorAll(".js-video-thumbnail");Array.from(n,function(i){return i.addEventListener("click",function(e){e.preventDefault();var t=document.createElement("div"),e=document.createElement("div");t.className="b-video-thumbnail__popup",t.innerHTML='<iframe class="b-video-thumbnail__popup-iframe" width="90%" height="90%" src="'+i.href+'"&playsinline=1" frameborder="0" allowfullscreen></iframe>',t.addEventListener("click",function(){t.remove()}),e.className="b-video-thumbnail__popup-close",e.innerHTML='<svg role="img" id="close" viewBox="0 0 100 100"><path d="M50 39.254L10.749 0 0 10.742l39.251 39.254L0 89.251 10.749 100 50 60.746 89.251 100 100 89.243 60.749 49.99 100 10.734 89.244 0 49.992 39.254z" fill="currentColor" fill-rule="evenodd"/></svg>',t.appendChild(e),document.body.appendChild(t)}),!0})},{}],29:[function(e,t,i){"use strict";var n,o,r=document.querySelector(".js-video-trailer");r&&(n=r.querySelector(".js-video-trailer-preview"),o=document.createElement("div"),r.addEventListener("click",function(e){e.preventDefault(),o.className="b-video-trailer__image",o.innerHTML='<iframe class="" width="100%" height="100%" src="'+r.href+'"&playsinline=1" frameborder="0" allowfullscreen></iframe>',n.remove(),r.appendChild(o),o.style.height=.5625*o.offsetWidth+"px"}),window.addEventListener("resize",function(){o.style.height=.5625*o.offsetWidth+"px"}))},{}],30:[function(e,t,i){"use strict";var n=document.querySelectorAll(".js-grid-reveal-more");n.length&&(Array.from(n,function(i){var e,n,t,o,r,s,a=i.dataset.revealMoreCounter||4;return a<i.childElementCount&&(e=i.dataset.iconUrl,n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(i.children)),t=i.dataset.revealMoreTheme||"dark",o=i.dataset.revealMoreTracking||"",(r=i).dataset.revealMorePutAfter&&(r=document.querySelector(i.dataset.revealMorePutAfter)),n.slice(a).forEach(function(e){return e.classList.add("s-visually-hidden")}),(s=document.createElement("footer")).setAttribute("class","b-block-grid__footer b-block-grid__footer--"+t),s.innerHTML='<a href="#" aria-label="show more" data-tracking-showmorebutton="'+o+'" class="js-reveal-more-btn"><div class="b-icon-badge b-icon-badge--small b-icon-badge--'+t+'"><div class="b-icon-badge__icon s-themed s-themed--background-color s-themed--background-color--hover"><svg aria-hidden="true"><use xlink:href="'+e+'#plus"></use></svg></div><small class="b-icon-badge__label">Show more</small></div></a>',r.parentNode.insertBefore(s,r.nextSibling),i.revealMoreClicks=0,s.addEventListener("click",function(e){e.preventDefault(),i.revealMoreClicks+=1;var t,e=n.filter(function(e){return e.classList.contains("s-visually-hidden")});e.length&&(1<window.getComputedStyle(i).getPropertyValue("column-count")&&((t=e[0].parentNode.insertBefore(e[0].cloneNode(!1),e[0])).classList.remove("s-visually-hidden"),t.classList.add("b-block-grid__cols-restarter")),e.slice(0,a).forEach(function(e){return e.classList.remove("s-visually-hidden")}),e.length<=a&&s.remove())},!1)),!0}),window.addEventListener("beforeunload",function(){var t=[];Array.from(n,function(e){return t.push(e.revealMoreClicks),!0}),history.replaceState({revealMoreClicks:t},"revealMoreClicks")},!1),window.addEventListener("load",function(){if(history.state&&history.state.revealMoreClicks)for(var e=document.querySelectorAll(".js-reveal-more-btn"),t=0;t<history.state.revealMoreClicks.length;t+=1)for(var i=0;i<history.state.revealMoreClicks[t];)e[t].click(),i+=1},!1))},{}],31:[function(e,t,i){"use strict";document.querySelector(".b-facet-box-modal__button")&&(document.querySelector(".b-facet-box-modal__button").onclick=function(e){document.querySelector(".b-facet-box-modal__container").classList.toggle("b-facet-box-modal__container--active"),e.preventDefault()}),document.querySelector(".b-facet-box-modal__button")&&document.addEventListener("closeFacetOverlay",function(){return document.querySelector(".b-facet-box-modal__container").classList.toggle("b-facet-box-modal__container--active")})},{}],32:[function(e,t,i){"use strict";function n(){s.classList.add("b-image-overlay__container--active"),a.style.overflowY="hidden",s.style.height=window.innerHeight+"px",window.innerWidth<=1e3&&o.any()?(a.style.position="fixed",l.style.marginBottom=screen.height-window.innerHeight+"px"):l.style.marginBottom="0px",document.querySelector(".b-image-carousel__image-preview-container").focus()}function r(){document.querySelector(".b-image-overlay__container").classList.remove("b-image-overlay__container--active"),document.querySelector("body").style.overflowY="auto",document.querySelector("body").style.position="relative"}var o={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return o.Android()||o.BlackBerry()||o.iOS()||o.Opera()||o.Windows()}},s=document.querySelector(".b-image-overlay__container"),a=document.querySelector("body"),l=document.querySelector(".b-image-overlay__figcaption");document.querySelector(".b-image-overlay__preview-concealer")&&(document.querySelector(".b-image-overlay__preview-concealer").onclick=function(e){e.stopPropagation()},document.querySelector(".b-image-overlay__preview-concealer-button").onclick=function(e){e.stopPropagation(),document.querySelector(".b-image-overlay__preview--offensive").classList.remove("b-image-overlay__preview--offensive"),document.querySelector(".b-image-overlay__preview-image--offensive").classList.remove("b-image-overlay__preview-image--offensive"),document.querySelector(".b-image-overlay__preview-concealer").remove(),document.querySelectorAll(".b-image-overlay__preview--hidden").forEach(function(e){return e.classList.remove("b-image-overlay__preview--hidden")})}),document.querySelector(".b-image-overlay")&&(document.querySelector(".b-image-overlay__close-container").onclick=r,window.addEventListener("resize",function(){s.style.height=window.innerHeight+"px",window.innerWidth<=1e3&&o.any()?l.style.marginBottom=screen.height-window.innerHeight+"px":l.style.marginBottom="0px"}),window.addEventListener("keydown",function(e){var t,i,n,o;27===e.keyCode&&(document.querySelector(".b-image-overlay").classList.contains("b-image-overlay--unfocus")?document.querySelector(".b-image-overlay").classList.remove("b-image-overlay--unfocus"):r()),document.querySelector(".b-image-overlay").classList.contains("b-image-overlay--unfocus")||9!==e.keyCode||(i=(t=Array.from(document.querySelector(".b-image-overlay__content").querySelectorAll("button")).filter(function(e){return!e.getAttribute("disabled")}).filter(function(e){return!e.closest(".js-modal")}).filter(function(e){return 0<e.offsetHeight}))[0],n=t[t.length-1],o=e.shiftKey,t.length&&(o&&document.activeElement===i?(n.focus(),e.preventDefault()):o||document.activeElement!==n||(i.focus(),e.preventDefault())))}),document.querySelector(".b-image-overlay").addEventListener("openObjectOverlay",n),document.querySelector(".b-image-overlay__container").addEventListener("jsModalOpen",function(){document.querySelector(".b-image-overlay__close-container").style.display="none"}),document.querySelector(".b-image-overlay__container").addEventListener("jsModalClosed",function(){document.querySelector(".b-image-overlay__close-container").style.display="block"}),Array.from(document.querySelectorAll(".b-image-overlay__preview")).forEach(function(e){e.onclick=function(e){e.preventDefault(),e.target.classList.contains("b-image-overlay__preview--offensive")||e.target.dispatchEvent(new CustomEvent("openObjectOverlay",{bubbles:!0}))}}),document.addEventListener("click",function(e){e.target.closest(".b-image-overlay__figcaption__handle")&&l.classList.toggle("b-image-overlay__figcaption--shut")},!1))},{}],33:[function(e,t,i){"use strict";var e=e("clamp-js"),n=(e=e)&&e.__esModule?e:{default:e};function o(){var e=Array.from(document.querySelectorAll(".b-story-box__content-text"));499<window.innerWidth?e.forEach(function(e){(0,n.default)(e,{clamp:"auto",splitOnChars:[".",","," "]})}):e.forEach(function(e){e.style.display="none"})}var r,s;document.querySelector(".b-story-box")&&(r=Array.from(document.querySelectorAll(".b-story-box")),s=Array.from(document.querySelectorAll(".b-story-box--column")),2<r.length&&document.querySelector(".b-story-box-container__reveal-container").classList.add("b-story-box-container__reveal-container--active"),r.slice(0,2).forEach(function(e){e.classList.add("b-story-box--active")}),(e=document.querySelector(".b-story-box-container__reveal-btn"))&&(e.onclick=function(){var t,e=Array.from(document.querySelectorAll(".b-story-box--active")).length;return Array.from(document.querySelectorAll(".b-story-box")).slice(e,e+2).forEach(function(e){e.classList.add("b-story-box--active")}),Array.from(document.querySelectorAll(".b-story-box--active")).length===r.length?document.querySelector(".b-story-box-container__reveal-container").classList.remove("b-story-box-container__reveal-container--active"):(e=s.slice(e-1,e+2).map(function(e){return e.querySelector(".b-story-box__content-text")}),t=e[e[0].offsetHeight>e[1].offsetHeight?0:1].offsetHeight,e.forEach(function(e){e.style.height=t+"px"})),o(),!1}),o(),window.addEventListener("resize",function(){o()}))},{"clamp-js":2}]},{},[9]);
//# sourceMappingURL=vamscript.js.map
