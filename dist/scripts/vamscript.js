!function r(s,a,l){function c(t,e){if(!a[t]){if(!s[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[t]={exports:{}};s[t][0].call(o.exports,function(e){return c(s[t][1][e]||e)},o,o.exports,r,s,a,l)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,d){d.defaults={},d.set=function(e,t,i){var n=i||{},o=d.defaults,r=n.expires||o.expires,s=n.domain||o.domain,a=void 0!==n.path?n.path:void 0!==o.path?o.path:"/",l=void 0!==n.secure?n.secure:o.secure,c=void 0!==n.httponly?n.httponly:o.httponly,u=void 0!==n.samesite?n.samesite:o.samesite,h=r?new Date("number"==typeof r?(new Date).getTime()+864e5*r:r):0;document.cookie=e.replace(/[^+#$&^`|]/g,encodeURIComponent).replace("(","%28").replace(")","%29")+"="+t.replace(/[^+#$&/:<-\[\]-}]/g,encodeURIComponent)+(h&&0<=h.getTime()?";expires="+h.toUTCString():"")+(s?";domain="+s:"")+(a?";path="+a:"")+(l?";secure":"")+(c?";httponly":"")+(u?";samesite="+u:"")},d.get=function(e){for(var t=document.cookie.split(";");t.length;){var i=t.pop(),n=(n=i.indexOf("="))<0?i.length:n;if(decodeURIComponent(i.slice(0,n).replace(/^\s+/,""))===e)return decodeURIComponent(i.slice(n+1))}return null},d.erase=function(e,t){d.set(e,"",{expires:-1,domain:t&&t.domain,path:t&&t.path,secure:0,httponly:0})},d.all=function(){for(var e={},t=document.cookie.split(";");t.length;){var i=t.pop(),n=(n=i.indexOf("="))<0?i.length:n;e[decodeURIComponent(i.slice(0,n).replace(/^\s+/,""))]=decodeURIComponent(i.slice(n+1))}return e}},{}],2:[function(e,t,i){var n,o;n=this,o=function(){return function(o,e){e=e||{};var r,i=window,s={clamp:e.clamp||2,useNativeClamp:void 0===e.useNativeClamp||e.useNativeClamp,splitOnChars:e.splitOnChars||[".","-","–","—"," "],animate:e.animate||!1,truncationChar:e.truncationChar||"…",truncationHTML:e.truncationHTML},t=o.style,n=o.innerHTML,a=void 0!==o.style.webkitLineClamp,l=s.clamp,c=l.indexOf&&(-1<l.indexOf("px")||-1<l.indexOf("em"));function u(e,t){return i.getComputedStyle||(i.getComputedStyle=function(i,e){return this.el=i,this.getPropertyValue=function(e){var t=/(\-([a-z]){1})/g;return"float"==e&&(e="styleFloat"),t.test(e)&&(e=e.replace(t,function(){return arguments[2].toUpperCase()})),i.currentStyle&&i.currentStyle[e]?i.currentStyle[e]:null},this}),i.getComputedStyle(e,null).getPropertyValue(t)}function h(e){var t=e||o.clientHeight,i=d(o);return Math.max(Math.floor(t/i),0)}function d(e){var t=u(e,"line-height");return"normal"==t&&(t=1.2*parseInt(u(e,"font-size"))),parseInt(t)}s.truncationHTML&&((r=document.createElement("span")).innerHTML=s.truncationHTML);var p,m,g,v,f,y=s.splitOnChars.slice(0),w=y[0];function b(e){return e.lastChild.children&&0<e.lastChild.children.length?b(Array.prototype.slice.call(e.children).pop()):e.lastChild&&e.lastChild.nodeValue&&""!==e.lastChild.nodeValue&&e.lastChild.nodeValue!=s.truncationChar?e.lastChild:(e.lastChild.parentNode.removeChild(e.lastChild),b(o))}function _(e,t){e.nodeValue=t+s.truncationChar}return"auto"==l?l=h():c&&(l=h(parseInt(l))),a&&s.useNativeClamp?(t.overflow="hidden",t.textOverflow="ellipsis",t.webkitBoxOrient="vertical",t.display="-webkit-box",t.webkitLineClamp=l,c&&(t.height=s.clamp+"px")):(v=(f=l,d(o)*f))<=o.clientHeight&&(g=function e(t,i){if(i){var n=t.nodeValue.replace(s.truncationChar,"");if(p||(w=0<y.length?y.shift():"",p=n.split(w)),1<p.length?(m=p.pop(),_(t,p.join(w))):p=null,r&&(t.nodeValue=t.nodeValue.replace(s.truncationChar,""),o.innerHTML=t.nodeValue+" "+r.innerHTML+s.truncationChar),p){if(o.clientHeight<=i){if(!(0<=y.length&&""!==w))return o.innerHTML;_(t,p.join(w)+w+m),p=null}}else""===w&&(_(t,""),t=b(o),y=s.splitOnChars.slice(0),w=y[0],m=p=null);if(!s.animate)return e(t,i);setTimeout(function(){e(t,i)},!0===s.animate?10:s.animate)}}(b(o),v)),{original:n,clamped:g}}},"function"==typeof define&&define.amd?define([],o):"object"==typeof i?t.exports=o():n.$clamp=o()},{}],3:[function(e,t,i){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})},{}],4:[function(require,module,exports){function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}var Ve,We,Xe,Ye,cf,on,vn,On,Pn,Qn,_s,ru,su,Gu,Zu,Lw,Wx,oz,Cz,Uz,nA,ZA,zB,EB,eC,nC,YD,ZD,dF,kF,yF,ZF,zG,yH,kJ,PM,vS,aT;function wn(e,t){for(var i=e.controls,n=i.length-1;0<=n;n--)if(i[n].element==t)return n;return-1}function Rn(e){return e=On.getElement(e),new On.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function Tn(e,t){if(t instanceof On.Overlay)return t;var i,n=null;t.element?n=On.getElement(t.element):(i=t.id?t.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random()),(n=On.getElement(t.id))||((n=document.createElement("a")).href="#/overlay/"+i),n.id=i,On.addClass(n,t.className?t.className:"openseadragon-overlay"));var o,r,s,a=t.location,l=t.width,c=t.height;a||(r=t.x,s=t.y,void 0!==t.px&&(r=(o=e.viewport.imageToViewportRectangle(new On.Rect(t.px,t.py,l||0,c||0))).x,s=o.y,l=void 0!==l?o.width:void 0,c=void 0!==c?o.height:void 0),a=new On.Point(r,s));var u=t.placement;return u&&"string"===On.type(u)&&(u=On.Placement[t.placement.toUpperCase()]),new On.Overlay({element:n,location:a,placement:u,onDraw:t.onDraw,checkResize:t.checkResize,width:l,height:c,rotationMode:t.rotationMode})}function Un(e,t){for(var i=e.length-1;0<=i;i--)if(e[i].element===t)return i;return-1}function Vn(e,t){return On.requestAnimationFrame(function(){t(e)})}function Wn(e){On.requestAnimationFrame(function(){!function(e){var t,i,n,o;if(e.controlsShouldFade){for(t=On.now(),i=t-e.controlsFadeBeginTime,n=1-i/e.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),o=e.controls.length-1;0<=o;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(n);0<n&&Wn(e)}}(e)})}function Xn(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=On.now()+e.controlsFadeDelay,window.setTimeout(function(){Wn(e)},e.controlsFadeDelay))}function Zn(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;0<=t;t--)e.controls[t].setOpacity(1)}function $n(){Zn(this)}function _n(){Xn(this)}function ao(e){var t={originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction,preventVerticalPan:e.preventVerticalPan,preventHorizontalPan:e.preventHorizontalPan};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function bo(e){var t={originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction,preventVerticalPan:e.preventVerticalPan,preventHorizontalPan:e.preventHorizontalPan};if(this.raiseEvent("canvas-key",t),t.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return t.preventVerticalPan||(e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return t.preventVerticalPan||(e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return t.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new On.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(On.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(On.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(On.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(On.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function co(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function eo(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function fo(e){var t,i,n,o,r={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-drag",r),!r.preventDefaultAction&&this.viewport&&(o=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan&&(t=this.viewport.deltaPointsFromPixels(e.delta.negate()),this.viewport.centerSpringX.target.value+=t.x,this.viewport.centerSpringY.target.value+=t.y,i=this.viewport.getBounds(),n=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=t.x,this.viewport.centerSpringY.target.value-=t.y,i.x!=n.x&&(e.delta.x=0),i.y!=n.y&&(e.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),o.flickEnabled&&!this.constrainDuringPan))}function go(e){var t,i,n,o,r;!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).flickEnabled&&e.speed>=t.flickMinSpeed&&(i=0,this.panHorizontal&&(i=t.flickMomentum*e.speed*Math.cos(e.direction)),n=0,this.panVertical&&(n=t.flickMomentum*e.speed*Math.sin(e.direction)),o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),r=this.viewport.pointFromPixel(new On.Point(o.x-i,o.y-n)),this.viewport.panTo(r,!1)),this.viewport.applyConstraints()),this.raiseEvent("canvas-drag-end",{tracker:e.eventSource,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function ho(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function io(e){window.location!=window.parent.location&&On.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function jo(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function ko(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function lo(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function mo(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function no(e){var t,i,n,o,r;return!e.preventDefaultAction&&this.viewport&&((r=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(t=this.viewport.pointFromPixel(e.center,!0),i=this.viewport.pointFromPixel(e.lastCenter,!0).minus(t),this.panHorizontal||(i.x=0),this.panVertical||(i.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,t,!0),r.zoomToRefPoint&&this.viewport.panBy(i,!0),this.viewport.applyConstraints()),r.pinchRotate&&(n=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),o=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(n-o)*(180/Math.PI)))),this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function oo(e){var t,i,n=On.now();if(n-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=n,this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).scrollToZoom&&(i=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(i,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),t&&t.scrollToZoom)return!1}else if((t=this.gestureSettingsByDeviceType(e.pointerType))&&t.scrollToZoom)return!1}function po(e){Pn[this.hash].mouseInside=!0,Zn(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function qo(e){e.pointers<1&&(Pn[this.hash].mouseInside=!1,Pn[this.hash].animating||Xn(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function ro(e){!function(e){if(e._opening)return;{var t,i,n,o,r,s,a;e.autoResize&&(t=Rn(e.container),i=Pn[e.hash].prevContainerSize,t.equals(i)||(n=e.viewport,e.preserveImageSizeOnResize?(o=i.x/t.x,r=n.getZoom()*o,s=n.getCenter(),n.resize(t,!1),n.zoomTo(r,null,!0),n.panTo(s,!0)):(a=n.getBounds(),n.resize(t,!0),n.fitBoundsWithConstraints(a,!0)),Pn[e.hash].prevContainerSize=t,Pn[e.hash].forceRedraw=!0))}var l=e.viewport.update(),c=e.world.update()||l;l&&e.raiseEvent("viewport-change");e.referenceStrip&&(c=e.referenceStrip.update(e.viewport)||c);!Pn[e.hash].animating&&c&&(e.raiseEvent("animation-start"),Zn(e));(c||Pn[e.hash].forceRedraw||e.world.needsDraw())&&(function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),Pn[e.hash].forceRedraw=!1,c&&e.raiseEvent("animation"));Pn[e.hash].animating&&!c&&(e.raiseEvent("animation-finish"),Pn[e.hash].mouseInside||Xn(e));Pn[e.hash].animating=c}(e),e.isOpen()?e._updateRequestId=Vn(e,ro):e._updateRequestId=!1}function uo(e,t){return e?e+t:t}function vo(){Pn[this.hash].lastZoomTime=On.now(),Pn[this.hash].zoomFactor=this.zoomPerSecond,Pn[this.hash].zooming=!0,yo(this)}function wo(){Pn[this.hash].lastZoomTime=On.now(),Pn[this.hash].zoomFactor=1/this.zoomPerSecond,Pn[this.hash].zooming=!0,yo(this)}function xo(){Pn[this.hash].zooming=!1}function yo(e){On.requestAnimationFrame(On.delegate(e,zo))}function zo(){var e,t,i;Pn[this.hash].zooming&&this.viewport&&(t=(e=On.now())-Pn[this.hash].lastZoomTime,i=Math.pow(Pn[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(i),this.viewport.applyConstraints(),Pn[this.hash].lastZoomTime=e,yo(this))}function Ao(){this.viewport&&(Pn[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function Bo(){this.viewport&&(Pn[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Co(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function Do(){this.viewport&&this.viewport.goHome()}function Eo(){this.isFullPage()&&!On.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Fo(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?On.positiveModulo(e+this.rotationIncrement,360):On.positiveModulo(e-this.rotationIncrement,360),this.viewport.setRotation(e))}function Go(){var e;this.viewport&&(e=this.viewport.getRotation(),e=this.viewport.flipped?On.positiveModulo(e-this.rotationIncrement,360):On.positiveModulo(e+this.rotationIncrement,360),this.viewport.setRotation(e))}function Ho(){this.viewport.toggleFlip()}function Io(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function Jo(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}function at(e){var t,i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-click",i),!i.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),t=this.viewport.pointFromPixel(e.position),this.panVertical?this.panHorizontal||(t.x=this.viewer.viewport.getCenter(!0).x):t.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(t),this.viewer.viewport.applyConstraints())}function bt(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function ct(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function dt(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function et(e,t){ft(e,"rotate("+t+"deg)")}function ft(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}function Nw(e,t){for(var i,n=t.Image,o=n.Url,r=n.Format,s=n.Size,a=n.DisplayRect||[],l=parseInt(s.Width,10),c=parseInt(s.Height,10),u=parseInt(n.TileSize,10),h=parseInt(n.Overlap,10),d=[],p=0;p<a.length;p++)i=a[p].Rect,d.push(new Lw.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return Lw.extend(!0,{width:l,height:c,tileSize:u,tileOverlap:h,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:r,displayRects:d},t)}function Xx(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),n=!1;return 2===e.version&&1<e.profile.length&&e.profile[1].supports&&(n=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(n=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||n}function Yx(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}function qA(e,t){return t.levels}function FB(o){EB.requestAnimationFrame(function(){var e,t,i,n;(e=o).shouldFade&&(t=EB.now(),i=t-e.fadeBeginTime,n=1-i/e.fadeLength,n=Math.min(1,n),n=Math.max(0,n),e.imgGroup&&EB.setElementOpacity(e.imgGroup,n,!0),0<n&&FB(e))})}function JB(e,t){var i;e.element.disabled||(t>=EB.ButtonState.GROUP&&e.currentState==EB.ButtonState.REST&&((i=e).shouldFade=!1,i.imgGroup&&EB.setElementOpacity(i.imgGroup,1,!0),e.currentState=EB.ButtonState.GROUP),t>=EB.ButtonState.HOVER&&e.currentState==EB.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=EB.ButtonState.HOVER),t>=EB.ButtonState.DOWN&&e.currentState==EB.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=EB.ButtonState.DOWN))}function KB(e,t){var i;e.element.disabled||(t<=EB.ButtonState.HOVER&&e.currentState==EB.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=EB.ButtonState.HOVER),t<=EB.ButtonState.GROUP&&e.currentState==EB.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=EB.ButtonState.GROUP),t<=EB.ButtonState.REST&&e.currentState==EB.ButtonState.GROUP&&((i=e).shouldFade=!0,i.fadeBeginTime=EB.now()+i.fadeDelay,window.setTimeout(function(){FB(i)},i.fadeDelay),e.currentState=EB.ButtonState.REST))}function $D(e){var t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=YD.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-e.delta.x?t>-(n-r.x)&&(this.element.style.marginLeft=t+2*e.delta.x+"px",aE(this,r.x,t+2*e.delta.x)):-e.delta.x<0&&t<0&&(this.element.style.marginLeft=t+2*e.delta.x+"px",aE(this,r.x,t+2*e.delta.x)):0<-e.delta.y?i>-(o-r.y)&&(this.element.style.marginTop=i+2*e.delta.y+"px",aE(this,r.y,i+2*e.delta.y)):-e.delta.y<0&&i<0&&(this.element.style.marginTop=i+2*e.delta.y+"px",aE(this,r.y,i+2*e.delta.y))),!1}function _D(e){var t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=YD.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<e.scroll?t>-(n-r.x)&&(this.element.style.marginLeft=t-60*e.scroll+"px",aE(this,r.x,t-60*e.scroll)):e.scroll<0&&t<0&&(this.element.style.marginLeft=t-60*e.scroll+"px",aE(this,r.x,t-60*e.scroll)):e.scroll<0?i>r.y-o&&(this.element.style.marginTop=i+60*e.scroll+"px",aE(this,r.y,i+60*e.scroll)):0<e.scroll&&i<0&&(this.element.style.marginTop=i+60*e.scroll+"px",aE(this,r.y,i+60*e.scroll))),!1}function aE(e,t,i){for(var n,o,r,s,a,l="horizontal"==e.scroll?e.panelWidth:e.panelHeight,c=Math.ceil(t/l)+5,u=Math.ceil((Math.abs(i)+t)/l)+1,h=c=(c=u-c)<0?0:c;h<u&&h<e.panels.length;h++){(a=e.panels[h]).activePanel||(r=(o=e.viewer.tileSources[h]).referenceStripThumbnailUrl?{type:"image",url:o.referenceStripThumbnailUrl}:o,(s=new YD.Viewer({id:a.id,tileSources:[r],element:a,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:e.viewer.loadTilesWithAjax,ajaxHeaders:e.viewer.ajaxHeaders,useCanvas:e.useCanvas})).displayRegion=YD.makeNeutralElement("div"),s.displayRegion.id=a.id+"-displayregion",s.displayRegion.className="displayregion",(n=s.displayRegion.style).position="relative",n.top="0px",n.left="0px",n.fontSize="0px",n.overflow="hidden",n.float="left",n.cssFloat="left",n.styleFloat="left",n.zIndex=999999999,n.cursor="default",n.width=e.panelWidth-4+"px",n.height=e.panelHeight-4+"px",s.displayRegion.innerTracker=new YD.MouseTracker({element:s.displayRegion,startDisabled:!0}),a.getElementsByTagName("div")[0].appendChild(s.displayRegion),e.miniViewers[a.id]=s,a.activePanel=!0)}}function bE(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function cE(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="-"+YD.getElementSize(t).y/2+"px":t.style.marginLeft="-"+YD.getElementSize(t).x/2+"px",!1}function dE(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return _D.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return _D.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return _D.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function eE(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return _D.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return _D.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return _D.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return _D.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return _D.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function zF(e){yF.extend(!0,this,{timeout:yF.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}function VM(e,t,i,n,o){var r=0;function s(){return r++,a}function a(){0===--r&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:o,image:i,getCompletionCallback:s}),s()()}function YM(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(void 0!==i&&void 0!==n)return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n];for(s in o=e[t])if(Object.prototype.hasOwnProperty.call(o,s))for(a in r=o[s])if(Object.prototype.hasOwnProperty.call(r,a)&&!r[a])return!1;return!0}function ZM(e,t,i,n){return void 0===i||void 0===n?YM(e,t+1):YM(e,t+1,2*i,2*n)&&YM(e,t+1,2*i,2*n+1)&&YM(e,t+1,2*i+1,2*n)&&YM(e,t+1,2*i+1,2*n+1)}function $M(e,t,i,n,o){e[t]?(e[t][i]||(e[t][i]={}),e[t][i][n]=o):PM.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",t)}function _M(e,t){e[t]={}}function wS(e){vS.console.assert(e,"[TileCache.cacheTile] options is required"),vS.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),vS.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage}function xS(e){vS.console.assert(e,"[ImageRecord] options is required"),vS.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]}!function(n){n.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var e,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,o=Object.prototype.hasOwnProperty;n.isFunction=function(e){return"function"===n.type(e)},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},n.type=function(e){return null==e?String(e):t[i.call(e)]||"object"},n.isPlainObject=function(e){if(!e||"object"!==OpenSeadragon.type(e)||e.nodeType||n.isWindow(e))return!1;if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(var i in e)t=i;return void 0===t||o.call(e,t)},n.isEmptyObject=function(e){for(var t in e)return!1;return!0},n.freezeObject=function(e){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(e){return e},n.freezeObject(e)},n.supportsCanvas=(e=document.createElement("canvas"),!(!n.isFunction(e.getContext)||!e.getContext("2d"))),n.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},n.pixelDensityRatio=function(){if(n.supportsCanvas){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(t,1)/i}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,i,n,o,r,s=arguments[0]||{},a=arguments.length,l=!1,c=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},c=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===c&&(s=this,--c);c<a;c++)if(null!==(e=arguments[c])||void 0!==e)for(t in e)i=s[t],s!==(n=e[t])&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(o=OpenSeadragon.isArray(n)))?(r=o?(o=!1,i&&OpenSeadragon.isArray(i)?i:[]):i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(l,r,n)):void 0!==n&&(s[t]=n));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,i){return function(){var e=arguments;return void 0===e&&(e=[]),i.apply(t,e)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){for(var t,i=new $.Point,n=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);n;)i.x+=e.offsetLeft,i.y+=e.offsetTop,t&&(i=i.plus($.getPageScroll())),n=getOffsetParent(e=n,t="fixed"==$.getElementStyle(e).position);return i},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,o={top:0,left:0};return n?(t=n.documentElement,void 0!==e.getBoundingClientRect&&(o=e.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(o.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),o.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var a={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==a[e])return a[e];var t=document.createElement("div").style,i=null;if(void 0!==t[e])i=e;else for(var n=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(e),r=0;r<n.length;r++){var s=n[r]+o;if(void 0!==t[s]){i=s;break}}return a[e]=i},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,o,r=i||0;if(!e)throw new TypeError;if(0===(o=e.length)||o<=r)return-1;for(r<0&&(r=o-Math.abs(r)),n=r;n<o;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){for(var i=[],n=(e=$.getElement(e)).className.split(/\s+/),o=0;o<n.length;o++)n[o]&&n[o]!==t&&i.push(n[o]);e.className=i.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i,n){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i,n){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(i,n){for(var o=[],e=2;e<arguments.length;e++)o.push(arguments[e]);return function(){for(var e=o.concat([]),t=0;t<arguments.length;t++)e.push(arguments[t]);return n.apply(i,e)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,i,n){var t,o,r;$.isPlainObject(e)&&(i=e.success,n=e.error,t=e.withCredentials,o=e.headers,r=e.responseType||null,e=e.url);var s=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(i))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},200<=a.status&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?i(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(n)&&n(a)))};try{if(a.open("GET",e,!0),r&&(a.responseType=r),o)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&a.setRequestHeader(l,o[l]);t&&(a.withCredentials=!0),a.send(null)}catch(t){var c=t.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==t.number&&-2147024891==t.number&&(c+="See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",t.name,c),a.onreadystatechange=function(){},window.XDomainRequest){var u=new window.XDomainRequest;if(u){u.onload=function(e){$.isFunction(i)&&i({responseText:u.responseText,status:200,statusText:"OK"})},u.onerror=function(e){$.isFunction(n)&&n({responseText:u.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{u.open("GET",e),u.send()}catch(e){$.isFunction(n)&&n(a,t)}}}else $.isFunction(n)&&n(a,t)}return a},jsonp:function(e){var i,t=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,o=e.callbackName||"openseadragon"+$.now(),r=window[o],s="$1"+o+"$2",a=e.param||"callback",l=e.callback,t=t.replace(/(\=)\?(&|$)|\?\?/i,s);t+=(/\?/.test(t)?"&":"?")+a+"="+o,window[o]=function(e){if(r)window[o]=r;else try{delete window[o]}catch(e){}l&&$.isFunction(l)&&l(e)},i=document.createElement("script"),void 0===e.async&&!1===e.async||(i.async="async"),e.scriptCharset&&(i.charset=e.scriptCharset),i.src=t,i.onload=i.onreadystatechange=function(e,t){!t&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=void 0)},n.insertBefore(i,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={},Ge,Je,Ke,Le,Me,He,Ie;function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=t.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):0<=t.indexOf("Safari")?($.Browser.vendor=0<=t.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}for(var i,n,o=window.location.search.substring(1).split("&"),r=0;r<o.length;r++)if(0<(n=(i=o[r]).indexOf("="))){var s=i.substring(0,n),a=i.substring(n+1);try{URLPARAMS[s]=decodeURIComponent(a)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",s,a)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),Ge=window,He=Ge.requestAnimationFrame||Ge.mozRequestAnimationFrame||Ge.webkitRequestAnimationFrame||Ge.msRequestAnimationFrame,Ie=Ge.cancelAnimationFrame||Ge.mozCancelAnimationFrame||Ge.webkitCancelAnimationFrame||Ge.msCancelAnimationFrame,He&&Ie?($.requestAnimationFrame=function(){return He.apply(Ge,arguments)},$.cancelAnimationFrame=function(){return Ie.apply(Ge,arguments)}):(Je=[],Ke=[],Le=0,$.requestAnimationFrame=function(e){return Je.push([++Le,e]),Me=Me||setInterval(function(){if(Je.length){var e=$.now(),t=Ke;for(Ke=Je,Je=t;Ke.length;)Ke.shift()[1](e)}else clearInterval(Me),Me=void 0},20),Le},$.cancelAnimationFrame=function(e){for(var t=0,i=Je.length;t<i;t+=1)if(Je[t][0]===e)return void Je.splice(t,1);for(t=0,i=Ke.length;t<i;t+=1)if(Ke[t][0]===e)return void Ke.splice(t,1)})}(OpenSeadragon),Ve=this,We=function(){return OpenSeadragon},"function"==typeof define&&define.amd?define([],We):"object"==typeof module&&module.exports?module.exports=We():Ve.OpenSeadragon=We(),Xe=OpenSeadragon,Ye={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(Ye.supportsFullScreen=!0,Ye.getFullScreenElement=function(){return document.fullscreenElement},Ye.requestFullScreen=function(e){return e.requestFullscreen()},Ye.exitFullScreen=function(){document.exitFullscreen()},Ye.fullScreenEventName="fullscreenchange",Ye.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(Ye.supportsFullScreen=!0,Ye.getFullScreenElement=function(){return document.msFullscreenElement},Ye.requestFullScreen=function(e){return e.msRequestFullscreen()},Ye.exitFullScreen=function(){document.msExitFullscreen()},Ye.fullScreenEventName="MSFullscreenChange",Ye.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(Ye.supportsFullScreen=!0,Ye.getFullScreenElement=function(){return document.webkitFullscreenElement},Ye.requestFullScreen=function(e){return e.webkitRequestFullscreen()},Ye.exitFullScreen=function(){document.webkitExitFullscreen()},Ye.fullScreenEventName="webkitfullscreenchange",Ye.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(Ye.supportsFullScreen=!0,Ye.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},Ye.requestFullScreen=function(e){return e.webkitRequestFullScreen()},Ye.exitFullScreen=function(){document.webkitCancelFullScreen()},Ye.fullScreenEventName="webkitfullscreenchange",Ye.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(Ye.supportsFullScreen=!0,Ye.getFullScreenElement=function(){return document.mozFullScreenElement},Ye.requestFullScreen=function(e){return e.mozRequestFullScreen()},Ye.exitFullScreen=function(){document.mozCancelFullScreen()},Ye.fullScreenEventName="mozfullscreenchange",Ye.fullScreenErrorEventName="mozfullscreenerror"),Ye.isFullScreen=function(){return null!==Ye.getFullScreenElement()},Ye.cancelFullScreen=function(){Xe.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),Ye.exitFullScreen()},Xe.extend(Xe,Ye),cf=OpenSeadragon,cf.EventSource=function(){this.events={}},cf.EventSource.prototype={addOnceHandler:function(t,i,e,n){var o=this;n=n||1;var r=0,s=function(e){++r===n&&o.removeHandler(t,s),i(e)};this.addHandler(t,s,e)},addHandler:function(e,t,i){var n=this.events[e];n||(this.events[e]=n=[]),t&&cf.isFunction(t)&&(n[n.length]={handler:t,userData:i||null})},removeHandler:function(e,t){var i,n=this.events[e],o=[];if(n&&cf.isArray(n)){for(i=0;i<n.length;i++)n[i].handler!==t&&o.push(n[i]);this.events[e]=o}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var o=this.events[e];return o&&o.length?(o=1===o.length?[o[0]]:Array.apply(null,o),function(e,t){for(var i=o.length,n=0;n<i;n++)o[n]&&(t.eventSource=e,t.userData=o[n].userData,o[n].handler(t))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&i(this,t=t||{})}},function(v){var l,r,c,e,u=[],f={};function s(e,t){return e.hash.toString()+t.type+t.id.toString()}function n(){var e,t,i,n,o,r=l.length,s=v.now(),a=s-c;for(c=s,e=0;e<r;e++)(i=(t=l[e]).gPoint).direction=Math.atan2(i.currentPos.y-t.lastPos.y,i.currentPos.x-t.lastPos.x),n=t.lastPos.distanceTo(i.currentPos),t.lastPos=i.currentPos,o=1e3*n/(1+a),i.speed=.75*o+.25*i.speed}function o(e){for(var t=f[e.hash],i=t.activePointersLists.length,n=0;n<i;n++)0<t.activePointersLists[n].captureCount&&(v.removeEvent(v.MouseTracker.captureElement,"mousemove",t.mousemovecaptured,!0),v.removeEvent(v.MouseTracker.captureElement,"mouseup",t.mouseupcaptured,!0),v.removeEvent(v.MouseTracker.captureElement,v.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",t.pointermovecaptured,!0),v.removeEvent(v.MouseTracker.captureElement,v.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",t.pointerupcaptured,!0),v.removeEvent(v.MouseTracker.captureElement,"touchmove",t.touchmovecaptured,!0),v.removeEvent(v.MouseTracker.captureElement,"touchend",t.touchendcaptured,!0),t.activePointersLists[n].captureCount=0);for(n=0;n<i;n++)t.activePointersLists.pop()}function t(e){var t,i,n=f[e.hash];if(n.tracking){for(i=0;i<v.MouseTracker.subscribeEvents.length;i++)t=v.MouseTracker.subscribeEvents[i],v.removeEvent(e.element,t,n[t],!1);o(e),n.tracking=!1}}function a(e,t){var i=f[e.hash];if("pointerevent"===t)return{upName:v.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:i.pointerupcaptured,moveName:v.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:i.pointermovecaptured};if("mouse"===t)return{upName:"mouseup",upHandler:i.mouseupcaptured,moveName:"mousemove",moveHandler:i.mousemovecaptured};if("touch"===t)return{upName:"touchend",upHandler:i.touchendcaptured,moveName:"touchmove",moveHandler:i.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount+=i||1,1===o.captureCount&&(v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?e.element.setCapture(!0):(n=a(e,v.MouseTracker.havePointerEvents?"pointerevent":t),U&&G(window.top)&&v.addEvent(window.top,n.upName,n.upHandler,!0),v.addEvent(v.MouseTracker.captureElement,n.upName,n.upHandler,!0),v.addEvent(v.MouseTracker.captureElement,n.moveName,n.moveHandler,!0)))}function d(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount-=i||1,0===o.captureCount&&(v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?e.element.releaseCapture():(n=a(e,v.MouseTracker.havePointerEvents?"pointerevent":t),U&&G(window.top)&&v.removeEvent(window.top,n.upName,n.upHandler,!0),v.removeEvent(v.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),v.removeEvent(v.MouseTracker.captureElement,n.upName,n.upHandler,!0)))}function p(e){var t;if(v.MouseTracker.unprefixedPointerEvents)t=e.pointerType;else switch(e.pointerType){case 2:t="touch";break;case 3:t="pen";break;case 4:t="mouse";break;default:t=""}return t}function m(e){return v.getMousePosition(e)}function g(e,t){return y(m(e),t)}function y(e,t){var i=v.getElementOffset(t);return e.minus(i)}function w(e,t){return new v.Point((e.x+t.x)/2,(e.y+t.y)/2)}function i(e,t){var i={target:(t=v.getEvent(t)).target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX?t.pageX:t.clientX,pageY:t.pageY?t.pageY:t.clientY,deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==v.MouseTracker.wheelEventName?i.deltaY=-t.wheelDelta/v.DEFAULT_SETTINGS.pixelsPerWheelLine:i.deltaY=t.detail,b(e,i,t)}function b(e,t,i){var n=t.deltaY<0?1:-1;e.scrollHandler&&!1===e.scrollHandler({eventSource:e,pointerType:"mouse",position:g(t,e.element),scroll:n,shift:t.shiftKey,isTouchEvent:!1,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(i)}function _(e,t){if(e!==t){for(;t&&t!==e;)t=t.parentNode;return t===e}}function x(e,t){N(e,t,[{id:v.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(t),currentTime:v.now()}])}function S(e,t){j(e,t,[{id:v.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(t),currentTime:v.now()}])}function T(e){return v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?1===e?0:2===e?2:4===e?1:-1:e}function E(e,t){W(e,t=v.getEvent(t),[{id:v.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(t),currentTime:v.now()}],T(t.button))&&d(e,"mouse")}function P(e,t){V(e,t=v.getEvent(t),[{id:v.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(t),currentTime:v.now()}])}function C(e,t,i){var n,o=i.getLength(),r=[];if("touch"===i.type||0<i.contacts){for(n=0;n<o;n++)r.push(i.getByIndex(n));0<r.length&&(W(e,t,r,0),i.captureCount=1,d(e,i.type),j(e,t,r))}}function k(e,t){for(var i,n,o=t.changedTouches.length,r=[],s=v.now(),a=0;a<o;a++)r.push({id:t.changedTouches[a].identifier,type:"touch",currentPos:m(t.changedTouches[a]),currentTime:s});for(W(e,t,r,0)&&d(e,"touch",o),j(e,t,r),a=0;a<u.length;a++)if(u[a]!==e&&u[a].isTracking()&&_(u[a].element,e.element)){for(n=[],i=0;i<o;i++)n.push({id:t.changedTouches[i].identifier,type:"touch",currentPos:m(t.changedTouches[i]),currentTime:s});j(u[a],t,n)}v.cancelEvent(t)}function O(e,t){for(var i=t.changedTouches.length,n=[],o=0;o<i;o++)n.push({id:t.changedTouches[o].identifier,type:"touch",currentPos:m(t.changedTouches[o]),currentTime:v.now()});V(e,t,n),v.cancelEvent(t)}function R(e,t){t.currentTarget===t.relatedTarget||_(t.currentTarget,t.relatedTarget)||N(e,t,[{id:t.pointerId,type:p(t),isPrimary:t.isPrimary,currentPos:m(t),currentTime:v.now()}])}function L(e,t){t.currentTarget===t.relatedTarget||_(t.currentTarget,t.relatedTarget)||j(e,t,[{id:t.pointerId,type:p(t),isPrimary:t.isPrimary,currentPos:m(t),currentTime:v.now()}])}function A(e,t){var i={id:t.pointerId,type:p(t),isPrimary:t.isPrimary,currentPos:m(t),currentTime:v.now()};q(e,t,[i],t.button)&&(v.stopEvent(t),h(e,i.type)),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler||e.pinchHandler)&&v.cancelEvent(t)}function I(e,t){M(e,t)}function M(e,t){var i={id:t.pointerId,type:p(t),isPrimary:t.isPrimary,currentPos:m(t),currentTime:v.now()};W(e,t,[i],t.button)&&d(e,i.type)}function D(e,t){z(e,t)}function z(e,t){V(e,t,[{id:t.pointerId,type:p(t),isPrimary:t.isPrimary,currentPos:m(t),currentTime:v.now()}])}function B(e,t){var i,n,o,r={id:t.pointerId,type:p(t)};W(i=e,n=t,o=[r],0),j(i,n,o)}function H(e,t){return Object.prototype.hasOwnProperty.call(t,"isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function F(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),Object.prototype.hasOwnProperty.call(t,"isPrimary")||(n=e.getPrimary())||(n=e.getByIndex(0))&&(n.isPrimary=!0)):i=e.getLength(),i}function N(e,t,i){for(var n,o,r=e.getActivePointersListByType(i[0].type),s=i.length,a=0;a<s;a++)n=i[a],(o=r.getById(n.id))?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=n.currentPos,o.currentTime=n.currentTime,n=o):(n.captured=!1,n.insideElementPressed=!1,n.insideElement=!0,H(r,n)),e.enterHandler&&!1===e.enterHandler({eventSource:e,pointerType:n.type,position:y(n.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:n.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===n.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t)}function j(e,t,i){for(var n,o,r=e.getActivePointersListByType(i[0].type),s=i.length,a=0;a<s;a++)n=i[a],(o=r.getById(n.id))&&(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=n.currentPos,o.currentTime=n.currentTime):F(r,o),n=o),e.exitHandler&&!1===e.exitHandler({eventSource:e,pointerType:n.type,position:n.currentPos&&y(n.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:!!o&&o.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===n.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t)}function q(e,t,i,n){var o,r,s=f[e.hash],a=e.getActivePointersListByType(i[0].type),l=i.length;void 0!==t.buttons?a.buttons=t.buttons:v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?0===n?a.buttons+=1:1===n?a.buttons+=4:2===n?a.buttons+=2:3===n?a.buttons+=8:4===n?a.buttons+=16:5===n&&(a.buttons+=32):0===n?a.buttons|=1:1===n?a.buttons|=4:2===n?a.buttons|=2:3===n?a.buttons|=8:4===n?a.buttons|=16:5===n&&(a.buttons|=32);for(var c=e.getActivePointersListsExceptType(i[0].type),u=0;u<c.length;u++)C(e,t,c[u]);if(0===n){for(u=0;u<l;u++)o=i[u],(r=a.getById(o.id))?(r.captured=!0,r.insideElementPressed=!0,r.insideElement=!0,r.contactPos=o.currentPos,r.contactTime=o.currentTime,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime,o=r):(o.captured=!0,o.insideElementPressed=!0,o.insideElement=!0,H(a,o)),a.addContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&v.MouseTracker.gesturePointVelocityTracker.addPoint(e,o),1===a.contacts?e.pressHandler&&!1===e.pressHandler({eventSource:e,pointerType:o.type,position:y(o.contactPos,e.element),buttons:a.buttons,isTouchEvent:"touch"===o.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t):2===a.contacts&&e.pinchHandler&&"touch"===o.type&&(s.pinchGPoints=a.asArray(),s.lastPinchDist=s.currentPinchDist=s.pinchGPoints[0].currentPos.distanceTo(s.pinchGPoints[1].currentPos),s.lastPinchCenter=s.currentPinchCenter=w(s.pinchGPoints[0].currentPos,s.pinchGPoints[1].currentPos));return 1}e.nonPrimaryPressHandler&&!1===e.nonPrimaryPressHandler({eventSource:e,pointerType:i[0].type,position:y(i[0].currentPos,e.element),button:n,buttons:a.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t)}function W(e,t,i,n){var o,r,s,a,l,c,u=f[e.hash],h=e.getActivePointersListByType(i[0].type),d=i.length,p=!1,m=!1;if(void 0!==t.buttons?h.buttons=t.buttons:v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?0===n?--h.buttons:1===n?h.buttons-=4:2===n?h.buttons-=2:3===n?h.buttons-=8:4===n?h.buttons-=16:5===n&&(h.buttons-=32):0===n?h.buttons^=-2:1===n?h.buttons^=-5:2===n?h.buttons^=-3:3===n?h.buttons^=-9:4===n?h.buttons^=-17:5===n&&(h.buttons^=-33),0===n){if(void 0!==i[0].currentPos){for(s=0;s<d;s++)a=i[s],(l=h.getById(a.id))&&(l.captured&&(m=p=!(l.captured=!1)),l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=a.currentPos,l.currentTime=a.currentTime,l.insideElement||F(h,l),o=l.currentPos,r=l.currentTime,m?(h.removeContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&v.MouseTracker.gesturePointVelocityTracker.removePoint(e,l),0===h.contacts?(e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:l.type,position:y(o,e.element),buttons:h.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t),e.dragEndHandler&&!l.currentPos.equals(l.contactPos)&&!1===e.dragEndHandler({eventSource:e,pointerType:l.type,position:y(l.currentPos,e.element),speed:l.speed,direction:l.direction,shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t),(e.clickHandler||e.dblClickHandler)&&l.insideElement&&(c=r-l.contactTime<=e.clickTimeThreshold&&l.contactPos.distanceTo(o)<=e.clickDistThreshold,e.clickHandler&&!1===e.clickHandler({eventSource:e,pointerType:l.type,position:y(l.currentPos,e.element),quick:c,shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t),e.dblClickHandler&&c&&(h.clicks++,1===h.clicks?(u.lastClickPos=o,u.dblClickTimeOut=setTimeout(function(){h.clicks=0},e.dblClickTimeThreshold)):2===h.clicks&&(clearTimeout(u.dblClickTimeOut),h.clicks=0,u.lastClickPos.distanceTo(o)<=e.dblClickDistThreshold&&!1===e.dblClickHandler({eventSource:e,pointerType:l.type,position:y(l.currentPos,e.element),shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t),u.lastClickPos=null)))):2===h.contacts&&e.pinchHandler&&"touch"===l.type&&(u.pinchGPoints=h.asArray(),u.lastPinchDist=u.currentPinchDist=u.pinchGPoints[0].currentPos.distanceTo(u.pinchGPoints[1].currentPos),u.lastPinchCenter=u.currentPinchCenter=w(u.pinchGPoints[0].currentPos,u.pinchGPoints[1].currentPos))):e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:l.type,position:y(o,e.element),buttons:h.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t));return p}C(e,t,h)}else{e.nonPrimaryReleaseHandler&&!1===e.nonPrimaryReleaseHandler({eventSource:e,pointerType:i[0].type,position:y(i[0].currentPos,e.element),button:n,buttons:h.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&v.cancelEvent(t);var g=e.getActivePointersListByType("mouse");C(e,t,g)}}function V(n,o,r){var e,t,i,s,a,l=f[n.hash],c=n.getActivePointersListByType(r[0].type),u=r.length;for(void 0!==o.buttons&&(c.buttons=o.buttons),e=0;e<u;e++)t=r[e],(i=c.getById(t.id))?(Object.prototype.hasOwnProperty.call(t,"isPrimary")&&(i.isPrimary=t.isPrimary),i.lastPos=i.currentPos,i.lastTime=i.currentTime,i.currentPos=t.currentPos,i.currentTime=t.currentTime):(t.captured=!1,t.insideElementPressed=!1,t.insideElement=!0,H(c,t));n.stopHandler&&"mouse"===r[0].type&&(clearTimeout(n.stopTimeOut),n.stopTimeOut=setTimeout(function(){var e,t,i;e=n,t=o,i=r[0].type,e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:g(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})},n.stopDelay)),0===c.contacts?n.moveHandler&&!1===n.moveHandler({eventSource:n,pointerType:r[0].type,position:y(r[0].currentPos,n.element),buttons:c.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:o,preventDefaultAction:!1,userData:n.userData})&&v.cancelEvent(o):1===c.contacts?(n.moveHandler&&(i=c.asArray()[0],!1===n.moveHandler({eventSource:n,pointerType:i.type,position:y(i.currentPos,n.element),buttons:c.buttons,isTouchEvent:"touch"===i.type,originalEvent:o,preventDefaultAction:!1,userData:n.userData})&&v.cancelEvent(o)),n.dragHandler&&(a=(i=c.asArray()[0]).currentPos.minus(i.lastPos),!1===n.dragHandler({eventSource:n,pointerType:i.type,position:y(i.currentPos,n.element),buttons:c.buttons,delta:a,speed:i.speed,direction:i.direction,shift:o.shiftKey,isTouchEvent:"touch"===i.type,originalEvent:o,preventDefaultAction:!1,userData:n.userData})&&v.cancelEvent(o))):2===c.contacts&&(n.moveHandler&&(s=c.asArray(),!1===n.moveHandler({eventSource:n,pointerType:s[0].type,position:y(w(s[0].currentPos,s[1].currentPos),n.element),buttons:c.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:o,preventDefaultAction:!1,userData:n.userData})&&v.cancelEvent(o)),n.pinchHandler&&"touch"===r[0].type&&(a=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos))!=l.currentPinchDist&&(l.lastPinchDist=l.currentPinchDist,l.currentPinchDist=a,l.lastPinchCenter=l.currentPinchCenter,l.currentPinchCenter=w(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos),!1===n.pinchHandler({eventSource:n,pointerType:"touch",gesturePoints:l.pinchGPoints,lastCenter:y(l.lastPinchCenter,n.element),center:y(l.currentPinchCenter,n.element),lastDistance:l.lastPinchDist,distance:l.currentPinchDist,shift:o.shiftKey,originalEvent:o,preventDefaultAction:!1,userData:n.userData})&&v.cancelEvent(o)))}v.MouseTracker=function(e){u.push(this);var t=arguments;v.isPlainObject(e)||(e={element:t[0],clickTimeThreshold:t[1],clickDistThreshold:t[2]}),this.hash=Math.random(),this.element=v.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||v.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||v.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||v.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||v.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.enterHandler=e.enterHandler||null,this.exitHandler=e.exitHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null;var o=this;f[this.hash]={click:function(e){var t;t=e,o.clickHandler&&v.cancelEvent(t)},dblclick:function(e){var t;t=e,o.dblClickHandler&&v.cancelEvent(t)},keydown:function(e){var t,i;i=e,(t=o).keyDownHandler&&(i=v.getEvent(i),t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||v.cancelEvent(i))},keyup:function(e){var t,i;i=e,(t=o).keyUpHandler&&(i=v.getEvent(i),t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||v.cancelEvent(i))},keypress:function(e){var t,i;i=e,(t=o).keyHandler&&(i=v.getEvent(i),t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||v.cancelEvent(i))},focus:function(e){var t,i;i=e,(t=o).focusHandler&&(i=v.getEvent(i),!1===t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&v.cancelEvent(i))},blur:function(e){var t,i;i=e,(t=o).blurHandler&&(i=v.getEvent(i),!1===t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&v.cancelEvent(i))},wheel:function(e){var t;b(o,t=e,t)},mousewheel:function(e){i(o,e)},DOMMouseScroll:function(e){i(o,e)},MozMousePixelScroll:function(e){i(o,e)},mouseenter:function(e){var t,i;t=o,i=e,i=v.getEvent(i),x(t,i)},mouseleave:function(e){var t,i;t=o,i=e,i=v.getEvent(i),S(t,i)},mouseover:function(e){!function(e,t){if((t=v.getEvent(t)).currentTarget===t.relatedTarget||_(t.currentTarget,t.relatedTarget))return;x(e,t)}(o,e)},mouseout:function(e){!function(e,t){if((t=v.getEvent(t)).currentTarget===t.relatedTarget||_(t.currentTarget,t.relatedTarget))return;S(e,t)}(o,e)},mousedown:function(e){!function(e,t){var i;t=v.getEvent(t),i={id:v.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(t),currentTime:v.now()},q(e,t,[i],T(t.button))&&(v.stopEvent(t),h(e,"mouse"));(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler)&&v.cancelEvent(t)}(o,e)},mouseup:function(e){E(o,e)},mouseupcaptured:function(e){var t;E(o,t=e),v.stopEvent(t)},mousemove:function(e){P(o,e)},mousemovecaptured:function(e){var t;P(o,t=e),v.stopEvent(t)},touchstart:function(e){!function(e,t){var i,n,o,r,s=t.changedTouches.length,a=[],l=e.getActivePointersListByType("touch");i=v.now(),l.getLength()>t.touches.length-s&&(v.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),C(e,t,l));for(n=0;n<s;n++)a.push({id:t.changedTouches[n].identifier,type:"touch",currentPos:m(t.changedTouches[n]),currentTime:i});for(N(e,t,a),n=0;n<u.length;n++)if(u[n]!==e&&u[n].isTracking()&&_(u[n].element,e.element)){for(r=[],o=0;o<s;o++)r.push({id:t.changedTouches[o].identifier,type:"touch",currentPos:m(t.changedTouches[o]),currentTime:i});N(u[n],t,r)}q(e,t,a,0)&&(v.stopEvent(t),h(e,"touch",s));v.cancelEvent(t)}(o,e)},touchend:function(e){k(o,e)},touchendcaptured:function(e){var t;k(o,t=e),v.stopEvent(t)},touchmove:function(e){O(o,e)},touchmovecaptured:function(e){var t;O(o,t=e),v.stopEvent(t)},touchcancel:function(e){var t,i,n;i=e,n=(t=o).getActivePointersListByType("touch"),C(t,i,n)},gesturestart:function(e){var t;(t=e).stopPropagation(),t.preventDefault()},gesturechange:function(e){var t;(t=e).stopPropagation(),t.preventDefault()},pointerover:function(e){R(o,e)},MSPointerOver:function(e){R(o,e)},pointerout:function(e){L(o,e)},MSPointerOut:function(e){L(o,e)},pointerdown:function(e){A(o,e)},MSPointerDown:function(e){A(o,e)},pointerup:function(e){I(o,e)},MSPointerUp:function(e){I(o,e)},pointermove:function(e){D(o,e)},MSPointerMove:function(e){D(o,e)},pointercancel:function(e){B(o,e)},MSPointerCancel:function(e){B(o,e)},pointerupcaptured:function(e){!function(e,t){e.getActivePointersListByType(p(t)).getById(t.pointerId)&&M(e,t);v.stopEvent(t)}(o,e)},pointermovecaptured:function(e){!function(e,t){e.getActivePointersListByType(p(t)).getById(t.pointerId)&&z(e,t);v.stopEvent(t)}(o,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},e.startDisabled||this.setTracking(!0)},v.MouseTracker.prototype={destroy:function(){var e;for(t(this),this.element=null,e=0;e<u.length;e++)if(u[e]===this){u.splice(e,1);break}f[this.hash]=null,delete f[this.hash]},isTracking:function(){return f[this.hash].tracking},setTracking:function(e){return(e?function(e){var t,i,n=f[e.hash];if(!n.tracking){for(i=0;i<v.MouseTracker.subscribeEvents.length;i++)t=v.MouseTracker.subscribeEvents[i],v.addEvent(e.element,t,n[t],!1);o(e),n.tracking=!0}}:t)(this),this},getActivePointersListsExceptType:function(e){for(var t=f[this.hash],i=[],n=0;n<t.activePointersLists.length;++n)t.activePointersLists[n].type!==e&&i.push(t.activePointersLists[n]);return i},getActivePointersListByType:function(e){for(var t,i=f[this.hash],n=i.activePointersLists.length,o=0;o<n;o++)if(i.activePointersLists[o].type===e)return i.activePointersLists[o];return t=new v.MouseTracker.GesturePointList(e),i.activePointersLists.push(t),t},getActivePointerCount:function(){for(var e=f[this.hash],t=e.activePointersLists.length,i=0,n=0;n<t;n++)i+=e.activePointersLists[n].getLength();return i},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},v.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<u.length;e++)u[e].isTracking()&&(u[e].setTracking(!1),u[e].setTracking(!0))},v.MouseTracker.gesturePointVelocityTracker=(l=[],c=r=0,{addPoint:function(e,t){var i=s(e,t);l.push({guid:i,gPoint:t,lastPos:t.currentPos}),1===l.length&&(c=v.now(),r=window.setInterval(n,50))},removePoint:function(e,t){for(var i=s(e,t),n=l.length,o=0;o<n;o++)if(l[o].guid===i){l.splice(o,1),0===--n&&window.clearInterval(r);break}}}),v.MouseTracker.captureElement=document,v.MouseTracker.wheelEventName=v.Browser.vendor==v.BROWSERS.IE&&8<v.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",v.MouseTracker.supportsMouseCapture=(e=document.createElement("div"),v.isFunction(e.setCapture)&&v.isFunction(e.releaseCapture)),v.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",v.MouseTracker.wheelEventName],"DOMMouseScroll"==v.MouseTracker.wheelEventName&&v.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||v.Browser.vendor!==v.BROWSERS.IE)?(v.MouseTracker.havePointerEvents=!0,v.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),v.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?v.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:v.MouseTracker.maxTouchPoints=0,v.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(v.MouseTracker.havePointerEvents=!0,v.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),v.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?v.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:v.MouseTracker.maxTouchPoints=0,v.MouseTracker.haveMouseEnter=!1):(v.MouseTracker.havePointerEvents=!1,v.Browser.vendor===v.BROWSERS.IE&&v.Browser.version<9?(v.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),v.MouseTracker.haveMouseEnter=!0):(v.MouseTracker.subscribeEvents.push("mouseover","mouseout"),v.MouseTracker.haveMouseEnter=!1),v.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&v.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&v.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),v.MouseTracker.mousePointerId="legacy-mouse",v.MouseTracker.maxTouchPoints=10),v.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},v.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].id===e)return this._gPoints[i];return null},getPrimary:function(e){for(var t=this._gPoints.length,i=0;i<t;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var U=function(){try{return window.self!==window.top}catch(e){return!0}}();function G(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return}}}(OpenSeadragon),on=OpenSeadragon,on.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},on.Control=function(e,t,i){var n=e.parentNode;"number"==typeof t&&(on.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),t={anchor:t}),t.attachToViewer=void 0===t.attachToViewer||t.attachToViewer,this.autoFade=void 0===t.autoFade||t.autoFade,this.element=e,this.anchor=t.anchor,this.container=i,this.anchor==on.ControlAnchor.ABSOLUTE?(this.wrapper=on.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof t.top?t.top+"px":t.top,this.wrapper.style.left="number"==typeof t.left?t.left+"px":t.left,this.wrapper.style.height="number"==typeof t.height?t.height+"px":t.height,this.wrapper.style.width="number"==typeof t.width?t.width+"px":t.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=on.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==on.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),t.attachToViewer?this.anchor==on.ControlAnchor.TOP_RIGHT||this.anchor==on.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},on.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor==on.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[on.SIGNAL]&&on.Browser.vendor==on.BROWSERS.IE?on.setElementOpacity(this.element,e,!0):on.setElementOpacity(this.wrapper,e,!0)}},vn=OpenSeadragon,vn.ControlDock=function(e){var t,i,n=["topleft","topright","bottomright","bottomleft"];for(vn.extend(!0,this,{id:"controldock-"+vn.now()+"-"+Math.floor(1e6*Math.random()),container:vn.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=vn.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<n.length;i++)t=n[i],this.controls[t]=vn.makeNeutralElement("div"),this.controls[t].style.position="absolute",t.match("left")&&(this.controls[t].style.left="0px"),t.match("right")&&(this.controls[t].style.right="0px"),t.match("top")&&(this.controls[t].style.top="0px"),t.match("bottom")&&(this.controls[t].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},vn.ControlDock.prototype={addControl:function(e,t){var i=null;if(!(0<=wn(this,e=vn.getElement(e)))){switch(t.anchor){case vn.ControlAnchor.TOP_RIGHT:i=this.controls.topright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingTop="0px";break;case vn.ControlAnchor.BOTTOM_RIGHT:i=this.controls.bottomright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingBottom="0px";break;case vn.ControlAnchor.BOTTOM_LEFT:i=this.controls.bottomleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingBottom="0px";break;case vn.ControlAnchor.TOP_LEFT:i=this.controls.topleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingTop="0px";break;case vn.ControlAnchor.ABSOLUTE:i=this.container,e.style.margin="0px",e.style.padding="0px";break;default:case vn.ControlAnchor.NONE:i=this.container,e.style.margin="0px",e.style.padding="0px"}this.controls.push(new vn.Control(e,t,i)),e.style.display="inline-block"}},removeControl:function(e){var t=wn(this,e=vn.getElement(e));return 0<=t&&(this.controls[t].destroy(),this.controls.splice(t,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){for(var e=this.controls.length-1;0<=e;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){for(var t=this.controls.length-1;0<=t;t--)this.controls[t].setVisible(e);return this}},OpenSeadragon.Placement=OpenSeadragon.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}}),On=OpenSeadragon,Pn={},Qn=1,On.Viewer=function(e){var t,i,n,o=arguments,r=this;if(On.isPlainObject(e)||(e={id:o[0],xmlPath:1<o.length?o[1]:void 0,prefixUrl:2<o.length?o[2]:void 0,controls:3<o.length?o[3]:void 0,overlays:4<o.length?o[4]:void 0}),e.config&&(On.extend(!0,e,e.config),delete e.config),On.extend(!0,this,{id:e.id,hash:e.hash||Qn++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},On.DEFAULT_SETTINGS,e),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==Pn[this.hash]&&On.console.warn("Hash "+this.hash+" has already been used."),Pn[this.hash]={fsBoundsDelta:new On.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=On.now(),On.EventSource.call(this),this.addHandler("open-failed",function(e){var t=On.getString("Errors.OpenFailed",e.eventSource,e.message);r._showMessage(t)}),On.ControlDock.call(this,e),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=On.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(i=this.canvas.style).width="100%",i.height="100%",i.overflow="hidden",i.position="absolute",i.top="0px",i.left="0px",On.setElementTouchActionNone(this.canvas),""!==e.tabIndex&&(this.canvas.tabIndex=void 0===e.tabIndex?0:e.tabIndex),this.container.className="openseadragon-container",(n=this.container.style).width="100%",n.height="100%",n.position="relative",n.overflow="hidden",n.left="0px",n.top="0px",n.textAlign="left",this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new On.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:On.delegate(this,ao),keyHandler:On.delegate(this,bo),clickHandler:On.delegate(this,co),dblClickHandler:On.delegate(this,eo),dragHandler:On.delegate(this,fo),dragEndHandler:On.delegate(this,go),enterHandler:On.delegate(this,ho),exitHandler:On.delegate(this,io),pressHandler:On.delegate(this,jo),releaseHandler:On.delegate(this,ko),nonPrimaryPressHandler:On.delegate(this,lo),nonPrimaryReleaseHandler:On.delegate(this,mo),scrollHandler:On.delegate(this,oo),pinchHandler:On.delegate(this,no)}),this.outerTracker=new On.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:On.delegate(this,po),exitHandler:On.delegate(this,qo)}),this.toolbar&&(this.toolbar=new On.ControlDock({element:this.toolbar})),this.bindStandardControls(),Pn[this.hash].prevContainerSize=Rn(this.container),this.world=new On.World({viewer:this}),this.world.addHandler("add-item",function(e){r.source=r.world.getItemAt(0).source,Pn[r.hash].forceRedraw=!0,r._updateRequestId||(r._updateRequestId=Vn(r,ro))}),this.world.addHandler("remove-item",function(e){r.world.getItemCount()?r.source=r.world.getItemAt(0).source:r.source=null,Pn[r.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(e){r.viewport&&r.viewport._setContentBounds(r.world.getHomeBounds(),r.world.getContentFactor())}),this.world.addHandler("item-index-change",function(e){r.source=r.world.getItemAt(0).source}),this.viewport=new On.Viewport({containerSize:Pn[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new On.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:e.timeout}),this.tileCache=new On.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new On.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=On.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(t=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(t,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(t=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(t,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new On.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});On.requestAnimationFrame(function(){Xn(r)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},On.extend(On.Viewer.prototype,On.EventSource.prototype,On.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return On.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return On.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},open:function(i,e){var o=this;if(this.close(),i){if(this.sequenceMode&&On.isArray(i))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===e||isNaN(e)||(this.initialPage=e),this.tileSources=i,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(On.isArray(i)||(i=[i]),i.length){this._opening=!0;function r(){if(a+l===n)if(a){!o._firstOpen&&o.preserveViewport||(o.viewport.goHome(!0),o.viewport.update()),o._firstOpen=!1;var e=i[0];if(e.tileSource&&(e=e.tileSource),o.overlays&&!o.preserveOverlays)for(var t=0;t<o.overlays.length;t++)o.currentOverlays[t]=Tn(o,o.overlays[t]);o._drawOverlays(),o._opening=!1,o.raiseEvent("open",{source:e})}else o._opening=!1,o.raiseEvent("open-failed",s)}for(var s,n=i.length,a=0,l=0,t=0;t<i.length;t++)!function(i){On.isPlainObject(i)&&i.tileSource||(i={tileSource:i}),void 0!==i.index&&(On.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete i.index),void 0===i.collectionImmediately&&(i.collectionImmediately=!0);var n=i.success;i.success=function(e){if(a++,i.tileSource.overlays)for(var t=0;t<i.tileSource.overlays.length;t++)o.addOverlay(i.tileSource.overlays[t]);n&&n(e),r()};var t=i.error;i.error=function(e){l++,s=s||e,t&&t(e),r()},o.addTiledImage(i)}(i[t]);return this}}},close:function(){return Pn[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Pn[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(Pn[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(On.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Pn[this.hash]=null,delete Pn[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){for(var e=this.controls.length,t=0;t<this.controls.length;t++)e=e&&this.controls[t].isVisible();return e},setControlsEnabled:function(e){return(e?Zn:Xn)(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return Pn[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,o=n.style,r=document.documentElement.style,s=this;if(e==this.isFullPage())return this;var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),a.preventDefaultAction)return this;if(e){for(this.elementSize=On.getElementSize(this.element),this.pageScroll=On.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=r.margin,o.margin="0",r.margin="0",this.bodyPadding=o.padding,this.docPadding=r.padding,o.padding="0",r.padding="0",this.bodyWidth=o.width,this.docWidth=r.width,o.width="100%",r.width="100%",this.bodyHeight=o.height,this.docHeight=r.height,o.height="100%",r.height="100%",this.previousBody=[],Pn[this.hash].prevElementParent=this.element.parentNode,Pn[this.hash].prevNextSibling=this.element.nextSibling,Pn[this.hash].prevElementWidth=this.element.style.width,Pn[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;i<t;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),On.addClass(this.toolbar.element,"fullpage")),On.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height=On.getWindowSize().y+"px",this.element.style.width=On.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=On.getElementSize(this.element).y-On.getElementSize(this.toolbar.element).y+"px"),Pn[this.hash].fullPage=!0,On.delegate(this,po)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,r.margin=this.docMargin,o.padding=this.bodyPadding,r.padding=this.docPadding,o.width=this.bodyWidth,r.width=this.docWidth,o.height=this.bodyHeight,r.height=this.docHeight,n.removeChild(this.element),t=this.previousBody.length,i=0;i<t;i++)n.appendChild(this.previousBody.shift());On.removeClass(this.element,"fullpage"),Pn[this.hash].prevElementParent.insertBefore(this.element,Pn[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),On.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Pn[this.hash].prevElementWidth,this.element.style.height=Pn[this.hash].prevElementHeight;var l=0,c=function(){On.setPageScroll(s.pageScroll);var e=On.getPageScroll();++l<10&&(e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&On.requestAnimationFrame(c)};On.requestAnimationFrame(c),Pn[this.hash].fullPage=!1,On.delegate(this,qo)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var t=this;if(!On.supportsFullScreen)return this.setFullPage(e);if(On.isFullScreen()===e)return this;var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),i.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=On.isFullScreen();e||(On.removeEvent(document,On.fullScreenEventName,n),On.removeEvent(document,On.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.navigator&&t.viewport&&setTimeout(function(){t.navigator.update(t.viewport)}),t.raiseEvent("full-screen",{fullScreen:e})};On.addEvent(document,On.fullScreenEventName,n),On.addEvent(document,On.fullScreenErrorEventName,n),On.requestFullScreen(document.body)}else On.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(i){On.console.assert(i,"[Viewer.addTiledImage] options is required"),On.console.assert(i.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),On.console.assert(!i.replace||-1<i.index&&i.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var o=this;i.replace&&(i.replaceItem=o.world.getItemAt(i.index)),this._hideMessage(),void 0===i.placeholderFillStyle&&(i.placeholderFillStyle=this.placeholderFillStyle),void 0===i.opacity&&(i.opacity=this.opacity),void 0===i.preload&&(i.preload=this.preload),void 0===i.compositeOperation&&(i.compositeOperation=this.compositeOperation),void 0===i.crossOriginPolicy&&(i.crossOriginPolicy=void 0!==i.tileSource.crossOriginPolicy?i.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=this.ajaxWithCredentials),void 0===i.loadTilesWithAjax&&(i.loadTilesWithAjax=this.loadTilesWithAjax),void 0===i.ajaxHeaders||null===i.ajaxHeaders?i.ajaxHeaders=this.ajaxHeaders:On.isPlainObject(i.ajaxHeaders)&&On.isPlainObject(this.ajaxHeaders)&&(i.ajaxHeaders=On.extend({},this.ajaxHeaders,i.ajaxHeaders));var n={options:i};function t(e){for(var t=0;t<o._loadQueue.length;t++)if(o._loadQueue[t]===n){o._loadQueue.splice(t,1);break}0===o._loadQueue.length&&r(n),o.raiseEvent("add-item-failed",e),i.error&&i.error(e)}function r(e){o.collectionMode&&(o.world.arrange({immediately:e.options.collectionImmediately,rows:o.collectionRows,columns:o.collectionColumns,layout:o.collectionLayout,tileSize:o.collectionTileSize,tileMargin:o.collectionTileMargin}),o.world.setAutoRefigureSizes(!0))}function s(){for(var e,t,i,n;o._loadQueue.length&&(e=o._loadQueue[0]).tileSource;){o._loadQueue.splice(0,1),e.options.replace&&(-1!=(n=o.world.getIndexOfItem(e.options.replaceItem))&&(e.options.index=n),o.world.removeItem(e.options.replaceItem)),t=new On.TiledImage({viewer:o,source:e.tileSource,viewport:o.viewport,drawer:o.drawer,tileCache:o.tileCache,imageLoader:o.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,compositeOperation:e.options.compositeOperation,springStiffness:o.springStiffness,animationTime:o.animationTime,minZoomImageRatio:o.minZoomImageRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,immediateRender:o.immediateRender,blendTime:o.blendTime,alwaysBlend:o.alwaysBlend,minPixelRatio:o.minPixelRatio,smoothTileEdgesMinZoom:o.smoothTileEdgesMinZoom,iOSDevice:o.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:o.debugMode}),o.collectionMode&&o.world.setAutoRefigureSizes(!1),o.world.addItem(t,{index:e.options.index}),0===o._loadQueue.length&&r(e),1!==o.world.getItemCount()||o.preserveViewport||o.viewport.goHome(!0),o.navigator&&(i=On.extend({},e.options,{replace:!1,originalTiledImage:t,tileSource:e.tileSource}),o.navigator.addTiledImage(i)),e.options.success&&e.options.success({item:t})}}On.isArray(i.tileSource)?setTimeout(function(){t({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:i.tileSource,options:i})}):(this._loadQueue.push(n),function(n,o,r,s,a){var l=n;if("string"==On.type(o))if(o.match(/^\s*<.*>\s*$/))o=On.parseXml(o);else if(o.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var e=On.parseJSON(o);o=e}catch(e){}function c(e,t){e.ready?s(e):(e.addHandler("ready",function(){s(e)}),e.addHandler("open-failed",function(e){a({message:e.message,source:t})}))}setTimeout(function(){if("string"==On.type(o))(o=new On.TileSource({url:o,crossOriginPolicy:void 0!==r.crossOriginPolicy?r.crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,ajaxHeaders:n.ajaxHeaders,useCanvas:n.useCanvas,success:function(e){s(e.tileSource)}})).addHandler("open-failed",function(e){a(e)});else if(On.isPlainObject(o)||o.nodeType)if(void 0!==o.crossOriginPolicy||void 0===r.crossOriginPolicy&&void 0===n.crossOriginPolicy||(o.crossOriginPolicy=void 0!==r.crossOriginPolicy?r.crossOriginPolicy:n.crossOriginPolicy),void 0===o.ajaxWithCredentials&&(o.ajaxWithCredentials=n.ajaxWithCredentials),void 0===o.useCanvas&&(o.useCanvas=n.useCanvas),On.isFunction(o.getTileUrl)){var e=new On.TileSource(o);e.getTileUrl=o.getTileUrl,s(e)}else{var t=On.TileSource.determineType(l,o);if(!t)return void a({message:"Unable to load TileSource",source:o});var i=t.prototype.configure.apply(l,[o]);c(new t(i),o)}else c(o,o)})}(this,i.tileSource,i,function(e){n.tileSource=e,s()},function(e){e.options=i,t(e),s()}))},addSimpleImage:function(e){On.console.assert(e,"[Viewer.addSimpleImage] options is required"),On.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");var t=On.extend({},e,{tileSource:{type:"image",url:e.url}});delete t.url,this.addTiledImage(t)},addLayer:function(t){var i=this;On.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var e=On.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(e),this},getLayerAtLevel:function(e){return On.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return On.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return On.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,t){return On.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,t)},removeLayer:function(e){return On.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return Pn[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=On.delegate(this,$n),t=On.delegate(this,_n),i=On.delegate(this,Jo),n=On.delegate(this,Io),o=this.navImages,r=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new On.Button({element:this.previousButton?On.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.PreviousPage"),srcRest:uo(this.prefixUrl,o.previous.REST),srcGroup:uo(this.prefixUrl,o.previous.GROUP),srcHover:uo(this.prefixUrl,o.previous.HOVER),srcDown:uo(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new On.Button({element:this.nextButton?On.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.NextPage"),srcRest:uo(this.prefixUrl,o.next.REST),srcGroup:uo(this.prefixUrl,o.next.GROUP),srcHover:uo(this.prefixUrl,o.next.HOVER),srcDown:uo(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),r&&(this.paging=new On.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:On.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||On.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=On.delegate(this,vo),t=On.delegate(this,xo),i=On.delegate(this,Ao),n=On.delegate(this,wo),o=On.delegate(this,Bo),r=On.delegate(this,Do),s=On.delegate(this,Eo),a=On.delegate(this,Fo),l=On.delegate(this,Go),c=On.delegate(this,Ho),u=On.delegate(this,$n),h=On.delegate(this,_n),d=this.navImages,p=[],m=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(m=!1),this.showZoomControl&&(p.push(this.zoomInButton=new On.Button({element:this.zoomInButton?On.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.ZoomIn"),srcRest:uo(this.prefixUrl,d.zoomIn.REST),srcGroup:uo(this.prefixUrl,d.zoomIn.GROUP),srcHover:uo(this.prefixUrl,d.zoomIn.HOVER),srcDown:uo(this.prefixUrl,d.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:u,onBlur:h})),p.push(this.zoomOutButton=new On.Button({element:this.zoomOutButton?On.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.ZoomOut"),srcRest:uo(this.prefixUrl,d.zoomOut.REST),srcGroup:uo(this.prefixUrl,d.zoomOut.GROUP),srcHover:uo(this.prefixUrl,d.zoomOut.HOVER),srcDown:uo(this.prefixUrl,d.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:u,onBlur:h}))),this.showHomeControl&&p.push(this.homeButton=new On.Button({element:this.homeButton?On.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.Home"),srcRest:uo(this.prefixUrl,d.home.REST),srcGroup:uo(this.prefixUrl,d.home.GROUP),srcHover:uo(this.prefixUrl,d.home.HOVER),srcDown:uo(this.prefixUrl,d.home.DOWN),onRelease:r,onFocus:u,onBlur:h})),this.showFullPageControl&&p.push(this.fullPageButton=new On.Button({element:this.fullPageButton?On.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.FullPage"),srcRest:uo(this.prefixUrl,d.fullpage.REST),srcGroup:uo(this.prefixUrl,d.fullpage.GROUP),srcHover:uo(this.prefixUrl,d.fullpage.HOVER),srcDown:uo(this.prefixUrl,d.fullpage.DOWN),onRelease:s,onFocus:u,onBlur:h})),this.showRotationControl&&(p.push(this.rotateLeftButton=new On.Button({element:this.rotateLeftButton?On.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.RotateLeft"),srcRest:uo(this.prefixUrl,d.rotateleft.REST),srcGroup:uo(this.prefixUrl,d.rotateleft.GROUP),srcHover:uo(this.prefixUrl,d.rotateleft.HOVER),srcDown:uo(this.prefixUrl,d.rotateleft.DOWN),onRelease:a,onFocus:u,onBlur:h})),p.push(this.rotateRightButton=new On.Button({element:this.rotateRightButton?On.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.RotateRight"),srcRest:uo(this.prefixUrl,d.rotateright.REST),srcGroup:uo(this.prefixUrl,d.rotateright.GROUP),srcHover:uo(this.prefixUrl,d.rotateright.HOVER),srcDown:uo(this.prefixUrl,d.rotateright.DOWN),onRelease:l,onFocus:u,onBlur:h}))),this.showFlipControl&&p.push(this.flipButton=new On.Button({element:this.flipButton?On.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:On.getString("Tooltips.Flip"),srcRest:uo(this.prefixUrl,d.flip.REST),srcGroup:uo(this.prefixUrl,d.flip.GROUP),srcHover:uo(this.prefixUrl,d.flip.HOVER),srcDown:uo(this.prefixUrl,d.flip.DOWN),onRelease:c,onFocus:u,onBlur:h})),m&&(this.buttons=new On.ButtonGroup({buttons:p,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",On.delegate(this,Co)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||On.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||On.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&0<=e&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(e,t,i,n){var o=On.isPlainObject(e)?e:{element:e,location:t,placement:i,onDraw:n};if(e=On.getElement(o.element),0<=Un(this.currentOverlays,e))return this;var r=Tn(this,o);return this.currentOverlays.push(r),r.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:o.location,placement:o.placement}),this},updateOverlay:function(e,t,i){var n;return e=On.getElement(e),0<=(n=Un(this.currentOverlays,e))&&(this.currentOverlays[n].update(t,i),Pn[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=On.getElement(e),0<=(t=Un(this.currentOverlays,e))&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),Pn[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return Pn[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){var t;return e=On.getElement(e),0<=(t=Un(this.currentOverlays,e))?this.currentOverlays[t]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<e?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=On.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=On.makeCenteredNode(t),On.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){for(var e=this.currentOverlays.length,t=0;t<e;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new On.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else On.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}}),_s=OpenSeadragon,_s.Navigator=function(e){var t,i,n,o,r,s,a=e.viewer,l=this;function c(e){et(l.displayRegionContainer,e),et(l.displayRegion,-e),l.viewport.setRotation(e)}e.id?(this.element=document.getElementById(e.id),e.controlOptions={anchor:_s.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(e.id="navigator-"+_s.now(),this.element=_s.makeNeutralElement("div"),e.controlOptions={anchor:_s.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:e.autoFade},e.position&&("BOTTOM_RIGHT"==e.position?e.controlOptions.anchor=_s.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==e.position?e.controlOptions.anchor=_s.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==e.position?e.controlOptions.anchor=_s.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==e.position?e.controlOptions.anchor=_s.ControlAnchor.TOP_LEFT:"ABSOLUTE"==e.position&&(e.controlOptions.anchor=_s.ControlAnchor.ABSOLUTE,e.controlOptions.top=e.top,e.controlOptions.left=e.left,e.controlOptions.height=e.height,e.controlOptions.width=e.width))),this.element.id=e.id,this.element.className+=" navigator",(e=_s.extend(!0,{sizeRatio:_s.DEFAULT_SETTINGS.navigatorSizeRatio},e,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:e.autoResize,minZoomImageRatio:1,background:e.background,opacity:e.opacity,borderColor:e.borderColor,displayRegionColor:e.displayRegionColor})).minPixelRatio=this.minPixelRatio=a.minPixelRatio,_s.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new _s.Point(1,1),this.totalBorderWidths=new _s.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),e.controlOptions.anchor!=_s.ControlAnchor.NONE&&(n=this.element.style,o=this.borderWidth,n.margin="0px",n.border=o+"px solid "+e.borderColor,n.padding="0px",n.background=e.background,n.opacity=e.opacity,n.overflow="hidden"),this.displayRegion=_s.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",r=this.displayRegion.style,s=this.borderWidth,r.position="relative",r.top="0px",r.left="0px",r.fontSize="0px",r.overflow="hidden",r.border=s+"px solid "+e.displayRegionColor,r.margin="0px",r.padding="0px",r.background="transparent",r.float="left",r.cssFloat="left",r.styleFloat="left",r.zIndex=999999999,r.cursor="default",this.displayRegionContainer=_s.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",a.addControl(this.element,e.controlOptions),this._resizeWithViewer=e.controlOptions.anchor!=_s.ControlAnchor.ABSOLUTE&&e.controlOptions.anchor!=_s.ControlAnchor.NONE,e.width&&e.height?(this.setWidth(e.width),this.setHeight(e.height)):this._resizeWithViewer&&(t=_s.getElementSize(a.element),this.element.style.height=Math.round(t.y*e.sizeRatio)+"px",this.element.style.width=Math.round(t.x*e.sizeRatio)+"px",this.oldViewerSize=t,i=_s.getElementSize(this.element),this.elementArea=i.x*i.y),this.oldContainerSize=new _s.Point(0,0),_s.Viewer.apply(this,[e]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),e.navigatorRotate&&(c(e.viewer.viewport?e.viewer.viewport.getRotation():e.viewer.degrees||0),e.viewer.addHandler("rotate",function(e){c(e.degrees)})),this.innerTracker.destroy(),this.innerTracker=new _s.MouseTracker({element:this.element,dragHandler:_s.delegate(this,bt),clickHandler:_s.delegate(this,at),releaseHandler:_s.delegate(this,ct),scrollHandler:_s.delegate(this,dt)}),this.addHandler("reset-size",function(){l.viewport&&l.viewport.goHome(!0)}),a.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=l.world.getItemAt(t.previousIndex);l.world.setItemIndex(e,t.newIndex)},1)}),a.world.addHandler("remove-item",function(e){var t=e.item,i=l._getMatchingItem(t);i&&l.world.removeItem(i)}),this.update(a.viewport)},_s.extend(_s.Navigator.prototype,_s.EventSource.prototype,_s.Viewer.prototype,{updateSize:function(){var e;this.viewport&&((e=new _s.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight)).equals(this.oldContainerSize)||(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw()))},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){ft(this.displayRegion,e),ft(this.canvas,e),ft(this.element,e)},update:function(e){var t,i,n,o,r,s,a,l,c=_s.getElementSize(this.viewer.element);this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,i=this.maintainSizeRatio||!this.elementArea?(t=c.x*this.sizeRatio,c.y*this.sizeRatio):(t=Math.sqrt(this.elementArea*(c.x/c.y)),this.elementArea/t),this.element.style.width=Math.round(t)+"px",this.element.style.height=Math.round(i)+"px",this.elementArea||(this.elementArea=t*i),this.updateSize()),e&&this.viewport&&(n=e.getBoundsNoRotate(!0),o=this.viewport.pixelFromPointNoRotate(n.getTopLeft(),!1),r=this.viewport.pixelFromPointNoRotate(n.getBottomRight(),!1).minus(this.totalBorderWidths),(s=this.displayRegion.style).display=this.world.getItemCount()?"block":"none",s.top=Math.round(o.y)+"px",s.left=Math.round(o.x)+"px",a=Math.abs(o.x-r.x),l=Math.abs(o.y-r.y),s.width=Math.round(Math.max(a,0))+"px",s.height=Math.round(Math.max(l,0))+"px")},addTiledImage:function(e){var n=this,o=e.originalTiledImage;delete e.original;var t=_s.extend({},e,{success:function(e){var t=e.item;function i(){n._matchBounds(t,o)}t._originalForNavigator=o,n._matchBounds(t,o,!0),o.addHandler("bounds-change",i),o.addHandler("clip-change",i),o.addHandler("opacity-change",function(){n._matchOpacity(t,o)}),o.addHandler("composite-operation-change",function(){n._matchCompositeOperation(t,o)})}});return _s.Viewer.prototype.addTiledImage.apply(this,[t])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}}),ru=OpenSeadragon,su={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}},ru.extend(ru,{getString:function(e){for(var t=e.split("."),i=null,n=arguments,o=su,r=0;r<t.length-1;r++)o=o[t[r]]||{};return"string"!=typeof(i=o[t[r]])&&(ru.console.log("Untranslated source string:",e),i=""),i.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<n.length?n[t]:""})},setString:function(e,t){for(var i=e.split("."),n=su,o=0;o<i.length-1;o++)n[i[o]]||(n[i[o]]={}),n=n[i[o]];n[i[o]]=t}}),Gu=OpenSeadragon,Gu.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},Gu.Point.prototype={clone:function(){return new Gu.Point(this.x,this.y)},plus:function(e){return new Gu.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new Gu.Point(this.x-e.x,this.y-e.y)},times:function(e){return new Gu.Point(this.x*e,this.y*e)},divide:function(e){return new Gu.Point(this.x/e,this.y/e)},negate:function(){return new Gu.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new Gu.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof Gu.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,t){if(t=t||new Gu.Point(0,0),e%90==0)switch(Gu.positiveModulo(e,360)){case 0:n=1,o=0;break;case 90:n=0,o=1;break;case 180:n=-1,o=0;break;case 270:n=0,o=-1}else var i=e*Math.PI/180,n=Math.cos(i),o=Math.sin(i);var r=n*(this.x-t.x)-o*(this.y-t.y)+t.x,s=o*(this.x-t.x)+n*(this.y-t.y)+t.y;return new Gu.Point(r,s)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}},Zu=OpenSeadragon,Zu.TileSource=function(e,t,i,n,o,r){var s,a=this,l=arguments,c=Zu.isPlainObject(e)?e:{width:l[0],height:l[1],tileSize:l[2],tileOverlap:l[3],minLevel:l[4],maxLevel:l[5]};if(Zu.EventSource.call(this),Zu.extend(!0,this,c),!this.success)for(s=0;s<arguments.length;s++)if(Zu.isFunction(arguments[s])){this.success=arguments[s];break}this.success&&this.addHandler("ready",function(e){a.success(e)}),"string"==Zu.type(e)&&(this.url=e),this.url?(this.aspectRatio=1,this.dimensions=new Zu.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=c.width&&c.height?c.width/c.height:1,this.dimensions=new Zu.Point(c.width,c.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=c.tileOverlap?c.tileOverlap:0,this.minLevel=c.minLevel?c.minLevel:0,this.maxLevel=void 0!==c.maxLevel&&null!==c.maxLevel?c.maxLevel:c.width&&c.height?Math.ceil(Math.log(Math.max(c.width,c.height))/Math.log(2)):0,this.success&&Zu.isFunction(this.success)&&this.success(this))},Zu.TileSource.prototype={getTileSize:function(e){return Zu.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){for(var t={},i=0;i<=this.maxLevel;i++)t[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(e){return t[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.getTileWidth(e)),n=Math.ceil(t*this.dimensions.y/this.getTileHeight(e));return new Zu.Point(i,n)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),i=1/t.x,n=1/t.y;return new Zu.Point(i,n)},getClosestLevel:function(){for(var e,t=this.minLevel+1;t<=this.maxLevel&&!(1<(e=this.getNumTiles(t)).x||1<e.y);t++);return t-1},getTileAtPoint:function(e,t){var i=0<=t.x&&t.x<=1&&0<=t.y&&t.y<=1/this.aspectRatio;Zu.console.assert(i,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(e),o=t.x*n,r=t.y*n,s=Math.floor(o/this.getTileWidth(e)),a=Math.floor(r/this.getTileHeight(e));1<=t.x&&(s=this.getNumTiles(e).x-1);return t.y>=1/this.aspectRatio-1e-15&&(a=this.getNumTiles(e).y-1),new Zu.Point(s,a)},getTileBounds:function(e,t,i,n){var o=this.dimensions.times(this.getLevelScale(e)),r=this.getTileWidth(e),s=this.getTileHeight(e),a=0===t?0:r*t-this.tileOverlap,l=0===i?0:s*i-this.tileOverlap,c=r+(0===t?1:2)*this.tileOverlap,u=s+(0===i?1:2)*this.tileOverlap,h=1/o.x,c=Math.min(c,o.x-a),u=Math.min(u,o.y-l);return n?new Zu.Rect(0,0,c,u):new Zu.Rect(a*h,l*h,c*h,u*h)},getImageInfo:function(n){var e,i,o,r,t,s,a,l=this;n&&-1<(a=(s=(t=n.split("/"))[t.length-1]).lastIndexOf("."))&&(t[t.length-1]=s.slice(0,a)),i=function(e){"string"==typeof e&&(e=Zu.parseXml(e));var t=Zu.TileSource.determineType(l,e,n);t?(void 0===(r=t.prototype.configure.apply(l,[e,n])).ajaxWithCredentials&&(r.ajaxWithCredentials=l.ajaxWithCredentials),o=new t(r),l.ready=!0,l.raiseEvent("ready",{tileSource:o})):l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n})},n.match(/\.js$/)?(e=n.split("/").pop().replace(".js",""),Zu.jsonp({url:n,async:!1,callbackName:e,callback:i})):Zu.makeAjaxRequest({url:n,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){var t=function(t){var e,i,n=t.responseText,o=t.status;{if(!t)throw new Error(Zu.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw o=t.status,e=404==o?"Not Found":t.statusText,new Error(Zu.getString("Errors.Status",o,e))}if(n.match(/\s*<.*/))try{i=t.responseXML&&t.responseXML.documentElement?t.responseXML:Zu.parseXml(n)}catch(e){i=t.responseText}else if(n.match(/\s*[\{\[].*/))try{i=Zu.parseJSON(n)}catch(e){i=n}else i=n;return i}(e);i(t)},error:function(e,t){var i;try{i="HTTP "+e.status+" attempting to load TileSource"}catch(e){i=(void 0!==t&&t.toString?t.toString():"Unknown error")+" attempting to load TileSource"}l.raiseEvent("open-failed",{message:i,source:n})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=t&&0<=i&&t<n.x&&i<n.y}},Zu.extend(!0,Zu.TileSource.prototype,Zu.EventSource.prototype),Zu.TileSource.determineType=function(e,t,i){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&Zu.isFunction(OpenSeadragon[n])&&Zu.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n];Zu.console.error("No TileSource was able to open %s %s",i,t)},Lw=OpenSeadragon,Lw.DziTileSource=function(e,t,i,n,o,r,s,a,l){var c,u,h,d=Lw.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o,fileFormat:r,displayRects:s,minLevel:a,maxLevel:l};if(this._levelRects={},this.tilesUrl=d.tilesUrl,this.fileFormat=d.fileFormat,this.displayRects=d.displayRects,this.displayRects)for(c=this.displayRects.length-1;0<=c;c--)for(h=(u=this.displayRects[c]).minLevel;h<=u.maxLevel;h++)this._levelRects[h]||(this._levelRects[h]=[]),this._levelRects[h].push(u);Lw.TileSource.apply(this,[d])},Lw.extend(Lw.DziTileSource.prototype,Lw.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(i=e.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(e,t){var i=(Lw.isPlainObject(e)?Nw:function(e,t){if(!t||!t.documentElement)throw new Error(Lw.getString("Errors.Xml"));var i,n,o,r,s,a=t.documentElement,l=a.localName||a.tagName,c=t.documentElement.namespaceURI,u=null,h=[];if("Image"==l)try{if(void 0===(r=a.getElementsByTagName("Size")[0])&&(r=a.getElementsByTagNameNS(c,"Size")[0]),u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(r.getAttribute("Height"),10),Width:parseInt(r.getAttribute("Width"),10)}}},!Lw.imageFormatSupported(u.Image.Format))throw new Error(Lw.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(void 0===(i=a.getElementsByTagName("DisplayRect"))&&(i=a.getElementsByTagNameNS(c,"DisplayRect")[0]),s=0;s<i.length;s++)n=i[s],void 0===(o=n.getElementsByTagName("Rect")[0])&&(o=n.getElementsByTagNameNS(c,"Rect")[0]),h.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(n.getAttribute("MinLevel"),10),MaxLevel:parseInt(n.getAttribute("MaxLevel"),10)}});return h.length&&(u.Image.DisplayRect=h),Nw(0,u)}catch(e){throw e instanceof Error?e:new Error(Lw.getString("Errors.Dzi"))}else{if("Collection"==l)throw new Error(Lw.getString("Errors.Dzc"));if("Error"==l){var d=a.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(d)}}throw new Error(Lw.getString("Errors.Dzi"))})(this,e);return t&&!i.tilesUrl&&(i.tilesUrl=t.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=t.search(/\.(dzi|xml|js)\?/)?i.queryParams=t.match(/\?.*/):i.queryParams=""),i},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,c,u=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!u||!u.length)return!0;for(c=u.length-1;0<=c;c--)if(!(e<(n=u[c]).minLevel||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,a=r+n.width*o,l=s+n.height*o,r=Math.floor(r/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),r<=t&&t<a&&s<=i&&i<l))return!0;return!1}}),Wx=OpenSeadragon,Wx.IIIFTileSource=function(e){if(Wx.extend(!0,this,e),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(e.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=e.version,this.tile_width&&this.tile_height)e.tileWidth=this.tile_width,e.tileHeight=this.tile_height;else if(this.tile_width)e.tileSize=this.tile_width;else if(this.tile_height)e.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)e.tileWidth=this.tiles[0].width,e.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var i=0;i<this.tiles[t].scaleFactors.length;i++){var n=this.tiles[t].scaleFactors[i];this.scale_factors.push(n),e.tileSizePerScaleFactor[n]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(Xx(e)){for(var o=Math.min(this.height,this.width),r=[256,512,1024],s=[],a=0;a<r.length;a++)r[a]<=o&&s.push(r[a]);0<s.length?e.tileSize=Math.max.apply(null,s):e.tileSize=o}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,e.levels=Yx(this),Wx.extend(!0,e,{width:e.levels[e.levels.length-1].width,height:e.levels[e.levels.length-1].height,tileSize:Math.max(e.height,e.width),tileOverlap:0,minLevel:0,maxLevel:e.levels.length-1}),this.levels=e.levels):Wx.console.error("Nothing in the info.json to construct image pyramids from");var l;e.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?(l=Math.max.apply(null,this.scale_factors),e.maxLevel=Math.round(Math.log(l)*Math.LOG2E)):e.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),Wx.TileSource.apply(this,[e])},Wx.extend(Wx.IIIFTileSource.prototype,Wx.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!=e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI))))},configure:function(e,t){if(Wx.isPlainObject(e)){if(e["@context"]){var i=e["@context"];if(Array.isArray(i))for(var n=0;n<i.length;n++)if("string"==typeof i[n]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(i[n])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===i[n])){i=i[n];break}switch(i){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":e.version=1;break;case"http://iiif.io/api/image/2/context.json":e.version=2;break;case"http://iiif.io/api/image/3/context.json":e.version=3;break;default:Wx.console.error("Data has a @context property which contains no known IIIF context URI.")}}else e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=t.replace("/info.json",""),e.version=1;if(!e["@id"]&&e.id&&(e["@id"]=e.id),e.preferredFormats)for(var o=0;o<e.preferredFormats.length;o++)if(OpenSeadragon.imageFormatSupported(e.preferredFormats[o])){e.tileFormat=e.preferredFormats[o];break}return e}var r=function(e){if(!e||!e.documentElement)throw new Error(Wx.getString("Errors.Xml"));var t=e.documentElement,i=t.tagName,n=null;if("info"==i)try{return function e(t,i,n){var o,r;if(3==t.nodeType&&n)(r=t.nodeValue.trim()).match(/^\d*$/)&&(r=Number(r)),i[n]?(Wx.isArray(i[n])||(i[n]=[i[n]]),i[n].push(r)):i[n]=r;else if(1==t.nodeType)for(o=0;o<t.childNodes.length;o++)e(t.childNodes[o],i,t.nodeName)}(t,n={}),n}catch(e){throw e instanceof Error?e:new Error(Wx.getString("Errors.IIIF"))}throw new Error(Wx.getString("Errors.IIIF"))}(e);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=t.replace("/info.xml",""),r.version=1,r},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return Wx.TileSource.prototype.getTileWidth.call(this,e);var t=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[t]?this.tileSizePerScaleFactor[t].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return Wx.TileSource.prototype.getTileHeight.call(this,e);var t=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[t]?this.tileSizePerScaleFactor[t].height:this._tileHeight},getLevelScale:function(e){if(this.emulateLegacyImagePyramid){var t=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t}return Wx.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){return this.emulateLegacyImagePyramid?this.getLevelScale(e)?new Wx.Point(1,1):new Wx.Point(0,0):Wx.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,t){return this.emulateLegacyImagePyramid?new Wx.Point(0,0):Wx.TileSource.prototype.getTileAtPoint.call(this,e,t)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var o,r,s,a,l,c,u,h,d=Math.pow(.5,this.maxLevel-e),p=Math.ceil(this.width*d),m=Math.ceil(this.height*d),g=this.getTileWidth(e),v=this.getTileHeight(e),f=Math.ceil(g/d),y=Math.ceil(v/d),w=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat;return p<g&&m<v?(c=2===this.version&&p===this.width||3===this.version&&p===this.width&&m===this.height?"max":3===this.version?p+","+m:p+",",o="full"):(r=t*f,s=i*y,a=Math.min(f,this.width-r),l=Math.min(y,this.height-s),o=0===t&&0===i&&a===this.width&&l===this.height?"full":[r,s,a,l].join(","),u=Math.ceil(a*d),h=Math.ceil(l*d),c=2===this.version&&u===this.width||3===this.version&&u===this.width&&h===this.height?"max":3===this.version?u+","+h:u+","),[this["@id"],o,c,"0",w].join("/")},__testonly__:{canBeTiled:Xx,constructLevels:Yx}}),oz=OpenSeadragon,oz.OsmTileSource=function(e,t,i,n,o){var r=oz.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o};r.width&&r.height||(r.width=65572864,r.height=65572864),r.tileSize||(r.tileSize=256,r.tileOverlap=0),r.tilesUrl||(r.tilesUrl="http://tile.openstreetmap.org/"),r.minLevel=8,oz.TileSource.apply(this,[r])},oz.extend(oz.OsmTileSource.prototype,oz.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}}),Cz=OpenSeadragon,Cz.TmsTileSource=function(e,t,i,n,o){var r=Cz.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o},s=256*Math.ceil(r.width/256),a=256*Math.ceil(r.height/256),l=a<s?s/256:a/256;r.maxLevel=Math.ceil(Math.log(l)/Math.log(2))-1,r.tileSize=256,r.width=s,r.height=a,Cz.TileSource.apply(this,[r])},Cz.extend(Cz.TmsTileSource.prototype,Cz.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}}),Uz=OpenSeadragon,Uz.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},Uz.extend(Uz.ZoomifyTileSource.prototype,Uz.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,o={},r=0;r<e;r++)n+=(o=this.gridSize[r]).x*o.y;return n+=(o=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this._calculateAbsoluteTileNumber(e,t,i),o=Math.floor(n/256);return this.tilesUrl+"TileGroup"+o+"/"+e+"-"+t+"-"+i+".jpg"}}),nA=OpenSeadragon,nA.LegacyTileSource=function(e){var t,i,n;nA.isArray(e)&&(t={type:"legacy-image-pyramid",levels:e}),t.levels=function(e){var t,i,n=[];for(i=0;i<e.length;i++)(t=e[i]).height&&t.width&&t.url?n.push({url:t.url,width:Number(t.width),height:Number(t.height)}):nA.console.error("Unsupported image format: %s",t.url?t.url:"<no URL>");return n.sort(function(e,t){return e.height-t.height})}(t.levels),0<t.levels.length?(i=t.levels[t.levels.length-1].width,n=t.levels[t.levels.length-1].height):(n=i=0,nA.console.error("No supported image formats found")),nA.extend(!0,t,{width:i,height:n,tileSize:Math.max(n,i),tileOverlap:0,minLevel:0,maxLevel:0<t.levels.length?t.levels.length-1:0}),nA.TileSource.apply(this,[t]),this.levels=t.levels},nA.extend(nA.LegacyTileSource.prototype,nA.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(e,t){var i=nA.isPlainObject(e)?e.levels:function(e,t){if(!t||!t.documentElement)throw new Error(nA.getString("Errors.Xml"));var i,n,o=t.documentElement,r=o.tagName,s=null,a=[];if("image"==r)try{for(s={type:o.getAttribute("type"),levels:[]},a=o.getElementsByTagName("level"),n=0;n<a.length;n++)i=a[n],s.levels.push({url:i.getAttribute("url"),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10)});return qA(0,s)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==r)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==r)throw new Error("Error: "+t)}throw new Error("Unknown element "+r)}(this,e);return i},getLevelScale:function(e){var t=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){return this.getLevelScale(e)?new nA.Point(1,1):new nA.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}}),ZA=OpenSeadragon,ZA.ImageTileSource=function(e){e=ZA.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),ZA.TileSource.apply(this,[e])},ZA.extend(ZA.ImageTileSource.prototype,ZA.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(e){var t=this._image=new Image,i=this;this.crossOriginPolicy&&(t.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(t.useCredentials=this.ajaxWithCredentials),ZA.addEvent(t,"load",function(){i.width=Object.prototype.hasOwnProperty.call(t,"naturalWidth")?t.naturalWidth:t.width,i.height=Object.prototype.hasOwnProperty.call(t,"naturalHeight")?t.naturalHeight:t.height,i.aspectRatio=i.width/i.height,i.dimensions=new ZA.Point(i.width,i.height),i._tileWidth=i.width,i._tileHeight=i.height,i.tileOverlap=0,i.minLevel=0,i.levels=i._buildLevels(),i.maxLevel=i.levels.length-1,i.ready=!0,i.raiseEvent("ready",{tileSource:i})}),ZA.addEvent(t,"error",function(){i.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),t.src=e},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){return this.getLevelScale(e)?new ZA.Point(1,1):new ZA.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n},getContext2D:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].context2D),n},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!ZA.supportsCanvas||!this.useCanvas)return delete this._image,e;var t=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,i=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,n=document.createElement("canvas"),o=n.getContext("2d");if(n.width=t,n.height=i,o.drawImage(this._image,0,0,t,i),e[0].context2D=o,delete this._image,ZA.isCanvasTainted(n))return e;for(;2<=t&&2<=i;){t=Math.floor(t/2),i=Math.floor(i/2);var r=document.createElement("canvas"),s=r.getContext("2d");r.width=t,r.height=i,s.drawImage(n,0,0,t,i),e.splice(0,0,{context2D:s,width:t,height:i}),n=r,o=s}return e}}),zB=OpenSeadragon,zB.TileSourceCollection=function(e,t,i,n){zB.console.error("TileSourceCollection is deprecated; use World instead")},EB=OpenSeadragon,EB.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},EB.Button=function(e){var t=this;EB.EventSource.call(this),EB.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:EB.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:EB.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},e),this.element=e.element||EB.makeNeutralElement("div"),e.element||(this.imgRest=EB.makeTransparentImage(this.srcRest),this.imgGroup=EB.makeTransparentImage(this.srcGroup),this.imgHover=EB.makeTransparentImage(this.srcHover),this.imgDown=EB.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",EB.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",EB.Browser.vendor==EB.BROWSERS.FIREFOX&&EB.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=EB.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new EB.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(JB(t,EB.ButtonState.DOWN),t.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||JB(t,EB.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),t.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(e){KB(t,EB.ButtonState.GROUP),e.insideElementPressed&&t.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(e){this.exitHandler(e),t.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(e){JB(t,EB.ButtonState.DOWN),t.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(KB(t,EB.ButtonState.HOVER),t.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?KB(t,EB.ButtonState.GROUP):JB(t,EB.ButtonState.HOVER)},clickHandler:function(e){e.quick&&t.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(t.raiseEvent("click",{originalEvent:e.originalEvent}),t.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),KB(this,EB.ButtonState.REST)},EB.extend(EB.Button.prototype,EB.EventSource.prototype,{notifyGroupEnter:function(){JB(this,EB.ButtonState.GROUP)},notifyGroupExit:function(){KB(this,EB.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,EB.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,EB.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}}),eC=OpenSeadragon,eC.ButtonGroup=function(e){eC.extend(!0,this,{buttons:[],clickTimeThreshold:eC.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:eC.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var t,i=this.buttons.concat([]),n=this;if(this.element=e.element||eC.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",t=0;t<i.length;t++)this.element.appendChild(i[t].element);eC.setElementTouchActionNone(this.element),this.tracker=new eC.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){for(var t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},eC.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}},nC=OpenSeadragon,nC.Rect=function(e,t,i,n,o){var r,s;this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof o?o:0,this.degrees=nC.positiveModulo(this.degrees,360),270<=this.degrees?(r=this.getTopRight(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):180<=this.degrees?(r=this.getBottomRight(),this.x=r.x,this.y=r.y,this.degrees-=180):90<=this.degrees&&(r=this.getBottomLeft(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},nC.Rect.fromSummits=function(e,t,i){var n=e.distanceTo(t),o=e.distanceTo(i),r=t.minus(e),s=Math.atan(r.y/r.x);return r.x<0?s+=Math.PI:r.y<0&&(s+=2*Math.PI),new nC.Rect(e.x,e.y,n,o,s/Math.PI*180)},nC.Rect.prototype={clone:function(){return new nC.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new nC.Point(this.x,this.y)},getBottomRight:function(){return new nC.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new nC.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new nC.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new nC.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new nC.Point(this.width,this.height)},equals:function(e){return e instanceof nC.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new nC.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new nC.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var t=this.getBoundingBox(),i=e.getBoundingBox(),n=Math.min(t.x,i.x),o=Math.min(t.y,i.y),r=Math.max(t.x+t.width,i.x+i.width),s=Math.max(t.y+t.height,i.y+i.height);return new nC.Rect(n,o,r-n,s-o)},intersection:function(e){var c=1e-10,t=[],i=this.getTopLeft();e.containsPoint(i,c)&&t.push(i);var n=this.getTopRight();e.containsPoint(n,c)&&t.push(n);var o=this.getBottomLeft();e.containsPoint(o,c)&&t.push(o);var r=this.getBottomRight();e.containsPoint(r,c)&&t.push(r);var s=e.getTopLeft();this.containsPoint(s,c)&&t.push(s);var a=e.getTopRight();this.containsPoint(a,c)&&t.push(a);var l=e.getBottomLeft();this.containsPoint(l,c)&&t.push(l);var u=e.getBottomRight();this.containsPoint(u,c)&&t.push(u);for(var h=this._getSegments(),d=e._getSegments(),p=0;p<h.length;p++)for(var m=h[p],g=0;g<d.length;g++){var v=d[g],f=function(e,t,i,n){var o=t.minus(e),r=n.minus(i),s=-r.x*o.y+o.x*r.y;if(0==s)return null;var a=(o.x*(e.y-i.y)-o.y*(e.x-i.x))/s,l=(r.x*(e.y-i.y)-r.y*(e.x-i.x))/s;if(-c<=a&&a<=1-c&&-c<=l&&l<=1-c)return new nC.Point(e.x+l*o.x,e.y+l*o.y);return null}(m[0],m[1],v[0],v[1]);f&&t.push(f)}if(0===t.length)return null;for(var y=t[0].x,w=t[0].x,b=t[0].y,_=t[0].y,x=1;x<t.length;x++){var S=t[x];S.x<y&&(y=S.x),S.x>w&&(w=S.x),S.y<b&&(b=S.y),S.y>_&&(_=S.y)}return new nC.Rect(y,b,w-y,_-b)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(e,t){if(0===(e=nC.positiveModulo(e,360)))return this.clone();t=t||this.getCenter();var i=this.getTopLeft().rotate(e,t),n=(n=this.getTopRight().rotate(e,t).minus(i)).apply(function(e){return Math.abs(e)<1e-15?0:e}),o=Math.atan(n.y/n.x);return n.x<0?o+=Math.PI:n.y<0&&(o+=2*Math.PI),new nC.Rect(i.x,i.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight(),o=Math.min(e.x,t.x,i.x,n.x),r=Math.max(e.x,t.x,i.x,n.x),s=Math.min(e.y,t.y,i.y,n.y),a=Math.max(e.y,t.y,i.y,n.y);return new nC.Rect(o,s,r-o,a-s)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),t=Math.floor(e.x),i=Math.floor(e.y),n=Math.ceil(e.width+e.x-t),o=Math.ceil(e.height+e.y-i);return new nC.Rect(t,i,n,o)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),o=this.getBottomLeft(),r=n.minus(i),s=o.minus(i);return(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-n.x)*r.x+(e.y-n.y)*r.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-o.x)*s.x+(e.y-o.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}},YD=OpenSeadragon,ZD={},YD.ReferenceStrip=function(e){var t,i,n,r=e.viewer,o=YD.getElementSize(r.element);for(e.id||(e.id="referencestrip-"+YD.now(),this.element=YD.makeNeutralElement("div"),this.element.id=e.id,this.element.className="referencestrip"),e=YD.extend(!0,{sizeRatio:YD.DEFAULT_SETTINGS.referenceStripSizeRatio,position:YD.DEFAULT_SETTINGS.referenceStripPosition,scroll:YD.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:YD.DEFAULT_SETTINGS.clickTimeThreshold},e,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),YD.extend(this,e),ZD[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(i=this.element.style).marginTop="0px",i.marginRight="0px",i.marginBottom="0px",i.marginLeft="0px",i.left="0px",i.bottom="0px",i.border="0px",i.background="#000",i.position="relative",YD.setElementTouchActionNone(this.element),YD.setElementOpacity(this.element,.8),this.viewer=r,this.innerTracker=new YD.MouseTracker({element:this.element,dragHandler:YD.delegate(this,$D),scrollHandler:YD.delegate(this,_D),enterHandler:YD.delegate(this,bE),exitHandler:YD.delegate(this,cE),keyDownHandler:YD.delegate(this,dE),keyHandler:YD.delegate(this,eE)}),e.width&&e.height?(this.element.style.width=e.width+"px",this.element.style.height=e.height+"px",r.addControl(this.element,{anchor:YD.ControlAnchor.BOTTOM_LEFT})):"horizontal"==e.scroll?(this.element.style.width=o.x*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.height=o.y*e.sizeRatio+"px",r.addControl(this.element,{anchor:YD.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=o.y*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.width=o.x*e.sizeRatio+"px",r.addControl(this.element,{anchor:YD.ControlAnchor.TOP_LEFT})),this.panelWidth=o.x*this.sizeRatio+8,this.panelHeight=o.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},n=0;n<r.tileSources.length;n++)(t=YD.makeNeutralElement("div")).id=this.element.id+"-"+n,t.style.width=this.panelWidth+"px",t.style.height=this.panelHeight+"px",t.style.display="inline",t.style.float="left",t.style.cssFloat="left",t.style.styleFloat="left",t.style.padding="2px",YD.setElementTouchActionNone(t),t.innerTracker=new YD.MouseTracker({element:t,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.eventSource.dragging=YD.now()},releaseHandler:function(e){var t=e.eventSource,i=t.element.id,n=Number(i.split("-")[2]),o=YD.now();e.insideElementPressed&&e.insideElementReleased&&t.dragging&&o-t.dragging<t.clickTimeThreshold&&(t.dragging=null,r.goToPage(n))}}),this.element.appendChild(t),t.activePanel=!1,this.panels.push(t);aE(this,"vertical"==this.scroll?o.y:o.x,0),this.setFocus(0)},YD.extend(YD.ReferenceStrip.prototype,YD.EventSource.prototype,YD.Viewer.prototype,{setFocus:function(e){var t,i=this.element.querySelector("#"+this.element.id+"-"+e),n=YD.getElementSize(this.viewer.canvas),o=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),s=-Number(this.element.style.marginLeft.replace("px","")),a=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==i&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=i,this.currentSelected.style.background="#999","horizontal"==this.scroll?(t=Number(e)*(this.panelWidth+3))>s+n.x-this.panelWidth?(t=Math.min(t,o-n.x),this.element.style.marginLeft=-t+"px",aE(this,n.x,-t)):t<s&&(t=Math.max(0,t-n.x/2),this.element.style.marginLeft=-t+"px",aE(this,n.x,-t)):(t=Number(e)*(this.panelHeight+3))>a+n.y-this.panelHeight?(t=Math.min(t,r-n.y),this.element.style.marginTop=-t+"px",aE(this,n.y,-t)):t<a&&(t=Math.max(0,t-n.y/2),this.element.style.marginTop=-t+"px",aE(this,n.y,-t)),this.currentPage=e,bE.call(this,{eventSource:this.innerTracker}))},update:function(){return!!ZD[this.id].animating&&(YD.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}}),dF=OpenSeadragon,dF.DisplayRect=function(e,t,i,n,o,r){dF.Rect.apply(this,[e,t,i,n]),this.minLevel=o,this.maxLevel=r},dF.extend(dF.DisplayRect.prototype,dF.Rect.prototype),kF=OpenSeadragon,kF.Spring=function(e){var t=arguments;"object"!=typeof e&&(e={initial:t.length&&"number"==typeof t[0]?t[0]:void 0,springStiffness:1<t.length?t[1].springStiffness:5,animationTime:1<t.length?t[1].animationTime:1.5}),kF.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),kF.console.assert("number"==typeof e.animationTime&&0<=e.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),kF.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:kF.now()},kF.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},kF.Spring.prototype={resetTo:function(e){kF.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=kF.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){kF.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(kF.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(kF.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var e,t;this.current.time=kF.now(),t=this._exponential?(e=this.start._logValue,this.target._logValue):(e=this.start.value,this.target.value);var i,n,o=this.current.time>=this.target.time?t:e+(t-e)*(i=this.springStiffness,n=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(i*-n))/(1-Math.exp(-i))),r=this.current.value;return this._exponential?this.current.value=Math.exp(o):this.current.value=o,r!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}},yF=OpenSeadragon,zF.prototype={errorMsg:null,start:function(){var r=this,e=this.abort;this.image=new Image,this.image.onload=function(){r.finish(!0)},this.image.onabort=this.image.onerror=function(){r.errorMsg="Image load aborted",r.finish(!1)},this.jobId=window.setTimeout(function(){r.errorMsg="Image load exceeded timeout ("+r.timeout+" ms)",r.finish(!1)},this.timeout),this.loadWithAjax?(this.request=yF.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(t){var i;try{i=new window.Blob([t.response])}catch(e){var n,o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===e.name&&o&&((n=new o).append(t.response),i=n.getBlob())}0===i.size&&(r.errorMsg="Empty image response.",r.finish(!1));var e=(window.URL||window.webkitURL).createObjectURL(i);r.image.src=e},error:function(e){r.errorMsg="Image load aborted - XHR error",r.finish(!1)}}),this.abort=function(){r.request.abort(),"function"==typeof e&&e()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},yF.ImageLoader=function(e){yF.extend(!0,this,{jobLimit:yF.DEFAULT_SETTINGS.imageLoaderLimit,timeout:yF.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},yF.ImageLoader.prototype={addJob:function(t){var i=this,e=new zF({src:t.src,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(e){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&0<e.jobQueue.length&&(e.jobQueue.shift().start(),e.jobsInProgress++);i(t.image,t.errorMsg,t.request)}(i,e,t.callback)},abort:t.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(e.start(),this.jobsInProgress++):this.jobQueue.push(e)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}},ZF=OpenSeadragon,ZF.Tile=function(e,t,i,n,o,r,s,a,l,c){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=c,this.exists=o,this.url=r,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},ZF.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){this.cacheImageRecord?this.loaded?(this.element||(this.element=ZF.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",ZF.setElementOpacity(this.element,this.opacity)):ZF.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):ZF.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,t,i,n){var o,r,s,a=this.position.times(ZF.pixelDensityRatio),l=this.size.times(ZF.pixelDensityRatio);this.context2D||this.cacheImageRecord?(s=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&s?(e.save(),e.globalAlpha=this.opacity,"number"==typeof i&&1!==i&&(a=a.times(i),l=l.times(i)),n instanceof ZF.Point&&(a=a.plus(n)),1===e.globalAlpha&&this._hasTransparencyChannel()&&e.clearRect(a.x,a.y,l.x,l.y),t({context:e,tile:this,rendered:s}),r=this.sourceBounds?(o=Math.min(this.sourceBounds.width,s.canvas.width),Math.min(this.sourceBounds.height,s.canvas.height)):(o=s.canvas.width,s.canvas.height),e.drawImage(s.canvas,0,0,o,r,a.x,a.y,l.x,l.y),e.restore()):ZF.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):ZF.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return ZF.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*ZF.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,t,i){var n=Math.max(1,Math.ceil((i.x-t.x)/2)),o=Math.max(1,Math.ceil((i.y-t.y)/2));return new ZF.Point(n,o).minus(this.position.times(ZF.pixelDensityRatio).times(e||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}},zG=OpenSeadragon,zG.OverlayPlacement=zG.Placement,zG.OverlayRotationMode=zG.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),zG.Overlay=function(e,t,i){var n=zG.isPlainObject(e)?e:{element:e,location:t,placement:i};this.element=n.element,this.style=n.element.style,this._init(n)},zG.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=void 0===e.placement?zG.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=void 0===e.checkResize||e.checkResize,this.width=void 0===e.width?null:e.width,this.height=void 0===e.height?null:e.height,this.rotationMode=e.rotationMode||zG.OverlayRotationMode.EXACT,this.location instanceof zG.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=zG.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new zG.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,t){var i=zG.Placement.properties[this.placement];i&&(i.isHorizontallyCentered?e.x-=t.x/2:i.isRight&&(e.x-=t.x),i.isVerticallyCentered?e.y-=t.y/2:i.isBottom&&(e.y-=t.y))},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),this.onDraw=null,t.top="",t.left="",t.position="",null!==this.width&&(t.width=""),null!==this.height&&(t.height="");var i=zG.getCssPropertyWithVendorPrefix("transformOrigin"),n=zG.getCssPropertyWithVendorPrefix("transform");i&&n&&(t[i]="",t[n]="")},drawHTML:function(e,t){var i=this.element;i.parentNode!==e&&(i.prevElementParent=i.parentNode,i.prevNextSibling=i.nextSibling,e.appendChild(i),this.style.position="absolute",this.size=zG.getElementSize(i));var n,o,r,s=this._getOverlayPositionAndSize(t),a=s.position,l=this.size=s.size,c=s.rotate;this.onDraw?this.onDraw(a,l,this.element):((n=this.style).left=a.x+"px",n.top=a.y+"px",null!==this.width&&(n.width=l.x+"px"),null!==this.height&&(n.height=l.y+"px"),o=zG.getCssPropertyWithVendorPrefix("transformOrigin"),r=zG.getCssPropertyWithVendorPrefix("transform"),o&&r&&(c?(n[o]=this._getTransformOrigin(),n[r]="rotate("+c+"deg)"):(n[o]="",n[r]="")),"none"!==n.display&&(n.display="block"))},_getOverlayPositionAndSize:function(e){var t=e.pixelFromPoint(this.location,!0),i=this._getSizeInPixels(e);this.adjust(t,i);var n,o,r=0;return e.degrees&&this.rotationMode!==zG.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===zG.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height?(n=new zG.Rect(t.x,t.y,i.x,i.y),t=(o=this._getBoundingBox(n,e.degrees)).getTopLeft(),i=o.getSize()):r=e.degrees),{position:t,size:i,rotate:r}},_getSizeInPixels:function(e){var t,i,n=this.size.x,o=this.size.y;return null===this.width&&null===this.height||(t=e.deltaPixelsFromPointsNoRotate(new zG.Point(this.width||0,this.height||0),!0),null!==this.width&&(n=t.x),null!==this.height&&(o=t.y)),!this.checkResize||null!==this.width&&null!==this.height||(i=this.size=zG.getElementSize(this.element),null===this.width&&(n=i.x),null===this.height&&(o=i.y)),new zG.Point(n,o)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(e){var t=new zG.Point(e.x,e.y),i=zG.Placement.properties[this.placement];return i&&(i.isHorizontallyCentered?t.x+=e.width/2:i.isRight&&(t.x+=e.width),i.isVerticallyCentered?t.y+=e.height/2:i.isBottom&&(t.y+=e.height)),t},_getTransformOrigin:function(){var e="",t=zG.Placement.properties[this.placement];return t&&(t.isLeft?e="left":t.isRight&&(e="right"),t.isTop?e+=" top":t.isBottom&&(e+=" bottom")),e},update:function(e,t){var i=zG.isPlainObject(e)?e:{location:e,placement:t};this._init({location:i.location||this.location,placement:void 0!==i.placement?i.placement:this.placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:void 0!==i.width?i.width:this.width,height:void 0!==i.height?i.height:this.height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(e){zG.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var t,i=this.width,n=this.height;null!==i&&null!==n||(t=e.deltaPointsFromPixelsNoRotate(this.size,!0),null===i&&(i=t.x),null===n&&(n=t.y));var o=this.location.clone();return this.adjust(o,new zG.Point(i,n)),this._adjustBoundsForRotation(e,new zG.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(e,t){if(!e||0===e.degrees||this.rotationMode===zG.OverlayRotationMode.EXACT)return t;if(this.rotationMode!==zG.OverlayRotationMode.BOUNDING_BOX)return t.rotate(-e.degrees,this._getPlacementPoint(t));if(null===this.width||null===this.height)return t;var i=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new zG.Rect(i.position.x,i.position.y,i.size.x,i.size.y))}},yH=OpenSeadragon,yH.Drawer=function(e){yH.console.assert(e.viewer,"[Drawer] options.viewer is required");var t,i=arguments;yH.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),yH.console.assert(e.viewport,"[Drawer] options.viewport is required"),yH.console.assert(e.element,"[Drawer] options.element is required"),e.source&&yH.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor="string"==typeof e.debugGridColor?[e.debugGridColor]:e.debugGridColor||yH.DEFAULT_SETTINGS.debugGridColor,e.opacity&&yH.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=yH.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=yH.getElement(e.element),this.canvas=yH.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(t=this._calculateCanvasSize(),this.canvas.width=t.x,this.canvas.height=t.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",yH.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},yH.Drawer.prototype={addOverlay:function(e,t,i,n){return yH.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,t,i,n),this},updateOverlay:function(e,t,i){return yH.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,t,i),this},removeOverlay:function(e){return yH.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return yH.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(e){var t=this.viewport.pixelFromPointNoRotate(e,!0);return new yH.Point(t.x*yH.pixelDensityRatio,t.y*yH.pixelDensityRatio)},clipWithPolygons:function(e,t){var i;this.useCanvas&&((i=this._getContext(t)).beginPath(),e.forEach(function(e){e.forEach(function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)})}),i.clip())},setOpacity:function(e){yH.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var t=this.viewer.world,i=0;i<t.getItemCount();i++)t.getItemAt(i).setOpacity(e);return this},getOpacity:function(){yH.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,t=0,i=0;i<e.getItemCount();i++){var n=e.getItemAt(i).getOpacity();t<n&&(t=n)}return t},needsUpdate:function(){return yH.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return yH.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return yH.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return yH.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){var e,t;this.canvas.innerHTML="",this.useCanvas&&(e=this._calculateCanvasSize(),this.canvas.width==e.x&&this.canvas.height==e.y||(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear())},_clear:function(e,t){var i,n;this.useCanvas&&(i=this._getContext(e),t?i.clearRect(t.x,t.y,t.width,t.height):(n=i.canvas,i.clearRect(0,0,n.width,n.height)))},viewportToDrawerRectangle:function(e){var t=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),i=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new yH.Rect(t.x*yH.pixelDensityRatio,t.y*yH.pixelDensityRatio,i.x*yH.pixelDensityRatio,i.y*yH.pixelDensityRatio)},drawTile:function(e,t,i,n,o){var r;yH.console.assert(e,"[Drawer.drawTile] tile is required"),yH.console.assert(t,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(r=this._getContext(i),n=n||1,e.drawCanvas(r,t,n,o)):e.drawHTML(this.canvas)},_getContext:function(e){var t,i,n=this.context;return e&&(null===this.sketchCanvas&&(this.sketchCanvas=document.createElement("canvas"),t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()&&(i=this).viewer.addHandler("rotate",function e(){var t;0!==i.viewport.getRotation()&&(i.viewer.removeHandler("rotate",e),t=i._calculateSketchCanvasSize(),i.sketchCanvas.width=t.x,i.sketchCanvas.height=t.y)}),this._updateImageSmoothingEnabled(this.sketchContext)),n=this.sketchContext),n},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){var i;this.useCanvas&&((i=this._getContext(t)).beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip())},drawRectangle:function(e,t,i){var n;this.useCanvas&&((n=this._getContext(i)).save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore())},blendSketch:function(e,t,i,n){var o,r,s,a,l,c,u=e;yH.isPlainObject(u)||(u={opacity:e,scale:t,translate:i,compositeOperation:n}),this.useCanvas&&this.sketchCanvas&&(e=u.opacity,n=u.compositeOperation,o=u.bounds,this.context.save(),this.context.globalAlpha=e,n&&(this.context.globalCompositeOperation=n),o?(o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height)):(t=u.scale||1,r=(i=u.translate)instanceof yH.Point?i:new yH.Point(0,0),c=l=0,i&&(s=this.sketchCanvas.width-this.canvas.width,a=this.sketchCanvas.height-this.canvas.height,l=Math.round(s/2),c=Math.round(a/2)),this.context.drawImage(this.sketchCanvas,r.x-l*t,r.y-c*t,(this.canvas.width+2*l)*t,(this.canvas.height+2*c)*t,-l,-c,this.canvas.width+2*l,this.canvas.height+2*c)),this.context.restore())},drawDebugInfo:function(e,t,i,n){var o,r,s,a;this.useCanvas&&(o=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,(r=this.context).save(),r.lineWidth=2*yH.pixelDensityRatio,r.font="small-caps bold "+13*yH.pixelDensityRatio+"px arial",r.strokeStyle=this.debugGridColor[o],r.fillStyle=this.debugGridColor[o],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),r.strokeRect(e.position.x*yH.pixelDensityRatio,e.position.y*yH.pixelDensityRatio,e.size.x*yH.pixelDensityRatio,e.size.y*yH.pixelDensityRatio),s=(e.position.x+e.size.x/2)*yH.pixelDensityRatio,a=(e.position.y+e.size.y/2)*yH.pixelDensityRatio,r.translate(s,a),r.rotate(Math.PI/180*-this.viewport.degrees),r.translate(-s,-a),0===e.x&&0===e.y&&(r.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*yH.pixelDensityRatio,(e.position.y-30)*yH.pixelDensityRatio),r.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*yH.pixelDensityRatio,(e.position.y-20)*yH.pixelDensityRatio)),r.fillText("Level: "+e.level,(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+20)*yH.pixelDensityRatio),r.fillText("Column: "+e.x,(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+30)*yH.pixelDensityRatio),r.fillText("Row: "+e.y,(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+40)*yH.pixelDensityRatio),r.fillText("Order: "+i+" of "+t,(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+50)*yH.pixelDensityRatio),r.fillText("Size: "+e.size.toString(),(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+60)*yH.pixelDensityRatio),r.fillText("Position: "+e.position.toString(),(e.position.x+10)*yH.pixelDensityRatio,(e.position.y+70)*yH.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),r.restore())},debugRect:function(e){var t;this.useCanvas&&((t=this.context).save(),t.lineWidth=2*yH.pixelDensityRatio,t.strokeStyle=this.debugGridColor[0],t.fillStyle=this.debugGridColor[0],t.strokeRect(e.x*yH.pixelDensityRatio,e.y*yH.pixelDensityRatio,e.width*yH.pixelDensityRatio,e.height*yH.pixelDensityRatio),t.restore())},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(e){var t=this._getContext(e).canvas;return new yH.Point(t.width,t.height)},getCanvasCenter:function(){return new yH.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var t=e.point?e.point.times(yH.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(e.useSketch);i.save(),i.translate(t.x,t.y),this.viewer.viewport.flipped?(i.rotate(Math.PI/180*-e.degrees),i.scale(-1,1)):i.rotate(Math.PI/180*e.degrees),i.translate(-t.x,-t.y)},_flip:function(e){var t=(e=e||{}).point?e.point.times(yH.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(e.useSketch);i.translate(t.x,0),i.scale(-1,1),i.translate(-t.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var e=yH.pixelDensityRatio,t=this.viewport.getContainerSize();return{x:Math.round(t.x*e),y:Math.round(t.y*e)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}},kJ=OpenSeadragon,kJ.Viewport=function(e){var t=arguments;t.length&&t[0]instanceof kJ.Point&&(e={containerSize:t[0],contentSize:t[1],config:t[2]}),e.config&&(kJ.extend(!0,e,e.config),delete e.config),this._margins=kJ.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,kJ.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:kJ.DEFAULT_SETTINGS.springStiffness,animationTime:kJ.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:kJ.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:kJ.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:kJ.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:kJ.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:kJ.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:kJ.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:kJ.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:kJ.DEFAULT_SETTINGS.maxZoomLevel,degrees:kJ.DEFAULT_SETTINGS.degrees,flipped:kJ.DEFAULT_SETTINGS.flipped,homeFillsViewer:kJ.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new kJ.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new kJ.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new kJ.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new kJ.Rect(0,0,1,1),1),this.goHome(!0),this.update()},kJ.Viewport.prototype={resetContentSize:function(e){return kJ.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),kJ.console.assert(e instanceof kJ.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),kJ.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),kJ.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new kJ.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,t){kJ.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,t)},_setContentBounds:function(e,t){kJ.console.assert(e,"[Viewport._setContentBounds] bounds is required"),kJ.console.assert(e instanceof kJ.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),kJ.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),kJ.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(t),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(t),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:t,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio(),t=this.homeFillsViewer?1<=e?e:1:1<=e?1:e;return t/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),i=t/this.getAspectRatio();return new kJ.Rect(e.x-t/2,e.y-i/2,t,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new kJ.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return kJ.extend({},this._margins)},setMargins:function(e){kJ.console.assert("object"===kJ.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=kJ.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var t=this.getCenter(e),i=1/this.getZoom(e),n=i/this.getAspectRatio();return new kJ.Rect(t.x-i/2,t.y-n/2,i,n)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(e){var t,i,n,o,r,s,a=new kJ.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),l=new kJ.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?a:this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),o=(n=1/(i=this.getZoom()))/this.getAspectRatio(),r=new kJ.Rect(a.x-n/2,a.y-o/2,n,o),s=this._pixelFromPoint(this.zoomPoint,r).minus(t).divide(this._containerInnerSize.x*i),l.plus(s)):l},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var t,i,n,o,r,s,a,l,c,u,h=new kJ.Rect(e.x,e.y,e.width,e.height);return this.wrapHorizontal||(t=this.visibilityRatio*h.width,i=h.x+h.width,n=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,o=this._contentBoundsNoRotate.x-i+t,r=n-h.x-t,t>this._contentBoundsNoRotate.width?h.x+=(o+r)/2:r<0?h.x+=r:0<o&&(h.x+=o)),this.wrapVertical||(s=this.visibilityRatio*h.height,a=h.y+h.height,l=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,c=this._contentBoundsNoRotate.y-a+s,u=l-h.y-s,s>this._contentBoundsNoRotate.height?h.y+=(c+u)/2:u<0?h.y+=u:0<c&&(h.y+=c)),h},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),n.x===o.x&&n.y===o.y&&!e||this.fitBounds(o.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,t){var i=(t=t||{}).immediately||!1,n=t.constraints||!1,o=this.getAspectRatio(),r=e.getCenter(),s=new kJ.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();s.getAspectRatio()>=o?s.height=s.width/o:s.width=s.height*o,s.x=r.x-s.width/2,s.y=r.y-s.height/2;var a,l,c=1/s.width;if(n&&(a=s.getAspectRatio(),c!==(l=this._applyZoomConstraints(c))&&(c=l,s.width=1/c,s.x=r.x-s.width/2,s.height=s.width/a,s.y=r.y-s.height/2),r=(s=this._applyBoundaryConstraints(s)).getCenter(),this._raiseConstraintsEvent(i)),i)return this.panTo(r,!0),this.zoomTo(c,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var u=this.getBounds(),h=this.getZoom();if(0===h||Math.abs(c/h-1)<1e-8)return this.zoomTo(c,!0),this.panTo(r,i);var d=(s=s.rotate(-this.getRotation())).getTopLeft().times(c).minus(u.getTopLeft().times(h)).divide(c-h);return this.zoomTo(c,d,i)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var t=new kJ.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(t,e)},fitHorizontally:function(e){var t=new kJ.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(t,e)},getConstrainedBounds:function(e){var t=this.getBounds(e);return this._applyBoundaryConstraints(t)},panBy:function(e,t){var i=new kJ.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(e),t)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(e,t,i){var n=this;return this.zoomPoint=t instanceof kJ.Point&&!isNaN(t.x)&&!isNaN(t.y)?t:null,i?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:t,immediately:i}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=kJ.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e})),this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),o=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,o.width=n.width*i,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(o,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new kJ.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){var t,i,n;this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),e(),i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)):e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(e,t){return e.minus(t.getTopLeft()).times(this._containerInnerSize.x/t.width).plus(new kJ.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(e,t){var i=this.getBoundsNoRotate(t);return e.minus(new kJ.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new kJ.Point(e*this._contentSizeNoRotate.x/i,t*this._contentSizeNoRotate.x/i)},viewportToImageCoordinates:function(e,t){if(e instanceof kJ.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)kJ.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(e,t,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,t-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new kJ.Point(e/this._contentSizeNoRotate.x*i,t/this._contentSizeNoRotate.x*i)},imageToViewportCoordinates:function(e,t){if(e instanceof kJ.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)kJ.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(e,t,!0)}}var n=this._imageToViewportDelta(e,t);return n.x+=this._contentBoundsNoRotate.x,n.y+=this._contentBoundsNoRotate.y,n},imageToViewportRectangle:function(e,t,i,n){var o=e;if(o instanceof kJ.Rect||(o=new kJ.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)kJ.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).imageToViewportRectangle(e,t,i,n,!0)}}var s=this.imageToViewportCoordinates(o.x,o.y),a=this._imageToViewportDelta(o.width,o.height);return new kJ.Rect(s.x,s.y,a.x,a.y,o.degrees)},viewportToImageRectangle:function(e,t,i,n){var o=e;if(o instanceof kJ.Rect||(o=new kJ.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)kJ.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).viewportToImageRectangle(e,t,i,n,!0)}}var s=this.viewportToImageCoordinates(o.x,o.y),a=this._viewportToImageDelta(o.width,o.height);return new kJ.Rect(s.x,s.y,a.x,a.y,o.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){kJ.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var t=e.minus(kJ.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return kJ.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(kJ.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return kJ.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return kJ.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){kJ.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var t=e.minus(kJ.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(e){return kJ.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(kJ.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)kJ.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===t){return this.viewer.world.getItemAt(0).viewportToImageZoom(e)}}var i=this._contentSizeNoRotate.x;return e*(this._containerInnerSize.x/i*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)kJ.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===t){return this.viewer.world.getItemAt(0).imageToViewportZoom(e)}}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}},PM=OpenSeadragon,PM.TiledImage=function(e){var t=this;PM.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),PM.console.assert(e.drawer,"[TiledImage] options.drawer is required"),PM.console.assert(e.viewer,"[TiledImage] options.viewer is required"),PM.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),PM.console.assert(e.source,"[TiledImage] options.source is required"),PM.console.assert(!e.clip||e.clip instanceof PM.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),PM.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof PM.Rect&&(this._clip=e.clip.clone()),delete e.clip;var i=e.x||0;delete e.x;var n=e.y||0;delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y;var o=1;e.width?(o=e.width,delete e.width,e.height&&(PM.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(o=e.height/this.normHeight,delete e.height);var r=e.fitBounds;delete e.fitBounds;var s=e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete e.fitBoundsPlacement;var a=e.degrees||0;delete e.degrees,PM.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:PM.DEFAULT_SETTINGS.springStiffness,animationTime:PM.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:PM.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:PM.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:PM.DEFAULT_SETTINGS.wrapVertical,immediateRender:PM.DEFAULT_SETTINGS.immediateRender,blendTime:PM.DEFAULT_SETTINGS.blendTime,alwaysBlend:PM.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:PM.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:PM.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:PM.DEFAULT_SETTINGS.iOSDevice,debugMode:PM.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:PM.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:PM.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:PM.DEFAULT_SETTINGS.placeholderFillStyle,opacity:PM.DEFAULT_SETTINGS.opacity,preload:PM.DEFAULT_SETTINGS.preload,compositeOperation:PM.DEFAULT_SETTINGS.compositeOperation},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new PM.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new PM.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new PM.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new PM.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),r&&this.fitBounds(r,s,!0),this._drawingHandler=function(e){t.viewer.raiseEvent("tile-drawing",PM.extend({tiledImage:t},e))}},PM.extend(PM.TiledImage.prototype,PM.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=PM.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(e){return e?new PM.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new PM.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return PM.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var t,i,n=this.getBoundsNoRotate(e);return this._clip&&(t=(e?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,i=this._clip.times(t),n=new PM.Rect(n.x+i.x,n.y+i.y,i.width,i.height)),n.rotate(this.getRotation(e),this._getRotationPoint(e))},getContentSize:function(){return new PM.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(e,t,i){var n=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new PM.Point(e*(this.source.dimensions.x/n),t*(this.source.dimensions.y*this.contentAspectX/n))},viewportToImageCoordinates:function(e,t,i){var n=e instanceof PM.Point?(i=t,e):new PM.Point(e,t);return n=n.rotate(-this.getRotation(i),this._getRotationPoint(i)),i?this._viewportToImageDelta(n.x-this._xSpring.current.value,n.y-this._ySpring.current.value):this._viewportToImageDelta(n.x-this._xSpring.target.value,n.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,t,i){var n=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new PM.Point(e/this.source.dimensions.x*n,t/this.source.dimensions.y/this.contentAspectX*n)},imageToViewportCoordinates:function(e,t,i){e instanceof PM.Point&&(i=t,t=e.y,e=e.x);var n=this._imageToViewportDelta(e,t);return i?(n.x+=this._xSpring.current.value,n.y+=this._ySpring.current.value):(n.x+=this._xSpring.target.value,n.y+=this._ySpring.target.value),n.rotate(this.getRotation(i),this._getRotationPoint(i))},imageToViewportRectangle:function(e,t,i,n,o){var r=e;r instanceof PM.Rect?o=t:r=new PM.Rect(e,t,i,n);var s=this.imageToViewportCoordinates(r.getTopLeft(),o),a=this._imageToViewportDelta(r.width,r.height,o);return new PM.Rect(s.x,s.y,a.x,a.y,r.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,t,i,n,o){var r=e;e instanceof PM.Rect?o=t:r=new PM.Rect(e,t,i,n);var s=this.viewportToImageCoordinates(r.getTopLeft(),o),a=this._viewportToImageDelta(r.width,r.height,o);return new PM.Rect(s.x,s.y,a.x,a.y,r.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var t=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new PM.Rect((e.x-this._xSpring.current.value)/t,(e.y-this._ySpring.current.value)/t,e.width/t,e.height/t,e.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(e){function t(e){return e.map(function(e){try{if((t=e)instanceof PM.Point||"number"==typeof t.x&&"number"==typeof t.y)return{x:e.x,y:e.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}var t})}try{if(!PM.isArray(e))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=e.map(t)}catch(e){PM.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),PM.console.error(e),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(e,t,i){t=t||PM.Placement.CENTER;var n,o,r,s,a=PM.Placement.properties[t],l=this.contentAspectX,c=0,u=0,h=1,d=1;this._clip&&(l=this._clip.getAspectRatio(),h=this._clip.width/this.source.dimensions.x,d=this._clip.height/this.source.dimensions.y,u=e.getAspectRatio()>l?(c=this._clip.x/this._clip.height*e.height,this._clip.y/this._clip.height*e.height):(c=this._clip.x/this._clip.width*e.width,this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>l?(n=e.height/d,o=0,a.isHorizontallyCentered?o=(e.width-e.height*l)/2:a.isRight&&(o=e.width-e.height*l),this.setPosition(new PM.Point(e.x-c+o,e.y-u),i),this.setHeight(n,i)):(r=e.width/h,s=0,a.isVerticallyCentered?s=(e.height-e.width/l)/2:a.isBottom&&(s=e.height-e.width/l),this.setPosition(new PM.Point(e.x-c,e.y-u+s),i),this.setWidth(r,i))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){PM.console.assert(!e||e instanceof PM.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof PM.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2)))),i=Math.max(i,this.source.minLevel||0);return{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;){this.lastDrawn.pop().beingDrawn=!1}var e=this.viewport,t=this._viewportToTiledImageRectangle(e.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var i=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(t=t.intersection(i)))return}for(var n,o,r,s=this._getLevelsInterval(),a=s.lowestLevel,l=s.highestLevel,c=null,u=!1,h=PM.now(),d=l;a<=d;d--){var p=!1,m=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(d),!0).x*this._scaleSpring.current.value;if(d===a||!u&&m>=this.minPixelRatio)u=p=!0;else if(!u)continue;var g=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(d),!1).x*this._scaleSpring.current.value,v=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,f=this.immediateRender?1:v,c=function(e,t,i,n,o,r,s,a,l){var c=s.getBoundingBox().getTopLeft(),u=s.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:n,opacity:o,visibility:r,drawArea:s,topleft:c,bottomright:u,currenttime:a,best:l});_M(e.coverage,n),_M(e.loadingCoverage,n);for(var h=e._getCornerTiles(n,c,u),d=h.topLeft,p=h.bottomRight,m=e.source.getNumTiles(n),g=e.viewport.pixelFromPoint(e.viewport.getCenter()),v=d.x;v<=p.x;v++)for(var f=d.y;f<=p.y;f++){if(!e.wrapHorizontal&&!e.wrapVertical){var y=e.source.getTileBounds(n,v,f);if(null===s.intersection(y))continue}l=function(e,t,i,n,o,r,s,a,l,c,u,h){var d=function(e,t,i,n,o,r,s,a,l,c){var u,h,d,p,m,g,v,f,y;r[i]||(r[i]={});r[i][e]||(r[i][e]={});r[i][e][t]||(u=(a.x+e%a.x)%a.x,h=(a.y+t%a.y)%a.y,d=o.getTileBounds(i,u,h),p=o.getTileBounds(i,u,h,!0),m=o.tileExists(i,u,h),g=o.getTileUrl(i,u,h),n.loadTilesWithAjax?(v=o.getTileAjaxHeaders(i,u,h),PM.isPlainObject(n.ajaxHeaders)&&(v=PM.extend({},n.ajaxHeaders,v))):v=null,f=o.getContext2D?o.getContext2D(i,u,h):void 0,d.x+=(e-u)/a.x,d.y+=c/l*((t-h)/a.y),y=new PM.Tile(i,e,t,d,m,g,f,n.loadTilesWithAjax,v,p),u==a.x-1&&(y.isRightMost=!0),h==a.y-1&&(y.isBottomMost=!0),r[i][e][t]=y);return(y=r[i][e][t]).lastTouchTime=s,y}(n,o,r,e,e.source,e.tilesMatrix,u,c,e._worldWidthCurrent,e._worldHeightCurrent),p=i;e.viewer&&e.viewer.raiseEvent("update-tile",{tiledImage:e,tile:d});$M(e.coverage,r,n,o,!1);var m=d.loaded||d.loading||ZM(e.loadingCoverage,r,n,o);if($M(e.loadingCoverage,r,n,o,m),!d.exists)return h;t&&!p&&(ZM(e.coverage,r,n,o)?$M(e.coverage,r,n,o,!0):p=!0);if(!p)return h;{var g,v;(function(e,t,i,n,o,r){var s=e.bounds.getTopLeft();s.x*=r._scaleSpring.current.value,s.y*=r._scaleSpring.current.value,s.x+=r._xSpring.current.value,s.y+=r._ySpring.current.value;var a=e.bounds.getSize();a.x*=r._scaleSpring.current.value,a.y*=r._scaleSpring.current.value;var l=i.pixelFromPointNoRotate(s,!0),c=i.pixelFromPointNoRotate(s,!1),u=i.deltaPixelsFromPointsNoRotate(a,!0),h=i.deltaPixelsFromPointsNoRotate(a,!1),d=c.plus(h.divide(2)),p=n.squaredDistanceTo(d);t||(u=u.plus(new PM.Point(1,1)));e.isRightMost&&r.wrapHorizontal&&(u.x+=.75);e.isBottomMost&&r.wrapVertical&&(u.y+=.75);e.position=l,e.size=u,e.squaredDistance=p,e.visibility=o})(d,e.source.tileOverlap,e.viewport,l,a,e),d.loaded||(d.context2D?VM(e,d):(g=e._tileCache.getImageRecord(d.cacheKey))&&(v=g.getImage(),VM(e,d,v)))}{d.loaded?function(e,t,i,n,o,r,s){var a,l,c=1e3*e.blendTime;t.blendStart||(t.blendStart=s);a=s-t.blendStart,l=c?Math.min(1,a/c):1,e.alwaysBlend&&(l*=r);if(t.opacity=l,e.lastDrawn.push(t),1===l)$M(e.coverage,o,i,n,!0),e._hasOpaqueTile=!0;else if(a<c)return!0;return!1}(e,d,n,o,r,s,u)&&(e._needsDraw=!0):d.loading?e._tilesLoading++:m||(h=function(e,t){if(!e)return t;{if(t.visibility>e.visibility)return t;if(t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance)return t}return e}(h,d))}return h}(e,i,t,v,f,n,o,r,g,m,a,l)}return l}(this,u,p,d,Math.min(1,(m-.5)/.5),f/Math.abs(f-g),t,h,c);if(YM(this.coverage,d))break}!function(n,e){if(0===n.opacity||0===e.length&&!n.placeholderFillStyle)return;var t,o,i,r=e[0];r&&(t=n.opacity<1||n.compositeOperation&&"source-over"!==n.compositeOperation||!n._isBottomItem()&&r._hasTransparencyChannel());var s,a=n.viewport.getZoom(!0),l=n.viewportToImageZoom(a);1<e.length&&l>n.smoothTileEdgesMinZoom&&!n.iOSDevice&&n.getRotation(!0)%360==0&&PM.supportsCanvas&&(t=!0,o=r.getScaleForEdgeSmoothing(),i=r.getTranslationForEdgeSmoothing(o,n._drawer.getCanvasSize(!1),n._drawer.getCanvasSize(!0)));t&&(o||(s=n.viewport.viewportToViewerElementRectangle(n.getClippedBounds(!0)).getIntegerBoundingBox(),n._drawer.viewer.viewport.getFlip()&&(0===n.viewport.degrees&&n.getRotation(!0)%360==0||(s.x=n._drawer.viewer.container.clientWidth-(s.x+s.width))),s=s.times(PM.pixelDensityRatio)),n._drawer._clear(!0,s));o||(0!==n.viewport.degrees&&n._drawer._offsetForRotation({degrees:n.viewport.degrees,useSketch:t}),n.getRotation(!0)%360!=0&&n._drawer._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0),useSketch:t}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip());var c=!1;{var u,h;n._clip&&(n._drawer.saveContext(t),u=(u=n.imageToViewportRectangle(n._clip,!0)).rotate(-n.getRotation(!0),n._getRotationPoint(!0)),h=n._drawer.viewportToDrawerRectangle(u),o&&(h=h.times(o)),i&&(h=h.translate(i)),n._drawer.setClip(h,t),c=!0)}if(n._croppingPolygons){n._drawer.saveContext(t);try{var d=n._croppingPolygons.map(function(e){return e.map(function(e){var t=n.imageToViewportCoordinates(e.x,e.y,!0).rotate(-n.getRotation(!0),n._getRotationPoint(!0)),i=n._drawer.viewportCoordToDrawerCoord(t);return o&&(i=i.times(o)),i})});n._drawer.clipWithPolygons(d,t)}catch(e){PM.console.error(e)}c=!0}{var p,m;n.placeholderFillStyle&&!1===n._hasOpaqueTile&&(p=n._drawer.viewportToDrawerRectangle(n.getBounds(!0)),o&&(p=p.times(o)),i&&(p=p.translate(i)),m=null,m="function"==typeof n.placeholderFillStyle?n.placeholderFillStyle(n,n._drawer.context):n.placeholderFillStyle,n._drawer.drawRectangle(p,m,t))}for(var g=e.length-1;0<=g;g--)r=e[g],n._drawer.drawTile(r,n._drawingHandler,t,o,i),r.beingDrawn=!0,n.viewer&&n.viewer.raiseEvent("tile-drawn",{tiledImage:n,tile:r});c&&n._drawer.restoreContext(t);o||(n.getRotation(!0)%360!=0&&n._drawer._restoreRotationChanges(t),0!==n.viewport.degrees&&n._drawer._restoreRotationChanges(t));t&&(o&&(0!==n.viewport.degrees&&n._drawer._offsetForRotation({degrees:n.viewport.degrees,useSketch:!1}),n.getRotation(!0)%360!=0&&n._drawer._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0),useSketch:!1})),n._drawer.blendSketch({opacity:n.opacity,scale:o,translate:i,compositeOperation:n.compositeOperation,bounds:s}),o&&(n.getRotation(!0)%360!=0&&n._drawer._restoreRotationChanges(!1),0!==n.viewport.degrees&&n._drawer._restoreRotationChanges(!1)));o||0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip();!function(e,t){if(e.debugMode)for(var i=t.length-1;0<=i;i--){var n=t[i];try{e._drawer.drawDebugInfo(n,t.length,i,e)}catch(e){PM.console.error(e)}}}(n,e)}(this,this.lastDrawn),c&&!c.context2D?(n=this,r=h,(o=c).loading=!0,n._imageLoader.addJob({src:o.url,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:function(e,t,i){!function(t,i,e,n,o,r){if(!n)return PM.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:e,message:o,tileRequest:r}),i.loading=!1,i.exists=!1;if(e<t.lastResetTime)return PM.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),i.loading=!1;function s(){var e=t.source.getClosestLevel();VM(t,i,n,e,r)}t._midDraw?window.setTimeout(s,1):s()}(n,o,r,e,t,i)},abort:function(){o.loading=!1}}),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,t,i){var n,o,r=this.wrapHorizontal?(n=PM.positiveModulo(t.x,1),PM.positiveModulo(i.x,1)):(n=Math.max(0,t.x),Math.min(1,i.x)),s=1/this.source.aspectRatio,a=this.wrapVertical?(o=PM.positiveModulo(t.y,s),PM.positiveModulo(i.y,s)):(o=Math.max(0,t.y),Math.min(s,i.y)),l=this.source.getTileAtPoint(e,new PM.Point(n,o)),c=this.source.getTileAtPoint(e,new PM.Point(r,a)),u=this.source.getNumTiles(e);return this.wrapHorizontal&&(l.x+=u.x*Math.floor(t.x),c.x+=u.x*Math.floor(i.x)),this.wrapVertical&&(l.y+=u.y*Math.floor(t.y/s),c.y+=u.y*Math.floor(i.y/s)),{topLeft:l,bottomRight:c}}}),vS=OpenSeadragon,xS.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){var e;return this._renderedContext||((e=document.createElement("canvas")).width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null),this._renderedContext},setRenderedContext:function(e){vS.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){vS.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var t=0;t<this._tiles.length;t++)if(this._tiles[t]===e)return void this._tiles.splice(t,1);vS.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},vS.TileCache=function(e){e=e||{},this._maxImageCacheCount=e.maxImageCacheCount||vS.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},vS.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(e){vS.console.assert(e,"[TileCache.cacheTile] options is required"),vS.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),vS.console.assert(e.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),vS.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var t=e.cutoff||0,i=this._tilesLoaded.length,n=this._imagesLoaded[e.tile.cacheKey];if(n||(vS.console.assert(e.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),n=this._imagesLoaded[e.tile.cacheKey]=new xS({image:e.image}),this._imagesLoadedCount++),n.addTile(e.tile),e.tile.cacheImageRecord=n,this._imagesLoadedCount>this._maxImageCacheCount){for(var o,r,s,a,l,c,u=null,h=-1,d=null,p=this._tilesLoaded.length-1;0<=p;p--)(o=(c=this._tilesLoaded[p]).tile).level<=t||o.beingDrawn||(u?(a=o.lastTouchTime,r=u.lastTouchTime,l=o.level,s=u.level,(a<r||a==r&&s<l)&&(u=o,h=p,d=c)):(u=o,h=p,d=c));u&&0<=h&&(this._unloadTile(d),i=h)}this._tilesLoaded[i]=new wS({tile:e.tile,tiledImage:e.tiledImage})},clearTilesFor:function(e){var t;vS.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(t=this._tilesLoaded[i]).tiledImage===e&&(this._unloadTile(t),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(e){return vS.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){vS.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var t=e.tile,i=e.tiledImage;t.unload(),t.cacheImageRecord=null;var n=this._imagesLoaded[t.cacheKey];n.removeTile(t),n.getTileCount()||(n.destroy(),delete this._imagesLoaded[t.cacheKey],this._imagesLoadedCount--),i.viewer.raiseEvent("tile-unloaded",{tile:t,tiledImage:i})}},aT=OpenSeadragon,aT.World=function(e){var t=this;aT.console.assert(e.viewer,"[World] options.viewer is required"),aT.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){t._autoRefigureSizes?t._figureSizes():t._needsSizesFigured=!0},this._figureSizes()},aT.extend(aT.World.prototype,aT.EventSource.prototype,{addItem:function(e,t){var i;aT.console.assert(e,"[World.addItem] item is required"),aT.console.assert(e instanceof aT.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(t=t||{}).index?(i=Math.max(0,Math.min(this._items.length,t.index)),this._items.splice(i,0,e)):this._items.push(e),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return aT.console.assert(void 0!==e,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return aT.console.assert(e,"[World.getIndexOfItem] item is required"),aT.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,t){aT.console.assert(e,"[World.setItemIndex] item is required"),aT.console.assert(void 0!==t,"[World.setItemIndex] index is required");var i=this.getIndexOfItem(e);if(t>=this._items.length)throw new Error("Index bigger than number of layers.");t!==i&&-1!==i&&(this._items.splice(i,1),this._items.splice(t,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:i,newIndex:t}))},removeItem:function(e){aT.console.assert(e,"[World.removeItem] item is required");var t=aT.indexOf(this._items,e);-1!==t&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(t,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){(this._autoRefigureSizes=e)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){var t,i,n,o,r,s=(e=e||{}).immediately||!1,a=e.layout||aT.DEFAULT_SETTINGS.collectionLayout,l=e.rows||aT.DEFAULT_SETTINGS.collectionRows,c=e.columns||aT.DEFAULT_SETTINGS.collectionColumns,u=e.tileSize||aT.DEFAULT_SETTINGS.collectionTileSize,h=u+(e.tileMargin||aT.DEFAULT_SETTINGS.collectionTileMargin),d=!e.rows&&c?c:Math.ceil(this._items.length/l),p=0,m=0;this.setAutoRefigureSizes(!1);for(var g=0;g<this._items.length;g++)g&&g%d==0&&("horizontal"===a?(m+=h,p=0):(p+=h,m=0)),o=(n=(i=(t=this._items[g]).getBounds()).width>i.height?u:u*(i.width/i.height))*(i.height/i.width),r=new aT.Point(p+(u-n)/2,m+(u-o)/2),t.setPosition(r,s),t.setWidth(n,s),"horizontal"===a?p+=h:m+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,t=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(this._items.length){var n=this._items[0],o=n.getBounds();this._contentFactor=n.getContentSize().x/o.width;for(var r=n.getClippedBounds().getBoundingBox(),s=r.x,a=r.y,l=r.x+r.width,c=r.y+r.height,u=1;u<this._items.length;u++)o=(n=this._items[u]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/o.width),r=n.getClippedBounds().getBoundingBox(),s=Math.min(s,r.x),a=Math.min(a,r.y),l=Math.max(l,r.x+r.width),c=Math.max(c,r.y+r.height);this._homeBounds=new aT.Rect(s,a,l-s,c-a),this._contentSize=new aT.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new aT.Rect(0,0,1,1),this._contentSize=new aT.Point(1,1),this._contentFactor=1;this._contentFactor===i&&this._homeBounds.equals(e)&&this._contentSize.equals(t)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})},{}],5:[function(e,t,i){"use strict";t.exports=function(e,t,i,n){t=t||"&",i=i||"=";var o={};if("string"!=typeof e||0===e.length)return o;var r=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=e.length;0<s&&s<a&&(a=s);for(var l,c,u=0;u<a;++u){var h,d=e[u].replace(r,"%20"),p=d.indexOf(i),m=0<=p?(h=d.substr(0,p),d.substr(p+1)):(h=d,""),g=decodeURIComponent(h),v=decodeURIComponent(m);l=o,c=g,Object.prototype.hasOwnProperty.call(l,c)?f(o[g])?o[g].push(v):o[g]=[o[g],v]:o[g]=v}return o};var f=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],6:[function(e,t,i){"use strict";function r(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}t.exports=function(i,n,o,e){return n=n||"&",o=o||"=",null===i&&(i=void 0),"object"==typeof i?a(l(i),function(e){var t=encodeURIComponent(r(e))+o;return s(i[e])?a(i[e],function(e){return t+encodeURIComponent(r(e))}).join(n):t+encodeURIComponent(r(i[e]))}).join(n):e?encodeURIComponent(r(e))+o+encodeURIComponent(r(i)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i.push(t(e[n],n));return i}var l=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t}},{}],7:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode"),i.encode=i.stringify=e("./encode")},{"./decode":5,"./encode":6}],8:[function(e,t,i){var n,o;n=this,o=function(){function v(e,t,i){if(i){var n=document.createDocumentFragment(),o=!t.hasAttribute("viewBox")&&i.getAttribute("viewBox");o&&t.setAttribute("viewBox",o);for(var r=i.cloneNode(!0);r.childNodes.length;)n.appendChild(r.firstChild);e.appendChild(n)}}return function(e){var u=Object(e),t=window.top!==window.self,h="polyfill"in u?u.polyfill:/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/.test(navigator.userAgent)||(navigator.userAgent.match(/\bEdge\/12\.(\d+)\b/)||[])[1]<10547||(navigator.userAgent.match(/\bAppleWebKit\/(\d+)\b/)||[])[1]<537||/\bEdge\/.(\d+)\b/.test(navigator.userAgent)&&t,d={},p=window.requestAnimationFrame||setTimeout,m=document.getElementsByTagName("use"),g=0;h&&function e(){for(var t=0;t<m.length;){var i,n,o,r,s=m[t],a=s.parentNode,l=function(e){for(var t=e;"svg"!==t.nodeName.toLowerCase()&&(t=t.parentNode););return t}(a),c=s.getAttribute("xlink:href")||s.getAttribute("href");!c&&u.attributeName&&(c=s.getAttribute(u.attributeName)),l&&c?h&&(!u.validate||u.validate(c,l,s)?(a.removeChild(s),n=(i=c.split("#")).shift(),o=i.join("#"),n.length?((r=d[n])||((r=d[n]=new XMLHttpRequest).open("GET",n),r.send(),r._embeds=[]),r._embeds.push({parent:a,svg:l,id:o}),function(n){n.onreadystatechange=function(){var i;4===n.readyState&&((i=n._cachedDocument)||((i=n._cachedDocument=document.implementation.createHTMLDocument("")).body.innerHTML=n.responseText,n._cachedTarget={}),n._embeds.splice(0).map(function(e){var t=(t=n._cachedTarget[e.id])||(n._cachedTarget[e.id]=i.getElementById(e.id));v(e.parent,e.svg,t)}))},n.onreadystatechange()}(r)):v(a,l,document.getElementById(o))):(++t,++g)):++t}(!m.length||0<m.length-g)&&p(e,67)}()}},"function"==typeof define&&define.amd?define([],function(){return n.svg4everybody=o()}):"object"==typeof t&&t.exports?t.exports=o():n.svg4everybody=o()},{}],9:[function(e,t,i){var n,o;n=this,o=function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function a(e){return t({},Y,e)}function o(e,t){var i,n=new e(t);try{i=new CustomEvent("LazyLoad::Initialized",{detail:{instance:n}})}catch(e){(i=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:n})}window.dispatchEvent(i)}function b(e,t){return e.getAttribute("data-"+t)}function _(e,t,i){var n="data-"+t;null!==i?e.setAttribute(n,i):e.removeAttribute(n)}function f(e){return b(e,"ll-status")}function x(e,t){return _(e,"ll-status",t)}function y(e){return x(e,null),0}function w(e){return null===f(e)}function s(e){return"native"===f(e)}function S(e,t,i,n){e&&(void 0===n?void 0===i?e(t):e(t,i):e(t,i,n))}function T(e,t){$?e.classList.add(t):e.className+=(e.className?" ":"")+t}function E(e,t){$?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")}function P(e){return e.llTempImage}function C(e,t){var i;!t||(i=t._observer)&&i.unobserve(e)}function k(e,t){e&&(e.loadingCount+=t)}function l(e,t){e&&(e.toLoadCount=t)}function n(e){for(var t,i=[],n=0;t=e.children[n];n+=1)"SOURCE"===t.tagName&&i.push(t);return i}function i(e,t,i){i&&e.setAttribute(t,i)}function r(e,t){e.removeAttribute(t)}function c(e){return!!e.llOriginalAttrs}function u(e){var t;c(e)||((t={}).src=e.getAttribute("src"),t.srcset=e.getAttribute("srcset"),t.sizes=e.getAttribute("sizes"),e.llOriginalAttrs=t)}function O(e){var t;c(e)&&(t=e.llOriginalAttrs,i(e,"src",t.src),i(e,"srcset",t.srcset),i(e,"sizes",t.sizes))}function h(e,t){i(e,"sizes",b(e,t.data_sizes)),i(e,"srcset",b(e,t.data_srcset)),i(e,"src",b(e,t.data_src))}function R(e){r(e,"src"),r(e,"srcset"),r(e,"sizes")}function L(e,t){var i=e.parentNode;i&&"PICTURE"===i.tagName&&n(i).forEach(t)}function d(e,t){n(e).forEach(t)}function p(e,t){var i=K[e.tagName];i&&i(e,t)}function A(e,t,i){k(i,1),T(e,t.class_loading),x(e,"loading"),S(t.callback_loading,e,i)}function m(e,t){var i,n,o=Q[e.tagName];o?o(e,t):(_(i=e,(n=t).data_bg,null),_(i,n.data_bg_hidpi,null))}function g(e,t){!t||0<t.loadingCount||0<t.toLoadCount||S(e.callback_finish,t)}function v(e,t,i){e.addEventListener(t,i),e.llEvLisnrs[t]=i}function I(e){return!!e.llEvLisnrs}function M(e){if(I(e)){var t=e.llEvLisnrs;for(var i in t){var n=t[i];o=i,r=n,e.removeEventListener(o,r)}delete e.llEvLisnrs}var o,r}function D(e,t,i){delete e.llTempImage,k(i,-1),i&&--i.toLoadCount,E(e,t.class_loading),t.unobserve_completed&&C(e,i)}function z(i,n,o){var r=P(i)||i;I(r)||function(e){I(e)||(e.llEvLisnrs={});var t="VIDEO"===e.tagName?"loadeddata":"load";v(e,t,function(e){!function(e,t,i,n){var o=s(t);D(t,i,n),T(t,i.class_loaded),x(t,"loaded"),m(t,i),S(i.callback_loaded,t,n),o||g(i,n)}(0,i,n,o),M(r)}),v(e,"error",function(e){!function(e,t,i,n){var o=s(t);D(t,i,n),T(t,i.class_error),x(t,"error"),S(i.callback_error,t,n),o||g(i,n)}(0,i,n,o),M(r)})}(r)}function B(e,t,i){var n,o,r,s,a,l,c,u,h,d,p,m,g,v,f,y,w;e.llTempImage=document.createElement("IMG"),z(e,t,i),v=i,f=b(m=e,(g=t).data_bg),y=b(m,g.data_bg_hidpi),(w=J&&y?y:f)&&(m.style.backgroundImage='url("'.concat(w,'")'),P(m).setAttribute("src",w),A(m,g,v)),r=i,h=b(n=e,(o=t).data_bg_multi),d=b(n,o.data_bg_multi_hidpi),(p=J&&d?d:h)&&(n.style.backgroundImage=p,l=r,T(s=n,(a=o).class_applied),x(s,"applied"),_(c=s,(u=a).data_bg_multi,null),_(c,u.data_bg_multi_hidpi,null),a.unobserve_completed&&C(s,a),S(a.callback_applied,s,l))}function H(e,t,i){var n,o,r;-1<ee.indexOf(e.tagName)?(z(n=e,o=t,r=i),p(n,o),A(n,o,r)):B(e,t,i)}function F(e){return e.use_native&&"loading"in HTMLImageElement.prototype}function N(e,g,v){e.forEach(function(e){return e.isIntersecting||0<e.intersectionRatio?(h=e.target,d=e,p=g,m=v,x(h,"entered"),p.unobserve_entered&&C(h,m),S(p.callback_enter,h,d,m),void(0<=X.indexOf(f(h))||H(h,p,m))):(t=e.target,i=e,n=g,o=v,void(w(t)||(r=t,s=i,l=o,(a=n).cancel_on_exit&&"loading"===f(r)&&"IMG"===r.tagName&&(M(r),L(u=r,function(e){R(e)}),R(u),L(c=r,function(e){O(e)}),O(c),E(r,a.class_loading),k(l,-1),y(r),S(a.callback_cancel,r,s,l)),S(n.callback_exit,t,i,o))));var t,i,n,o,r,s,a,l,c,u,h,d,p,m})}function j(e){return Array.prototype.slice.call(e)}function q(e){return e.container.querySelectorAll(e.elements_selector)}function W(e){return"error"===f(e)}function V(e,t){return i=e||q(t),j(i).filter(w);var i}function e(e,t){var n,o,i,r,s=a(e);this._settings=s,this.loadingCount=0,i=s,r=this,Z&&!F(i)&&(r._observer=new IntersectionObserver(function(e){N(e,i,r)},{root:i.container===document?null:i.container,rootMargin:i.thresholds||i.threshold+"px"})),n=s,o=this,U&&window.addEventListener("online",function(){var t,e,i;e=o,i=q(t=n),j(i).filter(W).forEach(function(e){E(e,t.class_error),y(e)}),e.update()}),this.update(t)}var U="undefined"!=typeof window,G=U&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),Z=U&&"IntersectionObserver"in window,$=U&&"classList"in document.createElement("p"),J=U&&1<window.devicePixelRatio,Y={elements_selector:".lazy",container:G||U?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1},X=["loading","loaded","applied","error"],K={IMG:function(e,t){L(e,function(e){u(e),h(e,t)}),u(e),h(e,t)},IFRAME:function(e,t){i(e,"src",b(e,t.data_src))},VIDEO:function(e,t){d(e,function(e){i(e,"src",b(e,t.data_src))}),i(e,"poster",b(e,t.data_poster)),i(e,"src",b(e,t.data_src)),e.load()}},Q={IMG:function(e,t){_(e,t.data_src,null),_(e,t.data_srcset,null),_(e,t.data_sizes,null),L(e,function(e){_(e,t.data_srcset,null),_(e,t.data_sizes,null)})},IFRAME:function(e,t){_(e,t.data_src,null)},VIDEO:function(e,t){_(e,t.data_src,null),_(e,t.data_poster,null),d(e,function(e){_(e,t.data_src,null)})}},ee=["IMG","IFRAME","VIDEO"],te=["IMG","IFRAME"];return e.prototype={update:function(e){var t,i,n,o,r,s=this._settings,a=V(e,s);l(this,a.length),!G&&Z?F(s)?(o=s,r=this,a.forEach(function(e){var t,i;-1!==te.indexOf(e.tagName)&&(e.setAttribute("loading","lazy"),z(t=e,i=o,r),p(t,i),m(t,i),x(t,"native"))}),l(r,0)):(i=a,(t=this._observer).disconnect(),n=t,i.forEach(function(e){n.observe(e)})):this.loadAll(a)},destroy:function(){this._observer&&this._observer.disconnect(),q(this._settings).forEach(function(e){delete e.llOriginalAttrs}),delete this._observer,delete this._settings,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){var t=this,i=this._settings;V(e,i).forEach(function(e){C(e,t),H(e,i,t)})}},e.load=function(e,t){var i=a(t);H(e,i)},e.resetStatus=function(e){y(e)},U&&function(e,t){if(t)if(t.length)for(var i,n=0;i=t[n];n+=1)o(e,i);else o(e,t)}(e,window.lazyLoadOptions),e},"object"==typeof i&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):(n=n||self).LazyLoad=o()},{}],10:[function(e,t,i){"use strict";e("element-closest-polyfill");var n=a(e("vanilla-lazyload")),o=a(e("svg4everybody")),r=a(e("../../components/blocks/object-image-overlay/_object-image-overlay")),s=a(e("../../components/blocks/object-card/_object-card"));function a(e){return e&&e.__esModule?e:{default:e}}e("../../components/services/object_fit_polyfill/_poly-object-fit.js"),e("../../components/blocks/background-video/_background-video.js"),e("../../components/groups/block-grid/_grid-reveal-more.js"),e("../../components/blocks/cookie-banner/_cookie-banner.js"),e("../../components/blocks/facet-box/_facet-box.js"),e("../../components/blocks/image-carousel/_image-carousel.js"),e("../../components/blocks/image-overlay-license-modal/_image-overlay-license-modal.js"),e("../../components/blocks/object-details/object-details.js"),e("../../components/blocks/object-shuffler/_object-shuffler.js"),e("../../components/blocks/modal/_modal.js"),e("../../components/blocks/newsletter-signup/_newsletter-signup.js"),e("../../components/blocks/search-form/_search-form.js"),e("../../components/blocks/search-pagination/_search-pagination.js"),e("../../components/blocks/search-result/_search-result.js"),e("../../components/blocks/search-results/_search-results.js"),e("../../components/blocks/site-nav/_site-nav.js"),e("../../components/blocks/toggle-nav/_toggle-nav.js"),e("../../components/blocks/video-thumbnail/_video-thumbnail.js"),e("../../components/blocks/video-trailer/_video-trailer.js"),e("../../components/groups/facet-box-modal/_facet-box-modal.js"),e("../../components/groups/image-overlay/_image-overlay.js"),e("../../components/groups/story-box-container/_story-box-container.js"),new n.default({elements_selector:"img[data-srcset]",cancel_on_exit:!1,class_loading:"s-lazyload--blur",class_error:"s-lazyload--error",callback_error:function(e){e.parentNode.insertBefore(document.createElement("div"),e).className=e.className,e.parentNode.removeChild(e)}}),(0,s.default)(),(0,r.default)(),(0,o.default)()},{"../../components/blocks/background-video/_background-video.js":11,"../../components/blocks/cookie-banner/_cookie-banner.js":12,"../../components/blocks/facet-box/_facet-box.js":13,"../../components/blocks/image-carousel/_image-carousel.js":14,"../../components/blocks/image-overlay-license-modal/_image-overlay-license-modal.js":15,"../../components/blocks/modal/_modal.js":16,"../../components/blocks/newsletter-signup/_newsletter-signup.js":17,"../../components/blocks/object-card/_object-card":18,"../../components/blocks/object-details/object-details.js":19,"../../components/blocks/object-image-overlay/_object-image-overlay":20,"../../components/blocks/object-shuffler/_object-shuffler.js":21,"../../components/blocks/search-form/_search-form.js":22,"../../components/blocks/search-pagination/_search-pagination.js":23,"../../components/blocks/search-result/_search-result.js":24,"../../components/blocks/search-results/_search-results.js":25,"../../components/blocks/site-nav/_site-nav.js":26,"../../components/blocks/toggle-nav/_toggle-nav.js":27,"../../components/blocks/video-thumbnail/_video-thumbnail.js":28,"../../components/blocks/video-trailer/_video-trailer.js":29,"../../components/groups/block-grid/_grid-reveal-more.js":30,"../../components/groups/facet-box-modal/_facet-box-modal.js":31,"../../components/groups/image-overlay/_image-overlay.js":32,"../../components/groups/story-box-container/_story-box-container.js":33,"../../components/services/object_fit_polyfill/_poly-object-fit.js":34,"element-closest-polyfill":3,svg4everybody:8,"vanilla-lazyload":9}],11:[function(e,t,i){"use strict";var n,o,r,s,a,l,c,u,h=document.querySelector(".js-background-video");h&&(n=document.querySelector(".js-background-video-container"),o=document.querySelector(".js-stop-button"),r=document.querySelector(".js-background-video-credit"),s=document.querySelector(".js-background-image-credit"),a=0,l=function(){r&&r.classList.remove("hidden"),s&&s.classList.add("hidden")},c=function(){r&&r.classList.add("hidden"),s&&s.classList.remove("hidden")},h.addEventListener("canplaythrough",function(){20<=a?(n.classList.remove("b-video-background--fade"),h.pause(),c()):(n.classList.add("b-video-background--fade"),a+=1,l())}),u=function(){0===n.offsetHeight?(h.pause(),c()):(h.play(),l())},window.addEventListener("load",function(){u()}),window.addEventListener("resize",function(){u()}),o&&(o.onclick=function(){h.pause(),n.classList.remove("b-video-background--fade"),h.paused&&(o.classList.add("hidden"),c())}))},{}],12:[function(e,t,i){"use strict";var n,o=document.querySelector(".js-cookie-banner");o&&(n=document.querySelector(".js-cookie-banner-close"),document.addEventListener("DOMContentLoaded",function(){o.classList.remove("b-cookie-banner--hidden")},!0),n.onclick=function(e){e.preventDefault(),o.classList.add("b-cookie-banner--hidden")})},{}],13:[function(e,t,i){"use strict";function d(e,i,t,n,o){var r=document.createElement("LI");r.className="b-facet-box__facet-term-toggle",r.innerHTML='<button class="b-facet-box__facet-term-toggle-button"><div class="b-facet-box__facet-term-toggle-checkbox"><svg class="b-facet-box__facet-term-toggle-tick" aria-hidden="true" role="img"><use xlink:href="/assets/svg/vamicons.svg#tick"></use></svg></div><span id="'+i.replace(" ","")+"-"+t.replace(" ","")+'-checkbox-label" class="b-facet-box__facet-term-toggle-text">'+t+'</span><span class="b-facet-box__facet-term-toggle-result">('+o+")</span></button>";var s=r.querySelector("button");s.dataset.id=i.replace(" ","")+"-"+n,s.dataset.facet=e,s.dataset.paramName=i,s.dataset.term=t,s.dataset.value=n,s.dataset.count=o,s.setAttribute("aria-labelledby",i.replace(" ","")+"-"+t.replace(" ","")+"-checkbox-label"),s.setAttribute("role","switch"),s.setAttribute("aria-checked","false");var a=document.createElement("INPUT");return a.type="checkbox",a.className="b-facet-box__hidden-input",a.name=i,a.value=n,a.id=i+"="+n,a.setAttribute("aria-hidden","true"),r.addEventListener("termToggle",function(e){var t=document.querySelector('input[id="'+i+"="+n+'"]');t?(t.click(),t.remove()):(document.querySelector("#vam-etc-search").appendChild(a),document.querySelector('input[id="'+i+"="+n+'"]').checked=!0),e.target.querySelector("."+c).classList.contains(c+"--active")?e.target.setAttribute("aria-checked","false"):e.target.setAttribute("aria-checked","true"),e.target.querySelector("."+c).classList.toggle(c+"--active"),e.detail.refreshing_page||document.querySelector(".b-facet-box").dispatchEvent(new Event("boxChecked",{bubbles:!0}))}),r}function a(e){var u=document.querySelector(".b-facet-box__facet-container"),h=Array.from(e).reduce(function(e,t){var i=t.split("-")[0],n=t.split("-")[1];return e[i]?e[i].push(n):e[i]=[n],e},{});Object.values(v).forEach(function(e){var t,i,o=e.facet,n=e.terms,r=e.paramName,s=e.index,a=document.createElement("DIV");a.className="b-facet-box__facet",a.setAttribute("data-param-name",r),a.innerHTML=(t=o,i=5<n.length,'<button class="b-facet-box__facet-text" data-facet-text="'+t+'">'+t+'</button><ul data-facet="'+t+'" class="b-facet-box__facet-term-container">'+(i?'<li class="b-facet-box__term-more-container"><button data-facet="'+t+'" class="b-facet-box__term-more" aria-label="see more terms of facet '+t+'">See more</button></li>':"")+"</ul>"),a.setAttribute("aria-haspopup","true"),a.setAttribute("aria-expanded","false"),a.addEventListener("click",function(e){e.preventDefault(),e.target.classList.contains(p)&&(e.target.parentNode.setAttribute("aria-expanded",String(!("true"===e.target.parentNode.getAttribute("aria-expanded")))),e.target.classList.toggle(e.target.classList[0]+"--active"),e.target.parentNode.querySelector("."+m).classList.toggle(m+"--active"))});var l=n.map(function(e){return e.value}),c=h[r]&&h[r].reduce(function(e,t){var i=l.indexOf(t);return i<e?e:i},5)||0;c=(c=5*Math.ceil(c/5))>n.length?n.length:c||5,n.slice(s,c).forEach(function(e){var t=e.term,i=e.count,n=e.value;a.querySelector("."+m).appendChild(d(o,r,t,n,i))}),v[o].index+=c,5<n.length&&(v[o].index<n.length?(a.querySelector("."+m).appendChild(a.querySelector(".b-facet-box__term-more-container")),a.querySelector("."+m+" .b-facet-box__term-more").onclick=function(e){e.preventDefault(),function(e){e.preventDefault();var t=e.target.parentNode,o=e.target.parentNode.parentNode,i=v[e.target.dataset.facet],n=i.terms,r=i.index,s=i.facet,a=i.paramName;n.slice(r,r+5).forEach(function(e){var t=e.term,i=e.count,n=e.value;o.appendChild(d(s,a,t,n,i))}),v[s].index+=5,v[s].index<n.length?o.appendChild(t):t.remove(),Array.from(o.querySelectorAll(".b-facet-box__facet-term-toggle-button")).slice(-1)[0].focus()}(e)}):a.querySelector("."+m).appendChild(a.querySelector(".b-facet-box__term-more-container")).remove()),u.appendChild(a)})}function u(e,t){return new CustomEvent("termToggle",{detail:e,bubbles:!(1<arguments.length&&void 0!==t)||t})}function r(){var t=(t=[]).concat(Array.from(document.querySelectorAll(".b-facet-box__term-list button")));return Array.from(document.querySelectorAll(".b-facet-box__facet")).forEach(function(e){t.push(e.querySelector("button")),"true"===e.getAttribute("aria-expanded")&&(t=e.classList.contains("b-facet-box__facet-date")?t.concat(Array.from(e.querySelectorAll("form button, form input"))):t.concat(Array.from(e.querySelectorAll("ul button"))))}),t}function s(e){var t,i,n,o=r();"Escape"===e.key&&(document.querySelector(".b-facet-box").classList.remove("b-facet-box--active"),window.removeEventListener("keydown",s)),9===e.keyCode&&(t=o[0],i=o[o.length-1],n=e.shiftKey,o.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault())))}var n,o="b-facet-box__facet",l=o+"-term-toggle",c=l+"-tick",p=o+"-text",m=o+"-term-container",h="b-facet-box__term-list",g=document.querySelector("."+h),v={};document.querySelector(".b-facet-box")&&(g.addEventListener("termToggle",function(e){var t,i,n,o,r,s,a,l,c;e.stopPropagation(),t=e.detail,s=t.id,a=t.facet,l=t.term,c=t.paramName,s&&((i=Array.from(document.querySelectorAll("button[data-id='"+s+"']")).filter(function(e){return!e.classList.contains("b-facet-box__facet-term-toggle-button")})).length?(i.forEach(function(e){return e.remove()}),document.querySelector(".b-search-form__facets").children.length||document.querySelector(".b-search-form__facet-pane").classList.remove("b-search-form__facet-pane--active")):(n=function(){Array.from(document.querySelectorAll("button[data-id='"+s+"']")).forEach(function(e){return e.dispatchEvent(u({id:s,facet:a,term:l,paramName:c}))})},(o=document.createElement("button")).dataset.id=s,o.className="b-facet-box__term",o.innerHTML='<span class="b-facet-box__term-text">'+a+": "+l+"</span>",o.onclick=function(e){"date_terms"===e.target.closest(".b-facet-box__term").dataset.id&&Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input")).forEach(function(e){e.value=""}),n()},o.classList.add("b-facet-box__term--mobile"),g.appendChild(o),(r=o.cloneNode(!0)).classList.remove("b-facet-box__term--mobile"),r.onclick=function(e){"date_terms"===e.target.closest(".b-facet-box__term").dataset.id&&Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input")).forEach(function(e){e.value=""}),e.preventDefault(),n()},r.classList.add("b-facet-box__term--form"),document.querySelector(".b-search-form__facets")&&document.querySelector(".b-search-form__facets").appendChild(r),document.querySelector(".b-search-form__facet-pane--active")||document.querySelector(".b-search-form__facet-pane").classList.add("b-search-form__facet-pane--active")),window.dispatchEvent(new Event("resize")))}),document.querySelector(".b-facet-box").addEventListener("newFacets",function(e){Object.keys(v).forEach(function(e){return delete v[e]});var t=e.detail,i=t.facets,n=t.activeFacets;i.forEach(function(e){var t,i,n;Object.assign(v,(t={},i=e.facet,n=Object.assign(e,{index:0}),i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t))}),Array.from(document.querySelectorAll(".b-facet-box__hidden-input")).forEach(function(e){return e.remove()});var o=document.querySelector(".b-facet-box__facet-container");o.innerHTML="",g.innerHTML="",a(n);var r=document.createElement("DIV");r.className="b-facet-box__facet b-facet-box__facet-date",r.setAttribute("aria-haspopup","true"),r.setAttribute("aria-expanded","false"),r.innerHTML='<button tabindex="0" class="b-facet-box__facet-text" data-facet-text="dates">Dates</button><div class="b-facet-box__facet-term-container"><span class="b-facet-box__facet-term-container-text">Use a hyphen to indicate dates BC. For example -800 is 800 BC.</span><form class="b-facet-box__facet-date-container"><div class="b-facet-box__facet-date-container-start"><label class="b-facet-box__facet-date-label">From year:</label><input class="b-facet-box__facet-date-input" placeholder="-800" type="number" name="year_made_from"></div><div class="b-facet-box__facet-date-container-end"><label class="b-facet-box__facet-date-label">To year:</label><input class="b-facet-box__facet-date-input" placeholder="2000" type="number" name="year_made_to"></div><div class="b-facet-box__facet-date-container-button"><label class="b-facet-box__facet-date-label">&nbsp;</label><button class="b-facet-box__facet-date-button"><svg class="b-facet-box__facet-date-button-icon" aria-label="apply-date-facet" role="img"><use xlink:href="/assets/svg/vamicons.svg#search"></use></svg></button></div></form><span disabled="false" class="b-facet-box__facet-term-container-text b-facet-box__facet-term-container-text--warning">Please enter both a start and end year.</span></div>',r.querySelector("button").addEventListener("click",function(e){var t;e.preventDefault(),e.target.classList.contains(p)&&(t=r.getAttribute("aria-expanded"),r.setAttribute("aria-expanded","true"===t?"false":"true"),e.target.classList.toggle(e.target.classList[0]+"--active"),e.target.parentNode.querySelector("."+m).classList.toggle(m+"--active"))}),r.querySelector("form").addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation();var i=Array.from(document.querySelectorAll(".b-facet-box__facet-date-container input"));i.forEach(function(e){return e.classList.remove("b-facet-box__facet-date-input--error")});var t,n,o,r,s=i.map(function(e){return e.value});2!==s.filter(function(e){return e.length}).length?(s.forEach(function(e,t){e.length||i[t].classList.add("b-facet-box__facet-date-input--error")}),document.querySelector(".b-facet-box__facet-term-container-text--warning").removeAttribute("disabled")):((t=document.createElement("INPUT")).type="hidden",t.className="b-search-results__hidden-date",document.querySelectorAll(".b-search-results__hidden-date").forEach(function(e){return e.remove()}),n=function(e){return parseInt(e,10)<0?-1*e+" BC":e},document.querySelector('button[data-id="date_terms"]')&&g.dispatchEvent(u({facet:"dates",id:"date_terms",paramName:"date_terms",refreshing_page:!1,term:n(s[0])+" - "+n(s[1])},!0)),document.querySelector(".b-facet-box__facet-term-container-text--warning").setAttribute("disabled","true"),(o=t.cloneNode(!0)).name="year_made_from",o.value=s[0],(r=t.cloneNode(!0)).name="year_made_to",r.value=s[1],document.querySelector("#vam-etc-search").appendChild(o),document.querySelector("#vam-etc-search").appendChild(r),g.dispatchEvent(u({facet:"dates",id:"date_terms",paramName:"date_terms",refreshing_page:!1,term:n(s[0])+" - "+n(s[1])},!0)))}),o.append(r);var s={};n&&Array.from(n).forEach(function(e){var t=document.querySelector("button[data-id='"+e+"'"),i=e.split("-");if(t)t.dispatchEvent(u(Object.assign(t.dataset,{refreshing_page:!0}))),document.querySelector("."+h).dispatchEvent(u(t.dataset));else for(;!document.querySelector("button[data-id='"+e+"']")&&document.querySelector('div[data-param-name="'+i[0]+'"] .b-facet-box__term-more');)document.querySelector('div[data-param-name="'+i[0]+'"] .b-facet-box__term-more').click(),document.querySelector("button[data-id='"+e+"'").dispatchEvent(u(Object.assign(document.querySelector("button[data-id='"+e+"'").dataset,{refreshing_page:!0}))),document.querySelector("."+h).dispatchEvent(u(document.querySelector("button[data-id='"+e+"'").dataset));var n;"year_made_from"!==i[0]&&"year_made_to"!==i[0]||(n=i[0],r.querySelector('input[name="'+n+'"]').value=2!==i.length?"-"+i[2]:i[1],s[n]=2!==i.length?"-"+i[2]:i[1],2===Object.keys(s).length&&r.querySelector("form button").click())}),window.dispatchEvent(new Event("resize"))},!0),document.onclick=function(e){var t;e.target.classList.contains("b-facet-box__close-button")&&(e.preventDefault(),e.target.dispatchEvent(new Event("closeFacetOverlay",{bubbles:!0}))),e.target.closest("."+l+"-button")&&(e.preventDefault(),t=e.target.closest("."+l+"-button"),g.dispatchEvent(u(t.dataset,!1)),t.dispatchEvent(u(t.dataset)))},(n=document.createElement("SPAN")).classList.add("b-facet-box__instruction"),n.setAttribute("aria-live","polite"),n.innerHTML="Use Escape Key to close filters",document.querySelector(".b-facet-box__modal-button-open")&&document.querySelectorAll(".b-facet-box__modal-button-open").forEach(function(e){return e.addEventListener("click",function(e){e.preventDefault(),document.querySelector(".b-facet-box").classList.add("b-facet-box--active"),window.addEventListener("keydown",s),document.querySelector(".b-facet-box").appendChild(n),r()[0].focus()})}),document.querySelector(".b-facet-box__close-button")&&document.querySelector(".b-facet-box__close-button").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".b-facet-box").classList.remove("b-facet-box--active"),window.removeEventListener("keydown",s),document.querySelector(".b-facet-box").removeChild(n)}),window.addEventListener("resize",function(){var t,i,n,e=Array.from(document.querySelectorAll(".b-facet-box__term.b-facet-box__term--form"));document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross")&&(499<window.innerWidth&&window.innerWidth<992?(t=document.querySelector(".b-search-form__facets").offsetWidth,i=0,n=1,e.forEach(function(e){(i+=e.offsetWidth)<t&&(n+=1)}),0<e.length-n?document.querySelector(".b-search-form__facets-mobile").style.display="block":document.querySelector(".b-search-form__facets-mobile").style.display="none",document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross").innerHTML="+"+(e.length-n)):window.innerWidth<500?(0<e.length?document.querySelector(".b-search-form__facets-mobile").style.display="block":document.querySelector(".b-search-form__facets-mobile").style.display="none",document.querySelector(".b-facet-box__term-text.b-facet-box__term-text--no-cross").innerHTML=e.length-1+" filter"+(1<e.length-1?"s":"")+" applied"):document.querySelector(".b-search-form__facets-mobile").style.display="none")}))},{}],14:[function(e,t,i){"use strict";var n,o=e("openseadragon"),r=(n=o)&&n.__esModule?n:{default:n};var s,a,l,c,u,h,d,p,m,g,v,f,y=document.querySelector(".b-image-carousel"),w=document.querySelector(".b-image-carousel__conceal-right"),b=document.querySelector(".b-image-carousel__conceal-left"),_=Array.from(document.querySelectorAll(".b-image-carousel__prev")),x=Array.from(document.querySelectorAll(".b-image-carousel__next")),S=document.querySelector(".b-image-overlay-detail__total-number-of-images"),T=document.querySelector(".b-image-overlay-detail__current-image"),E=document.querySelector(".b-image-overlay__img-ref-number"),P=document.querySelector(".b-image-overlay-detail__copyright-holder"),C=document.querySelector(".b-modal__description-license-contact"),k=document.querySelectorAll(".b-image-overlay-detail__navigation-container > button"),O=document.querySelectorAll(".b-image-carousel__prevnext > button"),R=[];y&&(R=(y.dataset.images?JSON.parse(y.dataset.images):{images:[]}).images),y&&R.length&&(s=function(e){var t=document.querySelectorAll(".b-image-carousel__image-preview-container").length;y.dataset.viewIndex=0<e?e>R.length-t?R.length-t:e:0},a=function(e){y.dataset.index=e},l=R.map(function(e){var t=e.imageId,i=e.alt,n=new Image;return n.src="https://framemark.vam.ac.uk/collections/"+t+"/full/!100,100/0/default.jpg",n.alt="thumbnail for "+i,n.className="b-image-carousel__image-preview",n}),c=function(n){var e=Array.from(document.querySelectorAll(".b-image-carousel__image-preview-container")),o=parseInt(y.dataset.viewIndex,10);e.forEach(function(e,t){var i=o+t;e.classList.remove("b-image-carousel__image-preview-container--selected"),i===parseInt(y.dataset.index,10)&&(e.classList.add("b-image-carousel__image-preview-container--selected"),n&&e.focus()),R[i].alt&&e.setAttribute("aria-label","view "+R[i].alt),e.firstElementChild&&e.firstElementChild.remove(),e.appendChild(l[i]),e.onclick=function(){a(i)}})},u=(0,r.default)({element:document.querySelector("#js-image-overlay__osd"),showHomeControl:!1,showFullPageControl:!1,zoomInButton:"js-image-overlay__zoomin",zoomOutButton:"js-image-overlay__zoomout",showNavigator:!0,navigatorId:"js-image-overlay__zoomnavigator",navigatorDisplayRegionColor:"#b7b8bd",navigatorAutoFade:!1}),(h=document.querySelector("#js-image-overlay__zoomnavigator")).parentNode.parentNode.insertBefore(h,h.parentNode),h.parentNode.removeChild(h.nextSibling),d=document.querySelector(".b-image-overlay-detail__zoom-in"),p=document.querySelector(".b-image-overlay-detail__zoom-out"),document.addEventListener("click",function(e){e.target.closest(".b-image-overlay-detail__zoom-in")?(u.viewport.getZoom()===u.viewport.getMaxZoom()&&d.classList.remove("b-image-overlay-detail__zoom-in--enabled"),p.classList.add("b-image-overlay-detail__zoom-out--enabled")):e.target.closest(".b-image-overlay-detail__zoom-out")&&(u.viewport.getZoom()===u.viewport.getMinZoom()&&p.classList.remove("b-image-overlay-detail__zoom-out--enabled"),d.classList.add("b-image-overlay-detail__zoom-in--enabled"))},!1),m={},new MutationObserver(function(e){var t,i,n,o,r;e.filter(function(e){return"data-view-index"===e.attributeName}).length&&(t=parseInt(y.dataset.viewIndex,10),b.style.display=0<t?"block":"none",w.style.display=t+document.querySelectorAll(".b-image-carousel__image-preview-container").length>=R.length?"none":"block"),e.filter(function(e){return"data-image-id"===e.attributeName}).length&&(i=y.dataset.imageId,-1<(n=R.findIndex(function(e){return e.imageId===i}))&&a(n)),e.filter(function(e){return"data-index"===e.attributeName}).length&&(o=parseInt(y.dataset.index,10),s(o-Math.floor(document.querySelectorAll(".b-image-carousel__image-preview-container").length/2)),r=R[o],m.tileSource="https://framemark.vam.ac.uk/collections/"+r.imageId+"/info.json",u.world.removeAll(),u.addTiledImage(m),u.viewport.fitHorizontally().fitVertically(),C.setAttribute("href","mailto:vaimages@vam.ac.uk?subject=Image reference: "+r.ref),E.innerHTML=r.ref,P.innerHTML=r.copyright,c(!0),991<window.innerWidth?(0<o?O[0].removeAttribute("disabled"):O[0].setAttribute("disabled","true"),o===R.length-1?O[1].setAttribute("disabled","true"):O[1].removeAttribute("disabled")):(0<o?k[0].removeAttribute("disabled"):k[0].setAttribute("disabled","true"),o===R.length-1?k[1].setAttribute("disabled","true"):k[1].removeAttribute("disabled")),T.innerHTML=""+(o+1))}).observe(y,{attributes:!0}),document.addEventListener("keydown",function(){var e,t;document.querySelector(".b-image-overlay__container--active")&&document.activeElement!==u.canvas&&(37!==event.keyCode||0<=(e=parseInt(y.dataset.index,10)-1)&&a(e),39!==event.keyCode||(t=parseInt(y.dataset.index,10)+1)<R.length&&a(t))}),(g=document.createElement("BUTTON")).className="b-image-carousel__image-preview-container",g.innerHTML='<div class="b-image-carousel__image-preview"></div>',v=function(){if(S.innerHTML=R.length,y.dataset.index||(y.dataset.index=0),y.dataset.viewIndex||(y.dataset.viewIndex=0),y)if(window.innerWidth<1200){if(3<document.querySelectorAll(".b-image-carousel__image-preview-container").length||0===document.querySelectorAll(".b-image-carousel__image-preview-container").length){document.querySelector(".b-image-carousel__image-carousel").innerHTML="";for(var e=0;e<3&&e!==R.length;e+=1)document.querySelector(".b-image-carousel__image-carousel").appendChild(g.cloneNode(!0))}}else if(1199<window.innerWidth&&(document.querySelectorAll(".b-image-carousel__image-preview-container").length<5||0===document.querySelectorAll(".b-image-carousel__image-preview-container").length)&&R.length!==document.querySelectorAll(".b-image-carousel__image-preview-container").length){document.querySelector(".b-image-carousel__image-carousel").innerHTML="";for(var t=0;t<5&&t!==R.length;t+=1)document.querySelector(".b-image-carousel__image-carousel").appendChild(g.cloneNode(!0))}},f=function(){window.innerWidth<992&&(k.forEach(function(e){e.removeAttribute("disabled")}),O.forEach(function(e){e.setAttribute("disabled","true")})),991<window.innerWidth&&(k.forEach(function(e){e.setAttribute("disabled","true")}),O.forEach(function(e){e.removeAttribute("disabled")}))},w.onclick=function(){var e=parseInt(y.dataset.viewIndex,10)+1;s(e),c()},b.onclick=function(){var e=parseInt(y.dataset.viewIndex,10)-1;s(e),c()},_.forEach(function(e){e.onclick=function(){var e=parseInt(y.dataset.index,10);a(e-1)}}),x.forEach(function(e){e.onclick=function(){var e=parseInt(y.dataset.index,10);a(e+1)}}),window.addEventListener("resize",function(){v(),a(parseInt(y.dataset.index,10)),f(),y.dataset.index=y.dataset.index,c(),p.classList.add("b-image-overlay-detail__zoom-out--enabled"),d.classList.add("b-image-overlay-detail__zoom-in--enabled")}),f(),v(),y.dataset.index=y.dataset.index,c())},{openseadragon:4}],15:[function(e,t,i){"use strict";var a="b-image-overlay-license-modal",l="__image-modal",n="__agree-to-terms",c="__modal-download-content",u="__modal-contact-content",o="__checkbox-container",r="__agree-checkbox",s="__agree-to-terms-reminder",h="--active",d="--warning",p=["__icon-link-container","__checkmark","__image-icon-link",n],m=document.querySelector("."+a+l),g=document.querySelector(".b-image-overlay")||document.querySelector("body"),v=document.querySelector("."+a+c),f=document.querySelector("."+a+u),y=document.querySelector(".u-link.b-image-overlay-license-modal__download-link.js-modal-action"),w=document.querySelector(".b-icon-link.b-icon-link__download.js-modal-action"),b=document.querySelector(".b-image-overlay-license-modal__close-container");window.addEventListener("click",function(e){var t;e.target.closest(".b-image-overlay-license-modal__close-container")&&(b.disabled=!0,m.classList.remove("b-modal--active"),m.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0}))),e.target.closest("."+a+"__download-button")&&(v.querySelector(".b-image-overlay-license-modal__close-container").disabled=!1,f.querySelector(".b-image-overlay-license-modal__close-container").disabled=!0,t=v.querySelectorAll(".b-image-overlay-license-modal__close-container,.b-image-overlay-license-modal__title-section a,.b-modal__description.b-image-overlay-license-modal__description-container,.b-image-overlay-license-modal__content-container button,.b-image-overlay-license-modal__footer-section a"),g.classList.add("b-image-overlay--unfocus"),m.dispatchEvent(new CustomEvent("jsModalOpen",{bubbles:!0})),m.classList.add("b-modal--active"),b.disabled=!1,v.classList.add(a+c+h),f.classList.remove(a+u+h),t[0].focus()),e.target.closest("."+a+"__contact-button")&&(v.querySelector(".b-image-overlay-license-modal__close-container").disabled=!0,f.querySelector(".b-image-overlay-license-modal__close-container").disabled=!1,g.classList.add("b-image-overlay--unfocus"),m.dispatchEvent(new CustomEvent("jsModalOpen",{bubbles:!0})),m.classList.add("b-modal--active"),b.disabled=!1,v.classList.remove(a+c+h),f.classList.add(a+u+h),document.querySelector(".b-modal__description-license-contact").focus()),e.target.closest("."+a+"__contact-modal-open")&&(v.classList.remove(a+c+h),f.classList.add(a+u+h),document.querySelector(".b-modal__description-license-contact").focus()),e.target.closest("."+a+o)&&e.target.closest("."+a+n)===document.querySelector("."+a+n)&&(document.querySelector("."+a+r).checked=!document.querySelector("."+a+r).checked,document.querySelector("."+a+n).classList.remove(a+n+d),document.querySelector("."+a+r).checked?(document.querySelector("."+a+s).style.display="none",p.forEach(function(e){return document.querySelector("."+a+e)&&document.querySelector("."+a+e).classList.add(a+e+"--active")}),document.querySelector(".b-image-overlay-license-modal__download-link .b-icon-link").classList.add("b-icon-link--active"),y.setAttribute("data-tracking-collections","image download"),w.setAttribute("data-tracking-collections","image download")):(p.forEach(function(e){return document.querySelector("."+a+e)&&document.querySelector("."+a+e).classList.remove(a+e+"--active")}),document.querySelector(".b-image-overlay-license-modal__download-link .b-icon-link").classList.remove("b-icon-link--active"),y.removeAttribute("data-tracking-collections"),w.removeAttribute("data-tracking-collections"))),e.target.closest("."+a+o)&&(document.querySelector("."+a+r).checked||(document.querySelector("."+a+s).style.display="block",document.querySelector("."+a+n).classList.add(a+n+d)))}),window.addEventListener("keydown",function(e){var t,i,n,o,r=document.querySelector("."+a+l+".b-modal--active"),s=document.querySelector("."+a+c+"."+a+c+h)||document.querySelector("."+a+u+"."+a+u+h);return r&&9===e.keyCode&&(i=(t=s.querySelectorAll(".b-image-overlay-license-modal__close-container,.b-image-overlay-license-modal__title-section a,.b-modal__description.b-image-overlay-license-modal__description-container,.b-image-overlay-license-modal__content-container button,.b-image-overlay-license-modal__footer-section a"))[0],n=t[t.length-1],o=e.shiftKey,t.length&&(o&&document.activeElement===i?(1===t.length?i.focus():n.focus(),e.preventDefault()):o||document.activeElement!==n||(i.focus(),e.preventDefault()))),13===e.keyCode&&document.activeElement.classList.contains("b-image-overlay-license-modal__contact-modal-open")&&document.activeElement.click(),!r||27!==e.keyCode||(m.classList.remove("b-modal--active"),m.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0})),e.preventDefault(),e.stopPropagation(),!1)})},{}],16:[function(e,t,i){"use strict";var n,o=e("browser-cookies"),l=(n=o)&&n.__esModule?n:{default:n};var r=document.querySelectorAll(".js-modal");function c(e,t){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"myClick",category:e,action:t})}Array.from(r,function(o){function r(){o.setAttribute("tabindex","-1"),o.setAttribute("aria-hidden","true"),c(t,"pop-up dismissed"),o.dispatchEvent(new CustomEvent("jsModalClosed",{bubbles:!0})),o.classList.remove("b-modal--active")}function s(e){var t,i,n;9===e.keyCode&&(t=a[0],i=a[a.length-1],n=e.shiftKey,a.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault()))),"Escape"===e.key&&(o.removeEventListener("keydown",s),r())}var t=o.dataset.modalCampaign,a=o.querySelectorAll("a");return o.dataset.modalOnceOnly&&l.default.get(t)||o.dataset.notOnLoad||(document.body.appendChild(o),o.setAttribute("tabindex","0"),o.removeAttribute("aria-hidden"),o.classList.add("b-modal--active"),c(t,"pop-up displayed"),o.focus(),a[1].focus(),o.addEventListener("keydown",s)),o.addEventListener("click",function(e){o.dataset.modalOnceOnly&&l.default.set(t,"seen",{domain:o.dataset.modalDomain,expires:365}),e.target!==o&&(Array.from(e.target.classList).find(function(e){return"js-modal-action"===e})||e.target.closest(".js-modal-action")?c(t,"clicked: "+e.target.textContent):(o.removeEventListener("keydown",s),r()))}),!0})},{"browser-cookies":1}],17:[function(e,t,i){"use strict";Array.from(document.querySelectorAll(".js-newsletter_form"),function(a){return a.addEventListener("submit",function(e){e.preventDefault();var t,i=a.querySelector(".js-emailValidation"),n=a.querySelector(".js-newsletter__descriptor"),o=a.querySelector(".js-newsletter__submit"),r=new XMLHttpRequest,s="";t=i.value,/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(t)?(r||a.submit(),Array.from(a.querySelectorAll("input"),function(e){return s+=e.name+"="+encodeURIComponent(e.value)+"&",!0}),r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?(o.value="Thank you!",n.innerHTML="A confirmation email will be sent to this address shortly&hellip;",a.classList.remove("invalid"),a.classList.add("sent")):a.submit())},r.open("POST",a.action),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(s)):(n.innerHTML="That doesn't look like an email address&hellip;",a.classList.add("invalid"),a.querySelector(".b-newsletter__form-fields-field").setAttribute("aria-invalid","true"))}),!0})},{}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){Array.from(document.querySelectorAll(".b-object-card__warning"),function(e){return e.innerHTML='<div class="b-object-card__warning__banner"><div class="b-object-card__warning__banner__text">This object, or the text that describes it, is deemed offensive and discriminatory. We are committed to improving our records, and work is ongoing.</div><div class="b-object-card__warning__banner__dismiss">View record</div></div>'+e.innerHTML+"",!0})},document.addEventListener("click",function(e){return!e.target.closest(".b-object-card__warning")||(e.preventDefault(),e.stopImmediatePropagation(),e.target.closest(".b-object-card__warning").classList.remove("b-object-card__warning"),!1)},!1)},{}],19:[function(e,t,i){"use strict";var n=document.createElement("DIV"),o=["etc-details__cell-concealer","etc-details__cell-revealer"],r=['<span class="etc-details__cell-concealer-text">Read More</span><button class="etc-details__cell-concealer-button">+</button>','<span class="etc-details__cell-concealer-text">Read Less</span><button class="etc-details__cell-concealer-button">-</button>'];function s(e){var t="etc-details__cell-free-content--hidden",i=e.target.parentElement.querySelector(".etc-details__cell-free-content"),n=i.classList.contains(t);e.target.innerHTML=r[n?1:0],e.target.className=o[n?1:0],n?(i.classList.remove(t),e.target.setAttribute("data-tracking-collections","read less")):(i.classList.add(t),e.target.setAttribute("data-tracking-collections","read more"))}n.className=o[0],n.innerHTML=r[0],n.setAttribute("data-tracking-collections","read more"),Array.from(document.querySelectorAll(".etc-details__cell-free")).forEach(function(e){var t;200<e.offsetHeight&&(e.querySelector(".etc-details__cell-free-content").classList.add("etc-details__cell-free-content--hidden"),(t=n.cloneNode(!0)).onclick=s,e.appendChild(t))})},{}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=function(){var r,f,y=Array.from(document.querySelectorAll(".js-object-image-overlay-item"));y.length&&(r=document.querySelector(".b-object-image-overlay")||document.createElement("div"),document.body.appendChild(r),r.classList.add("b-object-image-overlay"),r.innerHTML='<button class="b-object-image-overlay__dismiss" title="Close" aria-label="Close"></button><div class="b-object-image-overlay__items"></div>',f=r.querySelector(".b-object-image-overlay__items"),r.addItem=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=y[e]||y[0],n=i.dataset.objectImageOverlay?JSON.parse(i.dataset.objectImageOverlay):null,o=n&&n.museumNumber?'Museum number: <span itemprop="identifier">'+n.museumNumber+"</span>":"",r=n&&n.copyright?'<br/><span itemprop="copyrightHolder">'+n.copyright+"</span>":"",s=o||r?'<div class="b-object-image-overlay__numbercopyright">'+o+""+r+"</div>":"",a=n&&n.onDisplay?'<div class="b-object-image-overlay__location-status"><svg role="img" viewBox="0 0 52 52"><path d="M51.59 25.348C45.15 15.57 35.838 10 26 10S6.851 15.57.41 25.348L0 26l.41.652C6.85 36.43 16.162 42 26 42s19.149-5.57 25.59-15.348L52 26l-.41-.652zM25.5 35c-5.225 0-9.5-4.275-9.5-9.5s4.275-9.5 9.5-9.5 9.5 4.275 9.5 9.5-4.275 9.5-9.5 9.5z" fill="currentColor"/></svg>On display</div>':"",l="";n&&n.onDisplay?l=(l=n.displayOverride)||(n.locationSite?'<div class="b-object-image-overlay__location-site">'+n.locationSite+"</div>":"")+(n.locationRoom?n.locationRoom:""):n&&null!==n.onDisplay&&!n.onDisplay&&(l=n.storageOverride||"This object is currently not on display");var c=n&&n.visitUrl?'<a tabindex="-1" class="b-object-image-overlay__visit" href="'+n.visitUrl+'" data-tracking-oic="visit the object">Find out how to visit this object</a>':"",u=l||c?'<div class="b-object-image-overlay__location">'+a+'<div class="b-object-image-overlay__location-copy">'+l+"</div>"+c+"</div>":"",h=i.querySelector("a").getAttribute("href"),d=i.querySelector("img"),p=d?'<img class="b-object-image-overlay__image"itemprop="contentUrl"alt="'+d.alt+'"sizes="(max-width: 991px) calc(100vw - 20px),(min-width: 992px) calc(70vw - 145px),(min-width: 1200px) 710px"srcset="'+d.srcset+'"src="'+d.src+'">':'<div class="s-lazyload--error"></div>',m=1<h.length?'<br/><a tabindex="-1" class="b-object-image-overlay__cta b-object-image-overlay__cta--screen" href="'+h+'" data-tracking-oic="explore the object">Explore object in more depth</a>':"",g=1<h.length?'<a tabindex="-1" class="b-object-image-overlay__cta b-object-image-overlay__cta--mobile" href="'+h+'" data-tracking-oic="explore the object">Explore object in more depth</a>':"",v=document.createElement("div");v.classList.add("b-object-image-overlay__item"),v.innerHTML+='<div class="b-object-image-overlay__content"><figure class="b-object-image-overlay__figure">'+p+'<figcaption class="b-object-image-overlay__figcaption">'+s+'<div class="b-object-image-overlay__prevnext"><button disabled class="b-object-image-overlay__prev b-object-image-overlay__prev--disabled" title="Previous" aria-label="Previous" data-tracking-oic="previous object"><svg role="img" viewBox="0 0 100 100"><path fill="none" d="M-1-1h582v402H-1z"/><path d="M70.173 12.294L57.446.174l-47.62 50 47.62 50 12.727-12.122-36.075-37.879z" fill="currentColor"/></svg></button><button disabled class="b-object-image-overlay__next b-object-image-overlay__next--disabled" title="Next" aria-label="Next" data-tracking-oic="next object"><svg role="img" viewBox="0 0 100 100"><path fill="none" d="M-1-1h582v402H-1z"/><path d="M20 88.052l12.727 12.121 47.62-50-47.62-50L20 12.294l36.075 37.88z" fill="currentColor"/></svg></button></div></figcaption></figure><div class="b-object-image-overlay__details"><div class="b-object-image-overlay__caption">'+i.querySelector("figcaption").textContent+""+m+"</div>"+u+""+g+"</div></div>",t?f.insertBefore(v,f.firstElementChild):f.appendChild(v)},r.getIndex=function(t){return y.findIndex(function(e){return e===t})},r.clipItem=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0]?f.lastElementChild.remove():f.firstElementChild.remove()},r.buttonInit=function(e){r.querySelectorAll("button").forEach(function(e){return e.setAttribute("disabled",!0)}),r.querySelectorAll("a").forEach(function(e){return e.setAttribute("tabindex","-1")}),991<window.innerWidth&&r.querySelector(".b-object-image-overlay__dismiss").removeAttribute("disabled"),r.querySelector(".b-object-image-overlay__dismiss").removeAttribute("disabled");var t=document.querySelectorAll(".b-object-image-overlay__item")[1],i=t.querySelector(".b-object-image-overlay__prev"),n=t.querySelector(".b-object-image-overlay__next");991<window.innerWidth&&(0<r._index&&(i.classList.add("b-object-image-overlay__prev--enabled"),i.removeAttribute("disabled")),r._index<y.length-1&&(n.classList.add("b-object-image-overlay__next--enabled"),n.removeAttribute("disabled"))),t.querySelectorAll("a").forEach(function(e){return e.removeAttribute("tabindex")}),991<window.innerWidth?t.querySelector(".b-object-image-overlay__cta--mobile")&&(t.querySelector(".b-object-image-overlay__cta--mobile").setAttribute("tabindex",-1),t.querySelector(".b-object-image-overlay__cta--screen").removeAttribute("tabindex")):t.querySelector(".b-object-image-overlay__cta--screen")&&(t.querySelector(".b-object-image-overlay__cta--screen").setAttribute("tabindex",-1),t.querySelector(".b-object-image-overlay__cta--mobile").removeAttribute("tabindex")),r.focusable=[document.querySelector(".b-object-image-overlay__dismiss")].concat(Array.from(t.querySelectorAll('button:not([disabled]), a:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])')));function o(e,t,i){e?e.focus():t?t.focus():i.focus()}e?e&&o(t.querySelector(".b-object-image-overlay__prev:not([disabled]"),t.querySelector(".b-object-image-overlay__next:not([disabled]"),r.focusable[0]):o(t.querySelector(".b-object-image-overlay__next:not([disabled]"),t.querySelector(".b-object-image-overlay__prev:not([disabled]"),r.focusable[0])},r.advance=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(!e&&r._index<y.length-1||e&&0<r._index)&&(r.clipItem(e),r.addItem(r._index+2*(e?-1:1),e),r._index+=e?-1:1,r.track(r._index)),r.buttonInit(e)},r.track=function(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"OIC",object:y[e].querySelector("figcaption").textContent.trim(),museumNumber:JSON.parse(y[e].dataset.objectImageOverlay).museumNumber})},document.addEventListener("click",function(e){var t,i,o;e.target.closest(".js-object-image-overlay-item")&&(e.preventDefault(),t=e.target.closest(".js-object-image-overlay-item"),r._index=r.getIndex(t),r.addItem(r._index),r.classList.add("b-object-image-overlay--active"),r.addItem(r._index+1),r.addItem(r._index-1,!0),r.focus(),r.track(r._index),r.buttonInit(),document.body.style.overflow="hidden",i=function(e){var t,i,n;"ArrowLeft"===e.key?(e.preventDefault(),r.advance(!0)):"ArrowRight"===e.key?(e.preventDefault(),r.advance()):"Escape"===e.key||"Esc"===e.key?o():9===e.keyCode&&(t=r.focusable[0],i=r.focusable[r.focusable.length-1],n=e.shiftKey,r.focusable.length&&(n&&document.activeElement===t?(i.focus(),e.preventDefault()):n||document.activeElement!==i||(t.focus(),e.preventDefault())))},o=function(){r.classList.remove("b-object-image-overlay--active"),document.body.style.overflow="",f.innerHTML="",r.onclick=null,document.removeEventListener("keydown",i,!1)},document.addEventListener("keydown",i,!1),r.onclick=function(e){e.target.matches(".b-object-image-overlay__item, .b-object-image-overlay__dismiss")?(e.preventDefault(),o()):e.target.closest(".b-object-image-overlay__next--enabled")?(e.preventDefault(),r.advance()):e.target.closest(".b-object-image-overlay__prev--enabled")&&(e.preventDefault(),r.advance(!0))})},!1))}},{}],21:[function(e,t,i){"use strict";var p,n,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};p={init:function(e){for(var r=JSON.parse(e.dataset.objectShuffler),s=e.querySelector(".b-object-shuffler__tabs"),a=s.removeChild(s.querySelector(".b-object-shuffler__tab")),t=e.querySelector(".b-object-shuffler__deck"),l=t.firstElementChild.firstElementChild,i=l.firstElementChild,c=p.setSize(l),n=parseFloat(window.getComputedStyle(l).getPropertyValue("transition-duration")),u=parseFloat(window.getComputedStyle(i).getPropertyValue("transition-duration")),o=1;o<r.length;o+=1)t.parentNode.appendChild(t.cloneNode(!0));var h=0;Array.from(e.querySelectorAll(".b-object-shuffler__deck"),function(o){return o._props={deckTitle:r[h].title||"",slideSize:c,itemsData:r[h].data||[],itemsExclude:r[h].exclude||null,itemsDataFeed:encodeURI(r[h].feed),itemsIndex:0,transitionDurationItem:n,transitionDurationImg:u},p.getData(o).then(function(){if(o._props.itemsData.length<1.5*c)return o.parentNode.removeChild(o),!1;var e=s.appendChild(a.cloneNode(!0));e.className="b-object-shuffler__tab",e.title=""+o._props.deckTitle,e.setAttribute("tabindex","0"),e.setAttribute("aria-hidden",!1),e.dataset.trackingCollections="you may also like carousel",e._deck=o,e===e.parentNode.firstElementChild&&(e.setAttribute("active",!0),e._deck.setAttribute("active",!0));for(var t=o.firstElementChild,i=1;i<c;i+=1)t.appendChild(l.cloneNode(!0));t.removeAttribute("active");var n=p.newSlide(o);n.setAttribute("active",!0),p.newSlide(o),n.closest(".b-object-shuffler__deck[active]")&&p.tabIndexSlide(n),h===r.length&&1===h&&(s.removeChild(s.firstElementChild),s.classList.add("b-object-shuffler__tabs--void"))}),h+=1,!0}),document.addEventListener("click",function(e){var t,i;e.target.closest(".b-object-shuffler__tab")&&(t=e.target,(i=s.querySelector("[active]"))&&(i.removeAttribute("active"),i._deck.removeAttribute("active"),p.tabIndexSlide(i._deck.querySelector(".b-object-shuffler__slide[active]"),!1)),t.setAttribute("active",!0),t._deck.setAttribute("active",!0),p.tabIndexSlide(t._deck.querySelector(".b-object-shuffler__slide[active]")))},!1);var d=e.querySelector(".b-object-shuffler__more-icon");d.addEventListener("click",function(){p.nextSlide(e.querySelector(".b-object-shuffler__deck[active]")),d.setAttribute("active",!0)},!1),d.addEventListener("animationend",function(){d.removeAttribute("active")},!1)},setSize:function(e){return 2*Math.floor(e.parentNode.getBoundingClientRect().width/e.getBoundingClientRect().width)},getData:function(n){var e=2*n._props.slideSize;if(n._props.itemsData.length<n._props.itemsIndex+e){n._props.apiPage=n._props.apiPage+1||1;var t=n._props.itemsDataFeed+"&page_size="+e+"&page="+n._props.apiPage;return fetch(t).then(function(e){return e.json()}).then(function(e){Array.from(e.records,function(e){var t,i;return e.systemNumber!==n._props.itemsExclude&&(t=e._images._iiif_image_base_url+"full/",i=e._primaryTitle||"untitled "+e.objectType,n._props.itemsData.push({img:{srcset:t+"250,/0/default.jpg 250w, "+t+"350,/0/default.jpg 350w, "+t+"450,/0/default.jpg 450w, "+t+"550,/0/default.jpg 550w, "+t+"700,/0/default.jpg 700w, "+t+"900,/0/default.jpg 900w",src:t+"350,/0/default.jpg",alt:i},title:i,href:"/item/"+e.systemNumber+"/"})),!0})}).catch(function(e){return console.error(e.name,e.message)})}return Promise.resolve(!0)},newSlide:function(h){var e=h.appendChild(h.firstElementChild.cloneNode(!0));return Array.from(e.children,function(e){var t=h._props.itemsIndex%h._props.itemsData.length,i=e.querySelector("img");e.title=h._props.itemsData[t].title,e.href=h._props.itemsData[t].href,e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden",!0),e.dataset.trackingCollections="you may also like object",i.alt=h._props.itemsData[t].img.alt,i.classList.remove("s-lazyload--abort"),i.onerror=function(){return i.classList.add("s-lazyload--abort"),!0},i.srcset=h._props.itemsData[t].img.srcset,i.src=h._props.itemsData[t].img.src;var n=.1*Math.random(),o=1+(0<h._props.itemsIndex%2?1:-1)*n,r=h._props.itemsIndex%h._props.slideSize,s=r>h._props.slideSize/2-1?-1:1,a=r%(h._props.slideSize/2)*(100/(h._props.slideSize/2)),l=r<h._props.slideSize/2?0:50,c=34*n*1,u=s*n*74;return e.style.width="auto",e.style.height=50*o+"%",e.style.position="absolute",e.style.left=a+c+"%",e.style.top=l+u+"%",e.style.setProperty("--js-rotation",5*Math.sin(2*Math.random()*Math.PI)+"deg"),e.style.transitionDuration=h._props.transitionDurationItem*o*o+"s",i.style.transitionDuration=h._props.transitionDurationImg*o*o+"s",h._props.itemsIndex+=1,!0}),p.getData(h),e},nextSlide:function(e){p.newSlide(e),e.firstElementChild.remove();var t=e.querySelector("[active]");t.removeAttribute("active"),p.tabIndexSlide(t,!1),t.nextSibling.setAttribute("active",!0),p.tabIndexSlide(t.nextSibling)},tabIndexSlide:function(e,t){var i=!(1<arguments.length&&void 0!==t)||t;Array.from(e.children,function(e){return e.setAttribute("tabindex",i?"0":"-1"),e.setAttribute("aria-hidden",!i),!0})}},n=null,"IntersectionObserver"in window&&(n=new IntersectionObserver(function(e){var t,i=o(e,1)[0];0<i.intersectionRatio&&(t=i.target,n.unobserve(t),t.initialised||(p.init(t),t.initialised=!0))},{rootMargin:"0px 0px 1000px 0px"})),document.addEventListener("DOMContentLoaded",function(){Array.from(document.querySelectorAll(".js-object-shuffler"),function(t){try{n.observe(t)}catch(e){p.init(t)}return!0})},!0)},{}],22:[function(e,t,i){"use strict";Array.from(document.querySelectorAll(".js-search-site, .js-search-etc-gateway"),function(o){var e,t,i,n,r,s,a,l=o.querySelector(".b-search-form__input");return o.classList.contains("js-search-site")?(o._props={type:"siteSearch"},e=o.querySelector(".b-search-form__underscore"),t=o.querySelector(".b-search-form__submit"),i=o.querySelector(".b-search-form__clear"),n=function(){e.innerHTML=l.value.replace(/\s/g,"&nbsp;")},l.value.length?i.classList.remove("b-search-form__clear--hidden"):t.classList.add("b-search-form__submit--hidden"),n(),l.addEventListener("input",function(){n(),i.classList.add("b-search-form__clear--hidden"),l.value.length?t.classList.remove("b-search-form__submit--hidden"):t.classList.add("b-search-form__submit--hidden")},!1),i.addEventListener("click",function(){i.classList.add("b-search-form__clear--hidden"),l.value="",n()},!1)):o.classList.contains("js-search-etc-gateway")&&(o._props={type:"etcGatewaySearch",suggestionsTop:"https://collections.vam.ac.uk/assets/data/suggestions.json",suggestionsAPI:"https://api.vam.ac.uk/v2/sayt/search"},r=function(e){window.dataLayer.push({event:e.target.tracking.event,eventCategory:e.target.tracking.eventCategory,eventAction:e.target.tracking.eventAction,eventLabel:e.target.tracking.eventLabel})},s=o.querySelector(".b-search-form__suggestions"),a=function(e,t){var i,n,o=document.createElement("a");s.childElementCount<10&&(i=t.displayName||t.displayTerm,n="https://collections.vam.ac.uk/search/?id_"+t.recordType+"="+t.systemNumber,o.className="b-search-form__suggestion",o.href=n,o.tabindex=0,o.innerHTML='<div class="b-search-form__suggestion-type">'+t.recordType+"</div>"+i+"",o.tracking={event:"autosuggest EtC landing",eventCategory:"search - autosuggest - "+t.index,eventAction:e,eventLabel:n},o.addEventListener("click",r),s.appendChild(o))},function(i){i._props.storedSuggestions=JSON.parse(sessionStorage.getItem("storedSuggestions_"+i._props.type));var n=new Date;return!i._props.storedSuggestions||n.getTime()>i._props.storedSuggestions.expires?fetch(i._props.suggestionsTop,{cache:"no-cache"}).then(function(e){return e.json()}).then(function(e){var t={expires:n.getTime()+9e5,data:e};i._props.storedSuggestions=t,sessionStorage.setItem("storedSuggestions_"+i._props.type,JSON.stringify(i._props.storedSuggestions))}).catch(function(e){return console.error(e.name,e.message)}):Promise.resolve(!0)}(o).then(function(){var n=null;l.addEventListener("input",function(){var e,t,i;o.removeAttribute("suggesting"),s.innerHTML="",l.value.length&&(e=l.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),t="(^|\\|)",2<l.value.length&&(t="\\b"),i=new RegExp(""+t+e+".*","i"),Array.from(o._props.storedSuggestions.data,function(e){return Array.from(e.suggestions,function(e){var t=e.displayName;return i.test(t)&&(o.setAttribute("suggesting",!0),a(l.value,e)),!0}),!0}),4<l.value.length&&(n&&n.abort(),n=new window.AbortController,setTimeout(function(){return n.abort()},500),fetch(o._props.suggestionsAPI+"?q="+encodeURI(e)+"&page_size=10",{signal:n.signal}).then(function(e){return e.json()}).then(function(e){0<e.info.record_count&&(o.setAttribute("suggesting",!0),Array.from(e.records,function(e){return a(l.value,e),!0}))}).catch(function(e){return console.error(e.name,e.message)})))},!1)}).catch(function(e){return console.error(e.name,e.message)}),document.addEventListener("keydown",function(e){13===e.keyCode&&document.activeElement.closest(".b-search-form__filter-toggle")&&document.activeElement.click()}),document.addEventListener("click",function(e){var t,i,n;e.target.closest(".b-search-form__filter-toggle")&&((t=e.target.closest(".b-search-form__filter-toggle-set")).toggleAttribute("active"),n=(i=Array.from(document.querySelectorAll(".b-search-form__filter-toggle"))).indexOf(document.querySelector('[tabindex="0"]')),i[n].setAttribute("tabindex",-1),i[n].setAttribute("aria-hidden",!0),i[[1,0][n]].setAttribute("tabindex",0),i[[1,0][n]].removeAttribute("aria-hidden"),Array.from(t.querySelectorAll("input"),function(e){return!(e.value="")}))},!1)),!0})},{}],23:[function(e,t,i){"use strict";var l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function h(e){return Object.entries(e).reduce(function(e,t){var i,n,o,r=l(t,2),s=r[0],a=r[1];return Object.assign(e,(o=+a,(n=s)in(i={})?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i))},{})}function d(e,t){e.dataset.pageIndex=t,e.value=t,e.innerHTML=""+(t+1<11?0:"")+t,e.ariaLabel="Go to page "+t}function p(){var e,t,i,n=h(m.dataset),o=n.pageIndex,r=n.pageSize,s=n.totalCount;s<r?document.querySelector(".b-search-pagination__display-counter").innerHTML="":(t=r*(e=o-1)+1,i=r*e+r,document.querySelector(".b-search-pagination__display-counter").innerHTML=""+t+" - "+(s<i?s:i)+" of "+s+"")}var m=document.querySelector(".b-search-pagination"),g=Array.from(document.querySelectorAll(".b-search-pagination__page-button")),v=Array.from(document.querySelectorAll(".b-search-pagination__page-button-seperator")),f=document.querySelector(".b-search-pagination__prev-link"),y=document.querySelector(".b-search-pagination__next-link"),w=document.querySelector(".b-search-pagination__page-button-seperator-start"),b=document.querySelector(".b-search-pagination__page-button-seperator-last"),o=document.querySelector('input[name="page"]'),r=document.querySelector('input[name="page_size"]'),_="b-search-pagination__page-button--current";m&&(m.addEventListener("click",function(e){var t,i,n=e.target;return(n.closest(".b-search-pagination__page-button")||n.closest(".b-search-pagination__prev-link")||n.closest(".b-search-pagination__next-link"))&&!n.getAttribute("disabled")&&(t=n.dataset.pageIndex,m.dataset.pageIndex=t,o.value=t,window.setTimeout(function(){return o.dispatchEvent(new Event("change"))},100)),n.closest(".b-search-pagination__page-size")&&(i=n.dataset.pageSize,document.querySelector(".b-search-pagination__page-size--active").classList.toggle("b-search-pagination__page-size--active"),n.classList.add("b-search-pagination__page-size--active"),m.dataset.pageSize=i,r.value=i,window.setTimeout(function(){return r.dispatchEvent(new Event("change"))},100),p()),!1}),new MutationObserver(function(e){var i,t,n,o,r,s,a,l,c,u;e.filter(function(e){return"data-page-size"===e.attributeName}).length&&document.querySelector('button[data-page-size="'+m.dataset.pageSize+'"]')&&(document.querySelector(".b-search-pagination__page-size--active").classList.remove("b-search-pagination__page-size--active"),document.querySelector('button[data-page-size="'+m.dataset.pageSize+'"]').classList.add("b-search-pagination__page-size--active"),p()),e.filter(function(e){return"data-pages"===e.attributeName}).length&&(i=h(m.dataset).pages,g.forEach(function(e,t){i-1<t?e.setAttribute("disabled",!0):e.removeAttribute("disabled"),d(e,t+1)}),v.forEach(function(e){e.setAttribute("disabled",!0)}),t=g.slice(g.filter(function(e){return!e.getAttribute("disabled")}).length-1)[0],d(t,i),m.dataset.pageIndex=m.dataset.pageIndex),e.filter(function(e){return"data-page-index"===e.attributeName}).length&&(n=h(m.dataset),o=n.pageIndex,r=n.pages,s=document.querySelector("."+_),a=2<o&&o<r-1&&5<r,o<3&&(w.setAttribute("disabled","true"),g.slice(1)[0].removeAttribute("disabled","true"),r<6?b.setAttribute("disabled","true"):(g.slice(3)[0].setAttribute("disabled","true"),b.removeAttribute("disabled"))),r-3<o&&5<r&&(w.removeAttribute("disabled"),b.setAttribute("disabled","true"),g.slice(3)[0].setAttribute("disabled","true"),g.slice(1)[0].removeAttribute("disabled")),a&&(g.slice(3)[0].removeAttribute("disabled"),g.slice(1)[0].removeAttribute("disabled"),w.removeAttribute("disabled"),b.removeAttribute("disabled")),5<r&&g.slice(1,4).filter(function(e){return!e.getAttribute("disabled")}).forEach(function(e,t){d(e,t+(o<3?2:0)+(a?o-1:0)+(r-1<=o?r-2:0))}),s.classList.remove(_),g.filter(function(e){return+e.dataset.pageIndex===o})[0].classList.add(_),p(),l=h(m.dataset),c=l.pageIndex,u=l.pages,f.dataset.pageIndex=c-1,y.dataset.pageIndex=c+1,+f.dataset.pageIndex<1?f.setAttribute("disabled",!0):f.removeAttribute("disabled"),+y.dataset.pageIndex>u?y.setAttribute("disabled",!0):y.removeAttribute("disabled")),e.filter(function(e){return"data-total-count"===e.attributeName}).length&&p()}).observe(m,{attributes:!0}),m.dataset.pages=m.dataset.pages,m.dataset.totalCount=m.dataset.totalCount,m.dataset.pageIndex=m.dataset.pageIndex)},{}],24:[function(e,t,i){"use strict";function n(){Array.from(document.querySelectorAll(".js-search-result-text"),function(e){return function(e){e.dataset.fulltext||(e.dataset.fulltext=e.innerHTML);var t,i,n,o,r,s=e.dataset.fulltext;e.innerHTML=s,10<e.scrollHeight-e.clientHeight&&(i=s.indexOf("&lt;/em&gt;")-(t=e.clientHeight/e.scrollHeight*s.length),n=0,o=s.lastIndexOf(" ",t),r="",0<i&&(r="&hellip;",n=s.indexOf(" ",20+i)+1,o=s.lastIndexOf(" ",t+i+20)),e.innerHTML=""+r+s.substring(n,o)+"&hellip;")}(e),!0})}n(),window.addEventListener("resize",n,!1)},{}],25:[function(e,t,i){"use strict";function o(){Array.from(document.querySelectorAll(".b-search-results__offensive-warning")).forEach(function(e){var t=Array.from(document.querySelectorAll(".b-search-results__body-row"))[e.getAttribute("data-row-index")],i=(t.offsetHeight-e.offsetHeight)/2;e.style.top=t.offsetTop+i+"px",e.style.left="5px"})}function n(){Array.from(document.querySelectorAll(".b-search-results__body-row")).forEach(function(e,t){var i,n;e.classList.contains("b-search-results__body-row--offensive")&&((i=document.createElement("DIV")).className="b-search-results__offensive-warning",i.innerHTML='<div class="b-search-results__offensive-warning-text">This object, or the text that describes it, is deemed offensive and discriminatory. We are committed to improving our records, and work is ongoing.</br><button class="b-search-results__offensive-warning-button">View record</button></div>',n=(e.offsetHeight-i.offsetHeight)/2,i.style.top=e.offsetTop+n+"px",i.setAttribute("data-row-index",t),i.onclick=function(e){return Array.from(document.querySelectorAll(".b-search-results__body-row"))[e.target.parentElement.getAttribute("data-row-index")].classList.remove("b-search-results__body-row--offensive"),e.target.parentElement.remove(),o(),e.stopPropagation(),!1},e.parentElement.appendChild(i),o())}),o()}window.addEventListener("resize",function(){o()}),n(),document.querySelector(".etc-template__results-container")&&(document.querySelector(".etc-template__results-container").addEventListener("initWarnings",function(){n()}),document.querySelector(".etc-template__results-container").addEventListener("initSorts",function(){Array.from(document.querySelectorAll(".b-search-results__head-cell")).forEach(function(e){parseInt(e.dataset.sortable,10)&&(e.onclick=function(e){return t=e.target,i=t.dataset.value,n=document.querySelector(".b-search-results__hidden-input-order-by"),o=document.querySelector(".b-search-results__hidden-input-order-sort"),r="b-search-results__head-cell--sort-asc",s={"b-search-results__head-cell--sort-asc":"b-search-results__head-cell--sort-desc","b-search-results__head-cell--sort-desc":"b-search-results__head-cell--sort-none"}[Array.from(t.classList)[2]],Array.from(document.querySelectorAll(".b-search-results__head-cell")).forEach(function(e){e.classList.remove("b-search-results__head-cell--sort-desc"),e.classList.remove("b-search-results__head-cell--sort-asc"),e.classList.remove("b-search-results__head-cell--sort-none")}),s?"b-search-results__head-cell--sort-desc"===s?o.value="desc":"b-search-results__head-cell--sort-none"===s&&(n.value="",o.value="asc"):(t.classList.add(r),n.value=i),t.classList.add(s||r),void t.dispatchEvent(new Event("change",{bubbles:!0}));var t,i,n,o,r,s})})}),document.querySelector(".etc-template__results-container").dispatchEvent(new Event("initSorts")))},{}],26:[function(e,t,i){"use strict";var n,o=e("browser-cookies"),r=(n=o)&&n.__esModule?n:{default:n};var s,a,l,c,u,h,d,p,m,g,v,f,y,w,b,_,x,S,T,E,P,C,k,O=document.querySelector(".b-site-nav");O&&(s=O.querySelectorAll(".js-site-nav__mobile-toggle"),a=O.querySelector(".js-site-nav__mobile-toggle--icon"),l=O.querySelector(".js-site-nav__mobile-toggle-text"),c=O.querySelectorAll(".js-site-nav-bag"),u=O.querySelector(".js-site-nav-search-btn"),h=O.querySelector(".js-site-nav-search"),d=h.querySelector(".b-search-form__input"),p=h.querySelector(".js-search-content"),m=h.querySelector(".js-search-suggest"),g=r.default.get("basketCount"),v=O.querySelector(".js-site-nav__tablet-toggle"),g&&0<g&&(Array.from(c,function(e){return e.classList.remove("b-site-nav__bag--hidden"),e.querySelector(".js-site-nav-bag-total").innerHTML=g<100?g:"",!0}),l.classList.add("b-site-nav__mobile-toggle-text--hidden")),a&&"none"!==window.getComputedStyle(a).display&&(k=!(P=function(e){60<e?a.classList.add("b-site-nav__mobile-toggle--solo"):a.classList.remove("b-site-nav__mobile-toggle--solo")}),window.addEventListener("scroll",function(e){return e.preventDefault(),C=window.pageYOffset,k||window.requestAnimationFrame(function(){P.call(void 0,C),k=!1}),k=!0},!1)),v&&v.addEventListener("click",function(e){e.preventDefault(),document.querySelector(".js-site-nav-more").classList.toggle("active")},!1),f=function(e){e?(h.classList.add("b-site-nav__core__search--active"),document.body.style.overflow="hidden",d.setSelectionRange(100,100)):(h.classList.remove("b-site-nav__core__search--active"),document.body.style.overflow="")},Array.from(s,function(e){function t(e){"Tab"!==e.key&&9!==e.keyCode||(document.activeElement===i&&e.shiftKey?(e.preventDefault(),n.focus()):document.activeElement!==n||e.shiftKey||(e.preventDefault(),i.focus()))}var i=a,n=O.querySelector(".b-site-nav__core__item:nth-last-child(2)>a");return e.addEventListener("click",function(e){e.preventDefault(),O.classList.contains("b-site-nav--open")?(O.classList.remove("b-site-nav--open"),O.setAttribute("aria-expanded","false"),document.removeEventListener("keydown",t,!1),f(!1)):(O.classList.add("b-site-nav--open"),O.setAttribute("aria-expanded","true"),document.addEventListener("keydown",t,!1),f(!0))},!1),!0}),u&&(y=d,b=function(e){"Tab"!==e.key&&9!==e.keyCode||(document.activeElement===y&&e.shiftKey?(e.preventDefault(),w.focus()):document.activeElement!==w||e.shiftKey||(e.preventDefault(),y.focus()))},(w=u).addEventListener("click",function(e){e.preventDefault(),u.classList.contains("b-site-nav__core__search-btn--active")?(u.classList.remove("b-site-nav__core__search-btn--active"),document.removeEventListener("keydown",b,!1),f(!1)):(u.classList.add("b-site-nav__core__search-btn--active"),document.addEventListener("keydown",b,!1),f(!0))},!1)),_=0===document.location.host.indexOf("localhost")?"https://www.vam.ac.uk/":"/",(!(x=JSON.parse(sessionStorage.getItem("storedSearch")))||Date.parse(new Date)>Date.parse(x.expires))&&((S=new XMLHttpRequest).open("GET",_+"services/search/suggest/promoted"),S.send(),S.onreadystatechange=function(){var e,t;S.readyState===XMLHttpRequest.DONE&&200===S.status&&(e=new Date,t={expires:new Date(e.setMinutes(e.getMinutes()+15)),results:S.responseText},sessionStorage.setItem("storedSearch",JSON.stringify(t)),x=JSON.parse(sessionStorage.getItem("storedSearch")))}),T=function(){window.dataLayer.push({event:"autosuggest search",eventCategory:(void 0).tracking.eventCategory,eventAction:(void 0).tracking.eventAction,eventLabel:(void 0).tracking.eventLabel})},E=function(i,e,n,o){var r=null,s=null,a=null;JSON.parse(e).forEach(function(e){for(r=0;r<e.suggestions.length;r+=1){var t;s=e.suggestions[r].title,e.suggestions[r].terms&&(s=e.suggestions[r].terms.join("|")),i.test(s)&&(p.classList.remove("b-site-nav__core__search__container--hidden"),a=e.suggestions[r].icon?e.suggestions[r].icon:"https://s3-eu-west-1.amazonaws.com/vanda-production-assets/static/search/result_placeholder.jpg",t=document.createElement("li"),o&&t.classList.add("js-live-result"),t.innerHTML='<div class="b-search-result-auto-suggest"><a class="b-search-result-auto-suggest-content"href="'+e.suggestions[r].url+'"><img class="b-search-result-auto-suggest-image"src="'+a+'"alt=""aria-hidden="true"><div class="b-search-result-auto-suggest-text"><div class="b-search-result-auto-suggest-content-type">'+e.suggestions[r].type+'</div><div class="b-search-result-auto-suggest-title">'+e.suggestions[r].title+"</div></div></a></div>",t.tracking={eventCategory:"search - autosuggest - "+e.suggestions[r].type,eventAction:n,eventLabel:e.suggestions[r].url},t.addEventListener("click",T),m.appendChild(t))}})},d&&d.addEventListener("input",function(){var e,t,i,n;d.value.length<42&&(p.classList.add("b-site-nav__core__search__container--hidden"),m.innerHTML="",d.value.length&&(e="(^|\\|)",2<d.value.length&&(e="\\b"),t=d.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i=new RegExp(""+e+t+".*","i"),E(i,x.results,d.value,!1),4<d.value.length&&((n=new XMLHttpRequest).open("GET",_+"services/search/suggest/popular?q="+encodeURI(d.value)),n.send(),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status&&(Array.from(m.querySelectorAll(".js-live-result"),function(e){return e.remove(),!0}),E(i,n.responseText,d.value,!0))})))},!1))},{"browser-cookies":1}],27:[function(e,t,i){"use strict";var n,o=e("querystring"),r=(n=o)&&n.__esModule?n:{default:n};var s,a,l=document.querySelector(".js-toggle-nav");l&&(s=l.querySelectorAll(".js-toggle-nav-btn"),a=r.default.parse(window.location.search.replace("?","")).type,Array.from(s,function(i){var n=document.querySelectorAll(i.dataset.toggeesSelector);return i.addEventListener("click",function(e){e.preventDefault();var t=i.dataset.toggleType;l.scrollLeft=i.offsetLeft-(l.getBoundingClientRect().width-i.getBoundingClientRect().width)/2,i.preventHistoryPush||window.history.pushState({toggleNavType:t},"","?type="+t),i.preventHistoryPush=!1,Array.from(n,function(e){return e.style.display="none",e.dataset.toggleType===t&&(e.style.display="block"),!0}),Array.from(s,function(e){return e.classList.remove("b-toggle-nav__button--active"),!0}),i.classList.add("b-toggle-nav__button--active")},!1),i.dataset.toggleType===a&&(i.preventHistoryPush=!0,setTimeout(function(){i.click()},50)),!0}),window.addEventListener("popstate",function(t){return t.state&&t.state.toggleNavType&&Array.from(s,function(e){return t.state.toggleNavType===e.dataset.toggleType&&(e.preventHistoryPush=!0,e.click()),!0}),!0},!1),a||void 0===l.dataset.toggleTypeDefault||document.querySelector("[data-toggle-type="+l.dataset.toggleTypeDefault+"]").click())},{querystring:7}],28:[function(e,t,i){"use strict";var n=document.querySelectorAll(".js-video-thumbnail");Array.from(n,function(n){return n.addEventListener("click",function(e){e.preventDefault();var t=document.createElement("div"),i=document.createElement("div");t.className="b-video-thumbnail__popup",t.innerHTML='<iframe class="b-video-thumbnail__popup-iframe" width="90%" height="90%" src="'+n.href+'"&playsinline=1" frameborder="0" allowfullscreen></iframe>',t.addEventListener("click",function(){t.remove()}),i.className="b-video-thumbnail__popup-close",i.innerHTML='<svg role="img" id="close" viewBox="0 0 100 100"><path d="M50 39.254L10.749 0 0 10.742l39.251 39.254L0 89.251 10.749 100 50 60.746 89.251 100 100 89.243 60.749 49.99 100 10.734 89.244 0 49.992 39.254z" fill="currentColor" fill-rule="evenodd"/></svg>',t.appendChild(i),document.body.appendChild(t)}),!0})},{}],29:[function(e,t,i){"use strict";var n,o,r=document.querySelector(".js-video-trailer");r&&(n=r.querySelector(".js-video-trailer-preview"),o=document.createElement("div"),r.addEventListener("click",function(e){e.preventDefault(),o.className="b-video-trailer__image",o.innerHTML='<iframe class="" width="100%" height="100%" src="'+r.href+'"&playsinline=1" frameborder="0" allowfullscreen></iframe>',n.remove(),r.appendChild(o),o.style.height=.5625*o.offsetWidth+"px"}),window.addEventListener("resize",function(){o.style.height=.5625*o.offsetWidth+"px"}))},{}],30:[function(e,t,i){"use strict";var n=document.querySelectorAll(".js-grid-reveal-more");n.length&&(Array.from(n,function(n){var e,o,t,i,r,s,a=n.dataset.revealMoreCounter||4;return a<n.childElementCount&&(e=n.dataset.iconUrl,o=[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n.children)),t=n.dataset.revealMoreTheme||"dark",i=n.dataset.revealMoreTracking||"",(r=n).dataset.revealMorePutAfter&&(r=document.querySelector(n.dataset.revealMorePutAfter)),o.slice(a).forEach(function(e){return e.classList.add("s-visually-hidden")}),(s=document.createElement("footer")).setAttribute("class","b-block-grid__footer b-block-grid__footer--"+t),s.innerHTML='<a href="#" aria-label="show more" data-tracking-showmorebutton="'+i+'" class="js-reveal-more-btn"><div class="b-icon-badge b-icon-badge--small b-icon-badge--'+t+'"><div class="b-icon-badge__icon s-themed s-themed--background-color s-themed--background-color--hover"><svg aria-hidden="true"><use xlink:href="'+e+'#plus"></use></svg></div><small class="b-icon-badge__label">Show more</small></div></a>',r.parentNode.insertBefore(s,r.nextSibling),n.revealMoreClicks=0,s.addEventListener("click",function(e){e.preventDefault(),n.revealMoreClicks+=1;var t,i=o.filter(function(e){return e.classList.contains("s-visually-hidden")});1<window.getComputedStyle(n).getPropertyValue("column-count")&&((t=i[0].parentNode.insertBefore(i[0].cloneNode(!1),i[0])).classList.remove("s-visually-hidden"),t.classList.add("b-block-grid__cols-restarter")),i.slice(0,a).forEach(function(e){return e.classList.remove("s-visually-hidden")}),i.length<=a&&s.remove()},!1)),!0}),window.addEventListener("beforeunload",function(){var t=[];Array.from(n,function(e){return t.push(e.revealMoreClicks),!0}),history.replaceState({revealMoreClicks:t},"revealMoreClicks")},!1),window.addEventListener("load",function(){if(history.state&&history.state.revealMoreClicks)for(var e=document.querySelectorAll(".js-reveal-more-btn"),t=0;t<history.state.revealMoreClicks.length;t+=1)for(var i=0;i<history.state.revealMoreClicks[t];)e[t].click(),i+=1},!1))},{}],31:[function(e,t,i){"use strict";document.querySelector(".b-facet-box-modal__button")&&(document.querySelector(".b-facet-box-modal__button").onclick=function(e){document.querySelector(".b-facet-box-modal__container").classList.toggle("b-facet-box-modal__container--active"),e.preventDefault()}),document.querySelector(".b-facet-box-modal__button")&&document.addEventListener("closeFacetOverlay",function(){return document.querySelector(".b-facet-box-modal__container").classList.toggle("b-facet-box-modal__container--active")})},{}],32:[function(e,t,i){"use strict";function n(){s.classList.add("b-image-overlay__container--active"),a.style.overflowY="hidden",s.style.height=window.innerHeight+"px",window.innerWidth<=1e3&&o.any()?(a.style.position="fixed",l.style.marginBottom=screen.height-window.innerHeight+"px"):l.style.marginBottom="0px",document.querySelector(".b-image-carousel__image-preview-container").focus()}function r(){document.querySelector(".b-image-overlay__container").classList.remove("b-image-overlay__container--active"),document.querySelector("body").style.overflowY="auto",document.querySelector("body").style.position="relative"}var o={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return o.Android()||o.BlackBerry()||o.iOS()||o.Opera()||o.Windows()}},s=document.querySelector(".b-image-overlay__container"),a=document.querySelector("body"),l=document.querySelector(".b-image-overlay__figcaption");document.querySelector(".b-image-overlay__preview-concealer")&&(document.querySelector(".b-image-overlay__preview-concealer").onclick=function(e){e.stopPropagation()},document.querySelector(".b-image-overlay__preview-concealer-button").onclick=function(e){e.stopPropagation(),document.querySelector(".b-image-overlay__preview--offensive").classList.remove("b-image-overlay__preview--offensive"),document.querySelector(".b-image-overlay__preview-image--offensive").classList.remove("b-image-overlay__preview-image--offensive"),document.querySelector(".b-image-overlay__preview-concealer").remove(),document.querySelectorAll(".b-image-overlay__preview--hidden").forEach(function(e){return e.classList.remove("b-image-overlay__preview--hidden")})}),document.querySelector(".b-image-overlay")&&(document.querySelector(".b-image-overlay__close-container").onclick=r,window.addEventListener("resize",function(){s.style.height=window.innerHeight+"px",window.innerWidth<=1e3&&o.any()?l.style.marginBottom=screen.height-window.innerHeight+"px":l.style.marginBottom="0px"}),window.addEventListener("keydown",function(e){var t,i,n,o;27===e.keyCode&&(document.querySelector(".b-image-overlay").classList.contains("b-image-overlay--unfocus")?document.querySelector(".b-image-overlay").classList.remove("b-image-overlay--unfocus"):r()),document.querySelector(".b-image-overlay").classList.contains("b-image-overlay--unfocus")||9!==e.keyCode||(i=(t=Array.from(document.querySelector(".b-image-overlay__content").querySelectorAll("button")).filter(function(e){return!e.getAttribute("disabled")}).filter(function(e){return!e.closest(".js-modal")}).filter(function(e){return 0<e.offsetHeight}))[0],n=t[t.length-1],o=e.shiftKey,t.length&&(o&&document.activeElement===i?(n.focus(),e.preventDefault()):o||document.activeElement!==n||(i.focus(),e.preventDefault())))}),document.querySelector(".b-image-overlay").addEventListener("openObjectOverlay",n),document.querySelector(".b-image-overlay__container").addEventListener("jsModalOpen",function(){document.querySelector(".b-image-overlay__close-container").style.display="none"}),document.querySelector(".b-image-overlay__container").addEventListener("jsModalClosed",function(){document.querySelector(".b-image-overlay__close-container").style.display="block"}),Array.from(document.querySelectorAll(".b-image-overlay__preview")).forEach(function(e){e.onclick=function(e){e.preventDefault(),e.target.classList.contains("b-image-overlay__preview--offensive")||e.target.dispatchEvent(new CustomEvent("openObjectOverlay",{bubbles:!0}))}}),document.addEventListener("click",function(e){e.target.closest(".b-image-overlay__figcaption__handle")&&l.classList.toggle("b-image-overlay__figcaption--shut")},!1))},{}],33:[function(e,t,i){"use strict";var n,o=e("clamp-js"),r=(n=o)&&n.__esModule?n:{default:n};function s(){var e=Array.from(document.querySelectorAll(".b-story-box__content-text"));499<window.innerWidth?e.forEach(function(e){(0,r.default)(e,{clamp:"auto",splitOnChars:[".",","," "]})}):e.forEach(function(e){e.style.display="none"})}document.querySelector(".b-story-box")&&(function(){var n=Array.from(document.querySelectorAll(".b-story-box")),o=Array.from(document.querySelectorAll(".b-story-box--column"));2<n.length&&document.querySelector(".b-story-box-container__reveal-container").classList.add("b-story-box-container__reveal-container--active"),n.slice(0,2).forEach(function(e){e.classList.add("b-story-box--active")});var e=document.querySelector(".b-story-box-container__reveal-btn");e&&(e.onclick=function(){var e,t,i=Array.from(document.querySelectorAll(".b-story-box--active")).length;return Array.from(document.querySelectorAll(".b-story-box")).slice(i,i+2).forEach(function(e){e.classList.add("b-story-box--active")}),Array.from(document.querySelectorAll(".b-story-box--active")).length===n.length?document.querySelector(".b-story-box-container__reveal-container").classList.remove("b-story-box-container__reveal-container--active"):(e=o.slice(i-1,i+2).map(function(e){return e.querySelector(".b-story-box__content-text")}),t=e[e[0].offsetHeight>e[1].offsetHeight?0:1].offsetHeight,e.forEach(function(e){e.style.height=t+"px"})),s(),!1})}(),s(),window.addEventListener("resize",function(){s()}))},{"clamp-js":2}],34:[function(e,t,i){"use strict";"undefined"!=typeof Modernizr&&Modernizr.on("objectfit",function(e){var t;e||(t=document.querySelectorAll(".js-object-fit-container"),[].forEach.call(t,function(t){var i;t.getElementsByTagName("img")[0]&&(i=t.getElementsByTagName("img")[0]).addEventListener("load",function(){var e=i.src;e&&(t.classList.add("js-object-fit-container--fallback"),t.style.backgroundImage="url('"+e+"')")})}))})},{}]},{},[10]);
//# sourceMappingURL=vamscript.js.map
